var ur=Object.defineProperty,cr=Object.defineProperties;var lr=Object.getOwnPropertyDescriptors;var $n=Object.getOwnPropertySymbols;var mr=Object.prototype.hasOwnProperty,dr=Object.prototype.propertyIsEnumerable;var ei=(i,e,t)=>e in i?ur(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Z=(i,e)=>{for(var t in e||(e={}))mr.call(e,t)&&ei(i,t,e[t]);if($n)for(var t of $n(e))dr.call(e,t)&&ei(i,t,e[t]);return i},ee=(i,e)=>cr(i,lr(e));import{PublicKey as mA}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as fA,TOKEN_2022_PROGRAM_ID as bA,createTransferInstruction as yA}from"@solana/spl-token";import{get as ti,set as pr}from"lodash";var cn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ni={},fr={};function ie(i){let e=ti(ni,i);if(!e){let t=ti(fr,i);e=new cn({name:i,logLevel:t}),pr(ni,i,e)}return e}import{PublicKey as Io}from"@solana/web3.js";import So from"bn.js";import To from"big.js";import Ht from"bn.js";import Se from"bn.js";var At=9e15,rt=1e9,ln="0123456789abcdef",Dt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Vt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",mn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-At,maxE:At,crypto:!1},si,He,W=!0,qt="[DecimalError] ",it=qt+"Invalid argument: ",ai=qt+"Precision limit exceeded",ui=qt+"crypto unavailable",ci="[object Decimal]",he=Math.floor,me=Math.pow,br=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,yr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,gr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,li=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ve=1e7,v=7,Ar=9007199254740991,Pr=Dt.length-1,dn=Vt.length-1,P={toStringTag:ci};P.absoluteValue=P.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),O(i)};P.ceil=function(){return O(new this.constructor(this),this.e+1,2)};P.clampedTo=P.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(it+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};P.comparedTo=P.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};P.cosine=P.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+v,n.rounding=1,t=kr(n,bi(n,t)),n.precision=i,n.rounding=e,O(He==2||He==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};P.cubeRoot=P.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,m=this,l=m.constructor;if(!m.isFinite()||m.isZero())return new l(m);for(W=!1,o=m.s*me(m.s*m,1/3),!o||Math.abs(o)==1/0?(t=Pe(m.d),i=m.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=me(t,1/3),i=he((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new l(t),n.s=m.s):n=new l(o.toString()),s=(i=l.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(m),n=ne(c.plus(m).times(a),c.plus(u),s+2,1),Pe(a.d).slice(0,s)===(t=Pe(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(O(a,i+1,0),a.times(a).times(a).eq(m))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(O(n,i+1,1),e=!n.times(n).times(n).eq(m));break}return W=!0,O(n,i,l.rounding,e)};P.decimalPlaces=P.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-he(this.e/v))*v,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};P.dividedBy=P.div=function(i){return ne(this,new this.constructor(i))};P.dividedToIntegerBy=P.divToInt=function(i){var e=this,t=e.constructor;return O(ne(e,new t(i),0,1,1),t.precision,t.rounding)};P.equals=P.eq=function(i){return this.cmp(i)===0};P.floor=function(){return O(new this.constructor(this),this.e+1,3)};P.greaterThan=P.gt=function(i){return this.cmp(i)>0};P.greaterThanOrEqualTo=P.gte=function(i){var e=this.cmp(i);return e==1||e===0};P.hyperbolicCosine=P.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Ut(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=Pt(s,1,o.times(e),new s(1),!0);for(var u,c=i,m=new s(8);c--;)u=o.times(o),o=a.minus(u.times(m.minus(u.times(m))));return O(o,s.precision=t,s.rounding=n,!0)};P.hyperbolicSine=P.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=Pt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Ut(5,i)),r=Pt(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,O(r,e,t,!0)};P.hyperbolicTangent=P.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,ne(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};P.inverseCosine=P.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?_e(t,r,o):new t(0):new t(NaN):e.isZero()?_e(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=_e(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};P.inverseHyperbolicCosine=P.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,W=!1,t=t.times(t).minus(1).sqrt().plus(t),W=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};P.inverseHyperbolicSine=P.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,W=!1,t=t.times(t).plus(1).sqrt().plus(t),W=!0,n.precision=i,n.rounding=e,t.ln())};P.inverseHyperbolicTangent=P.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?O(new o(r),i,e,!0):(o.precision=t=n-r.e,r=ne(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};P.inverseSine=P.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=_e(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};P.inverseTangent=P.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,m=c.constructor,l=m.precision,d=m.rounding;if(c.isFinite()){if(c.isZero())return new m(c);if(c.abs().eq(1)&&l+4<=dn)return s=_e(m,l+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new m(NaN);if(l+4<=dn)return s=_e(m,l+4,d).times(.5),s.s=c.s,s}for(m.precision=a=l+10,m.rounding=1,t=Math.min(28,a/v+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(W=!1,e=Math.ceil(a/v),n=1,u=c.times(c),s=new m(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),W=!0,O(s,m.precision=l,m.rounding=d,!0)};P.isFinite=function(){return!!this.d};P.isInteger=P.isInt=function(){return!!this.d&&he(this.e/v)>this.d.length-2};P.isNaN=function(){return!this.s};P.isNegative=P.isNeg=function(){return this.s<0};P.isPositive=P.isPos=function(){return this.s>0};P.isZero=function(){return!!this.d&&this.d[0]===0};P.lessThan=P.lt=function(i){return this.cmp(i)<0};P.lessThanOrEqualTo=P.lte=function(i){return this.cmp(i)<1};P.logarithm=P.log=function(i){var e,t,n,r,o,s,a,u,c=this,m=c.constructor,l=m.precision,d=m.rounding,p=5;if(i==null)i=new m(10),e=!0;else{if(i=new m(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new m(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new m(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(W=!1,a=l+p,s=nt(c,a),n=e?Wt(m,a+10):nt(i,a),u=ne(s,n,a,1),Tt(u.d,r=l,d))do if(a+=10,s=nt(c,a),n=e?Wt(m,a+10):nt(i,a),u=ne(s,n,a,1),!o){+Pe(u.d).slice(r+1,r+15)+1==1e14&&(u=O(u,l+1,0));break}while(Tt(u.d,r+=10,d));return W=!0,O(u,l,d)};P.minus=P.sub=function(i){var e,t,n,r,o,s,a,u,c,m,l,d,p=this,g=p.constructor;if(i=new g(i),!p.d||!i.d)return!p.s||!i.s?i=new g(NaN):p.d?i.s=-i.s:i=new g(i.d||p.s!==i.s?p:NaN),i;if(p.s!=i.s)return i.s=-i.s,p.plus(i);if(c=p.d,d=i.d,a=g.precision,u=g.rounding,!c[0]||!d[0]){if(d[0])i.s=-i.s;else if(c[0])i=new g(p);else return new g(u===3?-0:0);return W?O(i,a,u):i}if(t=he(i.e/v),m=he(p.e/v),c=c.slice(),o=m-t,o){for(l=o<0,l?(e=c,o=-o,s=d.length):(e=d,t=m,s=c.length),n=Math.max(Math.ceil(a/v),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,l=n<s,l&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){l=c[n]<d[n];break}o=0}for(l&&(e=c,c=d,d=e,i.s=-i.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(r=n;r&&c[--r]===0;)c[r]=ve-1;--c[r],c[n]+=ve}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=Gt(c,t),W?O(i,a,u):i):new g(u===3?-0:0)};P.modulo=P.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?O(new n(t),n.precision,n.rounding):(W=!1,n.modulo==9?(e=ne(t,i.abs(),0,3,1),e.s*=i.s):e=ne(t,i,0,n.modulo,1),e=e.times(i),W=!0,t.minus(e))};P.naturalExponential=P.exp=function(){return pn(this)};P.naturalLogarithm=P.ln=function(){return nt(this)};P.negated=P.neg=function(){var i=new this.constructor(this);return i.s=-i.s,O(i)};P.plus=P.add=function(i){var e,t,n,r,o,s,a,u,c,m,l=this,d=l.constructor;if(i=new d(i),!l.d||!i.d)return!l.s||!i.s?i=new d(NaN):l.d||(i=new d(i.d||l.s===i.s?l:NaN)),i;if(l.s!=i.s)return i.s=-i.s,l.minus(i);if(c=l.d,m=i.d,a=d.precision,u=d.rounding,!c[0]||!m[0])return m[0]||(i=new d(l)),W?O(i,a,u):i;if(o=he(l.e/v),n=he(i.e/v),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=m.length):(t=m,n=o,s=c.length),o=Math.ceil(a/v),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=m.length,s-r<0&&(r=s,t=m,m=c,c=t),e=0;r;)e=(c[--r]=c[r]+m[r]+e)/ve|0,c[r]%=ve;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=Gt(c,n),W?O(i,a,u):i};P.precision=P.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(it+i);return t.d?(e=mi(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};P.round=function(){var i=this,e=i.constructor;return O(new e(i),i.e+1,e.rounding)};P.sine=P.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+v,n.rounding=1,t=hr(n,bi(n,t)),n.precision=i,n.rounding=e,O(He>2?t.neg():t,i,e,!0)):new n(NaN)};P.squareRoot=P.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,m=s.constructor;if(c!==1||!a||!a[0])return new m(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(W=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=Pe(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=he((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new m(e)):n=new m(c.toString()),t=(u=m.precision)+3;;)if(o=n,n=o.plus(ne(s,o,t+2,1)).times(.5),Pe(o.d).slice(0,t)===(e=Pe(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(O(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(O(n,u+1,1),i=!n.times(n).eq(s));break}return W=!0,O(n,u,m.rounding,i)};P.tangent=P.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=ne(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,O(He==2||He==4?t.neg():t,i,e,!0)):new n(NaN)};P.times=P.mul=function(i){var e,t,n,r,o,s,a,u,c,m=this,l=m.constructor,d=m.d,p=(i=new l(i)).d;if(i.s*=m.s,!d||!d[0]||!p||!p[0])return new l(!i.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?i.s/0:i.s*0);for(t=he(m.e/v)+he(i.e/v),u=d.length,c=p.length,u<c&&(o=d,d=p,p=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+p[n]*d[r-n-1]+e,o[r--]=a%ve|0,e=a/ve|0;o[r]=(o[r]+e)%ve|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=Gt(o,t),W?O(i,l.precision,l.rounding):i};P.toBinary=function(i,e){return bn(this,2,i,e)};P.toDecimalPlaces=P.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Ie(i,0,rt),e===void 0?e=n.rounding:Ie(e,0,8),O(t,i+t.e+1,e))};P.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=ze(n,!0):(Ie(i,0,rt),e===void 0?e=r.rounding:Ie(e,0,8),n=O(new r(n),i+1,e),t=ze(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};P.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=ze(r):(Ie(i,0,rt),e===void 0?e=o.rounding:Ie(e,0,8),n=O(new o(r),i+r.e+1,e),t=ze(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};P.toFraction=function(i){var e,t,n,r,o,s,a,u,c,m,l,d,p=this,g=p.d,f=p.constructor;if(!g)return new f(p);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=mi(g)-p.e-1,s=o%v,e.d[0]=me(10,s<0?v+s:s),i==null)i=o>0?e:c;else{if(a=new f(i),!a.isInt()||a.lt(c))throw Error(it+a);i=a.gt(e)?o>0?e:c:a}for(W=!1,a=new f(Pe(g)),m=f.precision,f.precision=o=g.length*v*2;l=ne(a,e,0,1,1),r=t.plus(l.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(l.times(r)),u=r,r=e,e=a.minus(l.times(r)),a=r;return r=ne(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=p.s,d=ne(c,n,o,1).minus(p).abs().cmp(ne(u,t,o,1).minus(p).abs())<1?[c,n]:[u,t],f.precision=m,W=!0,d};P.toHexadecimal=P.toHex=function(i,e){return bn(this,16,i,e)};P.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Ie(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(W=!1,t=ne(t,i,0,e,1).times(i),W=!0,O(t)):(i.s=t.s,t=i),t};P.toNumber=function(){return+this};P.toOctal=function(i,e){return bn(this,8,i,e)};P.toPower=P.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(me(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return O(a,n,o);if(e=he(i.e/v),e>=i.d.length-1&&(t=c<0?-c:c)<=Ar)return r=di(u,a,t,n),i.s<0?new u(1).div(r):O(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=me(+a,c),e=t==0||!isFinite(t)?he(c*(Math.log("0."+Pe(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(W=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=pn(i.times(nt(a,n+t)),n),r.d&&(r=O(r,n+5,1),Tt(r.d,n,o)&&(e=n+10,r=O(pn(i.times(nt(a,e+t)),e),e+5,1),+Pe(r.d).slice(n+1,n+15)+1==1e14&&(r=O(r,n+1,0)))),r.s=s,W=!0,u.rounding=o,O(r,n,o))};P.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=ze(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Ie(i,1,rt),e===void 0?e=r.rounding:Ie(e,0,8),n=O(new r(n),i,e),t=ze(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};P.toSignificantDigits=P.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Ie(i,1,rt),e===void 0?e=n.rounding:Ie(e,0,8)),O(new n(t),i,e)};P.toString=function(){var i=this,e=i.constructor,t=ze(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};P.truncated=P.trunc=function(){return O(new this.constructor(this),this.e+1,1)};P.valueOf=P.toJSON=function(){var i=this,e=i.constructor,t=ze(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function Pe(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=v-n.length,t&&(o+=tt(t)),o+=n;s=i[e],n=s+"",t=v-n.length,t&&(o+=tt(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ie(i,e,t){if(i!==~~i||i<e||i>t)throw Error(it+i)}function Tt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=v,r=0):(r=Math.ceil((e+1)/v),e%=v),o=me(10,v-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==me(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==me(10,e-3)-1,s}function vt(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=ln.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function kr(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Ut(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=Pt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var ne=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,m,l,d,p,g,f,y,A,T,w,C,V,B,F,L,H,h,_,ye,le=n.constructor,xe=n.s==r.s?1:-1,ae=n.d,$=r.d;if(!ae||!ae[0]||!$||!$[0])return new le(!n.s||!r.s||(ae?$&&ae[0]==$[0]:!$)?NaN:ae&&ae[0]==0||!$?xe*0:xe/0);for(u?(p=1,m=n.e-r.e):(u=ve,p=v,m=he(n.e/p)-he(r.e/p)),_=$.length,H=ae.length,A=new le(xe),T=A.d=[],l=0;$[l]==(ae[l]||0);l++);if($[l]>(ae[l]||0)&&m--,o==null?(B=o=le.precision,s=le.rounding):a?B=o+(n.e-r.e)+1:B=o,B<0)T.push(1),g=!0;else{if(B=B/p+2|0,l=0,_==1){for(d=0,$=$[0],B++;(l<H||d)&&B--;l++)F=d*u+(ae[l]||0),T[l]=F/$|0,d=F%$|0;g=d||l<H}else{for(d=u/($[0]+1)|0,d>1&&($=i($,d,u),ae=i(ae,d,u),_=$.length,H=ae.length),L=_,w=ae.slice(0,_),C=w.length;C<_;)w[C++]=0;ye=$.slice(),ye.unshift(0),h=$[0],$[1]>=u/2&&++h;do d=0,c=e($,w,_,C),c<0?(V=w[0],_!=C&&(V=V*u+(w[1]||0)),d=V/h|0,d>1?(d>=u&&(d=u-1),f=i($,d,u),y=f.length,C=w.length,c=e(f,w,y,C),c==1&&(d--,t(f,_<y?ye:$,y,u))):(d==0&&(c=d=1),f=$.slice()),y=f.length,y<C&&f.unshift(0),t(w,f,C,u),c==-1&&(C=w.length,c=e($,w,_,C),c<1&&(d++,t(w,_<C?ye:$,C,u))),C=w.length):c===0&&(d++,w=[0]),T[l++]=d,c&&w[0]?w[C++]=ae[L]||0:(w=[ae[L]],C=1);while((L++<H||w[0]!==void 0)&&B--);g=w[0]!==void 0}T[0]||T.shift()}if(p==1)A.e=m,si=g;else{for(l=1,d=T[0];d>=10;d/=10)l++;A.e=l+m*p-1,O(A,a?o+A.e+1:o,s,g)}return A}}();function O(i,e,t,n){var r,o,s,a,u,c,m,l,d,p=i.constructor;e:if(e!=null){if(l=i.d,!l)return i;for(r=1,a=l[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=v,s=e,m=l[d=0],u=m/me(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/v),a=l.length,d>=a)if(n){for(;a++<=d;)l.push(0);m=u=0,r=1,o%=v,s=o-v+1}else break e;else{for(m=a=l[d],r=1;a>=10;a/=10)r++;o%=v,s=o-v+r,u=s<0?0:m/me(10,r-s-1)%10|0}if(n=n||e<0||l[d+1]!==void 0||(s<0?m:m%me(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?m/me(10,r-s):0:l[d-1])%10&1||t==(i.s<0?8:7)),e<1||!l[0])return l.length=0,c?(e-=i.e+1,l[0]=me(10,(v-e%v)%v),i.e=-e||0):l[0]=i.e=0,i;if(o==0?(l.length=d,a=1,d--):(l.length=d+1,a=me(10,v-o),l[d]=s>0?(m/me(10,r-s)%me(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=l[0];s>=10;s/=10)o++;for(s=l[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,l[0]==ve&&(l[0]=1));break}else{if(l[d]+=a,l[d]!=ve)break;l[d--]=0,a=1}for(o=l.length;l[--o]===0;)l.pop()}return W&&(i.e>p.maxE?(i.d=null,i.e=NaN):i.e<p.minE&&(i.e=0,i.d=[0])),i}function ze(i,e,t){if(!i.isFinite())return fi(i);var n,r=i.e,o=Pe(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+tt(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+tt(-r-1)+o,t&&(n=t-s)>0&&(o+=tt(n))):r>=s?(o+=tt(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+tt(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=tt(n))),o}function Gt(i,e){var t=i[0];for(e*=v;t>=10;t/=10)e++;return e}function Wt(i,e,t){if(e>Pr)throw W=!0,t&&(i.precision=t),Error(ai);return O(new i(Dt),e,1,!0)}function _e(i,e,t){if(e>dn)throw Error(ai);return O(new i(Vt),e,t,!0)}function mi(i){var e=i.length-1,t=e*v+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function tt(i){for(var e="";i--;)e+="0";return e}function di(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/v+4);for(W=!1;;){if(t%2&&(o=o.times(e),ri(o.d,s)&&(r=!0)),t=he(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),ri(e.d,s)}return W=!0,o}function ii(i){return i.d[i.d.length-1]&1}function pi(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function pn(i,e){var t,n,r,o,s,a,u,c=0,m=0,l=0,d=i.constructor,p=d.rounding,g=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(W=!1,u=g):u=e,a=new d(.03125);i.e>-2;)i=i.times(a),l+=5;for(n=Math.log(me(2,l))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=O(o.times(i),u,1),t=t.times(++m),a=s.plus(ne(o,t,u,1)),Pe(a.d).slice(0,u)===Pe(s.d).slice(0,u)){for(r=l;r--;)s=O(s.times(s),u,1);if(e==null)if(c<3&&Tt(s.d,u-n,p,c))d.precision=u+=10,t=o=a=new d(1),m=0,c++;else return O(s,d.precision=g,p,W=!0);else return d.precision=g,s}s=a}}function nt(i,e){var t,n,r,o,s,a,u,c,m,l,d,p=1,g=10,f=i,y=f.d,A=f.constructor,T=A.rounding,w=A.precision;if(f.s<0||!y||!y[0]||!f.e&&y[0]==1&&y.length==1)return new A(y&&!y[0]?-1/0:f.s!=1?NaN:y?0:f);if(e==null?(W=!1,m=w):m=e,A.precision=m+=g,t=Pe(y),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=Pe(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new A("0."+t),o++):f=new A(n+"."+t.slice(1))}else return c=Wt(A,m+2,w).times(o+""),f=nt(new A(n+"."+t.slice(1)),m-g).plus(c),A.precision=w,e==null?O(f,w,T,W=!0):f;for(l=f,u=s=f=ne(f.minus(1),f.plus(1),m,1),d=O(f.times(f),m,1),r=3;;){if(s=O(s.times(d),m,1),c=u.plus(ne(s,new A(r),m,1)),Pe(c.d).slice(0,m)===Pe(u.d).slice(0,m))if(u=u.times(2),o!==0&&(u=u.plus(Wt(A,m+2,w).times(o+""))),u=ne(u,new A(p),m,1),e==null)if(Tt(u.d,m-g,T,a))A.precision=m+=g,c=s=f=ne(l.minus(1),l.plus(1),m,1),d=O(f.times(f),m,1),r=a=1;else return O(u,A.precision=w,T,W=!0);else return A.precision=w,u;u=c,r+=2}}function fi(i){return String(i.s*i.s/0)}function fn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%v,t<0&&(n+=v),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=v;n<r;)i.d.push(+e.slice(n,n+=v));e=e.slice(n),n=v-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),W&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function wr(i,e){var t,n,r,o,s,a,u,c,m;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),li.test(e))return fn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(yr.test(e))t=16,e=e.toLowerCase();else if(br.test(e))t=2;else if(gr.test(e))t=8;else throw Error(it+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=di(n,new n(t),o,o*2)),c=vt(e,t,ve),m=c.length-1,o=m;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=Gt(c,m),i.d=c,W=!1,s&&(i=ne(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?me(2,u):Bt.pow(2,u))),W=!0,i)}function hr(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:Pt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Ut(5,t)),e=Pt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function Pt(i,e,t,n,r){var o,s,a,u,c=1,m=i.precision,l=Math.ceil(m/v);for(W=!1,u=t.times(t),a=new i(n);;){if(s=ne(a.times(u),new i(e++*e++),m,1),a=r?n.plus(s):n.minus(s),n=ne(s.times(u),new i(e++*e++),m,1),s=a.plus(n),s.d[l]!==void 0){for(o=l;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return W=!0,s.d.length=l+1,s}function Ut(i,e){for(var t=i;--e;)t*=i;return t}function bi(i,e){var t,n=e.s<0,r=_e(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return He=n?4:1,e;if(t=e.divToInt(r),t.isZero())He=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return He=ii(t)?n?2:3:n?4:1,e;He=ii(t)?n?1:4:n?3:2}return e.minus(r).abs()}function bn(i,e,t,n){var r,o,s,a,u,c,m,l,d,p=i.constructor,g=t!==void 0;if(g?(Ie(t,1,rt),n===void 0?n=p.rounding:Ie(n,0,8)):(t=p.precision,n=p.rounding),!i.isFinite())m=fi(i);else{for(m=ze(i),s=m.indexOf("."),g?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(m=m.replace(".",""),d=new p(1),d.e=m.length-s,d.d=vt(ze(d),10,r),d.e=d.d.length),l=vt(m,10,r),o=u=l.length;l[--u]==0;)l.pop();if(!l[0])m=g?"0p+0":"0";else{if(s<0?o--:(i=new p(i),i.d=l,i.e=o,i=ne(i,d,t,n,0,r),l=i.d,o=i.e,c=si),s=l[t],a=r/2,c=c||l[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&l[t-1]&1||n===(i.s<0?8:7)),l.length=t,c)for(;++l[--t]>r-1;)l[t]=0,t||(++o,l.unshift(1));for(u=l.length;!l[u-1];--u);for(s=0,m="";s<u;s++)m+=ln.charAt(l[s]);if(g){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)m+="0";for(l=vt(m,r,e),u=l.length;!l[u-1];--u);for(s=1,m="1.";s<u;s++)m+=ln.charAt(l[s])}else m=m.charAt(0)+"."+m.slice(1);m=m+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)m="0"+m;m="0."+m}else if(++o>u)for(o-=u;o--;)m+="0";else o<u&&(m=m.slice(0,o)+"."+m.slice(o))}m=(e==16?"0x":e==2?"0b":e==8?"0o":"")+m}return i.s<0?"-"+m:m}function ri(i,e){if(i.length>e)return i.length=e,!0}function Tr(i){return new this(i).abs()}function Br(i){return new this(i).acos()}function xr(i){return new this(i).acosh()}function Ir(i,e){return new this(i).plus(e)}function Sr(i){return new this(i).asin()}function Kr(i){return new this(i).asinh()}function Cr(i){return new this(i).atan()}function Nr(i){return new this(i).atanh()}function Rr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=_e(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?_e(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=_e(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ne(i,e,o,1)),e=_e(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(ne(i,e,o,1)),t}function Lr(i){return new this(i).cbrt()}function Or(i){return O(i=new this(i),i.e+1,2)}function Mr(i,e,t){return new this(i).clamp(e,t)}function Er(i){if(!i||typeof i!="object")throw Error(qt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,rt,"rounding",0,8,"toExpNeg",-At,0,"toExpPos",0,At,"maxE",0,At,"minE",-At,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=mn[t]),(n=i[t])!==void 0)if(he(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(it+t+": "+n);if(t="crypto",r&&(this[t]=mn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(ui);else this[t]=!1;else throw Error(it+t+": "+n);return this}function Fr(i){return new this(i).cos()}function _r(i){return new this(i).cosh()}function yi(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,oi(o)){c.s=o.s,W?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;W?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return fn(c,o.toString())}else if(u!=="string")throw Error(it+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),li.test(o)?fn(c,o):wr(c,o)}if(r.prototype=P,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Er,r.clone=yi,r.isDecimal=oi,r.abs=Tr,r.acos=Br,r.acosh=xr,r.add=Ir,r.asin=Sr,r.asinh=Kr,r.atan=Cr,r.atanh=Nr,r.atan2=Rr,r.cbrt=Lr,r.ceil=Or,r.clamp=Mr,r.cos=Fr,r.cosh=_r,r.div=vr,r.exp=Dr,r.floor=Vr,r.hypot=Wr,r.ln=qr,r.log=Gr,r.log10=Xr,r.log2=Ur,r.max=zr,r.min=Qr,r.mod=Yr,r.mul=Hr,r.pow=jr,r.random=Zr,r.round=Jr,r.sign=$r,r.sin=eo,r.sinh=to,r.sqrt=no,r.sub=io,r.sum=ro,r.tan=oo,r.tanh=so,r.trunc=ao,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function vr(i,e){return new this(i).div(e)}function Dr(i){return new this(i).exp()}function Vr(i){return O(i=new this(i),i.e+1,3)}function Wr(){var i,e,t=new this(0);for(W=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return W=!0,new this(1/0);t=e}return W=!0,t.sqrt()}function oi(i){return i instanceof Bt||i&&i.toStringTag===ci||!1}function qr(i){return new this(i).ln()}function Gr(i,e){return new this(i).log(e)}function Ur(i){return new this(i).log(2)}function Xr(i){return new this(i).log(10)}function zr(){return pi(this,arguments,"lt")}function Qr(){return pi(this,arguments,"gt")}function Yr(i,e){return new this(i).mod(e)}function Hr(i,e){return new this(i).mul(e)}function jr(i,e){return new this(i).pow(e)}function Zr(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Ie(i,1,rt),n=Math.ceil(i/v),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(ui);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=v,n&&i&&(r=me(10,v-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=v)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<v&&(t-=v-n)}return s.e=t,s.d=a,s}function Jr(i){return O(i=new this(i),i.e+1,this.rounding)}function $r(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function eo(i){return new this(i).sin()}function to(i){return new this(i).sinh()}function no(i){return new this(i).sqrt()}function io(i,e){return new this(i).sub(e)}function ro(){var i=0,e=arguments,t=new this(e[i]);for(W=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return W=!0,O(t,this.precision,this.rounding)}function oo(i){return new this(i).tan()}function so(i){return new this(i).tanh()}function ao(i){return O(i=new this(i),i.e+1,1)}P[Symbol.for("nodejs.util.inspect.custom")]=P.toString;P[Symbol.toStringTag]="Decimal";var Bt=P.constructor=yi(mn);Dt=new Bt(Dt);Vt=new Bt(Vt);var E=Bt;import{PublicKey as kn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as uo}from"@solana/spl-token";import{PublicKey as oe,SystemProgram as gi,SYSVAR_RENT_PUBKEY as co}from"@solana/web3.js";function k({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var Js=[k({pubkey:uo,isWritable:!1}),k({pubkey:gi.programId,isWritable:!1}),k({pubkey:co,isWritable:!1})];function yn({publicKey:i,transformSol:e}){let t=gn(i.toString());if(t instanceof oe)return e&&t.equals(It)?xt:t;if(e&&t.toString()===It.toBase58())return xt;if(typeof t=="string"){if(t===oe.default.toBase58())return oe.default;try{return new oe(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function gn(i){try{return new oe(i)}catch{return i}}var Xt=new oe("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),An=new oe("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),dt=new oe("SysvarRent111111111111111111111111111111111"),$s=new oe("SysvarC1ock11111111111111111111111111111111"),kt=new oe("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ea=new oe("Sysvar1nstructions1111111111111111111111111"),lo=gi.programId,ta=new oe("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),na=new oe("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ia=new oe("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ra=new oe("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),oa=new oe("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),sa=new oe("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),aa=new oe("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ua=new oe("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),ca=new oe("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),la=new oe("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ma=new oe("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),xt=new oe("So11111111111111111111111111111111111111112"),It=oe.default;function wt(i){return yn({publicKey:i,transformSol:!0})}import{PublicKey as mo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ai}from"@solana/spl-token";var Pn={chainId:101,address:mo.default.toBase58(),programId:Ai.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},je={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Ai.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var wn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===It.toBase58()||e instanceof kn&&It.equals(e)){this.decimals=je.decimals,this.symbol=je.symbol,this.name=je.name,this.mint=new kn(je.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?kn.default:yn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},De=wn;De.WSOL=new wn(ee(Z({},je),{mint:je.address}));import Qt from"big.js";import bo from"bn.js";import yo from"decimal.js-light";import po from"toformat";var fo=po,St=fo;var zt=ie("module/fraction"),hn=St(Qt),Kt=St(yo),go={[0]:Kt.ROUND_DOWN,[1]:Kt.ROUND_HALF_UP,[2]:Kt.ROUND_UP},Ao={[0]:Qt.roundDown,[1]:Qt.roundHalfUp,[2]:Qt.roundUp},J=class{constructor(e,t=new bo(1)){this.numerator=se(e),this.denominator=se(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new J(this.denominator,this.numerator)}add(e){let t=e instanceof J?e:new J(se(e));return this.denominator.eq(t.denominator)?new J(this.numerator.add(t.numerator),this.denominator):new J(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof J?e:new J(se(e));return this.denominator.eq(t.denominator)?new J(this.numerator.sub(t.numerator),this.denominator):new J(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof J?e:new J(se(e));return new J(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof J?e:new J(se(e));return new J(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||zt.logWithError(`${e} is not an integer.`),e<=0&&zt.logWithError(`${e} is not positive.`),Kt.set({precision:e+1,rounding:go[n]});let r=new Kt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||zt.logWithError(`${e} is not an integer.`),e<0&&zt.logWithError(`${e} is negative.`),hn.DP=e,hn.RM=Ao[n]||1,new hn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var ko=ie("Raydium_price"),Ce=class extends J{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new J(Tn(n.decimals),Tn(r.decimals))}get raw(){return new J(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Ce({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&ko.logWithError("mul token not equals");let n=super.mul(t);return new Ce({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var Bn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Yt=Bn;Yt.SOL=new Bn(Pn);import wo from"bn.js";var Pi=new J(new wo(100)),ot=class extends J{toSignificant(e=5,t,n){return this.mul(Pi).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Pi).toFixed(e,t,n)}};var ki=new Se(0),ho=new Se(1),au=new Se(2),uu=new Se(3),cu=new Se(5),xn=new Se(10),lu=new Se(100),mu=new Se(1e3),du=new Se(1e4),wi=9007199254740991;function se(i){let e=ie("Raydium_parseBigNumberish");if(i instanceof Se)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Se(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=wi||i<=-wi)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Se(String(i))):typeof i=="bigint"?new Se(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Se(0))}function Tn(i){return xn.pow(se(i))}var Bo=ie("Raydium_amount"),Ti=St(To);function xo(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):Bo.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var de=class extends J{constructor(t,n,r=!0,o){let s=new Ht(0),a=xn.pow(new Ht(t.decimals));if(r)s=se(n);else{let u=new Ht(0),c=new Ht(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[m,l]=xo(n.toString(),t.decimals);u=se(m),c=se(l)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=ie(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new de(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new de(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return Ti.DP=this.token.decimals,new Ti(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};function hi(i){return typeof i=="object"&&i!==null&&![De,de,Io,J,So,Ce,ot].some(e=>typeof e=="object"&&i instanceof e)}function Ne(i){return typeof i=="string"?gn(i):Array.isArray(i)?i.map(e=>Ne(e)):hi(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,Ne(t)])):i}import{PublicKey as Ic,sendAndConfirmTransaction as Sc,Transaction as Cc,TransactionMessage as Rc,VersionedTransaction as Lc}from"@solana/web3.js";import Ec from"axios";var re={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{PublicKey as Ko,ComputeBudgetProgram as Wu,Transaction as Gu,TransactionMessage as Xu,Keypair as zu,VersionedTransaction as Yu}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Zu}from"@solana/spl-token";var ec=ie("Raydium_txUtil");function Ke(i,e){let[t,n]=Ko.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}import{PublicKey as No,AddressLookupTableAccount as Bi}from"@solana/web3.js";import{PublicKey as Co}from"@solana/web3.js";import{MINT_SIZE as ac,TOKEN_PROGRAM_ID as uc,getTransferFeeConfig as cc,unpackMint as lc}from"@solana/spl-token";var In=ie("Raydium_accountInfo_util");async function st(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=Z({batchRequest:!1},t),s=Sn(e,o),a=new Array(s.length).fill([]);if(n){let u=s.map(l=>{let d=i._buildArgs([l.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=Sn(u,10);a=(await(await Promise.all(c.map(async l=>await i._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&In.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(d=>{if(d){let{data:p,executable:g,lamports:f,owner:y,rentEpoch:A}=d;return p.length!==2&&p[1]!=="base64"&&In.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:g,lamports:f,owner:new Co(y),rentEpoch:A}}return null})))}else try{a=await Promise.all(s.map(u=>i.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&In.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function Ct(i,e,t){let n=await st(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>ee(Z({},r),{accountInfo:n[o]}))}var Ro={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new Bi({key:new No("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:Bi.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};function Sn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Q}from"@solana/web3.js";var Xc=new Q("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),zc=new Q("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Qc=new Q("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Yc=new Q("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Hc=new Q("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Ii=new Q("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Oo=new Q("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),jc=new Q("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Si=new Q("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Mo=new Q("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Zc=new Q("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Jc=new Q("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),$c=new Q("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),el=new Q("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),tl=new Q("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),nl=new Q("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Eo=new Q("8yQvrjQuritLntxz6pAaWcEX6CsRMeDmr7baCLnNwEuw"),il=new Q("E1oP2yNZXw3dFnUoPygWZPg9u2Gad87VFVPeYWqa6rD6"),rl=new Q("E1oP2yNZXw3dFnUoPygWZPg9u2Gad87VFVPeYWqa6rD6"),Fo=new Q("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),_o=new Q("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),vo=new Q("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");var ol={SERUM_MARKET:Q.default,OPENBOOK_MARKET:new Q("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:Q.default,FarmV3:new Q("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new Q("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new Q("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new Q("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new Q("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new Q("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),Router:new Q("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Fo,CREATE_CPMM_POOL_AUTH:_o,CREATE_CPMM_POOL_FEE_ACC:vo,FEE_DESTINATION_ID:new Q("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import{PublicKey as Do}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Vo}from"@solana/spl-token";function Qe(i,e,t){return Ke([i.toBuffer(),(t!=null?t:Vo).toBuffer(),e.toBuffer()],new Do("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import Ve from"bn.js";var Nt=1e4;function pe(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=ee(Z({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new Ve(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Nt){let u=new Ve(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=Kn(i.mul(new Ve(Nt)),new Ve(Nt-o.transferFeeBasisPoints)),c=new Ve(o.maximumFee.toString()),m=u.sub(i).gt(c)?i.add(c):u,l=Kn(m.mul(new Ve(o.transferFeeBasisPoints)),new Ve(Nt)),d=l.gt(s)?s:l;return{amount:m,fee:d,expirationTime:a}}else{let u=Kn(i.mul(new Ve(o.transferFeeBasisPoints)),new Ve(Nt)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function at(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function Kn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new Ve(0))?t.add(new Ve(1)):t}import{createInitializeAccountInstruction as rd,createCloseAccountInstruction as od,createTransferInstruction as sd,TOKEN_PROGRAM_ID as ad}from"@solana/spl-token";import{PublicKey as md,SystemProgram as pd}from"@solana/web3.js";import yd from"bn.js";import{PublicKey as ns,Keypair as is}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as rs}from"@solana/spl-token";import Zm from"bn.js";import{PublicKey as Ho}from"@solana/web3.js";import Ri,{isBN as Li}from"bn.js";import{bits as Fl,BitStructure as _l,blob as Wo,Blob as vl,cstr as Dl,f32 as Vl,f32be as Wl,f64 as ql,f64be as Gl,greedy as Ul,Layout as qo,ns64 as Xl,ns64be as zl,nu64 as Ql,nu64be as Yl,offset as Hl,s16 as jl,s16be as Zl,s24 as Jl,s24be as $l,s32 as Go,s32be as em,s40 as tm,s40be as nm,s48 as im,s48be as rm,s8 as om,seq as Uo,struct as sm,Structure as Xo,u16 as zo,u16be as am,u24 as um,u24be as cm,u32 as lm,u32be as mm,u40 as dm,u40be as pm,u48 as fm,u48be as bm,u8 as Qo,UInt as Yo,union as ym,Union as gm,unionLayoutDiscriminator as Am,utf8 as Pm}from"@solana/buffer-layout";var Cn=qo,Ki=Xo;var Nn=Yo;var Ci=Qo,ut=zo;var ke=Go;var Ni=Uo;var fe=Wo;var Rt=class extends Cn{constructor(t,n,r){super(t,r);this.blob=fe(t),this.signed=n}decode(t,n=0){let r=new Ri(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Ri(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function q(i){return new Nn(1,i)}function Me(i){return new Nn(4,i)}function b(i){return new Rt(8,!1,i)}function D(i){return new Rt(16,!1,i)}function Oi(i){return new Rt(16,!0,i)}var jt=class extends Cn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function S(i){return new jt(fe(32),e=>new Ho(e),e=>e.toBuffer(),i)}function Ee(i){return new jt(Ci(),jo,Zo,i)}function jo(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function Zo(i){return i?1:0}var Rn=class extends Ki{decode(e,t){return super.decode(e,t)}};function M(i,e,t){return new Rn(i,e,t)}function j(i,e,t){let n,r=typeof e=="number"?e:Li(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Li(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Ni(i,r,t)}var Mi=M([S("mint"),S("owner"),b("amount"),Me("delegateOption"),S("delegate"),q("state"),Me("isNativeOption"),b("isNative"),b("delegatedAmount"),Me("closeAuthorityOption"),S("closeAuthority")]);function Jo(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function Ln(i,...e){if(!Jo(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function On(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function Ei(i,e){Ln(i);let t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var Jt=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),We=(i,e)=>i<<32-e|i>>>e;var Fm=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function $o(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function Mn(i){return typeof i=="string"&&(i=$o(i)),Ln(i),i}var Zt=class{clone(){return this._cloneInto()}},_m={}.toString;function Fi(i){let e=n=>i().update(Mn(n)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function es(i,e,t,n){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,n);let r=BigInt(32),o=BigInt(4294967295),s=Number(t>>r&o),a=Number(t&o),u=n?4:0,c=n?0:4;i.setUint32(e+u,s,n),i.setUint32(e+c,a,n)}var _i=(i,e,t)=>i&e^~i&t,vi=(i,e,t)=>i&e^i&t^e&t,$t=class extends Zt{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Jt(this.buffer)}update(e){On(this);let{view:t,buffer:n,blockLen:r}=this;e=Mn(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(r-this.pos,o-s);if(a===r){let u=Jt(e);for(;r<=o-s;s+=r)this.process(u,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){On(this),Ei(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let l=s;l<r;l++)t[l]=0;es(n,r-8,BigInt(this.length*8),o),this.process(n,0);let a=Jt(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,m=this.get();if(c>m.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<c;l++)a.setUint32(4*l,m[l],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:o,destroyed:s,pos:a}=this;return e.length=r,e.pos=a,e.finished=o,e.destroyed=s,r%t&&e.buffer.set(n),e}};var ts=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ct=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),lt=new Uint32Array(64),En=class extends $t{constructor(){super(64,32,8,!1),this.A=ct[0]|0,this.B=ct[1]|0,this.C=ct[2]|0,this.D=ct[3]|0,this.E=ct[4]|0,this.F=ct[5]|0,this.G=ct[6]|0,this.H=ct[7]|0}get(){let{A:e,B:t,C:n,D:r,E:o,F:s,G:a,H:u}=this;return[e,t,n,r,o,s,a,u]}set(e,t,n,r,o,s,a,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,t){for(let l=0;l<16;l++,t+=4)lt[l]=e.getUint32(t,!1);for(let l=16;l<64;l++){let d=lt[l-15],p=lt[l-2],g=We(d,7)^We(d,18)^d>>>3,f=We(p,17)^We(p,19)^p>>>10;lt[l]=f+lt[l-7]+g+lt[l-16]|0}let{A:n,B:r,C:o,D:s,E:a,F:u,G:c,H:m}=this;for(let l=0;l<64;l++){let d=We(a,6)^We(a,11)^We(a,25),p=m+d+_i(a,u,c)+ts[l]+lt[l]|0,f=(We(n,2)^We(n,13)^We(n,22))+vi(n,r,o)|0;m=c,c=u,u=a,a=s+p|0,s=o,o=r,r=n,n=p+f|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,m=m+this.H|0,this.set(n,r,o,s,a,u,c,m)}roundClean(){lt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Di=Fi(()=>new En);var td=ie("Raydium_Util");function Fn({fromPublicKey:i,programId:e=rs}){let t=is.generate().publicKey.toBase58().slice(0,32);return{publicKey:os(i,t,e),seed:t}}function os(i,e,t){let n=Buffer.concat([i.toBuffer(),Buffer.from(e),t.toBuffer()]),r=Di(n);return new ns(r)}import Vi from"bn.js";var xd=new Vi(25),Id=new Vi(1e4);var _n=M([q("instruction"),b("amountIn"),b("minAmountOut")]),vn=M([q("instruction"),b("maxAmountIn"),b("amountOut")]),Od=M([q("instruction"),q("nonce")]),ss=M([q("instruction"),q("nonce"),b("startTime")]),as=M([b("status"),b("nonce"),b("maxOrder"),b("depth"),b("baseDecimal"),b("quoteDecimal"),b("state"),b("resetFlag"),b("minSize"),b("volMaxCutRatio"),b("amountWaveRatio"),b("baseLotSize"),b("quoteLotSize"),b("minPriceMultiplier"),b("maxPriceMultiplier"),b("systemDecimalValue"),b("minSeparateNumerator"),b("minSeparateDenominator"),b("tradeFeeNumerator"),b("tradeFeeDenominator"),b("pnlNumerator"),b("pnlDenominator"),b("swapFeeNumerator"),b("swapFeeDenominator"),b("baseNeedTakePnl"),b("quoteNeedTakePnl"),b("quoteTotalPnl"),b("baseTotalPnl"),b("poolOpenTime"),b("punishPcAmount"),b("punishCoinAmount"),b("orderbookToInitTime"),D("swapBaseInAmount"),D("swapQuoteOutAmount"),b("swapBase2QuoteFee"),D("swapQuoteInAmount"),D("swapBaseOutAmount"),b("swapQuote2BaseFee"),S("baseVault"),S("quoteVault"),S("baseMint"),S("quoteMint"),S("lpMint"),S("openOrders"),S("marketId"),S("marketProgramId"),S("targetOrders"),S("withdrawQueue"),S("lpVault"),S("owner"),b("lpReserve"),j(b(),3,"padding")]),Md=M([b("accountType"),b("status"),b("nonce"),b("maxOrder"),b("depth"),b("baseDecimal"),b("quoteDecimal"),b("state"),b("resetFlag"),b("minSize"),b("volMaxCutRatio"),b("amountWaveRatio"),b("baseLotSize"),b("quoteLotSize"),b("minPriceMultiplier"),b("maxPriceMultiplier"),b("systemDecimalsValue"),b("abortTradeFactor"),b("priceTickMultiplier"),b("priceTick"),b("minSeparateNumerator"),b("minSeparateDenominator"),b("tradeFeeNumerator"),b("tradeFeeDenominator"),b("pnlNumerator"),b("pnlDenominator"),b("swapFeeNumerator"),b("swapFeeDenominator"),b("baseNeedTakePnl"),b("quoteNeedTakePnl"),b("quoteTotalPnl"),b("baseTotalPnl"),b("poolOpenTime"),b("punishPcAmount"),b("punishCoinAmount"),b("orderbookToInitTime"),D("swapBaseInAmount"),D("swapQuoteOutAmount"),D("swapQuoteInAmount"),D("swapBaseOutAmount"),b("swapQuote2BaseFee"),b("swapBase2QuoteFee"),S("baseVault"),S("quoteVault"),S("baseMint"),S("quoteMint"),S("lpMint"),S("modelDataAccount"),S("openOrders"),S("marketId"),S("marketProgramId"),S("targetOrders"),S("owner"),j(b(),64,"padding")]),us=M([q("instruction"),b("baseAmountIn"),b("quoteAmountIn"),b("fixedSide")]),cs=M([q("instruction"),b("amountIn")]);var Ed=M([b("fee")]);import{PublicKey as Np}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Lp}from"@solana/spl-token";import{PublicKey as Dd}from"@solana/web3.js";import{MintLayout as Wd,TOKEN_PROGRAM_ID as Gd}from"@solana/spl-token";import{PublicKey as Zd}from"@solana/web3.js";var ep=ie("Raydium_liquidity_serum");import{PublicKey as ls}from"@solana/web3.js";var Dn=new ls("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ms=5e4,ds=M([b("x"),b("y"),b("price")]),op=M([b("accountType"),b("status"),b("multiplier"),b("validDataCount"),j(ds,ms,"DataElement")]);import{TOKEN_PROGRAM_ID as qi,ASSOCIATED_TOKEN_PROGRAM_ID as up}from"@solana/spl-token";import{PublicKey as lp,TransactionInstruction as Gi,SystemProgram as mp,SYSVAR_RENT_PUBKEY as dp}from"@solana/web3.js";var Wi=ie("Raydium_liquidity_instruction");function ps({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=Ne(i),s=Buffer.alloc(_n.span);_n.encode({instruction:9,amountIn:se(t),minAmountOut:se(n)},s);let a=[k({pubkey:qi,isWritable:!1}),k({pubkey:o.id}),k({pubkey:o.authority,isWritable:!1}),k({pubkey:o.openOrders})];return r===4&&a.push(k({pubkey:o.targetOrders})),a.push(k({pubkey:o.vault.A}),k({pubkey:o.vault.B})),r===5&&a.push(k({pubkey:Dn})),a.push(k({pubkey:o.marketProgramId,isWritable:!1}),k({pubkey:o.marketId}),k({pubkey:o.marketBids}),k({pubkey:o.marketAsks}),k({pubkey:o.marketEventQueue}),k({pubkey:o.marketBaseVault}),k({pubkey:o.marketQuoteVault}),k({pubkey:o.marketAuthority,isWritable:!1}),k({pubkey:e.tokenAccountIn}),k({pubkey:e.tokenAccountOut}),k({pubkey:e.owner,isWritable:!1})),new Gi({programId:o.programId,keys:a,data:s})}function fs({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=Ne(i),s=Buffer.alloc(vn.span);vn.encode({instruction:11,maxAmountIn:se(t),amountOut:se(n)},s);let a=[k({pubkey:qi,isWritable:!1}),k({pubkey:o.id}),k({pubkey:o.authority,isWritable:!1}),k({pubkey:o.openOrders}),k({pubkey:o.targetOrders}),k({pubkey:o.vault.A}),k({pubkey:o.vault.B})];return r===5&&a.push(k({pubkey:Dn})),a.push(k({pubkey:o.marketProgramId,isWritable:!1}),k({pubkey:o.marketId}),k({pubkey:o.marketBids}),k({pubkey:o.marketAsks}),k({pubkey:o.marketEventQueue}),k({pubkey:o.marketBaseVault}),k({pubkey:o.marketQuoteVault}),k({pubkey:o.marketAuthority,isWritable:!1}),k({pubkey:e.tokenAccountIn}),k({pubkey:e.tokenAccountOut}),k({pubkey:e.owner,isWritable:!1,isSigner:!0})),new Gi({programId:o.programId,keys:a,data:s})}function Ui(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:s}=i;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return ps(ee(Z({},a),{amountIn:r,minAmountOut:o}),t);if(s==="out")return fs(ee(Z({},a),{maxAmountIn:r,amountOut:o}),t);Wi.logWithError("invalid params","params",i)}throw Wi.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}import Dp from"bn.js";import Ts from"bn.js";function en(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Vn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Wn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Lt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function zi(i,e){return Lt(i,e)?null:Vn(i,e)}function Qi(i,e){return Lt(i,e)?null:Wn(i,e)}var $p=Buffer.from("amm_config","utf8"),bs=Buffer.from("pool","utf8"),ys=Buffer.from("pool_vault","utf8"),gs=Buffer.from("pool_reward_vault","utf8"),Yi=Buffer.from("position","utf8"),As=Buffer.from("tick_array","utf8"),Ps=Buffer.from("operation","utf8"),ks=Buffer.from("pool_tick_array_bitmap_extension","utf8");function Hi(i,e,t,n,r){return Ke([bs,e.toBuffer(),t.toBuffer(),n.toBuffer(),r.toBuffer()],i)}function qn(i,e,t){return Ke([ys,e.toBuffer(),t.toBuffer()],i)}function ji(i,e,t){return Ke([gs,e.toBuffer(),t.toBuffer()],i)}function te(i,e,t){return Ke([As,e.toBuffer(),en(t)],i)}function pt(i,e,t,n){return Ke([Yi,e.toBuffer(),en(t),en(n)],i)}function qe(i,e){return Ke([Yi,e.toBuffer()],i)}function tn(i){return Ke([Buffer.from("metadata","utf8"),kt.toBuffer(),i.toBuffer()],kt)}function nn(i){return Ke([Ps],i)}function Re(i,e){return Ke([ks,e.toBuffer()],i)}import Fe from"bn.js";var ue=new Fe(0),Le=new Fe(1),Ze=new Fe(-1),Oe=new Fe(1).shln(64),rn=new Fe(1).shln(128),Gn=Oe.sub(Le),Ot=64,Zi=rn.subn(1),Te=-443636,Be=-Te,Je=new Fe("4295048016"),$e=new Fe("79226673521066979257578248091"),on=new Fe("4295048017"),sn=new Fe("79226673521066979257578248090"),Ji=16,$i="59543866431248",er="184467440737095516",tr="15793534762490258745",an=new Fe(10).pow(new Fe(6));var nf=new Fe("18446744073700000000");var ws=15,z=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=R.getTickArrayStartIndexByTick(r,o),m=R.getInitializedTickArrayInRange(s,a,o,c,Math.floor(ws/2));for(let p=0;p<m.length;p++){let{publicKey:g}=te(t,n,m[p]);u.push(g)}let l=(await st(e,u)).map(p=>p!==null?Mt.decode(p.data):null),d={};for(let p=0;p<u.length;p++){let g=l[p];g!==null&&(d[g.startTickIndex]=ee(Z({},g),{address:u[p]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=R.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let m=n[c];if(m===void 0)continue;let{nextTick:l,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,m,s);[a,u,c]=[l,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/z.tickCount(t)),a=n?R.searchLowBitFromStart(r,o,s-1,1,t):R.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=be-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<be;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=te(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=R.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let m;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){m=d;break}u=u-1}else for(u=u+1;u<be;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){m=d;break}u=u+1}let{publicKey:l}=te(e,t,a);return{initializedTick:m,tickArrayAddress:l,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(R.checkIsOutOfBoundary(e)){if(e>Be)return!1;let n=R.getTickArrayStartIndexByTick(Te,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return be*e}};import X from"bn.js";import{PublicKey as Ge}from"@solana/web3.js";import ce from"bn.js";var Un=14,et=class{static maxTickInTickarrayBitmap(e){return e*be*ft}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!z.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-z.tickCount(n):t+z.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*be,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let m=e.shln(1024-c-1),l=zi(1024,m);if(l!==null){let d=(c-l-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let m=e.shrn(c),l=Qi(1024,m);if(l!==null){let d=(c+l-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-z.tickCount(n)}}}},Et=class{static getBitmapOffset(e,t){if(!z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=et.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=et.maxTickInTickarrayBitmap(e),n=-t;if(Be<=t)throw Error(`extensionTickBoundary check error: ${Be}, ${t}`);if(n<=Te)throw Error(`extensionTickBoundary check error: ${n}, ${Te}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:R.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=z.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=et.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=R.mergeTickArrayBitmap(e).shln(ft-1-a),c=Lt(512,u)?null:Vn(512,u);if(c!==null){let m=t-c*z.tickCount(n);return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:o}}else{let u=R.mergeTickArrayBitmap(e).shrn(a),c=Lt(512,u)?null:Wn(512,u);if(c!==null){let m=t+c*z.tickCount(n);return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:s-z.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%et.maxTickInTickarrayBitmap(t),r=Math.floor(n/z.tickCount(t));return e<0&&n!=0&&(r=ft-r),r}};import Ye from"bn.js";var Ft=class{static getfeeGrowthInside(e,t,n){let r=new Ye(0),o=new Ye(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Ye(0),a=new Ye(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=G.wrappingSubU128(G.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=G.wrappingSubU128(G.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=G.mulDivFloor(G.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Oe),u=t.tokenFeesOwedA.add(a),c=G.mulDivFloor(G.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Oe),m=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:m}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=G.mulDivFloor(G.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Oe),u=t.tokenFeesOwedA.add(a),c=G.mulDivFloor(G.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Oe),m=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:m}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],m=G.wrappingSubU128(u,c.growthInsideLastX64),l=G.mulDivFloor(m,t.liquidity,Oe),d=c.rewardAmountOwed.add(l);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],m=G.wrappingSubU128(u,c.growthInsideLastX64),l=G.mulDivFloor(m,t.liquidity,Oe),d=c.rewardAmountOwed.add(l);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ye(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Ye(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(G.wrappingSubU128(G.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ye(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Ye(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(G.wrappingSubU128(G.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var y,A,T,w;let a=U.priceToSqrtPriceX64(new E(e.price),e.mintA.decimals,e.mintB.decimals),u=U.getSqrtPriceX64FromTick(t.tickLower),c=U.getSqrtPriceX64FromTick(t.tickUpper),m=o?1+r:1-r,l=Y.getAmountsFromLiquidity(a,u,c,n,o),[d,p]=[pe(l.amountA,(y=e.mintA.extensions)==null?void 0:y.feeConfig,s,!0),pe(l.amountB,(A=e.mintB.extensions)==null?void 0:A.feeConfig,s,!0)],[g,f]=[pe(new Ye(new E(l.amountA.toString()).mul(m).toFixed(0)),(T=e.mintA.extensions)==null?void 0:T.feeConfig,s,!0),pe(new Ye(new E(l.amountB.toString()).mul(m).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:g,amountSlippageB:f,expirationTime:at(d.expirationTime,p.expirationTime)}}};import{TOKEN_2022_PROGRAM_ID as nr}from"@solana/spl-token";var ge=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:m,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,a);if(!c||m===void 0||!l)throw new Error("Invalid tick array");u.push(l);let{allTrade:d,amountCalculated:p,accounts:g,sqrtPriceX64:f,feeAmount:y}=bt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,m,o,s);return u.push(...g),{allTrade:d,expectedAmountOut:p.mul(Ze),remainingAccounts:u,executionPrice:f,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!m)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:y}=te(e.programId,e.id,f.nextStartIndex);a.push(y)}}catch{}a.push(m);let{amountCalculated:l,accounts:d,sqrtPriceX64:p,feeAmount:g}=bt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(Ze),c,o);return a.push(...d),{expectedAmountIn:l,remainingAccounts:a,executionPrice:p,feeAmount:g}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=ge.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Et.checkTickArrayIsInit(z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):R.checkTickArrayIsInitialized(R.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=te(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=te(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/z.tickCount(e.tickSpacing)),r=t?R.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):R.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=z.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=et.nextInitializedTickArrayStartIndex(R.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Et.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Te||t>Be)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,u,c;let s=[];for(let m=0;m<o.length;m++){let l=o[m],d=(c=(a=t.rewardDefaultInfos[m])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(l.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let p=ee(Z({},l),{perSecond:G.x64ToDecimal(l.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Ge(d)});if(p.tokenMint.equals(Ge.default))continue;if(n<=p.openTime.toNumber()||r.eq(ue)){s.push(p);continue}let g=new ce(Math.min(p.endTime.toNumber(),n)),f=g.sub(p.lastUpdateTime),y=G.mulDivFloor(f,p.emissionsPerSecondX64,r),A=p.rewardGrowthGlobalX64.add(y),T=G.mulDivFloor(f,p.emissionsPerSecondX64,Oe),w=p.rewardTotalEmissioned.add(T);s.push(ee(Z({},p),{rewardGrowthGlobalX64:A,rewardTotalEmissioned:w,lastUpdateTime:g}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=R.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=et.maxTickInTickarrayBitmap(e),n=-t;return t>Be&&(t=z.getArrayStartIndex(Be,e)+z.tickCount(e)),n<Te&&(n=z.getArrayStartIndex(Te,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/z.tickCount(t)*ft}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await Ct(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=ir.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=R.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),m=R.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let l of m){let{publicKey:d}=te(u.programId,u.id,l);o.push({pubkey:d}),r[d.toString()]=u.id}}let s=await Ct(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let m=Mt.decode(u.accountInfo.data);a[c.toString()][m.startTickIndex]=ee(Z({},m),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(m=>m.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let p of s)c.push(qe(p,d).publicKey);let m=await st(t,c,{batchRequest:r}),l={};for(let d of m){if(d===null)continue;let p=Xn.decode(d.data),g=p.poolId.toString(),f=e.find(L=>L.state.id.toBase58()===g);if(f===void 0)continue;let y=f.state,A=R._getTickPriceLegacy({poolInfo:y,tick:p.tickLower,baseIn:!0}),T=R._getTickPriceLegacy({poolInfo:y,tick:p.tickUpper,baseIn:!0}),{amountA:w,amountB:C}=Y.getAmountsFromLiquidity(y.sqrtPriceX64,A.tickSqrtPriceX64,T.tickSqrtPriceX64,p.liquidity,!1),V=1/(1-Math.sqrt(Math.sqrt(A.price.div(T.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:A.price,priceUpper:T.price,amountA:w,amountB:C,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(L=>ee(Z({},L),{pendingReward:new ce(0)})),leverage:V,tokenFeeAmountA:new ce(0),tokenFeeAmountB:new ce(0)}];let B=await R.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),F=await R.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);l[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=B,l[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=F}if(o){let d=Object.values(l),p=await st(t,d,{batchRequest:r}),g={};for(let f=0;f<d.length;f++){let y=p[f];if(y===null)continue;let A=d[f].toString();g[A]=Mt.decode(y.data)}for(let{state:f,positionAccount:y}of e)if(!!y)for(let A of y){let T=`${f.programId.toString()}-${f.id.toString()}-${A.tickLower}`,w=`${f.programId.toString()}-${f.id.toString()}-${A.tickUpper}`,C=g[l[T].toString()],V=g[l[w].toString()],B=C.ticks[R.getTickOffsetInArray(A.tickLower,f.tickSpacing)],F=V.ticks[R.getTickOffsetInArray(A.tickUpper,f.tickSpacing)],{tokenFeeAmountA:L,tokenFeeAmountB:H}=await Ft.GetPositionFees(f,A,B,F),h=await Ft.GetPositionRewards(f,A,B,F);A.tokenFeeAmountA=L.gte(new ce(0))?L:new ce(0),A.tokenFeeAmountB=H.gte(new ce(0))?H:new ce(0);for(let _=0;_<h.length;_++)A.rewardInfos[_].pendingReward=h[_].gte(new ce(0))?h[_]:new ce(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new E(0),catchLiquidityInsufficient:u=!1}){var ye;let c,m=n.toBase58()===e.mintA.address,[l,d]=m?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new E(0))?c=m?Je.add(new ce(1)):$e.sub(new ce(1)):c=U.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=pe(o,l,r,!1),{allTrade:g,expectedAmountOut:f,remainingAccounts:y,executionPrice:A,feeAmount:T}=ge.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub((ye=p.fee)!=null?ye:ue),c,u),w=pe(f,d,r,!1),C=U.sqrtPriceX64ToPrice(A,e.mintA.decimals,e.mintB.decimals),V=m?C:new E(1).div(C),B=f.mul(new ce(Math.floor((1-s)*1e10))).div(new ce(1e10)),F=pe(B,d,r,!1),L=m?e.currentPrice:new E(1).div(e.currentPrice),H=new E(V).sub(L).abs(),h=L,_=new ot(new E(H).mul(10**15).toFixed(0),new E(h).mul(10**15).toFixed(0));return{allTrade:g,realAmountIn:p,amountOut:w,minAmountOut:F,expirationTime:at(p.expirationTime,w.expirationTime),currentPrice:e.currentPrice,executionPrice:V,priceImpact:_,fee:T,remainingAccounts:y,executionPriceX64:A}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let u=r.address===e.mintB.address,[c,m]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[l,d]=[new De(ee(Z({},c),{mint:c.address,isToken2022:c.programId===nr.toBase58()})),new De(ee(Z({},m),{mint:m.address,isToken2022:m.programId===nr.toBase58()}))],{allTrade:p,realAmountIn:g,amountOut:f,minAmountOut:y,expirationTime:A,currentPrice:T,executionPrice:w,priceImpact:C,fee:V,remainingAccounts:B,executionPriceX64:F}=ge.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Ge(c.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),L=ee(Z({},g),{amount:new de(l,g.amount),fee:g.fee===void 0?void 0:new de(l,g.fee)}),H=ee(Z({},f),{amount:new de(d,f.amount),fee:f.fee===void 0?void 0:new de(d,f.fee)}),h=ee(Z({},y),{amount:new de(d,y.amount),fee:y.fee===void 0?void 0:new de(d,y.fee)}),_=new Ce({baseToken:l,denominator:new ce(10).pow(new ce(20+l.decimals)),quoteToken:d,numerator:T.mul(new E(10**(20+d.decimals))).toFixed(0)}),ye=new Ce({baseToken:l,denominator:new ce(10).pow(new ce(20+l.decimals)),quoteToken:d,numerator:w.mul(new E(10**(20+d.decimals))).toFixed(0)}),le=new de(l,V);return{allTrade:p,realAmountIn:L,amountOut:H,minAmountOut:h,expirationTime:A,currentPrice:_,executionPrice:ye,priceImpact:C,fee:le,remainingAccounts:B,executionPriceX64:F}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var g,f,y;let o=e[t],s=R.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=R.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),m=Math.min(a,o.priceMax)-u,l=a-s,d=o.priceMax-o.priceMin,p;return m<=0?p=0:l===m?p=d/m:d===m?p=m/l:p=m/d*(m/l),{feeApr:o.feeApr*p,rewardsApr:[((g=o.rewardApr[0])!=null?g:0)*p,((f=o.rewardApr[1])!=null?f:0)*p,((y=o.rewardApr[2])!=null?y:0)*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,m=e[n],l=r[wt(e.mintA.address).toString()],d=r[wt(e.mintB.address).toString()],p=e.mintA.decimals,g=e.mintB.decimals;if(!m||!l||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=U.priceToSqrtPriceX64(new E(e.price),e.mintA.decimals,e.mintB.decimals),y=U.getSqrtPriceX64FromTick(s),A=U.getSqrtPriceX64FromTick(a),{amountSlippageA:T,amountSlippageB:w}=Y.getAmountsFromLiquidityWithSlippage(f,y,A,t,!1,!1,0),{amountSlippageA:C,amountSlippageB:V}=Y.getAmountsFromLiquidityWithSlippage(f,y,A,o,!1,!1,0),B=new E(T.toString()).div(new E(10).pow(p)).mul(l.value).add(new E(w.toString()).div(new E(10).pow(g)).mul(d.value)),F=new E(C.toString()).div(new E(10).pow(p)).mul(l.value).add(new E(V.toString()).div(new E(10).pow(g)).mul(d.value)),L=new E(1).div(B.add(F)),h=new E(m.volumeFee).mul(365).div(c).mul(L).mul(100).toNumber(),_=3600*24*365,ye=e.rewardDefaultInfos.map(le=>{var $,Jn;let xe=le.mint.decimals,ae=r[le.mint.address];return u<(($=le.startTime)!=null?$:0)||u>((Jn=le.endTime)!=null?Jn:0)||!le.perSecond||!ae||xe===void 0?0:new E(ae.value).mul(new E(le.perSecond).mul(_)).div(new E(10).pow(xe)).mul(L).mul(100).toNumber()});return{feeApr:h,rewardsApr:ye,apr:h+ye.reduce((le,xe)=>le+xe,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var A,T;let m=U.priceToSqrtPriceX64(new E(e.price),e.mintA.decimals,e.mintB.decimals),l=U.getSqrtPriceX64FromTick(n),d=U.getSqrtPriceX64FromTick(r),p=a?1-s:1+s,g=pe(o,(A=e[t?"mintA":"mintB"].extensions)==null?void 0:A.feeConfig,u,!c),f=new ce(new E(g.amount.sub((T=g.fee)!=null?T:ue).toString()).mul(p).toFixed(0)),y;if(m.lte(l))y=t?Y.getLiquidityFromTokenAmountA(l,d,f,!a):new ce(0);else if(m.lte(d)){let w=Y.getLiquidityFromTokenAmountA(m,d,f,!a),C=Y.getLiquidityFromTokenAmountB(l,m,f);y=t?w:C}else y=t?new ce(0):Y.getLiquidityFromTokenAmountB(l,d,f);return ge.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:y,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var y,A,T,w;let u=U.getSqrtPriceX64FromTick(n),c=U.getSqrtPriceX64FromTick(r),m=a?1+s:1-s,l=Y.getAmountsFromLiquidity(U.priceToSqrtPriceX64(new E(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,p]=[pe(l.amountA,(y=t.mintA.extensions)==null?void 0:y.feeConfig,e,!0),pe(l.amountB,(A=t.mintB.extensions)==null?void 0:A.feeConfig,e,!0)],[g,f]=[pe(l.amountA.muln(m),(T=t.mintA.extensions)==null?void 0:T.feeConfig,e,!0),pe(l.amountB.muln(m),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:g,amountSlippageB:f,expirationTime:at(d.expirationTime,p.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(u=>!n[u.id]).map(u=>new Ge(u.id));(await st(e,r)).forEach((u,c)=>{!u||(n[r[c].toBase58()]=un.decode(u.data))});let s=t.map(u=>Re(new Ge(u.programId),new Ge(u.id)).publicKey),a=await ge.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((u,c)=>ee(Z({},u),{[c.id]:ee(Z({},n[c.id]),{id:new Ge(c.id),version:6,programId:new Ge(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:ee(Z({},c.config),{id:new Ge(c.config.id),fundOwner:""}),currentPrice:new E(c.price),exBitmapInfo:a[Re(new Ge(c.programId),new Ge(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber()})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var G=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(ue)||(o=o.add(Le)),o}static mulDivFloor(e,t,n){if(n.eq(ue))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ue))throw new Error("division by 0");return e.mul(t).add(n.sub(Le)).div(n)}static x64ToDecimal(e,t){return new E(e.toString()).div(E.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new X(e.mul(E.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(rn).sub(t).mod(rn)}};function Ae(i,e){return zn(i.mul(e),64,256)}function hs(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function zn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var U=class{static sqrtPriceX64ToPrice(e,t,n){return G.x64ToDecimal(e).pow(2).mul(E.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return G.decimalToX64(e.mul(E.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(ue))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ue))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(ue))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ue))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(ue))return e;let o=t.shln(Ot);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?G.mulDivCeil(s,e,a):G.mulDivRoundingUp(s,Le,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return G.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Ot);if(r)return e.add(o.div(t));{let s=G.mulDivRoundingUp(o,Le,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Te||e>Be)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new X("18445821805675395072"):new X("18446744073709551616");return(t&2)!=0&&(n=Ae(n,new X("18444899583751176192"))),(t&4)!=0&&(n=Ae(n,new X("18443055278223355904"))),(t&8)!=0&&(n=Ae(n,new X("18439367220385607680"))),(t&16)!=0&&(n=Ae(n,new X("18431993317065453568"))),(t&32)!=0&&(n=Ae(n,new X("18417254355718170624"))),(t&64)!=0&&(n=Ae(n,new X("18387811781193609216"))),(t&128)!=0&&(n=Ae(n,new X("18329067761203558400"))),(t&256)!=0&&(n=Ae(n,new X("18212142134806163456"))),(t&512)!=0&&(n=Ae(n,new X("17980523815641700352"))),(t&1024)!=0&&(n=Ae(n,new X("17526086738831433728"))),(t&2048)!=0&&(n=Ae(n,new X("16651378430235570176"))),(t&4096)!=0&&(n=Ae(n,new X("15030750278694412288"))),(t&8192)!=0&&(n=Ae(n,new X("12247334978884435968"))),(t&16384)!=0&&(n=Ae(n,new X("8131365268886854656"))),(t&32768)!=0&&(n=Ae(n,new X("3584323654725218816"))),(t&65536)!=0&&(n=Ae(n,new X("696457651848324352"))),(t&131072)!=0&&(n=Ae(n,new X("26294789957507116"))),(t&262144)!=0&&(n=Ae(n,new X("37481735321082"))),e>0&&(n=Zi.div(n)),n}static getTickFromPrice(e,t,n){return U.getTickFromSqrtPriceX64(U.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt($e)||e.lt(Je))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new X(t-64),r=hs(n,32,128),o=new X("8000000000000000","hex"),s=0,a=new X(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new X(0))&&s<Ji;){u=u.mul(u);let g=u.shrn(127);u=u.shrn(63+g.toNumber()),a=a.add(o.mul(g)),o=o.shrn(1),s+=1}let c=a.shrn(32),l=r.add(c).mul(new X($i)),d=zn(l.sub(new X(er)),64,128).toNumber(),p=zn(l.add(new X(tr)),64,128).toNumber();return d==p?d:U.getSqrtPriceX64FromTick(p).lte(e)?p:d}},yt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=U.getTickFromSqrtPriceX64(U.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=yt.getTickWithPriceAndTickspacing(e,t,n,r),s=U.getSqrtPriceX64FromTick(o);return U.sqrtPriceX64ToPrice(s,n,r)}},Y=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ue))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Ot),s=t.sub(e);return r?G.mulDivRoundingUp(G.mulDivCeil(o,s,t),Le,e):G.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ue))throw new Error("sqrtPriceX64A must greater than 0");return r?G.mulDivCeil(n,t.sub(e),Oe):G.mulDivFloor(n,t.sub(e),Oe)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?G.mulDivRoundingUp(a,Le,Gn):a.shrn(Ot)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),G.mulDivFloor(n,Gn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return Y.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=Y.getLiquidityFromTokenAmountA(e,n,r,!1),a=Y.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return Y.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:Y.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new X(0)};if(e.lt(n)){let s=Y.getTokenAmountAFromLiquidity(e,n,r,o),a=Y.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new X(0),amountB:Y.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=Y.getAmountsFromLiquidity(e,t,n,r,s),m=o?1+a:1-a,l=new X(new E(u.toString()).mul(m).toFixed(0)),d=new X(new E(c.toString()).mul(m).toFixed(0));return{amountSlippageA:l,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var T,w,C,V;let c=U.priceToSqrtPriceX64(new E(e.price),e.mintA.decimals,e.mintB.decimals),m=U.getSqrtPriceX64FromTick(t),l=U.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=Y.getAmountsFromLiquidity(c,m,l,r,s),[g,f]=[pe(p.amountA,(T=e.mintA.extensions)==null?void 0:T.feeConfig,a,u),pe(p.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,u)],[y,A]=[pe(new X(new E(p.amountA.toString()).mul(d).toFixed(0)),(C=e.mintA.extensions)==null?void 0:C.feeConfig,a,u),pe(new X(new E(p.amountB.toString()).mul(d).toFixed(0)),(V=e.mintB.extensions)==null?void 0:V.feeConfig,a,u)];return{liquidity:r,amountA:g,amountB:f,amountSlippageA:y,amountSlippageB:A,expirationTime:at(g.expirationTime,f.expirationTime)}}},bt=class{static swapCompute(e,t,n,r,o,s,a,u,c,m,l,d,p,g,f=!1){if(d.eq(ue))throw new Error("amountSpecified must not be 0");if(g||(g=s?Je.add(Le):$e.sub(Le)),s){if(g.lt(Je))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(g.gte(l))throw new Error("sqrtPriceX64 must smaller than current")}else{if(g.gt($e))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(g.lte(l))throw new Error("sqrtPriceX64 must greater than current")}let y=d.gt(ue),A={amountSpecifiedRemaining:d,amountCalculated:ue,sqrtPriceX64:l,tick:c>p?Math.min(p+z.tickCount(m)-1,c):p,accounts:[],liquidity:u,feeAmount:new X(0)},T=p,w=n[p],C=0,V=!s&&w.startTickIndex===A.tick;for(;!A.amountSpecifiedRemaining.eq(ue)&&!A.sqrtPriceX64.eq(g);){C>10;let B={};B.sqrtPriceStartX64=A.sqrtPriceX64;let F=R.nextInitTick(w,A.tick,m,s,V),L=F||null,H=null;if(!(L!=null&&L.liquidityGross.gtn(0))){let _=ge.nextInitializedTickArrayStartIndex({tickCurrent:A.tick,tickSpacing:m,tickArrayBitmap:r,exBitmapInfo:o},T,s);if(!_.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:A.amountSpecifiedRemaining,amountCalculated:A.amountCalculated,feeAmount:A.feeAmount,sqrtPriceX64:A.sqrtPriceX64,liquidity:A.liquidity,tickCurrent:A.tick,accounts:A.accounts};throw Error("swapCompute LiquidityInsufficient")}T=_.nextStartIndex;let{publicKey:ye}=te(e,t,T);H=ye,w=n[T];try{L=R.firstInitializedTick(w,s)}catch{throw Error("not found next tick info")}}B.tickNext=L.tick,B.initialized=L.liquidityGross.gtn(0),p!==T&&H&&(A.accounts.push(H),p=T),B.tickNext<Te?B.tickNext=Te:B.tickNext>Be&&(B.tickNext=Be),B.sqrtPriceNextX64=U.getSqrtPriceX64FromTick(B.tickNext);let h;if(s&&B.sqrtPriceNextX64.lt(g)||!s&&B.sqrtPriceNextX64.gt(g)?h=g:h=B.sqrtPriceNextX64,[A.sqrtPriceX64,B.amountIn,B.amountOut,B.feeAmount]=bt.swapStepCompute(A.sqrtPriceX64,h,A.liquidity,A.amountSpecifiedRemaining,a),A.feeAmount=A.feeAmount.add(B.feeAmount),y?(A.amountSpecifiedRemaining=A.amountSpecifiedRemaining.sub(B.amountIn.add(B.feeAmount)),A.amountCalculated=A.amountCalculated.sub(B.amountOut)):(A.amountSpecifiedRemaining=A.amountSpecifiedRemaining.add(B.amountOut),A.amountCalculated=A.amountCalculated.add(B.amountIn.add(B.feeAmount))),A.sqrtPriceX64.eq(B.sqrtPriceNextX64)){if(B.initialized){let _=L.liquidityNet;s&&(_=_.mul(Ze)),A.liquidity=Y.addDelta(A.liquidity,_)}V=B.tickNext!=A.tick&&!s&&w.startTickIndex===B.tickNext,A.tick=s?B.tickNext-1:B.tickNext}else if(A.sqrtPriceX64!=B.sqrtPriceStartX64){let _=U.getTickFromSqrtPriceX64(A.sqrtPriceX64);V=_!=A.tick&&!s&&w.startTickIndex===_,A.tick=_}++C}try{let{nextStartIndex:B,isExist:F}=z.nextInitializedTickArray(A.tick,m,s,r,o);F&&p!==B&&(A.accounts.push(te(e,t,B).publicKey),p=B)}catch{}return{allTrade:!0,amountSpecifiedRemaining:ue,amountCalculated:A.amountCalculated,feeAmount:A.feeAmount,sqrtPriceX64:A.sqrtPriceX64,liquidity:A.liquidity,tickCurrent:A.tick,accounts:A.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new X(0),amountIn:new X(0),amountOut:new X(0),feeAmount:new X(0)},a=e.gte(t),u=r.gte(ue);if(u){let m=G.mulDivFloor(r,an.sub(new X(o.toString())),an);s.amountIn=a?Y.getTokenAmountAFromLiquidity(t,e,n,!0):Y.getTokenAmountBFromLiquidity(e,t,n,!0),m.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=U.getNextSqrtPriceX64FromInput(e,n,m,a)}else s.amountOut=a?Y.getTokenAmountBFromLiquidity(t,e,n,!1):Y.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(Ze).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=U.getNextSqrtPriceX64FromOutput(e,n,r.mul(Ze),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=Y.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=Y.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:Y.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:Y.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(Ze))&&(s.amountOut=r.mul(Ze)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=G.mulDivCeil(s.amountIn,new X(o),an.sub(new X(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var be=60,ft=512,R=class{static getTickArrayAddressByTick(e,t,n,r){let o=R.getTickArrayStartIndexByTick(n,r),{publicKey:s}=te(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=R.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=be)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=z.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*z.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*be,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*be,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*be:e+t*be}static mergeTickArrayBitmap(e){let t=new Ts(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*be));return[...R.searchLowBitFromStart(e,t,s-1,o,n),...R.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return R.searchHightBitFromStart(e,t,0,ft,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=R.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=te(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>R.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),m=(n+7680)%512;if(s[c].testn(m)&&a.push(n),n--,a.length===r)break}let u=z.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>R.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),m=(n+7680)%512;if(s[c].testn(m)&&a.push(n),n++,a.length===r)break}let u=z.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Te||e>Be}static nextInitTick(e,t,n,r,o){if(z.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<be;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=be-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<be;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=U.getSqrtPriceX64FromTick(t),o=U.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new E(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new E(1).div(t),o=yt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=U.getSqrtPriceX64FromTick(o),a=U.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new E(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=U.getSqrtPriceX64FromTick(t),o=U.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new E(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new E(1).div(t),o=yt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=U.getSqrtPriceX64FromTick(o),a=U.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new E(1).div(a)}}};var Bs=M([fe(8),q("bump"),ut("index"),S(""),Me("protocolFeeRate"),Me("tradeFeeRate"),ut("tickSpacing"),j(b(),8,"")]),xs=M([Me("blockTimestamp"),D("sqrtPriceX64"),D("cumulativeTimePriceX64"),j(D(),1,"")]),Qn=M([fe(8),Ee("initialized"),S("poolId"),j(xs,1e3,"observations"),j(D(),5,"")]),Is=M([q("rewardState"),b("openTime"),b("endTime"),b("lastUpdateTime"),D("emissionsPerSecondX64"),b("rewardTotalEmissioned"),b("rewardClaimed"),S("tokenMint"),S("tokenVault"),S("creator"),D("rewardGrowthGlobalX64")]),un=M([fe(8),q("bump"),S("ammConfig"),S("creator"),S("mintA"),S("mintB"),S("vaultA"),S("vaultB"),S("observationId"),q("mintDecimalsA"),q("mintDecimalsB"),ut("tickSpacing"),D("liquidity"),D("sqrtPriceX64"),ke("tickCurrent"),ut("observationIndex"),ut("observationUpdateDuration"),D("feeGrowthGlobalX64A"),D("feeGrowthGlobalX64B"),b("protocolFeesTokenA"),b("protocolFeesTokenB"),D("swapInAmountTokenA"),D("swapOutAmountTokenB"),D("swapInAmountTokenB"),D("swapOutAmountTokenA"),q("status"),j(q(),7,""),j(Is,3,"rewardInfos"),j(b(),16,"tickArrayBitmap"),b("totalFeesTokenA"),b("totalFeesClaimedTokenA"),b("totalFeesTokenB"),b("totalFeesClaimedTokenB"),b("fundFeesTokenA"),b("fundFeesTokenB"),b("startTime"),j(b(),15*4-3,"padding")]),Ss=M([D("growthInsideLastX64"),b("rewardAmountOwed")]),Xn=M([fe(8),q("bump"),S("nftMint"),S("poolId"),ke("tickLower"),ke("tickUpper"),D("liquidity"),D("feeGrowthInsideLastX64A"),D("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),j(Ss,3,"rewardInfos"),j(b(),8,"")]),mb=M([fe(8),q("bump"),S("poolId"),ke("tickLowerIndex"),ke("tickUpperIndex"),D("liquidity"),D("feeGrowthInsideLastX64A"),D("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),j(D(),3,"rewardGrowthInside"),j(b(),8,"")]),Ks=M([ke("tick"),Oi("liquidityNet"),D("liquidityGross"),D("feeGrowthOutsideX64A"),D("feeGrowthOutsideX64B"),j(D(),3,"rewardGrowthsOutsideX64"),j(Me(),13,"")]),Mt=M([fe(8),S("poolId"),ke("startTickIndex"),j(Ks,be,"ticks"),q("initializedTickCount"),j(q(),115,"")]),Cs=M([fe(329),j(S(),100,"whitelistMints")]),ir=M([fe(8),S("poolId"),j(j(b(),8),Un,"positiveTickArrayBitmap"),j(j(b(),8),Un,"negativeTickArrayBitmap")]);var fb=M([fe(8),q("bump"),Ee("disableCreatePool"),ut("index"),b("tradeFeeRate"),b("protocolFeeRate"),b("fundFeeRate"),b("createPoolFee"),S("protocolOwner"),S("fundOwner"),j(b(),16)]),Ns=M([fe(8),S("configId"),S("poolCreator"),S("vaultA"),S("vaultB"),S("mintLp"),S("mintA"),S("mintB"),S("mintProgramA"),S("mintProgramB"),S("observationId"),q("bump"),q("status"),q("lpDecimals"),q("mintDecimalA"),q("mintDecimalB"),b("lpAmount"),b("protocolFeesMintA"),b("protocolFeesMintB"),b("fundFeesMintA"),b("fundFeesMintB"),j(b(),32)]);import{TransactionInstruction as Rs}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as kb,TOKEN_2022_PROGRAM_ID as wb,ASSOCIATED_TOKEN_PROGRAM_ID as hb}from"@solana/spl-token";var xb=ie("Raydium_cpmm"),Ls={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173]};function rr(i,e,t,n,r,o,s,a,u,c,m,l,d,p,g,f){let y=M([b("amountIn"),b("amounOutMin")]),A=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],T=Buffer.alloc(y.span);return y.encode({amountIn:g,amounOutMin:f},T),new Rs({keys:A,programId:i,data:Buffer.from([...Ls.swapBaseInput,...T])})}import{PublicKey as Kb}from"@solana/web3.js";var Nb=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Rb=Buffer.from("amm_config","utf8"),Lb=Buffer.from("pool","utf8"),Ob=Buffer.from("pool_lp_mint","utf8"),Mb=Buffer.from("pool_vault","utf8"),Eb=Buffer.from("observation","utf8");import Os from"bn.js";var vb=new Os(1e6);import Ms from"bn.js";var Ub=new Ms(0);import{PublicKey as xy}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as we,TOKEN_2022_PROGRAM_ID as mt,ASSOCIATED_TOKEN_PROGRAM_ID as or}from"@solana/spl-token";import{PublicKey as K,TransactionInstruction as Ue,SystemProgram as ht,Keypair as Yn}from"@solana/web3.js";import sr from"bn.js";var ar=ie("Raydium_Clmm"),Xe={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},_t=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,g){let f=M([D("sqrtPriceX64"),b("startTime")]),y=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:ht.programId,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1}],A=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:g},A);let T=Buffer.from([...Xe.createPool,...A]);return new Ue({keys:y,programId:e,data:T})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:r,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:u,startTime:c,forerunCreate:m}=e,l=Fn({fromPublicKey:r,programId:n}),[d,p]=[new K(o.address),new K(s.address)],g=[ht.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:l.seed,newAccountPubkey:l.publicKey,lamports:m?0:await t.getMinimumBalanceForRentExemption(Qn.span),space:Qn.span,programId:n})],{publicKey:f}=Hi(n,a,d,p,r),{publicKey:y}=qn(n,f,d),{publicKey:A}=qn(n,f,p);return g.push(this.createPoolInstruction(n,f,r,a,l.publicKey,d,y,new K(o.programId||we),p,A,new K(s.programId||we),Re(n,f).publicKey,u,c)),{signers:[],instructions:g,instructionTypes:[re.CreateAccount,re.ClmmCreatePool],address:{poolId:f,observationId:l.publicKey,mintAVault:y,mintBVault:A},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,g,f,y,A,T,w,C,V,B,F,L,H,h){let _=M([ke("tickLowerIndex"),ke("tickUpperIndex"),ke("tickArrayLowerStartIndex"),ke("tickArrayUpperStartIndex"),D("liquidity"),b("amountMaxA"),b("amountMaxB"),Ee("withMetadata"),q("optionBaseFlag"),Ee("baseFlag")]),ye=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],le=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:ht.programId,isSigner:!1,isWritable:!1},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:or,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},...ye],xe=Buffer.alloc(_.span);_.encode({tickLowerIndex:T,tickUpperIndex:w,tickArrayLowerStartIndex:C,tickArrayUpperStartIndex:V,liquidity:B,amountMaxA:F,amountMaxB:L,withMetadata:H==="create",baseFlag:!1,optionBaseFlag:0},xe);let ae=Buffer.from([...Xe.openPosition,...xe]);return new Ue({keys:le,programId:e,data:ae})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:m}){let l=[],[d,p]=[new K(e.programId),new K(e.id)],g;if(m)g=new K((await m(1))[0]);else{let L=Yn.generate();l.push(L),g=L.publicKey}let f=R.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=R.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=te(d,p,f),{publicKey:T}=te(d,p,y),{publicKey:w}=Qe(n.wallet,g,we),{publicKey:C}=tn(g),{publicKey:V}=qe(d,g),{publicKey:B}=pt(d,p,r,o),F=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,g,w,C,B,A,T,V,n.tokenAccountA,n.tokenAccountB,new K(t.vault.A),new K(t.vault.B),new K(e.mintA.address),new K(e.mintB.address),r,o,f,y,s,a,u,c);return{signers:l,instructions:[F],instructionTypes:[re.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:g,tickArrayLower:A,tickArrayUpper:T,positionNftAccount:w,metadataAccount:C,personalPosition:V,protocolPosition:B}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:m}){let l=[],[d,p]=[new K(e.programId),new K(e.id)],g;if(m)g=new K((await m(1))[0]);else{let L=Yn.generate();l.push(L),g=L.publicKey}let f=R.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=R.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=te(d,p,f),{publicKey:T}=te(d,p,y),{publicKey:w}=Qe(n.wallet,g,we),{publicKey:C}=tn(g),{publicKey:V}=qe(d,g),{publicKey:B}=pt(d,p,r,o),F=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,g,w,C,B,A,T,V,n.tokenAccountA,n.tokenAccountB,new K(t.vault.A),new K(t.vault.B),new K(e.mintA.address),new K(e.mintB.address),r,o,f,y,c,s,a,u,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,y])?Re(d,p).publicKey:void 0);return{address:{nftMint:g,tickArrayLower:A,tickArrayUpper:T,positionNftAccount:w,metadataAccount:C,personalPosition:V,protocolPosition:B},instructions:[F],signers:l,instructionTypes:[re.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,g,f,y,A,T,w,C,V,B,F,L,H,h){let _=M([ke("tickLowerIndex"),ke("tickUpperIndex"),ke("tickArrayLowerStartIndex"),ke("tickArrayUpperStartIndex"),D("liquidity"),b("amountMaxA"),b("amountMaxB"),Ee("withMetadata"),q("optionBaseFlag"),Ee("baseFlag")]),ye=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],le=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:ht.programId,isSigner:!1,isWritable:!1},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:or,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},...ye],xe=Buffer.alloc(_.span);_.encode({tickLowerIndex:T,tickUpperIndex:w,tickArrayLowerStartIndex:C,tickArrayUpperStartIndex:V,liquidity:new sr(0),amountMaxA:F==="MintA"?L:H,amountMaxB:F==="MintA"?H:L,withMetadata:B==="create",baseFlag:F==="MintA",optionBaseFlag:1},xe);let ae=Buffer.from([...Xe.openPosition,...xe]);return new Ue({keys:le,programId:e,data:ae})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:m}){let l,d=[];if(m)l=new K((await m(1))[0]);else{let L=Yn.generate();d.push(L),l=L.publicKey}let[p,g]=[new K(e.programId),new K(e.id)],f=R.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=R.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=te(p,g,f),{publicKey:T}=te(p,g,y),{publicKey:w}=Qe(n.wallet,l,we),{publicKey:C}=tn(l),{publicKey:V}=qe(p,l),{publicKey:B}=pt(p,g,r,o),F=this.openPositionFromLiquidityInstruction(p,n.wallet,g,n.wallet,l,w,C,B,A,T,V,n.tokenAccountA,n.tokenAccountB,new K(t.vault.A),new K(t.vault.B),new K(t.mintA.address),new K(t.mintB.address),r,o,f,y,s,a,u,c,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,y])?Re(p,g).publicKey:void 0);return{address:{nftMint:l,tickArrayLower:A,tickArrayUpper:T,positionNftAccount:w,metadataAccount:C,personalPosition:V,protocolPosition:B},instructions:[F],signers:d,instructionTypes:[re.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=M([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:ht.programId,isSigner:!1,isWritable:!1},{pubkey:we,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...Xe.closePosition,...u]);return new Ue({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new K(e.programId),{publicKey:s}=Qe(n.wallet,r.nftMint,we),{publicKey:a}=qe(o,r.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[re.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,g,f,y,A,T){let w=M([D("liquidity"),b("amountMaxA"),b("amountMaxB"),q("optionBaseFlag"),Ee("baseFlag")]),C=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],V=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...C],B=Buffer.alloc(w.span);w.encode({liquidity:f,amountMaxA:y,amountMaxB:A,optionBaseFlag:0,baseFlag:!1},B);let F=Buffer.from([...Xe.increaseLiquidity,...B]);return new Ue({keys:V,programId:e,data:F})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new K(e.programId),new K(e.id)],m=R.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),l=R.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=te(u,c,m),{publicKey:p}=te(u,c,l),{publicKey:g}=Qe(r.wallet,n.nftMint,we),{publicKey:f}=qe(u,n.nftMint),{publicKey:y}=pt(u,c,n.tickLower,n.tickUpper),A=this.increasePositionFromLiquidityInstruction(u,r.wallet,g,f,c,y,d,p,r.tokenAccountA,r.tokenAccountB,new K(t.vault.A),new K(t.vault.B),new K(e.mintA.address),new K(e.mintB.address),o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,l])?Re(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:g,personalPosition:f,protocolPosition:y},signers:[],instructions:[A],instructionTypes:[re.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new K(e.programId),new K(e.id)],m=R.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),l=R.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=te(u,c,m),{publicKey:p}=te(u,c,l),{publicKey:g}=Qe(r.wallet,n.nftMint,we),{publicKey:f}=qe(u,n.nftMint),{publicKey:y}=pt(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:g,personalPosition:f,protocolPosition:y},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,g,f,c,y,d,p,r.tokenAccountA,r.tokenAccountB,new K(t.vault.A),new K(t.vault.B),new K(e.mintA.address),new K(e.mintB.address),o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,l])?Re(u,c).publicKey:void 0)],signers:[],instructionTypes:[re.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,g,f,y,A,T){let w=M([D("liquidity"),b("amountMaxA"),b("amountMaxB"),q("optionBaseFlag"),Ee("baseFlag")]),C=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],V=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...C],B=Buffer.alloc(w.span);w.encode({liquidity:new sr(0),amountMaxA:f==="MintA"?y:A,amountMaxB:f==="MintA"?A:y,baseFlag:f==="MintA",optionBaseFlag:1},B);let F=Buffer.from([...Xe.increaseLiquidity,...B]);return new Ue({keys:V,programId:e,data:F})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,g,f,y,A,T,w){let C=M([D("liquidity"),b("amountMinA"),b("amountMinB")]),V=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...f.map(H=>[{pubkey:H.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:H.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:H.rewardMint,isSigner:!1,isWritable:!1}]).flat()],B=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:Xt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...V],F=Buffer.alloc(C.span);C.encode({liquidity:y,amountMinA:A,amountMinB:T},F);let L=Buffer.from([...Xe.decreaseLiquidity,...F]);return new Ue({keys:B,programId:e,data:L})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,m]=[new K(e.programId),new K(e.id)],l=R.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=R.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=te(c,m,l),{publicKey:g}=te(c,m,d),{publicKey:f}=Qe(r.wallet,n.nftMint,u),{publicKey:y}=qe(c,n.nftMint),{publicKey:A}=pt(c,m,n.tickLower,n.tickUpper),T=[];for(let C=0;C<e.rewardDefaultInfos.length;C++)T.push({poolRewardVault:new K(t.rewardInfos[C].vault),ownerRewardVault:r.rewardAccounts[C],rewardMint:new K(e.rewardDefaultInfos[C].mint.address)});let w=[];return w.push(this.decreaseLiquidityInstruction(c,r.wallet,f,y,m,A,p,g,r.tokenAccountA,r.tokenAccountB,new K(t.vault.A),new K(t.vault.B),new K(e.mintA.address),new K(e.mintB.address),T,o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,d])?Re(c,m).publicKey:void 0)),{address:{tickArrayLower:p,tickArrayUpper:g,positionNftAccount:f,personalPosition:y,protocolPosition:A},signers:[],instructions:w,instructionTypes:[re.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,g,f,y,A){let T=M([b("amount"),b("otherAmountThreshold"),D("sqrtPriceLimitX64"),Ee("isBaseInput")]),w=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[],...l.map(F=>({pubkey:F,isSigner:!1,isWritable:!0}))],C=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:Xt,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},...w],V=Buffer.alloc(T.span);T.encode({amount:p,otherAmountThreshold:g,sqrtPriceLimitX64:f,isBaseInput:y},V);let B=Buffer.from([...Xe.swap,...V]);return new Ue({keys:C,programId:e,data:B})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[m,l]=[new K(e.programId),new K(e.id)],[d,p]=[new K(t.vault.A),new K(t.vault.B)],[g,f]=[new K(e.mintA.address),new K(e.mintB.address)],y=e.mintA.address===o.toString(),A=[this.swapInstruction(m,r.wallet,l,new K(e.config.id),y?r.tokenAccountA:r.tokenAccountB,y?r.tokenAccountB:r.tokenAccountA,y?d:p,y?p:d,y?g:f,y?f:g,c,n,s,a,u,!0,Re(m,l).publicKey)];return{signers:[],instructions:A,instructionTypes:[re.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,m,l,d){let p=M([b("openTime"),b("endTime"),D("emissionsPerSecondX64")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:ht.programId,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:se(m),endTime:se(l),emissionsPerSecondX64:d},f);let y=Buffer.from([...Xe.initReward,...f]);return new Ue({keys:g,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new K(e.programId),new K(e.id)],a=ji(o,s,r.mint).publicKey,u=nn(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new K(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[re.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,m,l,d){let p=M([q("rewardIndex"),D("emissionsPerSecondX64"),b("openTime"),b("endTime")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:se(m),endTime:se(l)},f);let y=Buffer.from([...Xe.setRewardEmissions,...f]);return new Ue({keys:g,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new K(e.programId),new K(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,u=new K(t.rewardInfos[d].vault),c=new K(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&ar.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let m=nn(o).publicKey,l=[this.setRewardInstruction(o,n.wallet,s,m,new K(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:m},signers:[],instructions:l,instructionTypes:[re.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=M([q("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:Xt,isSigner:!1,isWritable:!1}],m=Buffer.alloc(u.span);u.encode({rewardIndex:a},m);let l=Buffer.from([...Xe.collectReward,...m]);return new Ue({keys:c,programId:e,data:l})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new K(e.programId),new K(e.id)],a,u;for(let m=0;m<e.rewardDefaultInfos.length;m++)e.rewardDefaultInfos[m].mint.address===r.toString()&&(a=m,u=new K(t.rewardInfos[m].vault));(a===void 0||u===void 0)&&ar.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[re.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:r,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,m]=[new K(e.programId),new K(e.id)],[l,d]=[new K(t.vault.A),new K(t.vault.B)],[p,g]=[new K(e.mintA.address),new K(e.mintB.address)],f=e.mintA.address===r.toString(),y=[this.swapInstruction(c,n.wallet,m,new K(e.config.id),f?n.tokenAccountB:n.tokenAccountA,f?n.tokenAccountA:n.tokenAccountB,f?d:l,f?l:d,f?p:g,f?g:p,u,l,o,s,a,!1)];return{signers:[],instructions:y,instructionTypes:[re.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};import qy from"bn.js";import{AccountLayout as Uy,TOKEN_PROGRAM_ID as Xy}from"@solana/spl-token";import Us from"bn.js";var bg=M([Me("mintAuthorityOption"),S("mintAuthority"),b("supply"),q("decimals"),q("isInitialized"),Me("freezeAuthorityOption"),S("freezeAuthority")]);import{TOKEN_PROGRAM_ID as Hn,TOKEN_2022_PROGRAM_ID as _s,ASSOCIATED_TOKEN_PROGRAM_ID as vs}from"@solana/spl-token";import{PublicKey as N,TransactionInstruction as jn,SystemProgram as Zn}from"@solana/web3.js";import gt from"bn.js";function Lg(i,e,t,n,r,o,s,a,u,c,m,l){let d=M([q("instruction"),b("amountIn"),b("amountOut")]),p=[{pubkey:Zn.programId,isSigner:!1,isWritable:!1},{pubkey:Hn,isSigner:!1,isWritable:!1},{pubkey:new N(t.programId),isSigner:!1,isWritable:!1},{pubkey:new N(t.id),isSigner:!1,isWritable:!0},{pubkey:new N(n.id),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let f=Ne(t);p.push({pubkey:f.config.id,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.A:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.B:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},...l.map(y=>({pubkey:y,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let f=Ne(t);p.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:new N("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0})}else{let f=Ne(t);p.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},...f.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:f.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:f.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0}])}let g=Buffer.alloc(d.span);return d.encode({instruction:4,amountIn:c,amountOut:m},g),new jn({keys:p,programId:i,data:g})}function Og(i,e,t,n,r,o,s,a,u,c){let m=M([q("instruction")]),l=[{pubkey:Zn.programId,isSigner:!1,isWritable:!1},{pubkey:Hn,isSigner:!1,isWritable:!1},{pubkey:new N(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new N(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new N(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let p=Ne(n);l.push({pubkey:p.config.id,isSigner:!1,isWritable:!1},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.mintA.address.equals(u)?p.vault.A:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.mintA.address.equals(u)?p.vault.B:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0},...c.map(g=>({pubkey:g,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let p=Ne(n);l.push({pubkey:p.authority,isSigner:!1,isWritable:!1},{pubkey:p.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:new N("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:p.openOrders,isSigner:!1,isWritable:!0},{pubkey:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.marketId,isSigner:!1,isWritable:!0},{pubkey:p.marketBids,isSigner:!1,isWritable:!0},{pubkey:p.marketAsks,isSigner:!1,isWritable:!0},{pubkey:p.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0})}else{let p=Ne(n);l.push({pubkey:p.authority,isSigner:!1,isWritable:!1},{pubkey:p.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:p.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:p.openOrders,isSigner:!1,isWritable:!0},{pubkey:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.marketId,isSigner:!1,isWritable:!0},{pubkey:p.marketBids,isSigner:!1,isWritable:!0},{pubkey:p.marketAsks,isSigner:!1,isWritable:!0},{pubkey:p.marketEventQueue,isSigner:!1,isWritable:!0},...p.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:p.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:p.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0}])}let d=Buffer.alloc(m.span);return m.encode({instruction:5},d),new jn({keys:l,programId:i,data:d})}function Ds(i,e,t,n,r,o,s,a,u,c,m,l,d,p,g){var B;let f=[],y=[k({pubkey:Hn,isWritable:!1}),k({pubkey:_s,isWritable:!1}),k({pubkey:vs,isWritable:!1}),k({pubkey:Zn.programId,isWritable:!1}),k({pubkey:e,isSigner:!0})];y.push(k({pubkey:t})),y.push(k({pubkey:r}));let A=[u,c],T=[m,l],w=[o,s,a];for(let F=0;F<A.length;F++){let L=A[F],H=w[F]===L.mintA.address;if(y.push(k({pubkey:new N(L.programId),isWritable:!1})),F===A.length-1?y.push(k({pubkey:r})):y.push(k({pubkey:n})),y.push(k({pubkey:new N(w[F])})),y.push(k({pubkey:new N(w[F+1])})),L.version===6){let h=T[F];y.push(k({pubkey:new N(h.config.id)})),y.push(k({pubkey:new N(h.id)})),y.push(k({pubkey:new N(H?h.vault.A:h.vault.B)})),y.push(k({pubkey:new N(H?h.vault.B:h.vault.A)})),y.push(k({pubkey:new N(L.observationId)})),y.push(k({pubkey:An})),y.push(k({pubkey:Re(new N(L.programId),new N(L.id)).publicKey})),f.push(Vs(L.sqrtPriceX64.toString(),H));for(let _ of(B=g[F])!=null?B:[])y.push(k({pubkey:new N(_)}))}else if(L.version===5){let h=T[F];y.push(k({pubkey:new N(h.id)})),y.push(k({pubkey:new N(h.authority),isWritable:!1})),y.push(k({pubkey:new N(h.marketProgramId)})),y.push(k({pubkey:new N(h.marketAuthority)})),y.push(k({pubkey:Si,isWritable:!1})),y.push(k({pubkey:new N(h.openOrders)})),y.push(k({pubkey:new N(h.vault.A)})),y.push(k({pubkey:new N(h.vault.B)})),y.push(k({pubkey:new N(h.id)})),y.push(k({pubkey:new N(h.id)})),y.push(k({pubkey:new N(h.id)})),y.push(k({pubkey:new N(h.id)})),y.push(k({pubkey:new N(h.id)})),y.push(k({pubkey:new N(h.id)})),y.push(k({pubkey:new N(h.marketId)})),y.push(k({pubkey:new N(h.marketBids)})),y.push(k({pubkey:new N(h.marketAsks)})),y.push(k({pubkey:new N(h.marketEventQueue)})),y.push(k({pubkey:new N(h.marketBaseVault)})),y.push(k({pubkey:new N(h.marketQuoteVault)}))}else if(L.version===4){let h=T[F],_=L.status!==1;y.push(k({pubkey:new N(h.id)})),y.push(k({pubkey:new N(h.authority),isWritable:!1})),y.push(k({pubkey:new N(_?h.id:h.marketProgramId)})),y.push(k({pubkey:new N(_?h.id:h.marketAuthority)})),y.push(k({pubkey:new N(_?h.id:h.openOrders)})),y.push(k({pubkey:new N(h.vault.A)})),y.push(k({pubkey:new N(h.vault.B)})),y.push(k({pubkey:new N(_?h.id:h.marketId)})),y.push(k({pubkey:new N(_?h.id:h.marketBids)})),y.push(k({pubkey:new N(_?h.id:h.marketAsks)})),y.push(k({pubkey:new N(_?h.id:h.marketEventQueue)})),y.push(k({pubkey:new N(_?h.id:h.marketBaseVault)})),y.push(k({pubkey:new N(_?h.id:h.marketQuoteVault)}))}else if(L.version===7){let h=T[F];y.push(k({pubkey:new N(h.authority)})),y.push(k({pubkey:new N(h.config.id)})),y.push(k({pubkey:new N(h.id)})),y.push(k({pubkey:new N(H?h.vault.A:h.vault.B)})),y.push(k({pubkey:new N(H?h.vault.B:h.vault.A)})),y.push(k({pubkey:new N(L.observationId)}))}else throw Error("pool type error")}let C=M([q("insId"),b("amountIn"),b("amountOut"),j(D(),f.length,"clmmPriceLimit")]),V=Buffer.alloc(C.span);return C.encode({insId:0,amountIn:d,amountOut:p,clmmPriceLimit:f},V),new jn({keys:y,programId:i,data:V})}function Vs(i,e){if(i)if(e){let t=new gt(i).div(new gt(25));return t.gt(on)?t:on}else{let t=new gt(i).mul(new gt(25));return t.lt(sn)?t:sn}else return e?on:sn}function Ws({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){var r,o,s,a,u,c,m;if(n.routeType==="amm")if(n.poolInfo[0].version===6){let l=n.poolKey[0],d=Ne(l),p=t.equals(d.mintA.address)?Je.add(Le):$e.sub(Le);return _t.makeSwapBaseInInstructions({poolInfo:l,poolKeys:l,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:d.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:d.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?o:new gt(0)),sqrtPriceLimitX64:p,remainingAccounts:(s=n.remainingAccounts[0])!=null?s:[]})}else if(n.poolInfo[0].version===7){let l=n.poolInfo[0],d=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[rr(l.programId,e.wallet,l.authority,l.configId,l.id,e.sourceToken,e.destinationToken,d?l.vaultA:l.vaultB,d?l.vaultB:l.vaultA,d?l.mintProgramA:l.mintProgramB,d?l.mintProgramB:l.mintProgramA,new N(l[d?"mintA":"mintB"].address),new N(l[d?"mintB":"mintA"].address),l.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[d?re.CpmmSwapBaseIn:re.CpmmSwapBaseOut],address:{}}}else{let l=n.poolKey[0];return{signers:[],instructions:[Ui({poolKeys:l,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((u=(a=n.minAmountOut.fee)==null?void 0:a.raw)!=null?u:new gt(0)),fixedSide:"in"})],lookupTableAddress:l.lookupTableAccount?[l.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?re.AmmV5SwapBaseIn:re.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let l=n.poolInfo[0],d=n.poolInfo[1],p=n.poolKey[0],g=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[Ds(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),l,d,p,g,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((m=(c=n.minAmountOut.fee)==null?void 0:c.raw)!=null?m:new gt(0)),n.remainingAccounts)],instructionTypes:[re.RouteSwap],lookupTableAddress:[p.lookupTableAccount,g.lookupTableAccount].filter(f=>f!==void 0),address:{}}}else throw Error("route type error")}var qs={[Ii.toBase58()]:3};var Gs=M([fe(5),fe(8),S("ownAddress"),b("vaultSignerNonce"),S("baseMint"),S("quoteMint"),S("baseVault"),b("baseDepositsTotal"),b("baseFeesAccrued"),S("quoteVault"),b("quoteDepositsTotal"),b("quoteFeesAccrued"),b("quoteDustThreshold"),S("requestQueue"),S("eventQueue"),S("bids"),S("asks"),b("baseLotSize"),b("quoteLotSize"),b("feeRateBps"),b("referrerRebatesAccrued"),fe(7)]);import{PublicKey as Gg}from"@solana/web3.js";var Yg=ie("Serum");var DA=new Us(0);export{Ws as makeSwapInstruction,Lg as route1Instruction,Og as route2Instruction,Ds as routeInstruction};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=index.mjs.map
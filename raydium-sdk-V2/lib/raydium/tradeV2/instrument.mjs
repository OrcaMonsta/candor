var ir=Object.defineProperty,rr=Object.defineProperties;var or=Object.getOwnPropertyDescriptors;var Jn=Object.getOwnPropertySymbols;var sr=Object.prototype.hasOwnProperty,ar=Object.prototype.propertyIsEnumerable;var $n=(i,e,t)=>e in i?ir(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,J=(i,e)=>{for(var t in e||(e={}))sr.call(e,t)&&$n(i,t,e[t]);if(Jn)for(var t of Jn(e))ar.call(e,t)&&$n(i,t,e[t]);return i},ee=(i,e)=>rr(i,or(e));import{TOKEN_PROGRAM_ID as Qn,TOKEN_2022_PROGRAM_ID as Ss,ASSOCIATED_TOKEN_PROGRAM_ID as Cs}from"@solana/spl-token";import{PublicKey as N,TransactionInstruction as Zn,SystemProgram as Yn}from"@solana/web3.js";import gt from"bn.js";import{PublicKey as Gp}from"@solana/web3.js";var wt=9e15,it=1e9,un="0123456789abcdef",vt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Wt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",cn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-wt,maxE:wt,crypto:!1},ii,Qe,V=!0,Dt="[DecimalError] ",nt=Dt+"Invalid argument: ",ri=Dt+"Precision limit exceeded",oi=Dt+"crypto unavailable",si="[object Decimal]",Ae=Math.floor,me=Math.pow,ur=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,cr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,lr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,ai=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ve=1e7,v=7,mr=9007199254740991,dr=vt.length-1,ln=Wt.length-1,k={toStringTag:si};k.absoluteValue=k.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),M(i)};k.ceil=function(){return M(new this.constructor(this),this.e+1,2)};k.clampedTo=k.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(nt+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};k.comparedTo=k.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};k.cosine=k.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+v,n.rounding=1,t=pr(n,di(n,t)),n.precision=i,n.rounding=e,M(Qe==2||Qe==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};k.cubeRoot=k.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,m=this,l=m.constructor;if(!m.isFinite()||m.isZero())return new l(m);for(V=!1,o=m.s*me(m.s*m,1/3),!o||Math.abs(o)==1/0?(t=ge(m.d),i=m.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=me(t,1/3),i=Ae((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new l(t),n.s=m.s):n=new l(o.toString()),s=(i=l.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(m),n=ne(c.plus(m).times(a),c.plus(u),s+2,1),ge(a.d).slice(0,s)===(t=ge(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(M(a,i+1,0),a.times(a).times(a).eq(m))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(M(n,i+1,1),e=!n.times(n).times(n).eq(m));break}return V=!0,M(n,i,l.rounding,e)};k.decimalPlaces=k.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-Ae(this.e/v))*v,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};k.dividedBy=k.div=function(i){return ne(this,new this.constructor(i))};k.dividedToIntegerBy=k.divToInt=function(i){var e=this,t=e.constructor;return M(ne(e,new t(i),0,1,1),t.precision,t.rounding)};k.equals=k.eq=function(i){return this.cmp(i)===0};k.floor=function(){return M(new this.constructor(this),this.e+1,3)};k.greaterThan=k.gt=function(i){return this.cmp(i)>0};k.greaterThanOrEqualTo=k.gte=function(i){var e=this.cmp(i);return e==1||e===0};k.hyperbolicCosine=k.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/qt(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=kt(s,1,o.times(e),new s(1),!0);for(var u,c=i,m=new s(8);c--;)u=o.times(o),o=a.minus(u.times(m.minus(u.times(m))));return M(o,s.precision=t,s.rounding=n,!0)};k.hyperbolicSine=k.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=kt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/qt(5,i)),r=kt(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,M(r,e,t,!0)};k.hyperbolicTangent=k.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,ne(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};k.inverseCosine=k.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Fe(t,r,o):new t(0):new t(NaN):e.isZero()?Fe(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Fe(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};k.inverseHyperbolicCosine=k.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,V=!1,t=t.times(t).minus(1).sqrt().plus(t),V=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};k.inverseHyperbolicSine=k.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,V=!1,t=t.times(t).plus(1).sqrt().plus(t),V=!0,n.precision=i,n.rounding=e,t.ln())};k.inverseHyperbolicTangent=k.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?M(new o(r),i,e,!0):(o.precision=t=n-r.e,r=ne(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};k.inverseSine=k.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Fe(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};k.inverseTangent=k.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,m=c.constructor,l=m.precision,d=m.rounding;if(c.isFinite()){if(c.isZero())return new m(c);if(c.abs().eq(1)&&l+4<=ln)return s=Fe(m,l+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new m(NaN);if(l+4<=ln)return s=Fe(m,l+4,d).times(.5),s.s=c.s,s}for(m.precision=a=l+10,m.rounding=1,t=Math.min(28,a/v+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(V=!1,e=Math.ceil(a/v),n=1,u=c.times(c),s=new m(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),V=!0,M(s,m.precision=l,m.rounding=d,!0)};k.isFinite=function(){return!!this.d};k.isInteger=k.isInt=function(){return!!this.d&&Ae(this.e/v)>this.d.length-2};k.isNaN=function(){return!this.s};k.isNegative=k.isNeg=function(){return this.s<0};k.isPositive=k.isPos=function(){return this.s>0};k.isZero=function(){return!!this.d&&this.d[0]===0};k.lessThan=k.lt=function(i){return this.cmp(i)<0};k.lessThanOrEqualTo=k.lte=function(i){return this.cmp(i)<1};k.logarithm=k.log=function(i){var e,t,n,r,o,s,a,u,c=this,m=c.constructor,l=m.precision,d=m.rounding,p=5;if(i==null)i=new m(10),e=!0;else{if(i=new m(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new m(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new m(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(V=!1,a=l+p,s=tt(c,a),n=e?_t(m,a+10):tt(i,a),u=ne(s,n,a,1),Pt(u.d,r=l,d))do if(a+=10,s=tt(c,a),n=e?_t(m,a+10):tt(i,a),u=ne(s,n,a,1),!o){+ge(u.d).slice(r+1,r+15)+1==1e14&&(u=M(u,l+1,0));break}while(Pt(u.d,r+=10,d));return V=!0,M(u,l,d)};k.minus=k.sub=function(i){var e,t,n,r,o,s,a,u,c,m,l,d,p=this,y=p.constructor;if(i=new y(i),!p.d||!i.d)return!p.s||!i.s?i=new y(NaN):p.d?i.s=-i.s:i=new y(i.d||p.s!==i.s?p:NaN),i;if(p.s!=i.s)return i.s=-i.s,p.plus(i);if(c=p.d,d=i.d,a=y.precision,u=y.rounding,!c[0]||!d[0]){if(d[0])i.s=-i.s;else if(c[0])i=new y(p);else return new y(u===3?-0:0);return V?M(i,a,u):i}if(t=Ae(i.e/v),m=Ae(p.e/v),c=c.slice(),o=m-t,o){for(l=o<0,l?(e=c,o=-o,s=d.length):(e=d,t=m,s=c.length),n=Math.max(Math.ceil(a/v),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,l=n<s,l&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){l=c[n]<d[n];break}o=0}for(l&&(e=c,c=d,d=e,i.s=-i.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(r=n;r&&c[--r]===0;)c[r]=ve-1;--c[r],c[n]+=ve}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=Vt(c,t),V?M(i,a,u):i):new y(u===3?-0:0)};k.modulo=k.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?M(new n(t),n.precision,n.rounding):(V=!1,n.modulo==9?(e=ne(t,i.abs(),0,3,1),e.s*=i.s):e=ne(t,i,0,n.modulo,1),e=e.times(i),V=!0,t.minus(e))};k.naturalExponential=k.exp=function(){return mn(this)};k.naturalLogarithm=k.ln=function(){return tt(this)};k.negated=k.neg=function(){var i=new this.constructor(this);return i.s=-i.s,M(i)};k.plus=k.add=function(i){var e,t,n,r,o,s,a,u,c,m,l=this,d=l.constructor;if(i=new d(i),!l.d||!i.d)return!l.s||!i.s?i=new d(NaN):l.d||(i=new d(i.d||l.s===i.s?l:NaN)),i;if(l.s!=i.s)return i.s=-i.s,l.minus(i);if(c=l.d,m=i.d,a=d.precision,u=d.rounding,!c[0]||!m[0])return m[0]||(i=new d(l)),V?M(i,a,u):i;if(o=Ae(l.e/v),n=Ae(i.e/v),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=m.length):(t=m,n=o,s=c.length),o=Math.ceil(a/v),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=m.length,s-r<0&&(r=s,t=m,m=c,c=t),e=0;r;)e=(c[--r]=c[r]+m[r]+e)/ve|0,c[r]%=ve;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=Vt(c,n),V?M(i,a,u):i};k.precision=k.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(nt+i);return t.d?(e=ui(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};k.round=function(){var i=this,e=i.constructor;return M(new e(i),i.e+1,e.rounding)};k.sine=k.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+v,n.rounding=1,t=br(n,di(n,t)),n.precision=i,n.rounding=e,M(Qe>2?t.neg():t,i,e,!0)):new n(NaN)};k.squareRoot=k.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,m=s.constructor;if(c!==1||!a||!a[0])return new m(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(V=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=ge(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=Ae((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new m(e)):n=new m(c.toString()),t=(u=m.precision)+3;;)if(o=n,n=o.plus(ne(s,o,t+2,1)).times(.5),ge(o.d).slice(0,t)===(e=ge(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(M(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(M(n,u+1,1),i=!n.times(n).eq(s));break}return V=!0,M(n,u,m.rounding,i)};k.tangent=k.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=ne(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,M(Qe==2||Qe==4?t.neg():t,i,e,!0)):new n(NaN)};k.times=k.mul=function(i){var e,t,n,r,o,s,a,u,c,m=this,l=m.constructor,d=m.d,p=(i=new l(i)).d;if(i.s*=m.s,!d||!d[0]||!p||!p[0])return new l(!i.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?i.s/0:i.s*0);for(t=Ae(m.e/v)+Ae(i.e/v),u=d.length,c=p.length,u<c&&(o=d,d=p,p=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+p[n]*d[r-n-1]+e,o[r--]=a%ve|0,e=a/ve|0;o[r]=(o[r]+e)%ve|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=Vt(o,t),V?M(i,l.precision,l.rounding):i};k.toBinary=function(i,e){return pn(this,2,i,e)};k.toDecimalPlaces=k.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Ie(i,0,it),e===void 0?e=n.rounding:Ie(e,0,8),M(t,i+t.e+1,e))};k.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Xe(n,!0):(Ie(i,0,it),e===void 0?e=r.rounding:Ie(e,0,8),n=M(new r(n),i+1,e),t=Xe(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};k.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Xe(r):(Ie(i,0,it),e===void 0?e=o.rounding:Ie(e,0,8),n=M(new o(r),i+r.e+1,e),t=Xe(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};k.toFraction=function(i){var e,t,n,r,o,s,a,u,c,m,l,d,p=this,y=p.d,f=p.constructor;if(!y)return new f(p);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=ui(y)-p.e-1,s=o%v,e.d[0]=me(10,s<0?v+s:s),i==null)i=o>0?e:c;else{if(a=new f(i),!a.isInt()||a.lt(c))throw Error(nt+a);i=a.gt(e)?o>0?e:c:a}for(V=!1,a=new f(ge(y)),m=f.precision,f.precision=o=y.length*v*2;l=ne(a,e,0,1,1),r=t.plus(l.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(l.times(r)),u=r,r=e,e=a.minus(l.times(r)),a=r;return r=ne(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=p.s,d=ne(c,n,o,1).minus(p).abs().cmp(ne(u,t,o,1).minus(p).abs())<1?[c,n]:[u,t],f.precision=m,V=!0,d};k.toHexadecimal=k.toHex=function(i,e){return pn(this,16,i,e)};k.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Ie(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(V=!1,t=ne(t,i,0,e,1).times(i),V=!0,M(t)):(i.s=t.s,t=i),t};k.toNumber=function(){return+this};k.toOctal=function(i,e){return pn(this,8,i,e)};k.toPower=k.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(me(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return M(a,n,o);if(e=Ae(i.e/v),e>=i.d.length-1&&(t=c<0?-c:c)<=mr)return r=ci(u,a,t,n),i.s<0?new u(1).div(r):M(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=me(+a,c),e=t==0||!isFinite(t)?Ae(c*(Math.log("0."+ge(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(V=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=mn(i.times(tt(a,n+t)),n),r.d&&(r=M(r,n+5,1),Pt(r.d,n,o)&&(e=n+10,r=M(mn(i.times(tt(a,e+t)),e),e+5,1),+ge(r.d).slice(n+1,n+15)+1==1e14&&(r=M(r,n+1,0)))),r.s=s,V=!0,u.rounding=o,M(r,n,o))};k.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Xe(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Ie(i,1,it),e===void 0?e=r.rounding:Ie(e,0,8),n=M(new r(n),i,e),t=Xe(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};k.toSignificantDigits=k.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Ie(i,1,it),e===void 0?e=n.rounding:Ie(e,0,8)),M(new n(t),i,e)};k.toString=function(){var i=this,e=i.constructor,t=Xe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};k.truncated=k.trunc=function(){return M(new this.constructor(this),this.e+1,1)};k.valueOf=k.toJSON=function(){var i=this,e=i.constructor,t=Xe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function ge(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=v-n.length,t&&(o+=et(t)),o+=n;s=i[e],n=s+"",t=v-n.length,t&&(o+=et(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ie(i,e,t){if(i!==~~i||i<e||i>t)throw Error(nt+i)}function Pt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=v,r=0):(r=Math.ceil((e+1)/v),e%=v),o=me(10,v-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==me(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==me(10,e-3)-1,s}function Ft(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=un.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function pr(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/qt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=kt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var ne=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,m,l,d,p,y,f,b,w,T,A,I,D,x,O,L,Z,P,E,fe,le=n.constructor,Be=n.s==r.s?1:-1,oe=n.d,$=r.d;if(!oe||!oe[0]||!$||!$[0])return new le(!n.s||!r.s||(oe?$&&oe[0]==$[0]:!$)?NaN:oe&&oe[0]==0||!$?Be*0:Be/0);for(u?(p=1,m=n.e-r.e):(u=ve,p=v,m=Ae(n.e/p)-Ae(r.e/p)),E=$.length,Z=oe.length,w=new le(Be),T=w.d=[],l=0;$[l]==(oe[l]||0);l++);if($[l]>(oe[l]||0)&&m--,o==null?(x=o=le.precision,s=le.rounding):a?x=o+(n.e-r.e)+1:x=o,x<0)T.push(1),y=!0;else{if(x=x/p+2|0,l=0,E==1){for(d=0,$=$[0],x++;(l<Z||d)&&x--;l++)O=d*u+(oe[l]||0),T[l]=O/$|0,d=O%$|0;y=d||l<Z}else{for(d=u/($[0]+1)|0,d>1&&($=i($,d,u),oe=i(oe,d,u),E=$.length,Z=oe.length),L=E,A=oe.slice(0,E),I=A.length;I<E;)A[I++]=0;fe=$.slice(),fe.unshift(0),P=$[0],$[1]>=u/2&&++P;do d=0,c=e($,A,E,I),c<0?(D=A[0],E!=I&&(D=D*u+(A[1]||0)),d=D/P|0,d>1?(d>=u&&(d=u-1),f=i($,d,u),b=f.length,I=A.length,c=e(f,A,b,I),c==1&&(d--,t(f,E<b?fe:$,b,u))):(d==0&&(c=d=1),f=$.slice()),b=f.length,b<I&&f.unshift(0),t(A,f,I,u),c==-1&&(I=A.length,c=e($,A,E,I),c<1&&(d++,t(A,E<I?fe:$,I,u))),I=A.length):c===0&&(d++,A=[0]),T[l++]=d,c&&A[0]?A[I++]=oe[L]||0:(A=[oe[L]],I=1);while((L++<Z||A[0]!==void 0)&&x--);y=A[0]!==void 0}T[0]||T.shift()}if(p==1)w.e=m,ii=y;else{for(l=1,d=T[0];d>=10;d/=10)l++;w.e=l+m*p-1,M(w,a?o+w.e+1:o,s,y)}return w}}();function M(i,e,t,n){var r,o,s,a,u,c,m,l,d,p=i.constructor;e:if(e!=null){if(l=i.d,!l)return i;for(r=1,a=l[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=v,s=e,m=l[d=0],u=m/me(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/v),a=l.length,d>=a)if(n){for(;a++<=d;)l.push(0);m=u=0,r=1,o%=v,s=o-v+1}else break e;else{for(m=a=l[d],r=1;a>=10;a/=10)r++;o%=v,s=o-v+r,u=s<0?0:m/me(10,r-s-1)%10|0}if(n=n||e<0||l[d+1]!==void 0||(s<0?m:m%me(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?m/me(10,r-s):0:l[d-1])%10&1||t==(i.s<0?8:7)),e<1||!l[0])return l.length=0,c?(e-=i.e+1,l[0]=me(10,(v-e%v)%v),i.e=-e||0):l[0]=i.e=0,i;if(o==0?(l.length=d,a=1,d--):(l.length=d+1,a=me(10,v-o),l[d]=s>0?(m/me(10,r-s)%me(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=l[0];s>=10;s/=10)o++;for(s=l[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,l[0]==ve&&(l[0]=1));break}else{if(l[d]+=a,l[d]!=ve)break;l[d--]=0,a=1}for(o=l.length;l[--o]===0;)l.pop()}return V&&(i.e>p.maxE?(i.d=null,i.e=NaN):i.e<p.minE&&(i.e=0,i.d=[0])),i}function Xe(i,e,t){if(!i.isFinite())return mi(i);var n,r=i.e,o=ge(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+et(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+et(-r-1)+o,t&&(n=t-s)>0&&(o+=et(n))):r>=s?(o+=et(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+et(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=et(n))),o}function Vt(i,e){var t=i[0];for(e*=v;t>=10;t/=10)e++;return e}function _t(i,e,t){if(e>dr)throw V=!0,t&&(i.precision=t),Error(ri);return M(new i(vt),e,1,!0)}function Fe(i,e,t){if(e>ln)throw Error(ri);return M(new i(Wt),e,t,!0)}function ui(i){var e=i.length-1,t=e*v+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function et(i){for(var e="";i--;)e+="0";return e}function ci(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/v+4);for(V=!1;;){if(t%2&&(o=o.times(e),ti(o.d,s)&&(r=!0)),t=Ae(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),ti(e.d,s)}return V=!0,o}function ei(i){return i.d[i.d.length-1]&1}function li(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function mn(i,e){var t,n,r,o,s,a,u,c=0,m=0,l=0,d=i.constructor,p=d.rounding,y=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(V=!1,u=y):u=e,a=new d(.03125);i.e>-2;)i=i.times(a),l+=5;for(n=Math.log(me(2,l))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=M(o.times(i),u,1),t=t.times(++m),a=s.plus(ne(o,t,u,1)),ge(a.d).slice(0,u)===ge(s.d).slice(0,u)){for(r=l;r--;)s=M(s.times(s),u,1);if(e==null)if(c<3&&Pt(s.d,u-n,p,c))d.precision=u+=10,t=o=a=new d(1),m=0,c++;else return M(s,d.precision=y,p,V=!0);else return d.precision=y,s}s=a}}function tt(i,e){var t,n,r,o,s,a,u,c,m,l,d,p=1,y=10,f=i,b=f.d,w=f.constructor,T=w.rounding,A=w.precision;if(f.s<0||!b||!b[0]||!f.e&&b[0]==1&&b.length==1)return new w(b&&!b[0]?-1/0:f.s!=1?NaN:b?0:f);if(e==null?(V=!1,m=A):m=e,w.precision=m+=y,t=ge(b),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=ge(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new w("0."+t),o++):f=new w(n+"."+t.slice(1))}else return c=_t(w,m+2,A).times(o+""),f=tt(new w(n+"."+t.slice(1)),m-y).plus(c),w.precision=A,e==null?M(f,A,T,V=!0):f;for(l=f,u=s=f=ne(f.minus(1),f.plus(1),m,1),d=M(f.times(f),m,1),r=3;;){if(s=M(s.times(d),m,1),c=u.plus(ne(s,new w(r),m,1)),ge(c.d).slice(0,m)===ge(u.d).slice(0,m))if(u=u.times(2),o!==0&&(u=u.plus(_t(w,m+2,A).times(o+""))),u=ne(u,new w(p),m,1),e==null)if(Pt(u.d,m-y,T,a))w.precision=m+=y,c=s=f=ne(l.minus(1),l.plus(1),m,1),d=M(f.times(f),m,1),r=a=1;else return M(u,w.precision=A,T,V=!0);else return w.precision=A,u;u=c,r+=2}}function mi(i){return String(i.s*i.s/0)}function dn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%v,t<0&&(n+=v),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=v;n<r;)i.d.push(+e.slice(n,n+=v));e=e.slice(n),n=v-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),V&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function fr(i,e){var t,n,r,o,s,a,u,c,m;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),ai.test(e))return dn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(cr.test(e))t=16,e=e.toLowerCase();else if(ur.test(e))t=2;else if(lr.test(e))t=8;else throw Error(nt+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=ci(n,new n(t),o,o*2)),c=Ft(e,t,ve),m=c.length-1,o=m;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=Vt(c,m),i.d=c,V=!1,s&&(i=ne(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?me(2,u):Tt.pow(2,u))),V=!0,i)}function br(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:kt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/qt(5,t)),e=kt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function kt(i,e,t,n,r){var o,s,a,u,c=1,m=i.precision,l=Math.ceil(m/v);for(V=!1,u=t.times(t),a=new i(n);;){if(s=ne(a.times(u),new i(e++*e++),m,1),a=r?n.plus(s):n.minus(s),n=ne(s.times(u),new i(e++*e++),m,1),s=a.plus(n),s.d[l]!==void 0){for(o=l;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return V=!0,s.d.length=l+1,s}function qt(i,e){for(var t=i;--e;)t*=i;return t}function di(i,e){var t,n=e.s<0,r=Fe(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Qe=n?4:1,e;if(t=e.divToInt(r),t.isZero())Qe=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Qe=ei(t)?n?2:3:n?4:1,e;Qe=ei(t)?n?1:4:n?3:2}return e.minus(r).abs()}function pn(i,e,t,n){var r,o,s,a,u,c,m,l,d,p=i.constructor,y=t!==void 0;if(y?(Ie(t,1,it),n===void 0?n=p.rounding:Ie(n,0,8)):(t=p.precision,n=p.rounding),!i.isFinite())m=mi(i);else{for(m=Xe(i),s=m.indexOf("."),y?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(m=m.replace(".",""),d=new p(1),d.e=m.length-s,d.d=Ft(Xe(d),10,r),d.e=d.d.length),l=Ft(m,10,r),o=u=l.length;l[--u]==0;)l.pop();if(!l[0])m=y?"0p+0":"0";else{if(s<0?o--:(i=new p(i),i.d=l,i.e=o,i=ne(i,d,t,n,0,r),l=i.d,o=i.e,c=ii),s=l[t],a=r/2,c=c||l[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&l[t-1]&1||n===(i.s<0?8:7)),l.length=t,c)for(;++l[--t]>r-1;)l[t]=0,t||(++o,l.unshift(1));for(u=l.length;!l[u-1];--u);for(s=0,m="";s<u;s++)m+=un.charAt(l[s]);if(y){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)m+="0";for(l=Ft(m,r,e),u=l.length;!l[u-1];--u);for(s=1,m="1.";s<u;s++)m+=un.charAt(l[s])}else m=m.charAt(0)+"."+m.slice(1);m=m+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)m="0"+m;m="0."+m}else if(++o>u)for(o-=u;o--;)m+="0";else o<u&&(m=m.slice(0,o)+"."+m.slice(o))}m=(e==16?"0x":e==2?"0b":e==8?"0o":"")+m}return i.s<0?"-"+m:m}function ti(i,e){if(i.length>e)return i.length=e,!0}function yr(i){return new this(i).abs()}function gr(i){return new this(i).acos()}function wr(i){return new this(i).acosh()}function kr(i,e){return new this(i).plus(e)}function hr(i){return new this(i).asin()}function Ar(i){return new this(i).asinh()}function Pr(i){return new this(i).atan()}function Tr(i){return new this(i).atanh()}function xr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Fe(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Fe(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Fe(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ne(i,e,o,1)),e=Fe(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(ne(i,e,o,1)),t}function Br(i){return new this(i).cbrt()}function Ir(i){return M(i=new this(i),i.e+1,2)}function Sr(i,e,t){return new this(i).clamp(e,t)}function Cr(i){if(!i||typeof i!="object")throw Error(Dt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,it,"rounding",0,8,"toExpNeg",-wt,0,"toExpPos",0,wt,"maxE",0,wt,"minE",-wt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=cn[t]),(n=i[t])!==void 0)if(Ae(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(nt+t+": "+n);if(t="crypto",r&&(this[t]=cn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(oi);else this[t]=!1;else throw Error(nt+t+": "+n);return this}function Kr(i){return new this(i).cos()}function Nr(i){return new this(i).cosh()}function pi(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,ni(o)){c.s=o.s,V?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;V?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return dn(c,o.toString())}else if(u!=="string")throw Error(nt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),ai.test(o)?dn(c,o):fr(c,o)}if(r.prototype=k,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Cr,r.clone=pi,r.isDecimal=ni,r.abs=yr,r.acos=gr,r.acosh=wr,r.add=kr,r.asin=hr,r.asinh=Ar,r.atan=Pr,r.atanh=Tr,r.atan2=xr,r.cbrt=Br,r.ceil=Ir,r.clamp=Sr,r.cos=Kr,r.cosh=Nr,r.div=Rr,r.exp=Lr,r.floor=Mr,r.hypot=Or,r.ln=Er,r.log=Fr,r.log10=Wr,r.log2=vr,r.max=_r,r.min=Dr,r.mod=Vr,r.mul=qr,r.pow=Gr,r.random=Ur,r.round=Xr,r.sign=zr,r.sin=Hr,r.sinh=Qr,r.sqrt=Zr,r.sub=Yr,r.sum=jr,r.tan=Jr,r.tanh=$r,r.trunc=eo,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function Rr(i,e){return new this(i).div(e)}function Lr(i){return new this(i).exp()}function Mr(i){return M(i=new this(i),i.e+1,3)}function Or(){var i,e,t=new this(0);for(V=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return V=!0,new this(1/0);t=e}return V=!0,t.sqrt()}function ni(i){return i instanceof Tt||i&&i.toStringTag===si||!1}function Er(i){return new this(i).ln()}function Fr(i,e){return new this(i).log(e)}function vr(i){return new this(i).log(2)}function Wr(i){return new this(i).log(10)}function _r(){return li(this,arguments,"lt")}function Dr(){return li(this,arguments,"gt")}function Vr(i,e){return new this(i).mod(e)}function qr(i,e){return new this(i).mul(e)}function Gr(i,e){return new this(i).pow(e)}function Ur(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Ie(i,1,it),n=Math.ceil(i/v),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(oi);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=v,n&&i&&(r=me(10,v-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=v)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<v&&(t-=v-n)}return s.e=t,s.d=a,s}function Xr(i){return M(i=new this(i),i.e+1,this.rounding)}function zr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function Hr(i){return new this(i).sin()}function Qr(i){return new this(i).sinh()}function Zr(i){return new this(i).sqrt()}function Yr(i,e){return new this(i).sub(e)}function jr(){var i=0,e=arguments,t=new this(e[i]);for(V=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return V=!0,M(t,this.precision,this.rounding)}function Jr(i){return new this(i).tan()}function $r(i){return new this(i).tanh()}function eo(i){return M(i=new this(i),i.e+1,1)}k[Symbol.for("nodejs.util.inspect.custom")]=k.toString;k[Symbol.toStringTag]="Decimal";var Tt=k.constructor=pi(cn);vt=new Tt(vt);Wt=new Tt(Wt);var F=Tt;import{get as fi,set as to}from"lodash";var fn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},bi={},no={};function se(i){let e=fi(bi,i);if(!e){let t=fi(no,i);e=new fn({name:i,logLevel:t}),to(bi,i,e)}return e}import{PublicKey as Ao}from"@solana/web3.js";import Po from"bn.js";import wo from"big.js";import Qt from"bn.js";import Se from"bn.js";import{PublicKey as kn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as io}from"@solana/spl-token";import{PublicKey as ie,SystemProgram as yi,SYSVAR_RENT_PUBKEY as ro}from"@solana/web3.js";function h({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var Ws=[h({pubkey:io,isWritable:!1}),h({pubkey:yi.programId,isWritable:!1}),h({pubkey:ro,isWritable:!1})];function bn({publicKey:i,transformSol:e}){let t=yn(i.toString());if(t instanceof ie)return e&&t.equals(xt)?Gt:t;if(e&&t.toString()===xt.toBase58())return Gt;if(typeof t=="string"){if(t===ie.default.toBase58())return ie.default;try{return new ie(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function yn(i){try{return new ie(i)}catch{return i}}var Ut=new ie("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),gn=new ie("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),mt=new ie("SysvarRent111111111111111111111111111111111"),_s=new ie("SysvarC1ock11111111111111111111111111111111"),ht=new ie("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ds=new ie("Sysvar1nstructions1111111111111111111111111"),oo=yi.programId,Vs=new ie("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),qs=new ie("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Gs=new ie("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Us=new ie("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Xs=new ie("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),zs=new ie("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Hs=new ie("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Qs=new ie("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Zs=new ie("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ys=new ie("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),js=new ie("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Gt=new ie("So11111111111111111111111111111111111111112"),xt=ie.default;function Bt(i){return bn({publicKey:i,transformSol:!0})}import{PublicKey as so}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as gi}from"@solana/spl-token";var wn={chainId:101,address:so.default.toBase58(),programId:gi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},rt={chainId:101,address:"So11111111111111111111111111111111111111112",programId:gi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var hn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===xt.toBase58()||e instanceof kn&&xt.equals(e)){this.decimals=rt.decimals,this.symbol=rt.symbol,this.name=rt.name,this.mint=new kn(rt.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?kn.default:bn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},We=hn;We.WSOL=new hn(ee(J({},rt),{mint:rt.address}));import zt from"big.js";import co from"bn.js";import lo from"decimal.js-light";import ao from"toformat";var uo=ao,It=uo;var Xt=se("module/fraction"),An=It(zt),St=It(lo),mo={[0]:St.ROUND_DOWN,[1]:St.ROUND_HALF_UP,[2]:St.ROUND_UP},po={[0]:zt.roundDown,[1]:zt.roundHalfUp,[2]:zt.roundUp},j=class{constructor(e,t=new co(1)){this.numerator=ae(e),this.denominator=ae(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new j(this.denominator,this.numerator)}add(e){let t=e instanceof j?e:new j(ae(e));return this.denominator.eq(t.denominator)?new j(this.numerator.add(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof j?e:new j(ae(e));return this.denominator.eq(t.denominator)?new j(this.numerator.sub(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof j?e:new j(ae(e));return new j(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof j?e:new j(ae(e));return new j(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Xt.logWithError(`${e} is not an integer.`),e<=0&&Xt.logWithError(`${e} is not positive.`),St.set({precision:e+1,rounding:mo[n]});let r=new St(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Xt.logWithError(`${e} is not an integer.`),e<0&&Xt.logWithError(`${e} is negative.`),An.DP=e,An.RM=po[n]||1,new An(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var bo=se("Raydium_price"),Me=class extends j{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new j(Pn(n.decimals),Pn(r.decimals))}get raw(){return new j(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Me({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&bo.logWithError("mul token not equals");let n=super.mul(t);return new Me({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var Tn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Ht=Tn;Ht.SOL=new Tn(wn);import yo from"bn.js";var wi=new j(new yo(100)),ot=class extends j{toSignificant(e=5,t,n){return this.mul(wi).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(wi).toFixed(e,t,n)}};var ki=new Se(0),go=new Se(1),Ha=new Se(2),Qa=new Se(3),Za=new Se(5),xn=new Se(10),Ya=new Se(100),ja=new Se(1e3),Ja=new Se(1e4),hi=9007199254740991;function ae(i){let e=se("Raydium_parseBigNumberish");if(i instanceof Se)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Se(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=hi||i<=-hi)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Se(String(i))):typeof i=="bigint"?new Se(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Se(0))}function Pn(i){return xn.pow(ae(i))}var ko=se("Raydium_amount"),Pi=It(wo);function ho(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):ko.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var be=class extends j{constructor(t,n,r=!0,o){let s=new Qt(0),a=xn.pow(new Qt(t.decimals));if(r)s=ae(n);else{let u=new Qt(0),c=new Qt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[m,l]=ho(n.toString(),t.decimals);u=ae(m),c=ae(l)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=se(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new be(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new be(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return Pi.DP=this.token.decimals,new Pi(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};function Ai(i){return typeof i=="object"&&i!==null&&![We,be,Ao,j,Po,Me,ot].some(e=>typeof e=="object"&&i instanceof e)}function Ce(i){return typeof i=="string"?yn(i):Array.isArray(i)?i.map(e=>Ce(e)):Ai(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,Ce(t)])):i}import{PublicKey as dc,sendAndConfirmTransaction as pc,Transaction as bc,TransactionMessage as gc,VersionedTransaction as wc}from"@solana/web3.js";import Ac from"axios";var re={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{PublicKey as To,ComputeBudgetProgram as Su,Transaction as Ku,TransactionMessage as Ru,Keypair as Lu,VersionedTransaction as Ou}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as vu}from"@solana/spl-token";var Du=se("Raydium_txUtil");function Ke(i,e){let[t,n]=To.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}import{PublicKey as Bo,AddressLookupTableAccount as Ti}from"@solana/web3.js";import{PublicKey as xo}from"@solana/web3.js";import{MINT_SIZE as Hu,TOKEN_PROGRAM_ID as Qu,getTransferFeeConfig as Zu,unpackMint as Yu}from"@solana/spl-token";var Bn=se("Raydium_accountInfo_util");async function st(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=J({batchRequest:!1},t),s=In(e,o),a=new Array(s.length).fill([]);if(n){let u=s.map(l=>{let d=i._buildArgs([l.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=In(u,10);a=(await(await Promise.all(c.map(async l=>await i._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&Bn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(d=>{if(d){let{data:p,executable:y,lamports:f,owner:b,rentEpoch:w}=d;return p.length!==2&&p[1]!=="base64"&&Bn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:y,lamports:f,owner:new xo(b),rentEpoch:w}}return null})))}else try{a=await Promise.all(s.map(u=>i.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&Bn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function Zt(i,e,t){let n=await st(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>ee(J({},r),{accountInfo:n[o]}))}var Io={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new Ti({key:new Bo("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:Ti.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};function In(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as H}from"@solana/web3.js";var Rc=new H("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Lc=new H("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Mc=new H("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Oc=new H("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Ec=new H("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Fc=new H("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),vc=new H("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Wc=new H("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),xi=new H("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),_c=new H("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Dc=new H("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Vc=new H("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),qc=new H("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Gc=new H("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Uc=new H("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Xc=new H("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),zc=new H("8yQvrjQuritLntxz6pAaWcEX6CsRMeDmr7baCLnNwEuw"),Hc=new H("E1oP2yNZXw3dFnUoPygWZPg9u2Gad87VFVPeYWqa6rD6"),Qc=new H("E1oP2yNZXw3dFnUoPygWZPg9u2Gad87VFVPeYWqa6rD6"),Ko=new H("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),No=new H("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Ro=new H("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");var Zc={SERUM_MARKET:H.default,OPENBOOK_MARKET:new H("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:H.default,FarmV3:new H("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new H("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new H("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new H("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new H("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new H("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),Router:new H("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Ko,CREATE_CPMM_POOL_AUTH:No,CREATE_CPMM_POOL_FEE_ACC:Ro,FEE_DESTINATION_ID:new H("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import{PublicKey as Lo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Mo}from"@solana/spl-token";function ze(i,e,t){return Ke([i.toBuffer(),(t!=null?t:Mo).toBuffer(),e.toBuffer()],new Lo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import _e from"bn.js";var Ct=1e4;function de(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=ee(J({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new _e(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Ct){let u=new _e(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=Sn(i.mul(new _e(Ct)),new _e(Ct-o.transferFeeBasisPoints)),c=new _e(o.maximumFee.toString()),m=u.sub(i).gt(c)?i.add(c):u,l=Sn(m.mul(new _e(o.transferFeeBasisPoints)),new _e(Ct)),d=l.gt(s)?s:l;return{amount:m,fee:d,expirationTime:a}}else{let u=Sn(i.mul(new _e(o.transferFeeBasisPoints)),new _e(Ct)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function dt(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function Sn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new _e(0))?t.add(new _e(1)):t}import{PublicKey as Pl}from"@solana/web3.js";import{MintLayout as xl,TOKEN_PROGRAM_ID as Il}from"@solana/spl-token";import Oe from"bn.js";var ue=new Oe(0),Ne=new Oe(1),Ze=new Oe(-1),Re=new Oe(1).shln(64),Yt=new Oe(1).shln(128),Cn=Re.sub(Ne),Kt=64,Bi=Yt.subn(1),Pe=-443636,Te=-Pe,Ye=new Oe("4295048016"),je=new Oe("79226673521066979257578248091"),jt=new Oe("4295048017"),Jt=new Oe("79226673521066979257578248090"),Ii=16,Si="59543866431248",Ci="184467440737095516",Ki="15793534762490258745",$t=new Oe(10).pow(new Oe(6));var Wl=new Oe("18446744073700000000");import X from"bn.js";function en(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Kn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Nn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Nt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function Ni(i,e){return Nt(i,e)?null:Kn(i,e)}function Ri(i,e){return Nt(i,e)?null:Nn(i,e)}var Ul=Buffer.from("amm_config","utf8"),Oo=Buffer.from("pool","utf8"),Eo=Buffer.from("pool_vault","utf8"),Fo=Buffer.from("pool_reward_vault","utf8"),Li=Buffer.from("position","utf8"),vo=Buffer.from("tick_array","utf8"),Wo=Buffer.from("operation","utf8"),_o=Buffer.from("pool_tick_array_bitmap_extension","utf8");function Mi(i,e,t,n,r){return Ke([Oo,e.toBuffer(),t.toBuffer(),n.toBuffer(),r.toBuffer()],i)}function Rn(i,e,t){return Ke([Eo,e.toBuffer(),t.toBuffer()],i)}function Oi(i,e,t){return Ke([Fo,e.toBuffer(),t.toBuffer()],i)}function te(i,e,t){return Ke([vo,e.toBuffer(),en(t)],i)}function pt(i,e,t,n){return Ke([Li,e.toBuffer(),en(t),en(n)],i)}function De(i,e){return Ke([Li,e.toBuffer()],i)}function tn(i){return Ke([Buffer.from("metadata","utf8"),ht.toBuffer(),i.toBuffer()],ht)}function nn(i){return Ke([Wo],i)}function Le(i,e){return Ke([_o,e.toBuffer()],i)}import{PublicKey as Ve}from"@solana/web3.js";import ce from"bn.js";import rs from"bn.js";import{PublicKey as Qo}from"@solana/web3.js";import Wi,{isBN as _i}from"bn.js";import{bits as Hl,BitStructure as Ql,blob as Do,Blob as Zl,cstr as Yl,f32 as jl,f32be as Jl,f64 as $l,f64be as em,greedy as tm,Layout as Vo,ns64 as nm,ns64be as im,nu64 as rm,nu64be as om,offset as sm,s16 as am,s16be as um,s24 as cm,s24be as lm,s32 as qo,s32be as mm,s40 as dm,s40be as pm,s48 as fm,s48be as bm,s8 as ym,seq as Go,struct as gm,Structure as Uo,u16 as Xo,u16be as wm,u24 as km,u24be as hm,u32 as Am,u32be as Pm,u40 as Tm,u40be as xm,u48 as Bm,u48be as Im,u8 as zo,UInt as Ho,union as Sm,Union as Cm,unionLayoutDiscriminator as Km,utf8 as Nm}from"@solana/buffer-layout";var Ln=Vo,Ei=Uo;var Mn=Ho;var Fi=zo,at=Xo;var we=qo;var vi=Go;var xe=Do;var Rt=class extends Ln{constructor(t,n,r){super(t,r);this.blob=xe(t),this.signed=n}decode(t,n=0){let r=new Wi(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Wi(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function U(i){return new Mn(1,i)}function Je(i){return new Mn(4,i)}function g(i){return new Rt(8,!1,i)}function _(i){return new Rt(16,!1,i)}function Di(i){return new Rt(16,!0,i)}var rn=class extends Ln{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function K(i){return new rn(xe(32),e=>new Qo(e),e=>e.toBuffer(),i)}function Ee(i){return new rn(Fi(),Zo,Yo,i)}function Zo(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function Yo(i){return i?1:0}var On=class extends Ei{decode(e,t){return super.decode(e,t)}};function W(i,e,t){return new On(i,e,t)}function Y(i,e,t){let n,r=typeof e=="number"?e:_i(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=_i(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return vi(i,r,t)}var En=14,$e=class{static maxTickInTickarrayBitmap(e){return e*pe*ft}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!z.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-z.tickCount(n):t+z.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*pe,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let m=e.shln(1024-c-1),l=Ni(1024,m);if(l!==null){let d=(c-l-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let m=e.shrn(c),l=Ri(1024,m);if(l!==null){let d=(c+l-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-z.tickCount(n)}}}},Lt=class{static getBitmapOffset(e,t){if(!z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=$e.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=$e.maxTickInTickarrayBitmap(e),n=-t;if(Te<=t)throw Error(`extensionTickBoundary check error: ${Te}, ${t}`);if(n<=Pe)throw Error(`extensionTickBoundary check error: ${n}, ${Pe}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:R.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=z.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=$e.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=R.mergeTickArrayBitmap(e).shln(ft-1-a),c=Nt(512,u)?null:Kn(512,u);if(c!==null){let m=t-c*z.tickCount(n);return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:o}}else{let u=R.mergeTickArrayBitmap(e).shrn(a),c=Nt(512,u)?null:Nn(512,u);if(c!==null){let m=t+c*z.tickCount(n);return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:s-z.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%$e.maxTickInTickarrayBitmap(t),r=Math.floor(n/z.tickCount(t));return e<0&&n!=0&&(r=ft-r),r}};var jo=W([xe(8),U("bump"),at("index"),K(""),Je("protocolFeeRate"),Je("tradeFeeRate"),at("tickSpacing"),Y(g(),8,"")]),Jo=W([Je("blockTimestamp"),_("sqrtPriceX64"),_("cumulativeTimePriceX64"),Y(_(),1,"")]),Fn=W([xe(8),Ee("initialized"),K("poolId"),Y(Jo,1e3,"observations"),Y(_(),5,"")]),$o=W([U("rewardState"),g("openTime"),g("endTime"),g("lastUpdateTime"),_("emissionsPerSecondX64"),g("rewardTotalEmissioned"),g("rewardClaimed"),K("tokenMint"),K("tokenVault"),K("creator"),_("rewardGrowthGlobalX64")]),vn=W([xe(8),U("bump"),K("ammConfig"),K("creator"),K("mintA"),K("mintB"),K("vaultA"),K("vaultB"),K("observationId"),U("mintDecimalsA"),U("mintDecimalsB"),at("tickSpacing"),_("liquidity"),_("sqrtPriceX64"),we("tickCurrent"),at("observationIndex"),at("observationUpdateDuration"),_("feeGrowthGlobalX64A"),_("feeGrowthGlobalX64B"),g("protocolFeesTokenA"),g("protocolFeesTokenB"),_("swapInAmountTokenA"),_("swapOutAmountTokenB"),_("swapInAmountTokenB"),_("swapOutAmountTokenA"),U("status"),Y(U(),7,""),Y($o,3,"rewardInfos"),Y(g(),16,"tickArrayBitmap"),g("totalFeesTokenA"),g("totalFeesClaimedTokenA"),g("totalFeesTokenB"),g("totalFeesClaimedTokenB"),g("fundFeesTokenA"),g("fundFeesTokenB"),g("startTime"),Y(g(),15*4-3,"padding")]),es=W([_("growthInsideLastX64"),g("rewardAmountOwed")]),Wn=W([xe(8),U("bump"),K("nftMint"),K("poolId"),we("tickLower"),we("tickUpper"),_("liquidity"),_("feeGrowthInsideLastX64A"),_("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),Y(es,3,"rewardInfos"),Y(g(),8,"")]),jm=W([xe(8),U("bump"),K("poolId"),we("tickLowerIndex"),we("tickUpperIndex"),_("liquidity"),_("feeGrowthInsideLastX64A"),_("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),Y(_(),3,"rewardGrowthInside"),Y(g(),8,"")]),ts=W([we("tick"),Di("liquidityNet"),_("liquidityGross"),_("feeGrowthOutsideX64A"),_("feeGrowthOutsideX64B"),Y(_(),3,"rewardGrowthsOutsideX64"),Y(Je(),13,"")]),Mt=W([xe(8),K("poolId"),we("startTickIndex"),Y(ts,pe,"ticks"),U("initializedTickCount"),Y(U(),115,"")]),ns=W([xe(329),Y(K(),100,"whitelistMints")]),Vi=W([xe(8),K("poolId"),Y(Y(g(),8),En,"positiveTickArrayBitmap"),Y(Y(g(),8),En,"negativeTickArrayBitmap")]);var is=15,z=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=R.getTickArrayStartIndexByTick(r,o),m=R.getInitializedTickArrayInRange(s,a,o,c,Math.floor(is/2));for(let p=0;p<m.length;p++){let{publicKey:y}=te(t,n,m[p]);u.push(y)}let l=(await st(e,u)).map(p=>p!==null?Mt.decode(p.data):null),d={};for(let p=0;p<u.length;p++){let y=l[p];y!==null&&(d[y.startTickIndex]=ee(J({},y),{address:u[p]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=R.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let m=n[c];if(m===void 0)continue;let{nextTick:l,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,m,s);[a,u,c]=[l,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/z.tickCount(t)),a=n?R.searchLowBitFromStart(r,o,s-1,1,t):R.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=pe-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<pe;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=te(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=R.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let m;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){m=d;break}u=u-1}else for(u=u+1;u<pe;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){m=d;break}u=u+1}let{publicKey:l}=te(e,t,a);return{initializedTick:m,tickArrayAddress:l,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(R.checkIsOutOfBoundary(e)){if(e>Te)return!1;let n=R.getTickArrayStartIndexByTick(Pe,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return pe*e}};var pe=60,ft=512,R=class{static getTickArrayAddressByTick(e,t,n,r){let o=R.getTickArrayStartIndexByTick(n,r),{publicKey:s}=te(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=R.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=pe)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=z.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*z.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*pe,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*pe,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*pe:e+t*pe}static mergeTickArrayBitmap(e){let t=new rs(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*pe));return[...R.searchLowBitFromStart(e,t,s-1,o,n),...R.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return R.searchHightBitFromStart(e,t,0,ft,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=R.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=te(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>R.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),m=(n+7680)%512;if(s[c].testn(m)&&a.push(n),n--,a.length===r)break}let u=z.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>R.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),m=(n+7680)%512;if(s[c].testn(m)&&a.push(n),n++,a.length===r)break}let u=z.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Pe||e>Te}static nextInitTick(e,t,n,r,o){if(z.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<pe;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=pe-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<pe;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=q.getSqrtPriceX64FromTick(t),o=q.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new F(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new F(1).div(t),o=bt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=q.getSqrtPriceX64FromTick(o),a=q.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new F(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=q.getSqrtPriceX64FromTick(t),o=q.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new F(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new F(1).div(t),o=bt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=q.getSqrtPriceX64FromTick(o),a=q.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new F(1).div(a)}}};import He from"bn.js";var Ot=class{static getfeeGrowthInside(e,t,n){let r=new He(0),o=new He(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new He(0),a=new He(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=G.wrappingSubU128(G.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=G.wrappingSubU128(G.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=G.mulDivFloor(G.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Re),u=t.tokenFeesOwedA.add(a),c=G.mulDivFloor(G.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Re),m=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:m}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=G.mulDivFloor(G.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Re),u=t.tokenFeesOwedA.add(a),c=G.mulDivFloor(G.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Re),m=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:m}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],m=G.wrappingSubU128(u,c.growthInsideLastX64),l=G.mulDivFloor(m,t.liquidity,Re),d=c.rewardAmountOwed.add(l);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],m=G.wrappingSubU128(u,c.growthInsideLastX64),l=G.mulDivFloor(m,t.liquidity,Re),d=c.rewardAmountOwed.add(l);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new He(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new He(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(G.wrappingSubU128(G.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new He(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new He(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(G.wrappingSubU128(G.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var b,w,T,A;let a=q.priceToSqrtPriceX64(new F(e.price),e.mintA.decimals,e.mintB.decimals),u=q.getSqrtPriceX64FromTick(t.tickLower),c=q.getSqrtPriceX64FromTick(t.tickUpper),m=o?1+r:1-r,l=Q.getAmountsFromLiquidity(a,u,c,n,o),[d,p]=[de(l.amountA,(b=e.mintA.extensions)==null?void 0:b.feeConfig,s,!0),de(l.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)],[y,f]=[de(new He(new F(l.amountA.toString()).mul(m).toFixed(0)),(T=e.mintA.extensions)==null?void 0:T.feeConfig,s,!0),de(new He(new F(l.amountB.toString()).mul(m).toFixed(0)),(A=e.mintB.extensions)==null?void 0:A.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:y,amountSlippageB:f,expirationTime:dt(d.expirationTime,p.expirationTime)}}};import{TOKEN_2022_PROGRAM_ID as qi}from"@solana/spl-token";var ke=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:m,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,a);if(!c||m===void 0||!l)throw new Error("Invalid tick array");u.push(l);let{allTrade:d,amountCalculated:p,accounts:y,sqrtPriceX64:f,feeAmount:b}=yt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,m,o,s);return u.push(...y),{allTrade:d,expectedAmountOut:p.mul(Ze),remainingAccounts:u,executionPrice:f,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!m)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:b}=te(e.programId,e.id,f.nextStartIndex);a.push(b)}}catch{}a.push(m);let{amountCalculated:l,accounts:d,sqrtPriceX64:p,feeAmount:y}=yt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(Ze),c,o);return a.push(...d),{expectedAmountIn:l,remainingAccounts:a,executionPrice:p,feeAmount:y}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=ke.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Lt.checkTickArrayIsInit(z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):R.checkTickArrayIsInitialized(R.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=te(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=te(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/z.tickCount(e.tickSpacing)),r=t?R.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):R.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=z.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=$e.nextInitializedTickArrayStartIndex(R.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Lt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Pe||t>Te)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,u,c;let s=[];for(let m=0;m<o.length;m++){let l=o[m],d=(c=(a=t.rewardDefaultInfos[m])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(l.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let p=ee(J({},l),{perSecond:G.x64ToDecimal(l.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Ve(d)});if(p.tokenMint.equals(Ve.default))continue;if(n<=p.openTime.toNumber()||r.eq(ue)){s.push(p);continue}let y=new ce(Math.min(p.endTime.toNumber(),n)),f=y.sub(p.lastUpdateTime),b=G.mulDivFloor(f,p.emissionsPerSecondX64,r),w=p.rewardGrowthGlobalX64.add(b),T=G.mulDivFloor(f,p.emissionsPerSecondX64,Re),A=p.rewardTotalEmissioned.add(T);s.push(ee(J({},p),{rewardGrowthGlobalX64:w,rewardTotalEmissioned:A,lastUpdateTime:y}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=R.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=$e.maxTickInTickarrayBitmap(e),n=-t;return t>Te&&(t=z.getArrayStartIndex(Te,e)+z.tickCount(e)),n<Pe&&(n=z.getArrayStartIndex(Pe,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/z.tickCount(t)*ft}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await Zt(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=Vi.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=R.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),m=R.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let l of m){let{publicKey:d}=te(u.programId,u.id,l);o.push({pubkey:d}),r[d.toString()]=u.id}}let s=await Zt(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let m=Mt.decode(u.accountInfo.data);a[c.toString()][m.startTickIndex]=ee(J({},m),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(m=>m.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let p of s)c.push(De(p,d).publicKey);let m=await st(t,c,{batchRequest:r}),l={};for(let d of m){if(d===null)continue;let p=Wn.decode(d.data),y=p.poolId.toString(),f=e.find(L=>L.state.id.toBase58()===y);if(f===void 0)continue;let b=f.state,w=R._getTickPriceLegacy({poolInfo:b,tick:p.tickLower,baseIn:!0}),T=R._getTickPriceLegacy({poolInfo:b,tick:p.tickUpper,baseIn:!0}),{amountA:A,amountB:I}=Q.getAmountsFromLiquidity(b.sqrtPriceX64,w.tickSqrtPriceX64,T.tickSqrtPriceX64,p.liquidity,!1),D=1/(1-Math.sqrt(Math.sqrt(w.price.div(T.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:w.price,priceUpper:T.price,amountA:A,amountB:I,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(L=>ee(J({},L),{pendingReward:new ce(0)})),leverage:D,tokenFeeAmountA:new ce(0),tokenFeeAmountB:new ce(0)}];let x=await R.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),O=await R.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);l[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=x,l[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=O}if(o){let d=Object.values(l),p=await st(t,d,{batchRequest:r}),y={};for(let f=0;f<d.length;f++){let b=p[f];if(b===null)continue;let w=d[f].toString();y[w]=Mt.decode(b.data)}for(let{state:f,positionAccount:b}of e)if(!!b)for(let w of b){let T=`${f.programId.toString()}-${f.id.toString()}-${w.tickLower}`,A=`${f.programId.toString()}-${f.id.toString()}-${w.tickUpper}`,I=y[l[T].toString()],D=y[l[A].toString()],x=I.ticks[R.getTickOffsetInArray(w.tickLower,f.tickSpacing)],O=D.ticks[R.getTickOffsetInArray(w.tickUpper,f.tickSpacing)],{tokenFeeAmountA:L,tokenFeeAmountB:Z}=await Ot.GetPositionFees(f,w,x,O),P=await Ot.GetPositionRewards(f,w,x,O);w.tokenFeeAmountA=L.gte(new ce(0))?L:new ce(0),w.tokenFeeAmountB=Z.gte(new ce(0))?Z:new ce(0);for(let E=0;E<P.length;E++)w.rewardInfos[E].pendingReward=P[E].gte(new ce(0))?P[E]:new ce(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new F(0),catchLiquidityInsufficient:u=!1}){var fe;let c,m=n.toBase58()===e.mintA.address,[l,d]=m?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new F(0))?c=m?Ye.add(new ce(1)):je.sub(new ce(1)):c=q.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=de(o,l,r,!1),{allTrade:y,expectedAmountOut:f,remainingAccounts:b,executionPrice:w,feeAmount:T}=ke.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub((fe=p.fee)!=null?fe:ue),c,u),A=de(f,d,r,!1),I=q.sqrtPriceX64ToPrice(w,e.mintA.decimals,e.mintB.decimals),D=m?I:new F(1).div(I),x=f.mul(new ce(Math.floor((1-s)*1e10))).div(new ce(1e10)),O=de(x,d,r,!1),L=m?e.currentPrice:new F(1).div(e.currentPrice),Z=new F(D).sub(L).abs(),P=L,E=new ot(new F(Z).mul(10**15).toFixed(0),new F(P).mul(10**15).toFixed(0));return{allTrade:y,realAmountIn:p,amountOut:A,minAmountOut:O,expirationTime:dt(p.expirationTime,A.expirationTime),currentPrice:e.currentPrice,executionPrice:D,priceImpact:E,fee:T,remainingAccounts:b,executionPriceX64:w}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let u=r.address===e.mintB.address,[c,m]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[l,d]=[new We(ee(J({},c),{mint:c.address,isToken2022:c.programId===qi.toBase58()})),new We(ee(J({},m),{mint:m.address,isToken2022:m.programId===qi.toBase58()}))],{allTrade:p,realAmountIn:y,amountOut:f,minAmountOut:b,expirationTime:w,currentPrice:T,executionPrice:A,priceImpact:I,fee:D,remainingAccounts:x,executionPriceX64:O}=ke.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Ve(c.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),L=ee(J({},y),{amount:new be(l,y.amount),fee:y.fee===void 0?void 0:new be(l,y.fee)}),Z=ee(J({},f),{amount:new be(d,f.amount),fee:f.fee===void 0?void 0:new be(d,f.fee)}),P=ee(J({},b),{amount:new be(d,b.amount),fee:b.fee===void 0?void 0:new be(d,b.fee)}),E=new Me({baseToken:l,denominator:new ce(10).pow(new ce(20+l.decimals)),quoteToken:d,numerator:T.mul(new F(10**(20+d.decimals))).toFixed(0)}),fe=new Me({baseToken:l,denominator:new ce(10).pow(new ce(20+l.decimals)),quoteToken:d,numerator:A.mul(new F(10**(20+d.decimals))).toFixed(0)}),le=new be(l,D);return{allTrade:p,realAmountIn:L,amountOut:Z,minAmountOut:P,expirationTime:w,currentPrice:E,executionPrice:fe,priceImpact:I,fee:le,remainingAccounts:x,executionPriceX64:O}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var y,f,b;let o=e[t],s=R.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=R.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),m=Math.min(a,o.priceMax)-u,l=a-s,d=o.priceMax-o.priceMin,p;return m<=0?p=0:l===m?p=d/m:d===m?p=m/l:p=m/d*(m/l),{feeApr:o.feeApr*p,rewardsApr:[((y=o.rewardApr[0])!=null?y:0)*p,((f=o.rewardApr[1])!=null?f:0)*p,((b=o.rewardApr[2])!=null?b:0)*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,m=e[n],l=r[Bt(e.mintA.address).toString()],d=r[Bt(e.mintB.address).toString()],p=e.mintA.decimals,y=e.mintB.decimals;if(!m||!l||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=q.priceToSqrtPriceX64(new F(e.price),e.mintA.decimals,e.mintB.decimals),b=q.getSqrtPriceX64FromTick(s),w=q.getSqrtPriceX64FromTick(a),{amountSlippageA:T,amountSlippageB:A}=Q.getAmountsFromLiquidityWithSlippage(f,b,w,t,!1,!1,0),{amountSlippageA:I,amountSlippageB:D}=Q.getAmountsFromLiquidityWithSlippage(f,b,w,o,!1,!1,0),x=new F(T.toString()).div(new F(10).pow(p)).mul(l.value).add(new F(A.toString()).div(new F(10).pow(y)).mul(d.value)),O=new F(I.toString()).div(new F(10).pow(p)).mul(l.value).add(new F(D.toString()).div(new F(10).pow(y)).mul(d.value)),L=new F(1).div(x.add(O)),P=new F(m.volumeFee).mul(365).div(c).mul(L).mul(100).toNumber(),E=3600*24*365,fe=e.rewardDefaultInfos.map(le=>{var $,jn;let Be=le.mint.decimals,oe=r[le.mint.address];return u<(($=le.startTime)!=null?$:0)||u>((jn=le.endTime)!=null?jn:0)||!le.perSecond||!oe||Be===void 0?0:new F(oe.value).mul(new F(le.perSecond).mul(E)).div(new F(10).pow(Be)).mul(L).mul(100).toNumber()});return{feeApr:P,rewardsApr:fe,apr:P+fe.reduce((le,Be)=>le+Be,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var w,T;let m=q.priceToSqrtPriceX64(new F(e.price),e.mintA.decimals,e.mintB.decimals),l=q.getSqrtPriceX64FromTick(n),d=q.getSqrtPriceX64FromTick(r),p=a?1-s:1+s,y=de(o,(w=e[t?"mintA":"mintB"].extensions)==null?void 0:w.feeConfig,u,!c),f=new ce(new F(y.amount.sub((T=y.fee)!=null?T:ue).toString()).mul(p).toFixed(0)),b;if(m.lte(l))b=t?Q.getLiquidityFromTokenAmountA(l,d,f,!a):new ce(0);else if(m.lte(d)){let A=Q.getLiquidityFromTokenAmountA(m,d,f,!a),I=Q.getLiquidityFromTokenAmountB(l,m,f);b=t?A:I}else b=t?new ce(0):Q.getLiquidityFromTokenAmountB(l,d,f);return ke.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:b,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var b,w,T,A;let u=q.getSqrtPriceX64FromTick(n),c=q.getSqrtPriceX64FromTick(r),m=a?1+s:1-s,l=Q.getAmountsFromLiquidity(q.priceToSqrtPriceX64(new F(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,p]=[de(l.amountA,(b=t.mintA.extensions)==null?void 0:b.feeConfig,e,!0),de(l.amountB,(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)],[y,f]=[de(l.amountA.muln(m),(T=t.mintA.extensions)==null?void 0:T.feeConfig,e,!0),de(l.amountB.muln(m),(A=t.mintB.extensions)==null?void 0:A.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:y,amountSlippageB:f,expirationTime:dt(d.expirationTime,p.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(u=>!n[u.id]).map(u=>new Ve(u.id));(await st(e,r)).forEach((u,c)=>{!u||(n[r[c].toBase58()]=vn.decode(u.data))});let s=t.map(u=>Le(new Ve(u.programId),new Ve(u.id)).publicKey),a=await ke.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((u,c)=>ee(J({},u),{[c.id]:ee(J({},n[c.id]),{id:new Ve(c.id),version:6,programId:new Ve(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:ee(J({},c.config),{id:new Ve(c.config.id),fundOwner:""}),currentPrice:new F(c.price),exBitmapInfo:a[Le(new Ve(c.programId),new Ve(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber()})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var G=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(ue)||(o=o.add(Ne)),o}static mulDivFloor(e,t,n){if(n.eq(ue))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ue))throw new Error("division by 0");return e.mul(t).add(n.sub(Ne)).div(n)}static x64ToDecimal(e,t){return new F(e.toString()).div(F.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new X(e.mul(F.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Yt).sub(t).mod(Yt)}};function ye(i,e){return _n(i.mul(e),64,256)}function os(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function _n(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var q=class{static sqrtPriceX64ToPrice(e,t,n){return G.x64ToDecimal(e).pow(2).mul(F.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return G.decimalToX64(e.mul(F.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(ue))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ue))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(ue))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ue))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(ue))return e;let o=t.shln(Kt);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?G.mulDivCeil(s,e,a):G.mulDivRoundingUp(s,Ne,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return G.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Kt);if(r)return e.add(o.div(t));{let s=G.mulDivRoundingUp(o,Ne,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Pe||e>Te)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new X("18445821805675395072"):new X("18446744073709551616");return(t&2)!=0&&(n=ye(n,new X("18444899583751176192"))),(t&4)!=0&&(n=ye(n,new X("18443055278223355904"))),(t&8)!=0&&(n=ye(n,new X("18439367220385607680"))),(t&16)!=0&&(n=ye(n,new X("18431993317065453568"))),(t&32)!=0&&(n=ye(n,new X("18417254355718170624"))),(t&64)!=0&&(n=ye(n,new X("18387811781193609216"))),(t&128)!=0&&(n=ye(n,new X("18329067761203558400"))),(t&256)!=0&&(n=ye(n,new X("18212142134806163456"))),(t&512)!=0&&(n=ye(n,new X("17980523815641700352"))),(t&1024)!=0&&(n=ye(n,new X("17526086738831433728"))),(t&2048)!=0&&(n=ye(n,new X("16651378430235570176"))),(t&4096)!=0&&(n=ye(n,new X("15030750278694412288"))),(t&8192)!=0&&(n=ye(n,new X("12247334978884435968"))),(t&16384)!=0&&(n=ye(n,new X("8131365268886854656"))),(t&32768)!=0&&(n=ye(n,new X("3584323654725218816"))),(t&65536)!=0&&(n=ye(n,new X("696457651848324352"))),(t&131072)!=0&&(n=ye(n,new X("26294789957507116"))),(t&262144)!=0&&(n=ye(n,new X("37481735321082"))),e>0&&(n=Bi.div(n)),n}static getTickFromPrice(e,t,n){return q.getTickFromSqrtPriceX64(q.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(je)||e.lt(Ye))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new X(t-64),r=os(n,32,128),o=new X("8000000000000000","hex"),s=0,a=new X(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new X(0))&&s<Ii;){u=u.mul(u);let y=u.shrn(127);u=u.shrn(63+y.toNumber()),a=a.add(o.mul(y)),o=o.shrn(1),s+=1}let c=a.shrn(32),l=r.add(c).mul(new X(Si)),d=_n(l.sub(new X(Ci)),64,128).toNumber(),p=_n(l.add(new X(Ki)),64,128).toNumber();return d==p?d:q.getSqrtPriceX64FromTick(p).lte(e)?p:d}},bt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=q.getTickFromSqrtPriceX64(q.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=bt.getTickWithPriceAndTickspacing(e,t,n,r),s=q.getSqrtPriceX64FromTick(o);return q.sqrtPriceX64ToPrice(s,n,r)}},Q=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ue))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Kt),s=t.sub(e);return r?G.mulDivRoundingUp(G.mulDivCeil(o,s,t),Ne,e):G.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ue))throw new Error("sqrtPriceX64A must greater than 0");return r?G.mulDivCeil(n,t.sub(e),Re):G.mulDivFloor(n,t.sub(e),Re)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?G.mulDivRoundingUp(a,Ne,Cn):a.shrn(Kt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),G.mulDivFloor(n,Cn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return Q.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=Q.getLiquidityFromTokenAmountA(e,n,r,!1),a=Q.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return Q.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:Q.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new X(0)};if(e.lt(n)){let s=Q.getTokenAmountAFromLiquidity(e,n,r,o),a=Q.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new X(0),amountB:Q.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=Q.getAmountsFromLiquidity(e,t,n,r,s),m=o?1+a:1-a,l=new X(new F(u.toString()).mul(m).toFixed(0)),d=new X(new F(c.toString()).mul(m).toFixed(0));return{amountSlippageA:l,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var T,A,I,D;let c=q.priceToSqrtPriceX64(new F(e.price),e.mintA.decimals,e.mintB.decimals),m=q.getSqrtPriceX64FromTick(t),l=q.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=Q.getAmountsFromLiquidity(c,m,l,r,s),[y,f]=[de(p.amountA,(T=e.mintA.extensions)==null?void 0:T.feeConfig,a,u),de(p.amountB,(A=e.mintB.extensions)==null?void 0:A.feeConfig,a,u)],[b,w]=[de(new X(new F(p.amountA.toString()).mul(d).toFixed(0)),(I=e.mintA.extensions)==null?void 0:I.feeConfig,a,u),de(new X(new F(p.amountB.toString()).mul(d).toFixed(0)),(D=e.mintB.extensions)==null?void 0:D.feeConfig,a,u)];return{liquidity:r,amountA:y,amountB:f,amountSlippageA:b,amountSlippageB:w,expirationTime:dt(y.expirationTime,f.expirationTime)}}},yt=class{static swapCompute(e,t,n,r,o,s,a,u,c,m,l,d,p,y,f=!1){if(d.eq(ue))throw new Error("amountSpecified must not be 0");if(y||(y=s?Ye.add(Ne):je.sub(Ne)),s){if(y.lt(Ye))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(y.gte(l))throw new Error("sqrtPriceX64 must smaller than current")}else{if(y.gt(je))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(y.lte(l))throw new Error("sqrtPriceX64 must greater than current")}let b=d.gt(ue),w={amountSpecifiedRemaining:d,amountCalculated:ue,sqrtPriceX64:l,tick:c>p?Math.min(p+z.tickCount(m)-1,c):p,accounts:[],liquidity:u,feeAmount:new X(0)},T=p,A=n[p],I=0,D=!s&&A.startTickIndex===w.tick;for(;!w.amountSpecifiedRemaining.eq(ue)&&!w.sqrtPriceX64.eq(y);){I>10;let x={};x.sqrtPriceStartX64=w.sqrtPriceX64;let O=R.nextInitTick(A,w.tick,m,s,D),L=O||null,Z=null;if(!(L!=null&&L.liquidityGross.gtn(0))){let E=ke.nextInitializedTickArrayStartIndex({tickCurrent:w.tick,tickSpacing:m,tickArrayBitmap:r,exBitmapInfo:o},T,s);if(!E.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:w.amountSpecifiedRemaining,amountCalculated:w.amountCalculated,feeAmount:w.feeAmount,sqrtPriceX64:w.sqrtPriceX64,liquidity:w.liquidity,tickCurrent:w.tick,accounts:w.accounts};throw Error("swapCompute LiquidityInsufficient")}T=E.nextStartIndex;let{publicKey:fe}=te(e,t,T);Z=fe,A=n[T];try{L=R.firstInitializedTick(A,s)}catch{throw Error("not found next tick info")}}x.tickNext=L.tick,x.initialized=L.liquidityGross.gtn(0),p!==T&&Z&&(w.accounts.push(Z),p=T),x.tickNext<Pe?x.tickNext=Pe:x.tickNext>Te&&(x.tickNext=Te),x.sqrtPriceNextX64=q.getSqrtPriceX64FromTick(x.tickNext);let P;if(s&&x.sqrtPriceNextX64.lt(y)||!s&&x.sqrtPriceNextX64.gt(y)?P=y:P=x.sqrtPriceNextX64,[w.sqrtPriceX64,x.amountIn,x.amountOut,x.feeAmount]=yt.swapStepCompute(w.sqrtPriceX64,P,w.liquidity,w.amountSpecifiedRemaining,a),w.feeAmount=w.feeAmount.add(x.feeAmount),b?(w.amountSpecifiedRemaining=w.amountSpecifiedRemaining.sub(x.amountIn.add(x.feeAmount)),w.amountCalculated=w.amountCalculated.sub(x.amountOut)):(w.amountSpecifiedRemaining=w.amountSpecifiedRemaining.add(x.amountOut),w.amountCalculated=w.amountCalculated.add(x.amountIn.add(x.feeAmount))),w.sqrtPriceX64.eq(x.sqrtPriceNextX64)){if(x.initialized){let E=L.liquidityNet;s&&(E=E.mul(Ze)),w.liquidity=Q.addDelta(w.liquidity,E)}D=x.tickNext!=w.tick&&!s&&A.startTickIndex===x.tickNext,w.tick=s?x.tickNext-1:x.tickNext}else if(w.sqrtPriceX64!=x.sqrtPriceStartX64){let E=q.getTickFromSqrtPriceX64(w.sqrtPriceX64);D=E!=w.tick&&!s&&A.startTickIndex===E,w.tick=E}++I}try{let{nextStartIndex:x,isExist:O}=z.nextInitializedTickArray(w.tick,m,s,r,o);O&&p!==x&&(w.accounts.push(te(e,t,x).publicKey),p=x)}catch{}return{allTrade:!0,amountSpecifiedRemaining:ue,amountCalculated:w.amountCalculated,feeAmount:w.feeAmount,sqrtPriceX64:w.sqrtPriceX64,liquidity:w.liquidity,tickCurrent:w.tick,accounts:w.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new X(0),amountIn:new X(0),amountOut:new X(0),feeAmount:new X(0)},a=e.gte(t),u=r.gte(ue);if(u){let m=G.mulDivFloor(r,$t.sub(new X(o.toString())),$t);s.amountIn=a?Q.getTokenAmountAFromLiquidity(t,e,n,!0):Q.getTokenAmountBFromLiquidity(e,t,n,!0),m.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=q.getNextSqrtPriceX64FromInput(e,n,m,a)}else s.amountOut=a?Q.getTokenAmountBFromLiquidity(t,e,n,!1):Q.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(Ze).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=q.getNextSqrtPriceX64FromOutput(e,n,r.mul(Ze),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=Q.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=Q.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:Q.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:Q.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(Ze))&&(s.amountOut=r.mul(Ze)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=G.mulDivCeil(s.amountIn,new X(o),$t.sub(new X(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};import{TOKEN_PROGRAM_ID as he,TOKEN_2022_PROGRAM_ID as lt,ASSOCIATED_TOKEN_PROGRAM_ID as Zi}from"@solana/spl-token";import{PublicKey as B,TransactionInstruction as Ge,SystemProgram as At,Keypair as Un}from"@solana/web3.js";import Yi from"bn.js";import{PublicKey as ms,Keypair as ds}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ps}from"@solana/spl-token";import yp from"bn.js";var ss=W([K("mint"),K("owner"),g("amount"),Je("delegateOption"),K("delegate"),U("state"),Je("isNativeOption"),g("isNative"),g("delegatedAmount"),Je("closeAuthorityOption"),K("closeAuthority")]);function as(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function Dn(i,...e){if(!as(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function Vn(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function Gi(i,e){Dn(i);let t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var sn=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),qe=(i,e)=>i<<32-e|i>>>e;var tp=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function us(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function qn(i){return typeof i=="string"&&(i=us(i)),Dn(i),i}var on=class{clone(){return this._cloneInto()}},np={}.toString;function Ui(i){let e=n=>i().update(qn(n)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function cs(i,e,t,n){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,n);let r=BigInt(32),o=BigInt(4294967295),s=Number(t>>r&o),a=Number(t&o),u=n?4:0,c=n?0:4;i.setUint32(e+u,s,n),i.setUint32(e+c,a,n)}var Xi=(i,e,t)=>i&e^~i&t,zi=(i,e,t)=>i&e^i&t^e&t,an=class extends on{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=sn(this.buffer)}update(e){Vn(this);let{view:t,buffer:n,blockLen:r}=this;e=qn(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(r-this.pos,o-s);if(a===r){let u=sn(e);for(;r<=o-s;s+=r)this.process(u,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Vn(this),Gi(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let l=s;l<r;l++)t[l]=0;cs(n,r-8,BigInt(this.length*8),o),this.process(n,0);let a=sn(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,m=this.get();if(c>m.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<c;l++)a.setUint32(4*l,m[l],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:o,destroyed:s,pos:a}=this;return e.length=r,e.pos=a,e.finished=o,e.destroyed=s,r%t&&e.buffer.set(n),e}};var ls=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ut=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ct=new Uint32Array(64),Gn=class extends an{constructor(){super(64,32,8,!1),this.A=ut[0]|0,this.B=ut[1]|0,this.C=ut[2]|0,this.D=ut[3]|0,this.E=ut[4]|0,this.F=ut[5]|0,this.G=ut[6]|0,this.H=ut[7]|0}get(){let{A:e,B:t,C:n,D:r,E:o,F:s,G:a,H:u}=this;return[e,t,n,r,o,s,a,u]}set(e,t,n,r,o,s,a,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,t){for(let l=0;l<16;l++,t+=4)ct[l]=e.getUint32(t,!1);for(let l=16;l<64;l++){let d=ct[l-15],p=ct[l-2],y=qe(d,7)^qe(d,18)^d>>>3,f=qe(p,17)^qe(p,19)^p>>>10;ct[l]=f+ct[l-7]+y+ct[l-16]|0}let{A:n,B:r,C:o,D:s,E:a,F:u,G:c,H:m}=this;for(let l=0;l<64;l++){let d=qe(a,6)^qe(a,11)^qe(a,25),p=m+d+Xi(a,u,c)+ls[l]+ct[l]|0,f=(qe(n,2)^qe(n,13)^qe(n,22))+zi(n,r,o)|0;m=c,c=u,u=a,a=s+p|0,s=o,o=r,r=n,n=p+f|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,m=m+this.H|0,this.set(n,r,o,s,a,u,c,m)}roundClean(){ct.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Hi=Ui(()=>new Gn);var hp=se("Raydium_Util");function Qi({fromPublicKey:i,programId:e=ps}){let t=ds.generate().publicKey.toBase58().slice(0,32);return{publicKey:fs(i,t,e),seed:t}}function fs(i,e,t){let n=Buffer.concat([i.toBuffer(),Buffer.from(e),t.toBuffer()]),r=Hi(n);return new ms(r)}var ji=se("Raydium_Clmm"),Ue={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Et=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,y){let f=W([_("sqrtPriceX64"),g("startTime")]),b=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:At.programId,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1}],w=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:y},w);let T=Buffer.from([...Ue.createPool,...w]);return new Ge({keys:b,programId:e,data:T})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:r,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:u,startTime:c,forerunCreate:m}=e,l=Qi({fromPublicKey:r,programId:n}),[d,p]=[new B(o.address),new B(s.address)],y=[At.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:l.seed,newAccountPubkey:l.publicKey,lamports:m?0:await t.getMinimumBalanceForRentExemption(Fn.span),space:Fn.span,programId:n})],{publicKey:f}=Mi(n,a,d,p,r),{publicKey:b}=Rn(n,f,d),{publicKey:w}=Rn(n,f,p);return y.push(this.createPoolInstruction(n,f,r,a,l.publicKey,d,b,new B(o.programId||he),p,w,new B(s.programId||he),Le(n,f).publicKey,u,c)),{signers:[],instructions:y,instructionTypes:[re.CreateAccount,re.ClmmCreatePool],address:{poolId:f,observationId:l.publicKey,mintAVault:b,mintBVault:w},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,y,f,b,w,T,A,I,D,x,O,L,Z,P){let E=W([we("tickLowerIndex"),we("tickUpperIndex"),we("tickArrayLowerStartIndex"),we("tickArrayUpperStartIndex"),_("liquidity"),g("amountMaxA"),g("amountMaxB"),Ee("withMetadata"),U("optionBaseFlag"),Ee("baseFlag")]),fe=[...P?[{pubkey:P,isSigner:!1,isWritable:!0}]:[]],le=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:At.programId,isSigner:!1,isWritable:!1},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:Zi,isSigner:!1,isWritable:!1},{pubkey:ht,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...fe],Be=Buffer.alloc(E.span);E.encode({tickLowerIndex:T,tickUpperIndex:A,tickArrayLowerStartIndex:I,tickArrayUpperStartIndex:D,liquidity:x,amountMaxA:O,amountMaxB:L,withMetadata:Z==="create",baseFlag:!1,optionBaseFlag:0},Be);let oe=Buffer.from([...Ue.openPosition,...Be]);return new Ge({keys:le,programId:e,data:oe})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:m}){let l=[],[d,p]=[new B(e.programId),new B(e.id)],y;if(m)y=new B((await m(1))[0]);else{let L=Un.generate();l.push(L),y=L.publicKey}let f=R.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=R.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=te(d,p,f),{publicKey:T}=te(d,p,b),{publicKey:A}=ze(n.wallet,y,he),{publicKey:I}=tn(y),{publicKey:D}=De(d,y),{publicKey:x}=pt(d,p,r,o),O=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,y,A,I,x,w,T,D,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),r,o,f,b,s,a,u,c);return{signers:l,instructions:[O],instructionTypes:[re.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:y,tickArrayLower:w,tickArrayUpper:T,positionNftAccount:A,metadataAccount:I,personalPosition:D,protocolPosition:x}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:m}){let l=[],[d,p]=[new B(e.programId),new B(e.id)],y;if(m)y=new B((await m(1))[0]);else{let L=Un.generate();l.push(L),y=L.publicKey}let f=R.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=R.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=te(d,p,f),{publicKey:T}=te(d,p,b),{publicKey:A}=ze(n.wallet,y,he),{publicKey:I}=tn(y),{publicKey:D}=De(d,y),{publicKey:x}=pt(d,p,r,o),O=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,y,A,I,x,w,T,D,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),r,o,f,b,c,s,a,u,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?Le(d,p).publicKey:void 0);return{address:{nftMint:y,tickArrayLower:w,tickArrayUpper:T,positionNftAccount:A,metadataAccount:I,personalPosition:D,protocolPosition:x},instructions:[O],signers:l,instructionTypes:[re.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,y,f,b,w,T,A,I,D,x,O,L,Z,P){let E=W([we("tickLowerIndex"),we("tickUpperIndex"),we("tickArrayLowerStartIndex"),we("tickArrayUpperStartIndex"),_("liquidity"),g("amountMaxA"),g("amountMaxB"),Ee("withMetadata"),U("optionBaseFlag"),Ee("baseFlag")]),fe=[...P?[{pubkey:P,isSigner:!1,isWritable:!0}]:[]],le=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:At.programId,isSigner:!1,isWritable:!1},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:Zi,isSigner:!1,isWritable:!1},{pubkey:ht,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...fe],Be=Buffer.alloc(E.span);E.encode({tickLowerIndex:T,tickUpperIndex:A,tickArrayLowerStartIndex:I,tickArrayUpperStartIndex:D,liquidity:new Yi(0),amountMaxA:O==="MintA"?L:Z,amountMaxB:O==="MintA"?Z:L,withMetadata:x==="create",baseFlag:O==="MintA",optionBaseFlag:1},Be);let oe=Buffer.from([...Ue.openPosition,...Be]);return new Ge({keys:le,programId:e,data:oe})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:m}){let l,d=[];if(m)l=new B((await m(1))[0]);else{let L=Un.generate();d.push(L),l=L.publicKey}let[p,y]=[new B(e.programId),new B(e.id)],f=R.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=R.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=te(p,y,f),{publicKey:T}=te(p,y,b),{publicKey:A}=ze(n.wallet,l,he),{publicKey:I}=tn(l),{publicKey:D}=De(p,l),{publicKey:x}=pt(p,y,r,o),O=this.openPositionFromLiquidityInstruction(p,n.wallet,y,n.wallet,l,A,I,x,w,T,D,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(t.mintA.address),new B(t.mintB.address),r,o,f,b,s,a,u,c,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?Le(p,y).publicKey:void 0);return{address:{nftMint:l,tickArrayLower:w,tickArrayUpper:T,positionNftAccount:A,metadataAccount:I,personalPosition:D,protocolPosition:x},instructions:[O],signers:d,instructionTypes:[re.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=W([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:At.programId,isSigner:!1,isWritable:!1},{pubkey:he,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...Ue.closePosition,...u]);return new Ge({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new B(e.programId),{publicKey:s}=ze(n.wallet,r.nftMint,he),{publicKey:a}=De(o,r.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[re.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,y,f,b,w,T){let A=W([_("liquidity"),g("amountMaxA"),g("amountMaxB"),U("optionBaseFlag"),Ee("baseFlag")]),I=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],D=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...I],x=Buffer.alloc(A.span);A.encode({liquidity:f,amountMaxA:b,amountMaxB:w,optionBaseFlag:0,baseFlag:!1},x);let O=Buffer.from([...Ue.increaseLiquidity,...x]);return new Ge({keys:D,programId:e,data:O})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new B(e.programId),new B(e.id)],m=R.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),l=R.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=te(u,c,m),{publicKey:p}=te(u,c,l),{publicKey:y}=ze(r.wallet,n.nftMint,he),{publicKey:f}=De(u,n.nftMint),{publicKey:b}=pt(u,c,n.tickLower,n.tickUpper),w=this.increasePositionFromLiquidityInstruction(u,r.wallet,y,f,c,b,d,p,r.tokenAccountA,r.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),o,s,a,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,l])?Le(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:y,personalPosition:f,protocolPosition:b},signers:[],instructions:[w],instructionTypes:[re.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new B(e.programId),new B(e.id)],m=R.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),l=R.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=te(u,c,m),{publicKey:p}=te(u,c,l),{publicKey:y}=ze(r.wallet,n.nftMint,he),{publicKey:f}=De(u,n.nftMint),{publicKey:b}=pt(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:y,personalPosition:f,protocolPosition:b},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,y,f,c,b,d,p,r.tokenAccountA,r.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),o,s,a,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,l])?Le(u,c).publicKey:void 0)],signers:[],instructionTypes:[re.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,y,f,b,w,T){let A=W([_("liquidity"),g("amountMaxA"),g("amountMaxB"),U("optionBaseFlag"),Ee("baseFlag")]),I=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],D=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...I],x=Buffer.alloc(A.span);A.encode({liquidity:new Yi(0),amountMaxA:f==="MintA"?b:w,amountMaxB:f==="MintA"?w:b,baseFlag:f==="MintA",optionBaseFlag:1},x);let O=Buffer.from([...Ue.increaseLiquidity,...x]);return new Ge({keys:D,programId:e,data:O})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,y,f,b,w,T,A){let I=W([_("liquidity"),g("amountMinA"),g("amountMinB")]),D=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[],...f.map(Z=>[{pubkey:Z.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:Z.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:Z.rewardMint,isSigner:!1,isWritable:!1}]).flat()],x=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:Ut,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...D],O=Buffer.alloc(I.span);I.encode({liquidity:b,amountMinA:w,amountMinB:T},O);let L=Buffer.from([...Ue.decreaseLiquidity,...O]);return new Ge({keys:x,programId:e,data:L})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,m]=[new B(e.programId),new B(e.id)],l=R.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=R.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=te(c,m,l),{publicKey:y}=te(c,m,d),{publicKey:f}=ze(r.wallet,n.nftMint,u),{publicKey:b}=De(c,n.nftMint),{publicKey:w}=pt(c,m,n.tickLower,n.tickUpper),T=[];for(let I=0;I<e.rewardDefaultInfos.length;I++)T.push({poolRewardVault:new B(t.rewardInfos[I].vault),ownerRewardVault:r.rewardAccounts[I],rewardMint:new B(e.rewardDefaultInfos[I].mint.address)});let A=[];return A.push(this.decreaseLiquidityInstruction(c,r.wallet,f,b,m,w,p,y,r.tokenAccountA,r.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),T,o,s,a,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,d])?Le(c,m).publicKey:void 0)),{address:{tickArrayLower:p,tickArrayUpper:y,positionNftAccount:f,personalPosition:b,protocolPosition:w},signers:[],instructions:A,instructionTypes:[re.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,y,f,b,w){let T=W([g("amount"),g("otherAmountThreshold"),_("sqrtPriceLimitX64"),Ee("isBaseInput")]),A=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...l.map(O=>({pubkey:O,isSigner:!1,isWritable:!0}))],I=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:Ut,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},...A],D=Buffer.alloc(T.span);T.encode({amount:p,otherAmountThreshold:y,sqrtPriceLimitX64:f,isBaseInput:b},D);let x=Buffer.from([...Ue.swap,...D]);return new Ge({keys:I,programId:e,data:x})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[m,l]=[new B(e.programId),new B(e.id)],[d,p]=[new B(t.vault.A),new B(t.vault.B)],[y,f]=[new B(e.mintA.address),new B(e.mintB.address)],b=e.mintA.address===o.toString(),w=[this.swapInstruction(m,r.wallet,l,new B(e.config.id),b?r.tokenAccountA:r.tokenAccountB,b?r.tokenAccountB:r.tokenAccountA,b?d:p,b?p:d,b?y:f,b?f:y,c,n,s,a,u,!0,Le(m,l).publicKey)];return{signers:[],instructions:w,instructionTypes:[re.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,m,l,d){let p=W([g("openTime"),g("endTime"),_("emissionsPerSecondX64")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:At.programId,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:ae(m),endTime:ae(l),emissionsPerSecondX64:d},f);let b=Buffer.from([...Ue.initReward,...f]);return new Ge({keys:y,programId:e,data:b})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new B(e.programId),new B(e.id)],a=Oi(o,s,r.mint).publicKey,u=nn(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new B(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[re.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,m,l,d){let p=W([U("rewardIndex"),_("emissionsPerSecondX64"),g("openTime"),g("endTime")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:ae(m),endTime:ae(l)},f);let b=Buffer.from([...Ue.setRewardEmissions,...f]);return new Ge({keys:y,programId:e,data:b})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new B(e.programId),new B(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,u=new B(t.rewardInfos[d].vault),c=new B(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&ji.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let m=nn(o).publicKey,l=[this.setRewardInstruction(o,n.wallet,s,m,new B(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:m},signers:[],instructions:l,instructionTypes:[re.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=W([U("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:he,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:Ut,isSigner:!1,isWritable:!1}],m=Buffer.alloc(u.span);u.encode({rewardIndex:a},m);let l=Buffer.from([...Ue.collectReward,...m]);return new Ge({keys:c,programId:e,data:l})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new B(e.programId),new B(e.id)],a,u;for(let m=0;m<e.rewardDefaultInfos.length;m++)e.rewardDefaultInfos[m].mint.address===r.toString()&&(a=m,u=new B(t.rewardInfos[m].vault));(a===void 0||u===void 0)&&ji.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[re.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:r,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,m]=[new B(e.programId),new B(e.id)],[l,d]=[new B(t.vault.A),new B(t.vault.B)],[p,y]=[new B(e.mintA.address),new B(e.mintB.address)],f=e.mintA.address===r.toString(),b=[this.swapInstruction(c,n.wallet,m,new B(e.config.id),f?n.tokenAccountB:n.tokenAccountA,f?n.tokenAccountA:n.tokenAccountB,f?d:l,f?l:d,f?p:y,f?y:p,u,l,o,s,a,!1)];return{signers:[],instructions:b,instructionTypes:[re.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};import af from"bn.js";import{AccountLayout as cf,TOKEN_PROGRAM_ID as lf}from"@solana/spl-token";import{TOKEN_PROGRAM_ID as $i,ASSOCIATED_TOKEN_PROGRAM_ID as Zf}from"@solana/spl-token";import{PublicKey as jf,TransactionInstruction as er,SystemProgram as Jf,SYSVAR_RENT_PUBKEY as $f}from"@solana/web3.js";var Xn=W([U("instruction"),g("amountIn"),g("minAmountOut")]),zn=W([U("instruction"),g("maxAmountIn"),g("amountOut")]),Wf=W([U("instruction"),U("nonce")]),bs=W([U("instruction"),U("nonce"),g("startTime")]),_f=W([g("status"),g("nonce"),g("maxOrder"),g("depth"),g("baseDecimal"),g("quoteDecimal"),g("state"),g("resetFlag"),g("minSize"),g("volMaxCutRatio"),g("amountWaveRatio"),g("baseLotSize"),g("quoteLotSize"),g("minPriceMultiplier"),g("maxPriceMultiplier"),g("systemDecimalValue"),g("minSeparateNumerator"),g("minSeparateDenominator"),g("tradeFeeNumerator"),g("tradeFeeDenominator"),g("pnlNumerator"),g("pnlDenominator"),g("swapFeeNumerator"),g("swapFeeDenominator"),g("baseNeedTakePnl"),g("quoteNeedTakePnl"),g("quoteTotalPnl"),g("baseTotalPnl"),g("poolOpenTime"),g("punishPcAmount"),g("punishCoinAmount"),g("orderbookToInitTime"),_("swapBaseInAmount"),_("swapQuoteOutAmount"),g("swapBase2QuoteFee"),_("swapQuoteInAmount"),_("swapBaseOutAmount"),g("swapQuote2BaseFee"),K("baseVault"),K("quoteVault"),K("baseMint"),K("quoteMint"),K("lpMint"),K("openOrders"),K("marketId"),K("marketProgramId"),K("targetOrders"),K("withdrawQueue"),K("lpVault"),K("owner"),g("lpReserve"),Y(g(),3,"padding")]),Df=W([g("accountType"),g("status"),g("nonce"),g("maxOrder"),g("depth"),g("baseDecimal"),g("quoteDecimal"),g("state"),g("resetFlag"),g("minSize"),g("volMaxCutRatio"),g("amountWaveRatio"),g("baseLotSize"),g("quoteLotSize"),g("minPriceMultiplier"),g("maxPriceMultiplier"),g("systemDecimalsValue"),g("abortTradeFactor"),g("priceTickMultiplier"),g("priceTick"),g("minSeparateNumerator"),g("minSeparateDenominator"),g("tradeFeeNumerator"),g("tradeFeeDenominator"),g("pnlNumerator"),g("pnlDenominator"),g("swapFeeNumerator"),g("swapFeeDenominator"),g("baseNeedTakePnl"),g("quoteNeedTakePnl"),g("quoteTotalPnl"),g("baseTotalPnl"),g("poolOpenTime"),g("punishPcAmount"),g("punishCoinAmount"),g("orderbookToInitTime"),_("swapBaseInAmount"),_("swapQuoteOutAmount"),_("swapQuoteInAmount"),_("swapBaseOutAmount"),g("swapQuote2BaseFee"),g("swapBase2QuoteFee"),K("baseVault"),K("quoteVault"),K("baseMint"),K("quoteMint"),K("lpMint"),K("modelDataAccount"),K("openOrders"),K("marketId"),K("marketProgramId"),K("targetOrders"),K("owner"),Y(g(),64,"padding")]),ys=W([U("instruction"),g("baseAmountIn"),g("quoteAmountIn"),g("fixedSide")]),gs=W([U("instruction"),g("amountIn")]);var Vf=W([g("fee")]);import{PublicKey as ws}from"@solana/web3.js";var Hn=new ws("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ks=5e4,hs=W([g("x"),g("y"),g("price")]),zf=W([g("accountType"),g("status"),g("multiplier"),g("validDataCount"),Y(hs,ks,"DataElement")]);var Ji=se("Raydium_liquidity_instruction");function As({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=Ce(i),s=Buffer.alloc(Xn.span);Xn.encode({instruction:9,amountIn:ae(t),minAmountOut:ae(n)},s);let a=[h({pubkey:$i,isWritable:!1}),h({pubkey:o.id}),h({pubkey:o.authority,isWritable:!1}),h({pubkey:o.openOrders})];return r===4&&a.push(h({pubkey:o.targetOrders})),a.push(h({pubkey:o.vault.A}),h({pubkey:o.vault.B})),r===5&&a.push(h({pubkey:Hn})),a.push(h({pubkey:o.marketProgramId,isWritable:!1}),h({pubkey:o.marketId}),h({pubkey:o.marketBids}),h({pubkey:o.marketAsks}),h({pubkey:o.marketEventQueue}),h({pubkey:o.marketBaseVault}),h({pubkey:o.marketQuoteVault}),h({pubkey:o.marketAuthority,isWritable:!1}),h({pubkey:e.tokenAccountIn}),h({pubkey:e.tokenAccountOut}),h({pubkey:e.owner,isWritable:!1})),new er({programId:o.programId,keys:a,data:s})}function Ps({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=Ce(i),s=Buffer.alloc(zn.span);zn.encode({instruction:11,maxAmountIn:ae(t),amountOut:ae(n)},s);let a=[h({pubkey:$i,isWritable:!1}),h({pubkey:o.id}),h({pubkey:o.authority,isWritable:!1}),h({pubkey:o.openOrders}),h({pubkey:o.targetOrders}),h({pubkey:o.vault.A}),h({pubkey:o.vault.B})];return r===5&&a.push(h({pubkey:Hn})),a.push(h({pubkey:o.marketProgramId,isWritable:!1}),h({pubkey:o.marketId}),h({pubkey:o.marketBids}),h({pubkey:o.marketAsks}),h({pubkey:o.marketEventQueue}),h({pubkey:o.marketBaseVault}),h({pubkey:o.marketQuoteVault}),h({pubkey:o.marketAuthority,isWritable:!1}),h({pubkey:e.tokenAccountIn}),h({pubkey:e.tokenAccountOut}),h({pubkey:e.owner,isWritable:!1,isSigner:!0})),new er({programId:o.programId,keys:a,data:s})}function tr(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:s}=i;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return As(ee(J({},a),{amountIn:r,minAmountOut:o}),t);if(s==="out")return Ps(ee(J({},a),{maxAmountIn:r,amountOut:o}),t);Ji.logWithError("invalid params","params",i)}throw Ji.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}var lb=W([xe(8),U("bump"),Ee("disableCreatePool"),at("index"),g("tradeFeeRate"),g("protocolFeeRate"),g("fundFeeRate"),g("createPoolFee"),K("protocolOwner"),K("fundOwner"),Y(g(),16)]),mb=W([xe(8),K("configId"),K("poolCreator"),K("vaultA"),K("vaultB"),K("mintLp"),K("mintA"),K("mintB"),K("mintProgramA"),K("mintProgramB"),K("observationId"),U("bump"),U("status"),U("lpDecimals"),U("mintDecimalA"),U("mintDecimalB"),g("lpAmount"),g("protocolFeesMintA"),g("protocolFeesMintB"),g("fundFeesMintA"),g("fundFeesMintB"),Y(g(),32)]);import{TransactionInstruction as Ts}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as gb,TOKEN_2022_PROGRAM_ID as wb,ASSOCIATED_TOKEN_PROGRAM_ID as kb}from"@solana/spl-token";var Pb=se("Raydium_cpmm"),xs={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173]};function nr(i,e,t,n,r,o,s,a,u,c,m,l,d,p,y,f){let b=W([g("amountIn"),g("amounOutMin")]),w=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],T=Buffer.alloc(b.span);return b.encode({amountIn:y,amounOutMin:f},T),new Ts({keys:w,programId:i,data:Buffer.from([...xs.swapBaseInput,...T])})}import{PublicKey as Bb}from"@solana/web3.js";var Sb=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Cb=Buffer.from("amm_config","utf8"),Kb=Buffer.from("pool","utf8"),Nb=Buffer.from("pool_lp_mint","utf8"),Rb=Buffer.from("pool_vault","utf8"),Lb=Buffer.from("observation","utf8");import Bs from"bn.js";var Eb=new Bs(1e6);import Is from"bn.js";var Vb=new Is(0);function fy(i,e,t,n,r,o,s,a,u,c,m,l){let d=W([U("instruction"),g("amountIn"),g("amountOut")]),p=[{pubkey:Yn.programId,isSigner:!1,isWritable:!1},{pubkey:Qn,isSigner:!1,isWritable:!1},{pubkey:new N(t.programId),isSigner:!1,isWritable:!1},{pubkey:new N(t.id),isSigner:!1,isWritable:!0},{pubkey:new N(n.id),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let f=Ce(t);p.push({pubkey:f.config.id,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.A:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.B:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},...l.map(b=>({pubkey:b,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let f=Ce(t);p.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:new N("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0})}else{let f=Ce(t);p.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},...f.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:f.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:f.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0}])}let y=Buffer.alloc(d.span);return d.encode({instruction:4,amountIn:c,amountOut:m},y),new Zn({keys:p,programId:i,data:y})}function by(i,e,t,n,r,o,s,a,u,c){let m=W([U("instruction")]),l=[{pubkey:Yn.programId,isSigner:!1,isWritable:!1},{pubkey:Qn,isSigner:!1,isWritable:!1},{pubkey:new N(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new N(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new N(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let p=Ce(n);l.push({pubkey:p.config.id,isSigner:!1,isWritable:!1},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.mintA.address.equals(u)?p.vault.A:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.mintA.address.equals(u)?p.vault.B:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0},...c.map(y=>({pubkey:y,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let p=Ce(n);l.push({pubkey:p.authority,isSigner:!1,isWritable:!1},{pubkey:p.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:new N("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:p.openOrders,isSigner:!1,isWritable:!0},{pubkey:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.marketId,isSigner:!1,isWritable:!0},{pubkey:p.marketBids,isSigner:!1,isWritable:!0},{pubkey:p.marketAsks,isSigner:!1,isWritable:!0},{pubkey:p.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0})}else{let p=Ce(n);l.push({pubkey:p.authority,isSigner:!1,isWritable:!1},{pubkey:p.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:p.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:p.openOrders,isSigner:!1,isWritable:!0},{pubkey:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.marketId,isSigner:!1,isWritable:!0},{pubkey:p.marketBids,isSigner:!1,isWritable:!0},{pubkey:p.marketAsks,isSigner:!1,isWritable:!0},{pubkey:p.marketEventQueue,isSigner:!1,isWritable:!0},...p.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:p.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:p.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0}])}let d=Buffer.alloc(m.span);return m.encode({instruction:5},d),new Zn({keys:l,programId:i,data:d})}function Ks(i,e,t,n,r,o,s,a,u,c,m,l,d,p,y){var x;let f=[],b=[h({pubkey:Qn,isWritable:!1}),h({pubkey:Ss,isWritable:!1}),h({pubkey:Cs,isWritable:!1}),h({pubkey:Yn.programId,isWritable:!1}),h({pubkey:e,isSigner:!0})];b.push(h({pubkey:t})),b.push(h({pubkey:r}));let w=[u,c],T=[m,l],A=[o,s,a];for(let O=0;O<w.length;O++){let L=w[O],Z=A[O]===L.mintA.address;if(b.push(h({pubkey:new N(L.programId),isWritable:!1})),O===w.length-1?b.push(h({pubkey:r})):b.push(h({pubkey:n})),b.push(h({pubkey:new N(A[O])})),b.push(h({pubkey:new N(A[O+1])})),L.version===6){let P=T[O];b.push(h({pubkey:new N(P.config.id)})),b.push(h({pubkey:new N(P.id)})),b.push(h({pubkey:new N(Z?P.vault.A:P.vault.B)})),b.push(h({pubkey:new N(Z?P.vault.B:P.vault.A)})),b.push(h({pubkey:new N(L.observationId)})),b.push(h({pubkey:gn})),b.push(h({pubkey:Le(new N(L.programId),new N(L.id)).publicKey})),f.push(Ns(L.sqrtPriceX64.toString(),Z));for(let E of(x=y[O])!=null?x:[])b.push(h({pubkey:new N(E)}))}else if(L.version===5){let P=T[O];b.push(h({pubkey:new N(P.id)})),b.push(h({pubkey:new N(P.authority),isWritable:!1})),b.push(h({pubkey:new N(P.marketProgramId)})),b.push(h({pubkey:new N(P.marketAuthority)})),b.push(h({pubkey:xi,isWritable:!1})),b.push(h({pubkey:new N(P.openOrders)})),b.push(h({pubkey:new N(P.vault.A)})),b.push(h({pubkey:new N(P.vault.B)})),b.push(h({pubkey:new N(P.id)})),b.push(h({pubkey:new N(P.id)})),b.push(h({pubkey:new N(P.id)})),b.push(h({pubkey:new N(P.id)})),b.push(h({pubkey:new N(P.id)})),b.push(h({pubkey:new N(P.id)})),b.push(h({pubkey:new N(P.marketId)})),b.push(h({pubkey:new N(P.marketBids)})),b.push(h({pubkey:new N(P.marketAsks)})),b.push(h({pubkey:new N(P.marketEventQueue)})),b.push(h({pubkey:new N(P.marketBaseVault)})),b.push(h({pubkey:new N(P.marketQuoteVault)}))}else if(L.version===4){let P=T[O],E=L.status!==1;b.push(h({pubkey:new N(P.id)})),b.push(h({pubkey:new N(P.authority),isWritable:!1})),b.push(h({pubkey:new N(E?P.id:P.marketProgramId)})),b.push(h({pubkey:new N(E?P.id:P.marketAuthority)})),b.push(h({pubkey:new N(E?P.id:P.openOrders)})),b.push(h({pubkey:new N(P.vault.A)})),b.push(h({pubkey:new N(P.vault.B)})),b.push(h({pubkey:new N(E?P.id:P.marketId)})),b.push(h({pubkey:new N(E?P.id:P.marketBids)})),b.push(h({pubkey:new N(E?P.id:P.marketAsks)})),b.push(h({pubkey:new N(E?P.id:P.marketEventQueue)})),b.push(h({pubkey:new N(E?P.id:P.marketBaseVault)})),b.push(h({pubkey:new N(E?P.id:P.marketQuoteVault)}))}else if(L.version===7){let P=T[O];b.push(h({pubkey:new N(P.authority)})),b.push(h({pubkey:new N(P.config.id)})),b.push(h({pubkey:new N(P.id)})),b.push(h({pubkey:new N(Z?P.vault.A:P.vault.B)})),b.push(h({pubkey:new N(Z?P.vault.B:P.vault.A)})),b.push(h({pubkey:new N(L.observationId)}))}else throw Error("pool type error")}let I=W([U("insId"),g("amountIn"),g("amountOut"),Y(_(),f.length,"clmmPriceLimit")]),D=Buffer.alloc(I.span);return I.encode({insId:0,amountIn:d,amountOut:p,clmmPriceLimit:f},D),new Zn({keys:b,programId:i,data:D})}function Ns(i,e){if(i)if(e){let t=new gt(i).div(new gt(25));return t.gt(jt)?t:jt}else{let t=new gt(i).mul(new gt(25));return t.lt(Jt)?t:Jt}else return e?jt:Jt}function yy({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){var r,o,s,a,u,c,m;if(n.routeType==="amm")if(n.poolInfo[0].version===6){let l=n.poolKey[0],d=Ce(l),p=t.equals(d.mintA.address)?Ye.add(Ne):je.sub(Ne);return Et.makeSwapBaseInInstructions({poolInfo:l,poolKeys:l,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:d.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:d.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?o:new gt(0)),sqrtPriceLimitX64:p,remainingAccounts:(s=n.remainingAccounts[0])!=null?s:[]})}else if(n.poolInfo[0].version===7){let l=n.poolInfo[0],d=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[nr(l.programId,e.wallet,l.authority,l.configId,l.id,e.sourceToken,e.destinationToken,d?l.vaultA:l.vaultB,d?l.vaultB:l.vaultA,d?l.mintProgramA:l.mintProgramB,d?l.mintProgramB:l.mintProgramA,new N(l[d?"mintA":"mintB"].address),new N(l[d?"mintB":"mintA"].address),l.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[d?re.CpmmSwapBaseIn:re.CpmmSwapBaseOut],address:{}}}else{let l=n.poolKey[0];return{signers:[],instructions:[tr({poolKeys:l,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((u=(a=n.minAmountOut.fee)==null?void 0:a.raw)!=null?u:new gt(0)),fixedSide:"in"})],lookupTableAddress:l.lookupTableAccount?[l.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?re.AmmV5SwapBaseIn:re.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let l=n.poolInfo[0],d=n.poolInfo[1],p=n.poolKey[0],y=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[Ks(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),l,d,p,y,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((m=(c=n.minAmountOut.fee)==null?void 0:c.raw)!=null?m:new gt(0)),n.remainingAccounts)],instructionTypes:[re.RouteSwap],lookupTableAddress:[p.lookupTableAccount,y.lookupTableAccount].filter(f=>f!==void 0),address:{}}}else throw Error("route type error")}export{yy as makeSwapInstruction,fy as route1Instruction,by as route2Instruction,Ks as routeInstruction};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=instrument.mjs.map
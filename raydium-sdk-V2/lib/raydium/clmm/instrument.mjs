var Oi=Object.defineProperty,Di=Object.defineProperties;var vi=Object.getOwnPropertyDescriptors;var Fn=Object.getOwnPropertySymbols;var Wi=Object.prototype.hasOwnProperty,qi=Object.prototype.propertyIsEnumerable;var _n=(i,e,t)=>e in i?Oi(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Z=(i,e)=>{for(var t in e||(e={}))Wi.call(e,t)&&_n(i,t,e[t]);if(Fn)for(var t of Fn(e))qi.call(e,t)&&_n(i,t,e[t]);return i},ee=(i,e)=>Di(i,vi(e));import{TOKEN_PROGRAM_ID as ge,TOKEN_2022_PROGRAM_ID as nt,ASSOCIATED_TOKEN_PROGRAM_ID as Ei}from"@solana/spl-token";import{PublicKey as T,TransactionInstruction as _e,SystemProgram as bt,Keypair as En}from"@solana/web3.js";import Mi from"bn.js";import{get as On,set as Vi}from"lodash";var Qt=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Dn={},Gi={};function me(i){let e=On(Dn,i);if(!e){let t=On(Gi,i);e=new Qt({name:i,logLevel:t}),Vi(Dn,i,e)}return e}import{PublicKey as Fa}from"@solana/web3.js";import Oa from"bn.js";import Yr from"big.js";import Vt from"bn.js";import Pe from"bn.js";var lt=9e15,Je=1e9,Jt="0123456789abcdef",Lt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Rt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",$t={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-lt,maxE:lt,crypto:!1},Vn,Ge,C=!0,Mt="[DecimalError] ",Qe=Mt+"Invalid argument: ",Gn=Mt+"Precision limit exceeded",Un=Mt+"crypto unavailable",Xn="[object Decimal]",be=Math.floor,se=Math.pow,Ui=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Xi=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,zi=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,zn=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ke=1e7,I=7,Hi=9007199254740991,ji=Lt.length-1,en=Rt.length-1,h={toStringTag:Xn};h.absoluteValue=h.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),B(i)};h.ceil=function(){return B(new this.constructor(this),this.e+1,2)};h.clampedTo=h.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(Qe+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};h.comparedTo=h.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};h.cosine=h.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+I,n.rounding=1,t=Zi(n,Qn(n,t)),n.precision=i,n.rounding=e,B(Ge==2||Ge==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};h.cubeRoot=h.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(C=!1,o=l.s*se(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=de(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=se(t,1/3),i=be((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=z(c.plus(l).times(a),c.plus(u),s+2,1),de(a.d).slice(0,s)===(t=de(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(B(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(B(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return C=!0,B(n,i,m.rounding,e)};h.decimalPlaces=h.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-be(this.e/I))*I,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};h.dividedBy=h.div=function(i){return z(this,new this.constructor(i))};h.dividedToIntegerBy=h.divToInt=function(i){var e=this,t=e.constructor;return B(z(e,new t(i),0,1,1),t.precision,t.rounding)};h.equals=h.eq=function(i){return this.cmp(i)===0};h.floor=function(){return B(new this.constructor(this),this.e+1,3)};h.greaterThan=h.gt=function(i){return this.cmp(i)>0};h.greaterThanOrEqualTo=h.gte=function(i){var e=this.cmp(i);return e==1||e===0};h.hyperbolicCosine=h.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/_t(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=mt(s,1,o.times(e),new s(1),!0);for(var u,c=i,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return B(o,s.precision=t,s.rounding=n,!0)};h.hyperbolicSine=h.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=mt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/_t(5,i)),r=mt(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,B(r,e,t,!0)};h.hyperbolicTangent=h.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,z(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};h.inverseCosine=h.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Ce(t,r,o):new t(0):new t(NaN):e.isZero()?Ce(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Ce(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};h.inverseHyperbolicCosine=h.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,C=!1,t=t.times(t).minus(1).sqrt().plus(t),C=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};h.inverseHyperbolicSine=h.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,C=!1,t=t.times(t).plus(1).sqrt().plus(t),C=!0,n.precision=i,n.rounding=e,t.ln())};h.inverseHyperbolicTangent=h.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?B(new o(r),i,e,!0):(o.precision=t=n-r.e,r=z(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};h.inverseSine=h.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Ce(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};h.inverseTangent=h.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=en)return s=Ce(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=en)return s=Ce(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/I+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(C=!1,e=Math.ceil(a/I),n=1,u=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),C=!0,B(s,l.precision=m,l.rounding=d,!0)};h.isFinite=function(){return!!this.d};h.isInteger=h.isInt=function(){return!!this.d&&be(this.e/I)>this.d.length-2};h.isNaN=function(){return!this.s};h.isNegative=h.isNeg=function(){return this.s<0};h.isPositive=h.isPos=function(){return this.s>0};h.isZero=function(){return!!this.d&&this.d[0]===0};h.lessThan=h.lt=function(i){return this.cmp(i)<0};h.lessThanOrEqualTo=h.lte=function(i){return this.cmp(i)<1};h.logarithm=h.log=function(i){var e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,f=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(C=!1,a=m+f,s=Ye(c,a),n=e?Et(l,a+10):Ye(i,a),u=z(s,n,a,1),yt(u.d,r=m,d))do if(a+=10,s=Ye(c,a),n=e?Et(l,a+10):Ye(i,a),u=z(s,n,a,1),!o){+de(u.d).slice(r+1,r+15)+1==1e14&&(u=B(u,m+1,0));break}while(yt(u.d,r+=10,d));return C=!0,B(u,m,d)};h.minus=h.sub=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,f=this,g=f.constructor;if(i=new g(i),!f.d||!i.d)return!f.s||!i.s?i=new g(NaN):f.d?i.s=-i.s:i=new g(i.d||f.s!==i.s?f:NaN),i;if(f.s!=i.s)return i.s=-i.s,f.plus(i);if(c=f.d,d=i.d,a=g.precision,u=g.rounding,!c[0]||!d[0]){if(d[0])i.s=-i.s;else if(c[0])i=new g(f);else return new g(u===3?-0:0);return C?B(i,a,u):i}if(t=be(i.e/I),l=be(f.e/I),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/I),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,i.s=-i.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(r=n;r&&c[--r]===0;)c[r]=Ke-1;--c[r],c[n]+=Ke}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=Ft(c,t),C?B(i,a,u):i):new g(u===3?-0:0)};h.modulo=h.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?B(new n(t),n.precision,n.rounding):(C=!1,n.modulo==9?(e=z(t,i.abs(),0,3,1),e.s*=i.s):e=z(t,i,0,n.modulo,1),e=e.times(i),C=!0,t.minus(e))};h.naturalExponential=h.exp=function(){return tn(this)};h.naturalLogarithm=h.ln=function(){return Ye(this)};h.negated=h.neg=function(){var i=new this.constructor(this);return i.s=-i.s,B(i)};h.plus=h.add=function(i){var e,t,n,r,o,s,a,u,c,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(c=m.d,l=i.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(i=new d(m)),C?B(i,a,u):i;if(o=be(m.e/I),n=be(i.e/I),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/I),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/Ke|0,c[r]%=Ke;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=Ft(c,n),C?B(i,a,u):i};h.precision=h.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(Qe+i);return t.d?(e=Hn(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};h.round=function(){var i=this,e=i.constructor;return B(new e(i),i.e+1,e.rounding)};h.sine=h.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+I,n.rounding=1,t=Qi(n,Qn(n,t)),n.precision=i,n.rounding=e,B(Ge>2?t.neg():t,i,e,!0)):new n(NaN)};h.squareRoot=h.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(C=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=de(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=be((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(z(s,o,t+2,1)).times(.5),de(o.d).slice(0,t)===(e=de(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(B(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(B(n,u+1,1),i=!n.times(n).eq(s));break}return C=!0,B(n,u,l.rounding,i)};h.tangent=h.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=z(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,B(Ge==2||Ge==4?t.neg():t,i,e,!0)):new n(NaN)};h.times=h.mul=function(i){var e,t,n,r,o,s,a,u,c,l=this,m=l.constructor,d=l.d,f=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!f||!f[0])return new m(!i.s||d&&!d[0]&&!f||f&&!f[0]&&!d?NaN:!d||!f?i.s/0:i.s*0);for(t=be(l.e/I)+be(i.e/I),u=d.length,c=f.length,u<c&&(o=d,d=f,f=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+f[n]*d[r-n-1]+e,o[r--]=a%Ke|0,e=a/Ke|0;o[r]=(o[r]+e)%Ke|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=Ft(o,t),C?B(i,m.precision,m.rounding):i};h.toBinary=function(i,e){return rn(this,2,i,e)};h.toDecimalPlaces=h.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(xe(i,0,Je),e===void 0?e=n.rounding:xe(e,0,8),B(t,i+t.e+1,e))};h.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=De(n,!0):(xe(i,0,Je),e===void 0?e=r.rounding:xe(e,0,8),n=B(new r(n),i+1,e),t=De(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};h.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=De(r):(xe(i,0,Je),e===void 0?e=o.rounding:xe(e,0,8),n=B(new o(r),i+r.e+1,e),t=De(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};h.toFraction=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,f=this,g=f.d,p=f.constructor;if(!g)return new p(f);if(c=t=new p(1),n=u=new p(0),e=new p(n),o=e.e=Hn(g)-f.e-1,s=o%I,e.d[0]=se(10,s<0?I+s:s),i==null)i=o>0?e:c;else{if(a=new p(i),!a.isInt()||a.lt(c))throw Error(Qe+a);i=a.gt(e)?o>0?e:c:a}for(C=!1,a=new p(de(g)),l=p.precision,p.precision=o=g.length*I*2;m=z(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(m.times(r)),u=r,r=e,e=a.minus(m.times(r)),a=r;return r=z(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=f.s,d=z(c,n,o,1).minus(f).abs().cmp(z(u,t,o,1).minus(f).abs())<1?[c,n]:[u,t],p.precision=l,C=!0,d};h.toHexadecimal=h.toHex=function(i,e){return rn(this,16,i,e)};h.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:xe(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(C=!1,t=z(t,i,0,e,1).times(i),C=!0,B(t)):(i.s=t.s,t=i),t};h.toNumber=function(){return+this};h.toOctal=function(i,e){return rn(this,8,i,e)};h.toPower=h.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(se(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return B(a,n,o);if(e=be(i.e/I),e>=i.d.length-1&&(t=c<0?-c:c)<=Hi)return r=jn(u,a,t,n),i.s<0?new u(1).div(r):B(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=se(+a,c),e=t==0||!isFinite(t)?be(c*(Math.log("0."+de(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(C=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=tn(i.times(Ye(a,n+t)),n),r.d&&(r=B(r,n+5,1),yt(r.d,n,o)&&(e=n+10,r=B(tn(i.times(Ye(a,e+t)),e),e+5,1),+de(r.d).slice(n+1,n+15)+1==1e14&&(r=B(r,n+1,0)))),r.s=s,C=!0,u.rounding=o,B(r,n,o))};h.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=De(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(xe(i,1,Je),e===void 0?e=r.rounding:xe(e,0,8),n=B(new r(n),i,e),t=De(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};h.toSignificantDigits=h.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(xe(i,1,Je),e===void 0?e=n.rounding:xe(e,0,8)),B(new n(t),i,e)};h.toString=function(){var i=this,e=i.constructor,t=De(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};h.truncated=h.trunc=function(){return B(new this.constructor(this),this.e+1,1)};h.valueOf=h.toJSON=function(){var i=this,e=i.constructor,t=De(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function de(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=I-n.length,t&&(o+=Ze(t)),o+=n;s=i[e],n=s+"",t=I-n.length,t&&(o+=Ze(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function xe(i,e,t){if(i!==~~i||i<e||i>t)throw Error(Qe+i)}function yt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=I,r=0):(r=Math.ceil((e+1)/I),e%=I),o=se(10,I-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==se(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==se(10,e-3)-1,s}function Kt(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=Jt.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function Zi(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/_t(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=mt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var z=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,l,m,d,f,g,p,y,b,k,w,x,R,A,O,E,j,Y,D,ce,oe=n.constructor,Te=n.s==r.s?1:-1,$=n.d,U=r.d;if(!$||!$[0]||!U||!U[0])return new oe(!n.s||!r.s||($?U&&$[0]==U[0]:!U)?NaN:$&&$[0]==0||!U?Te*0:Te/0);for(u?(f=1,l=n.e-r.e):(u=Ke,f=I,l=be(n.e/f)-be(r.e/f)),D=U.length,j=$.length,b=new oe(Te),k=b.d=[],m=0;U[m]==($[m]||0);m++);if(U[m]>($[m]||0)&&l--,o==null?(A=o=oe.precision,s=oe.rounding):a?A=o+(n.e-r.e)+1:A=o,A<0)k.push(1),g=!0;else{if(A=A/f+2|0,m=0,D==1){for(d=0,U=U[0],A++;(m<j||d)&&A--;m++)O=d*u+($[m]||0),k[m]=O/U|0,d=O%U|0;g=d||m<j}else{for(d=u/(U[0]+1)|0,d>1&&(U=i(U,d,u),$=i($,d,u),D=U.length,j=$.length),E=D,w=$.slice(0,D),x=w.length;x<D;)w[x++]=0;ce=U.slice(),ce.unshift(0),Y=U[0],U[1]>=u/2&&++Y;do d=0,c=e(U,w,D,x),c<0?(R=w[0],D!=x&&(R=R*u+(w[1]||0)),d=R/Y|0,d>1?(d>=u&&(d=u-1),p=i(U,d,u),y=p.length,x=w.length,c=e(p,w,y,x),c==1&&(d--,t(p,D<y?ce:U,y,u))):(d==0&&(c=d=1),p=U.slice()),y=p.length,y<x&&p.unshift(0),t(w,p,x,u),c==-1&&(x=w.length,c=e(U,w,D,x),c<1&&(d++,t(w,D<x?ce:U,x,u))),x=w.length):c===0&&(d++,w=[0]),k[m++]=d,c&&w[0]?w[x++]=$[E]||0:(w=[$[E]],x=1);while((E++<j||w[0]!==void 0)&&A--);g=w[0]!==void 0}k[0]||k.shift()}if(f==1)b.e=l,Vn=g;else{for(m=1,d=k[0];d>=10;d/=10)m++;b.e=m+l*f-1,B(b,a?o+b.e+1:o,s,g)}return b}}();function B(i,e,t,n){var r,o,s,a,u,c,l,m,d,f=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=I,s=e,l=m[d=0],u=l/se(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/I),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,r=1,o%=I,s=o-I+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=I,s=o-I+r,u=s<0?0:l/se(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%se(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/se(10,r-s):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=i.e+1,m[0]=se(10,(I-e%I)%I),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=se(10,I-o),m[d]=s>0?(l/se(10,r-s)%se(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==Ke&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Ke)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return C&&(i.e>f.maxE?(i.d=null,i.e=NaN):i.e<f.minE&&(i.e=0,i.d=[0])),i}function De(i,e,t){if(!i.isFinite())return Yn(i);var n,r=i.e,o=de(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Ze(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+Ze(-r-1)+o,t&&(n=t-s)>0&&(o+=Ze(n))):r>=s?(o+=Ze(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+Ze(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=Ze(n))),o}function Ft(i,e){var t=i[0];for(e*=I;t>=10;t/=10)e++;return e}function Et(i,e,t){if(e>ji)throw C=!0,t&&(i.precision=t),Error(Gn);return B(new i(Lt),e,1,!0)}function Ce(i,e,t){if(e>en)throw Error(Gn);return B(new i(Rt),e,t,!0)}function Hn(i){var e=i.length-1,t=e*I+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function Ze(i){for(var e="";i--;)e+="0";return e}function jn(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/I+4);for(C=!1;;){if(t%2&&(o=o.times(e),Wn(o.d,s)&&(r=!0)),t=be(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Wn(e.d,s)}return C=!0,o}function vn(i){return i.d[i.d.length-1]&1}function Zn(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function tn(i,e){var t,n,r,o,s,a,u,c=0,l=0,m=0,d=i.constructor,f=d.rounding,g=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(C=!1,u=g):u=e,a=new d(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(se(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=B(o.times(i),u,1),t=t.times(++l),a=s.plus(z(o,t,u,1)),de(a.d).slice(0,u)===de(s.d).slice(0,u)){for(r=m;r--;)s=B(s.times(s),u,1);if(e==null)if(c<3&&yt(s.d,u-n,f,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return B(s,d.precision=g,f,C=!0);else return d.precision=g,s}s=a}}function Ye(i,e){var t,n,r,o,s,a,u,c,l,m,d,f=1,g=10,p=i,y=p.d,b=p.constructor,k=b.rounding,w=b.precision;if(p.s<0||!y||!y[0]||!p.e&&y[0]==1&&y.length==1)return new b(y&&!y[0]?-1/0:p.s!=1?NaN:y?0:p);if(e==null?(C=!1,l=w):l=e,b.precision=l+=g,t=de(y),n=t.charAt(0),Math.abs(o=p.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)p=p.times(i),t=de(p.d),n=t.charAt(0),f++;o=p.e,n>1?(p=new b("0."+t),o++):p=new b(n+"."+t.slice(1))}else return c=Et(b,l+2,w).times(o+""),p=Ye(new b(n+"."+t.slice(1)),l-g).plus(c),b.precision=w,e==null?B(p,w,k,C=!0):p;for(m=p,u=s=p=z(p.minus(1),p.plus(1),l,1),d=B(p.times(p),l,1),r=3;;){if(s=B(s.times(d),l,1),c=u.plus(z(s,new b(r),l,1)),de(c.d).slice(0,l)===de(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Et(b,l+2,w).times(o+""))),u=z(u,new b(f),l,1),e==null)if(yt(u.d,l-g,k,a))b.precision=l+=g,c=s=p=z(m.minus(1),m.plus(1),l,1),d=B(p.times(p),l,1),r=a=1;else return B(u,b.precision=w,k,C=!0);else return b.precision=w,u;u=c,r+=2}}function Yn(i){return String(i.s*i.s/0)}function nn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%I,t<0&&(n+=I),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=I;n<r;)i.d.push(+e.slice(n,n+=I));e=e.slice(n),n=I-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),C&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function Yi(i,e){var t,n,r,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),zn.test(e))return nn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(Xi.test(e))t=16,e=e.toLowerCase();else if(Ui.test(e))t=2;else if(zi.test(e))t=8;else throw Error(Qe+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=jn(n,new n(t),o,o*2)),c=Kt(e,t,Ke),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=Ft(c,l),i.d=c,C=!1,s&&(i=z(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?se(2,u):ht.pow(2,u))),C=!0,i)}function Qi(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:mt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/_t(5,t)),e=mt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function mt(i,e,t,n,r){var o,s,a,u,c=1,l=i.precision,m=Math.ceil(l/I);for(C=!1,u=t.times(t),a=new i(n);;){if(s=z(a.times(u),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=z(s.times(u),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return C=!0,s.d.length=m+1,s}function _t(i,e){for(var t=i;--e;)t*=i;return t}function Qn(i,e){var t,n=e.s<0,r=Ce(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Ge=n?4:1,e;if(t=e.divToInt(r),t.isZero())Ge=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Ge=vn(t)?n?2:3:n?4:1,e;Ge=vn(t)?n?1:4:n?3:2}return e.minus(r).abs()}function rn(i,e,t,n){var r,o,s,a,u,c,l,m,d,f=i.constructor,g=t!==void 0;if(g?(xe(t,1,Je),n===void 0?n=f.rounding:xe(n,0,8)):(t=f.precision,n=f.rounding),!i.isFinite())l=Yn(i);else{for(l=De(i),s=l.indexOf("."),g?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new f(1),d.e=l.length-s,d.d=Kt(De(d),10,r),d.e=d.d.length),m=Kt(l,10,r),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=g?"0p+0":"0";else{if(s<0?o--:(i=new f(i),i.d=m,i.e=o,i=z(i,d,t,n,0,r),m=i.d,o=i.e,c=Vn),s=m[t],a=r/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,c)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=Jt.charAt(m[s]);if(g){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=Kt(l,r,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=Jt.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function Wn(i,e){if(i.length>e)return i.length=e,!0}function Ji(i){return new this(i).abs()}function $i(i){return new this(i).acos()}function er(i){return new this(i).acosh()}function tr(i,e){return new this(i).plus(e)}function nr(i){return new this(i).asin()}function ir(i){return new this(i).asinh()}function rr(i){return new this(i).atan()}function or(i){return new this(i).atanh()}function sr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Ce(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Ce(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Ce(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(z(i,e,o,1)),e=Ce(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(z(i,e,o,1)),t}function ar(i){return new this(i).cbrt()}function ur(i){return B(i=new this(i),i.e+1,2)}function cr(i,e,t){return new this(i).clamp(e,t)}function lr(i){if(!i||typeof i!="object")throw Error(Mt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,Je,"rounding",0,8,"toExpNeg",-lt,0,"toExpPos",0,lt,"maxE",0,lt,"minE",-lt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=$t[t]),(n=i[t])!==void 0)if(be(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(Qe+t+": "+n);if(t="crypto",r&&(this[t]=$t[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Un);else this[t]=!1;else throw Error(Qe+t+": "+n);return this}function mr(i){return new this(i).cos()}function dr(i){return new this(i).cosh()}function Jn(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,qn(o)){c.s=o.s,C?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;C?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return nn(c,o.toString())}else if(u!=="string")throw Error(Qe+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),zn.test(o)?nn(c,o):Yi(c,o)}if(r.prototype=h,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=lr,r.clone=Jn,r.isDecimal=qn,r.abs=Ji,r.acos=$i,r.acosh=er,r.add=tr,r.asin=nr,r.asinh=ir,r.atan=rr,r.atanh=or,r.atan2=sr,r.cbrt=ar,r.ceil=ur,r.clamp=cr,r.cos=mr,r.cosh=dr,r.div=fr,r.exp=pr,r.floor=gr,r.hypot=br,r.ln=yr,r.log=hr,r.log10=Ar,r.log2=wr,r.max=kr,r.min=Tr,r.mod=xr,r.mul=Pr,r.pow=Br,r.random=Ir,r.round=Sr,r.sign=Nr,r.sin=Cr,r.sinh=Kr,r.sqrt=Lr,r.sub=Rr,r.sum=Er,r.tan=Mr,r.tanh=Fr,r.trunc=_r,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function fr(i,e){return new this(i).div(e)}function pr(i){return new this(i).exp()}function gr(i){return B(i=new this(i),i.e+1,3)}function br(){var i,e,t=new this(0);for(C=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return C=!0,new this(1/0);t=e}return C=!0,t.sqrt()}function qn(i){return i instanceof ht||i&&i.toStringTag===Xn||!1}function yr(i){return new this(i).ln()}function hr(i,e){return new this(i).log(e)}function wr(i){return new this(i).log(2)}function Ar(i){return new this(i).log(10)}function kr(){return Zn(this,arguments,"lt")}function Tr(){return Zn(this,arguments,"gt")}function xr(i,e){return new this(i).mod(e)}function Pr(i,e){return new this(i).mul(e)}function Br(i,e){return new this(i).pow(e)}function Ir(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:xe(i,1,Je),n=Math.ceil(i/I),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(Un);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=I,n&&i&&(r=se(10,I-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=I)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<I&&(t-=I-n)}return s.e=t,s.d=a,s}function Sr(i){return B(i=new this(i),i.e+1,this.rounding)}function Nr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function Cr(i){return new this(i).sin()}function Kr(i){return new this(i).sinh()}function Lr(i){return new this(i).sqrt()}function Rr(i,e){return new this(i).sub(e)}function Er(){var i=0,e=arguments,t=new this(e[i]);for(C=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return C=!0,B(t,this.precision,this.rounding)}function Mr(i){return new this(i).tan()}function Fr(i){return new this(i).tanh()}function _r(i){return B(i=new this(i),i.e+1,1)}h[Symbol.for("nodejs.util.inspect.custom")]=h.toString;h[Symbol.toStringTag]="Decimal";var ht=h.constructor=Jn($t);Lt=new ht(Lt);Rt=new ht(Rt);var S=ht;import{PublicKey as un}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Or}from"@solana/spl-token";import{PublicKey as Q,SystemProgram as $n,SYSVAR_RENT_PUBKEY as Dr}from"@solana/web3.js";function on({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var Zo=[on({pubkey:Or,isWritable:!1}),on({pubkey:$n.programId,isWritable:!1}),on({pubkey:Dr,isWritable:!1})];function an({publicKey:i,transformSol:e}){let t=ei(i.toString());if(t instanceof Q)return e&&t.equals(wt)?sn:t;if(e&&t.toString()===wt.toBase58())return sn;if(typeof t=="string"){if(t===Q.default.toBase58())return Q.default;try{return new Q(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ei(i){try{return new Q(i)}catch{return i}}var Ot=new Q("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Yo=new Q("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),At=new Q("SysvarRent111111111111111111111111111111111"),Qo=new Q("SysvarC1ock11111111111111111111111111111111"),dt=new Q("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Jo=new Q("Sysvar1nstructions1111111111111111111111111"),$o=$n.programId,es=new Q("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ts=new Q("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ns=new Q("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),is=new Q("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),rs=new Q("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),os=new Q("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ss=new Q("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),as=new Q("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),us=new Q("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),cs=new Q("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ls=new Q("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),sn=new Q("So11111111111111111111111111111111111111112"),wt=Q.default;function Dt(i){return an({publicKey:i,transformSol:!0})}import{PublicKey as vr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ti}from"@solana/spl-token";var ni={chainId:101,address:vr.default.toBase58(),programId:ti.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},it={chainId:101,address:"So11111111111111111111111111111111111111112",programId:ti.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var cn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===wt.toBase58()||e instanceof un&&wt.equals(e)){this.decimals=it.decimals,this.symbol=it.symbol,this.name=it.name,this.mint=new un(it.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?un.default:an({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ue=cn;Ue.WSOL=new cn(ee(Z({},it),{mint:it.address}));import Wt from"big.js";import Vr from"bn.js";import Gr from"decimal.js-light";import Wr from"toformat";var qr=Wr,kt=qr;var vt=me("module/fraction"),ln=kt(Wt),Tt=kt(Gr),Ur={[0]:Tt.ROUND_DOWN,[1]:Tt.ROUND_HALF_UP,[2]:Tt.ROUND_UP},Xr={[0]:Wt.roundDown,[1]:Wt.roundHalfUp,[2]:Wt.roundUp},G=class{constructor(e,t=new Vr(1)){this.numerator=fe(e),this.denominator=fe(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new G(this.denominator,this.numerator)}add(e){let t=e instanceof G?e:new G(fe(e));return this.denominator.eq(t.denominator)?new G(this.numerator.add(t.numerator),this.denominator):new G(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof G?e:new G(fe(e));return this.denominator.eq(t.denominator)?new G(this.numerator.sub(t.numerator),this.denominator):new G(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof G?e:new G(fe(e));return new G(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof G?e:new G(fe(e));return new G(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||vt.logWithError(`${e} is not an integer.`),e<=0&&vt.logWithError(`${e} is not positive.`),Tt.set({precision:e+1,rounding:Ur[n]});let r=new Tt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||vt.logWithError(`${e} is not an integer.`),e<0&&vt.logWithError(`${e} is negative.`),ln.DP=e,ln.RM=Xr[n]||1,new ln(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Hr=me("Raydium_price"),Le=class extends G{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new G(mn(n.decimals),mn(r.decimals))}get raw(){return new G(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Le({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Hr.logWithError("mul token not equals");let n=super.mul(t);return new Le({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var dn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},qt=dn;qt.SOL=new dn(ni);import jr from"bn.js";var ii=new G(new jr(100)),rt=class extends G{toSignificant(e=5,t,n){return this.mul(ii).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(ii).toFixed(e,t,n)}};var Zr=new Pe(0),sa=new Pe(1),aa=new Pe(2),ua=new Pe(3),ca=new Pe(5),fn=new Pe(10),la=new Pe(100),ma=new Pe(1e3),da=new Pe(1e4),ri=9007199254740991;function fe(i){let e=me("Raydium_parseBigNumberish");if(i instanceof Pe)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Pe(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=ri||i<=-ri)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Pe(String(i))):typeof i=="bigint"?new Pe(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Pe(0))}function mn(i){return fn.pow(fe(i))}var Qr=me("Raydium_amount"),oi=kt(Yr);function Jr(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):Qr.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var ye=class extends G{constructor(t,n,r=!0,o){let s=new Vt(0),a=fn.pow(new Vt(t.decimals));if(r)s=fe(n);else{let u=new Vt(0),c=new Vt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Jr(n.toString(),t.decimals);u=fe(l),c=fe(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=me(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new ye(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new ye(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return oi.DP=this.token.decimals,new oi(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Lu,sendAndConfirmTransaction as Ru,Transaction as Mu,TransactionMessage as _u,VersionedTransaction as Ou}from"@solana/web3.js";import Wu from"axios";var he={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{PublicKey as $r,ComputeBudgetProgram as Ua,Transaction as za,TransactionMessage as ja,Keypair as Za,VersionedTransaction as Qa}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as eu}from"@solana/spl-token";var iu=me("Raydium_txUtil");function Ie(i,e){let[t,n]=$r.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}import{PublicKey as to,AddressLookupTableAccount as si}from"@solana/web3.js";import{PublicKey as eo}from"@solana/web3.js";import{MINT_SIZE as lu,TOKEN_PROGRAM_ID as mu,getTransferFeeConfig as du,unpackMint as fu}from"@solana/spl-token";var pn=me("Raydium_accountInfo_util");async function $e(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=Z({batchRequest:!1},t),s=gn(e,o),a=new Array(s.length).fill([]);if(n){let u=s.map(m=>{let d=i._buildArgs([m.map(f=>f.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=gn(u,10);a=(await(await Promise.all(c.map(async m=>await i._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&pn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:f,executable:g,lamports:p,owner:y,rentEpoch:b}=d;return f.length!==2&&f[1]!=="base64"&&pn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(f[0],"base64"),executable:g,lamports:p,owner:new eo(y),rentEpoch:b}}return null})))}else try{a=await Promise.all(s.map(u=>i.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&pn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function bn(i,e,t){let n=await $e(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>ee(Z({},r),{accountInfo:n[o]}))}var no={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new si({key:new to("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:si.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};function gn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as q}from"@solana/web3.js";var Yu=new q("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Qu=new q("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ju=new q("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),$u=new q("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ec=new q("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),tc=new q("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),nc=new q("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ic=new q("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),rc=new q("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),oc=new q("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),sc=new q("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),ac=new q("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),uc=new q("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),cc=new q("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),lc=new q("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),mc=new q("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),dc=new q("8yQvrjQuritLntxz6pAaWcEX6CsRMeDmr7baCLnNwEuw"),fc=new q("E1oP2yNZXw3dFnUoPygWZPg9u2Gad87VFVPeYWqa6rD6"),pc=new q("E1oP2yNZXw3dFnUoPygWZPg9u2Gad87VFVPeYWqa6rD6"),io=new q("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),ro=new q("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),oo=new q("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");var gc={SERUM_MARKET:q.default,OPENBOOK_MARKET:new q("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:q.default,FarmV3:new q("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new q("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new q("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new q("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new q("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new q("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),Router:new q("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:io,CREATE_CPMM_POOL_AUTH:ro,CREATE_CPMM_POOL_FEE_ACC:oo,FEE_DESTINATION_ID:new q("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import{PublicKey as so}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ao}from"@solana/spl-token";function Xe(i,e,t){return Ie([i.toBuffer(),(t!=null?t:ao).toBuffer(),e.toBuffer()],new so("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import Re from"bn.js";var xt=1e4;function ae(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=ee(Z({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new Re(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===xt){let u=new Re(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=yn(i.mul(new Re(xt)),new Re(xt-o.transferFeeBasisPoints)),c=new Re(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,m=yn(l.mul(new Re(o.transferFeeBasisPoints)),new Re(xt)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=yn(i.mul(new Re(o.transferFeeBasisPoints)),new Re(xt)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function ot(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function yn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new Re(0))?t.add(new Re(1)):t}import{PublicKey as yo}from"@solana/web3.js";import li,{isBN as mi}from"bn.js";import{bits as qc,BitStructure as Vc,blob as uo,Blob as Gc,cstr as Uc,f32 as Xc,f32be as zc,f64 as Hc,f64be as jc,greedy as Zc,Layout as co,ns64 as Yc,ns64be as Qc,nu64 as Jc,nu64be as $c,offset as el,s16 as tl,s16be as nl,s24 as il,s24be as rl,s32 as lo,s32be as ol,s40 as sl,s40be as al,s48 as ul,s48be as cl,s8 as ll,seq as mo,struct as ml,Structure as fo,u16 as po,u16be as dl,u24 as fl,u24be as pl,u32 as gl,u32be as bl,u40 as yl,u40be as hl,u48 as wl,u48be as Al,u8 as go,UInt as bo,union as kl,Union as Tl,unionLayoutDiscriminator as xl,utf8 as Pl}from"@solana/buffer-layout";var hn=co,ai=fo;var wn=bo;var ui=go,ft=po;var pe=lo;var ci=mo;var Se=uo;var Pt=class extends hn{constructor(t,n,r){super(t,r);this.blob=Se(t),this.signed=n}decode(t,n=0){let r=new li(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new li(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function ne(i){return new wn(1,i)}function ze(i){return new wn(4,i)}function N(i){return new Pt(8,!1,i)}function v(i){return new Pt(16,!1,i)}function di(i){return new Pt(16,!0,i)}var Gt=class extends hn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function J(i){return new Gt(Se(32),e=>new yo(e),e=>e.toBuffer(),i)}function ve(i){return new Gt(ui(),ho,wo,i)}function ho(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function wo(i){return i?1:0}var An=class extends ai{decode(e,t){return super.decode(e,t)}};function H(i,e,t){return new An(i,e,t)}function te(i,e,t){let n,r=typeof e=="number"?e:mi(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=mi(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return ci(i,r,t)}import No from"bn.js";function Ut(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function kn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Tn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Bt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function fi(i,e){return Bt(i,e)?null:kn(i,e)}function pi(i,e){return Bt(i,e)?null:Tn(i,e)}var ql=Buffer.from("amm_config","utf8"),Ao=Buffer.from("pool","utf8"),ko=Buffer.from("pool_vault","utf8"),To=Buffer.from("pool_reward_vault","utf8"),gi=Buffer.from("position","utf8"),xo=Buffer.from("tick_array","utf8"),Po=Buffer.from("operation","utf8"),Bo=Buffer.from("pool_tick_array_bitmap_extension","utf8");function bi(i,e,t,n,r){return Ie([Ao,e.toBuffer(),t.toBuffer(),n.toBuffer(),r.toBuffer()],i)}function xn(i,e,t){return Ie([ko,e.toBuffer(),t.toBuffer()],i)}function yi(i,e,t){return Ie([To,e.toBuffer(),t.toBuffer()],i)}function X(i,e,t){return Ie([xo,e.toBuffer(),Ut(t)],i)}function st(i,e,t,n){return Ie([gi,e.toBuffer(),Ut(t),Ut(n)],i)}function We(i,e){return Ie([gi,e.toBuffer()],i)}function Xt(i){return Ie([Buffer.from("metadata","utf8"),dt.toBuffer(),i.toBuffer()],dt)}function Pn(i){return Ie([Po],i)}function Ee(i,e){return Ie([Bo,e.toBuffer()],i)}import Ne from"bn.js";var ie=new Ne(0),qe=new Ne(1),He=new Ne(-1),Be=new Ne(1).shln(64),zt=new Ne(1).shln(128),Bn=Be.sub(qe),It=64,hi=zt.subn(1),we=-443636,ke=-we,pt=new Ne("4295048016"),gt=new Ne("79226673521066979257578248091"),Ul=new Ne("4295048017"),Xl=new Ne("79226673521066979257578248090"),wi=16,Ai="59543866431248",ki="184467440737095516",Ti="15793534762490258745",Ht=new Ne(10).pow(new Ne(6));var zl=new Ne("18446744073700000000");var Io=15,W=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=P.getTickArrayStartIndexByTick(r,o),l=P.getInitializedTickArrayInRange(s,a,o,c,Math.floor(Io/2));for(let f=0;f<l.length;f++){let{publicKey:g}=X(t,n,l[f]);u.push(g)}let m=(await $e(e,u)).map(f=>f!==null?St.decode(f.data):null),d={};for(let f=0;f<u.length;f++){let g=m[f];g!==null&&(d[g.startTickIndex]=ee(Z({},g),{address:u[f]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=P.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:f}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,f]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/W.tickCount(t)),a=n?P.searchLowBitFromStart(r,o,s-1,1,t):P.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=ue-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<ue;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=X(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=P.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<ue;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=X(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(P.checkIsOutOfBoundary(e)){if(e>ke)return!1;let n=P.getTickArrayStartIndexByTick(we,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return ue*e}};import _ from"bn.js";import{PublicKey as Me}from"@solana/web3.js";import re from"bn.js";var In=14,je=class{static maxTickInTickarrayBitmap(e){return e*ue*at}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!W.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-W.tickCount(n):t+W.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*ue,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),m=fi(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=pi(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-W.tickCount(n)}}}},Nt=class{static getBitmapOffset(e,t){if(!W.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=je.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=je.maxTickInTickarrayBitmap(e),n=-t;if(ke<=t)throw Error(`extensionTickBoundary check error: ${ke}, ${t}`);if(n<=we)throw Error(`extensionTickBoundary check error: ${n}, ${we}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:P.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=W.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=je.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=P.mergeTickArrayBitmap(e).shln(at-1-a),c=Bt(512,u)?null:kn(512,u);if(c!==null){let l=t-c*W.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=P.mergeTickArrayBitmap(e).shrn(a),c=Bt(512,u)?null:Tn(512,u);if(c!==null){let l=t+c*W.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-W.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%je.maxTickInTickarrayBitmap(t),r=Math.floor(n/W.tickCount(t));return e<0&&n!=0&&(r=at-r),r}};import Ve from"bn.js";var Ct=class{static getfeeGrowthInside(e,t,n){let r=new Ve(0),o=new Ve(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Ve(0),a=new Ve(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=M.wrappingSubU128(M.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=M.wrappingSubU128(M.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=M.mulDivFloor(M.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Be),u=t.tokenFeesOwedA.add(a),c=M.mulDivFloor(M.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Be),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=M.mulDivFloor(M.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Be),u=t.tokenFeesOwedA.add(a),c=M.mulDivFloor(M.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Be),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=M.wrappingSubU128(u,c.growthInsideLastX64),m=M.mulDivFloor(l,t.liquidity,Be),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=M.wrappingSubU128(u,c.growthInsideLastX64),m=M.mulDivFloor(l,t.liquidity,Be),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ve(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Ve(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(M.wrappingSubU128(M.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ve(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Ve(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(M.wrappingSubU128(M.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var y,b,k,w;let a=F.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),u=F.getSqrtPriceX64FromTick(t.tickLower),c=F.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=V.getAmountsFromLiquidity(a,u,c,n,o),[d,f]=[ae(m.amountA,(y=e.mintA.extensions)==null?void 0:y.feeConfig,s,!0),ae(m.amountB,(b=e.mintB.extensions)==null?void 0:b.feeConfig,s,!0)],[g,p]=[ae(new Ve(new S(m.amountA.toString()).mul(l).toFixed(0)),(k=e.mintA.extensions)==null?void 0:k.feeConfig,s,!0),ae(new Ve(new S(m.amountB.toString()).mul(l).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:f,amountSlippageA:g,amountSlippageB:p,expirationTime:ot(d.expirationTime,f.expirationTime)}}};import{TOKEN_2022_PROGRAM_ID as xi}from"@solana/spl-token";var Ae=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!c||l===void 0||!m)throw new Error("Invalid tick array");u.push(m);let{allTrade:d,amountCalculated:f,accounts:g,sqrtPriceX64:p,feeAmount:y}=ut.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return u.push(...g),{allTrade:d,expectedAmountOut:f.mul(He),remainingAccounts:u,executionPrice:p,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let p=this.preInitializedTickArrayStartIndex(e,s);if(p.isExist){let{publicKey:y}=X(e.programId,e.id,p.nextStartIndex);a.push(y)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:f,feeAmount:g}=ut.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(He),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:f,feeAmount:g}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=Ae.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Nt.checkTickArrayIsInit(W.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):P.checkTickArrayIsInitialized(P.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=X(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,W.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=X(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/W.tickCount(e.tickSpacing)),r=t?P.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):P.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=W.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=je.nextInitializedTickArrayStartIndex(P.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Nt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<we||t>ke)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let f=ee(Z({},m),{perSecond:M.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Me(d)});if(f.tokenMint.equals(Me.default))continue;if(n<=f.openTime.toNumber()||r.eq(ie)){s.push(f);continue}let g=new re(Math.min(f.endTime.toNumber(),n)),p=g.sub(f.lastUpdateTime),y=M.mulDivFloor(p,f.emissionsPerSecondX64,r),b=f.rewardGrowthGlobalX64.add(y),k=M.mulDivFloor(p,f.emissionsPerSecondX64,Be),w=f.rewardTotalEmissioned.add(k);s.push(ee(Z({},f),{rewardGrowthGlobalX64:b,rewardTotalEmissioned:w,lastUpdateTime:g}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=P.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=je.maxTickInTickarrayBitmap(e),n=-t;return t>ke&&(t=W.getArrayStartIndex(ke,e)+W.tickCount(e)),n<we&&(n=W.getArrayStartIndex(we,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!W.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/W.tickCount(t)*at}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await bn(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=Ii.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=P.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=P.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=X(u.programId,u.id,m);o.push({pubkey:d}),r[d.toString()]=u.id}}let s=await bn(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=St.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=ee(Z({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let f of s)c.push(We(f,d).publicKey);let l=await $e(t,c,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let f=Bi.decode(d.data),g=f.poolId.toString(),p=e.find(E=>E.state.id.toBase58()===g);if(p===void 0)continue;let y=p.state,b=P._getTickPriceLegacy({poolInfo:y,tick:f.tickLower,baseIn:!0}),k=P._getTickPriceLegacy({poolInfo:y,tick:f.tickUpper,baseIn:!0}),{amountA:w,amountB:x}=V.getAmountsFromLiquidity(y.sqrtPriceX64,b.tickSqrtPriceX64,k.tickSqrtPriceX64,f.liquidity,!1),R=1/(1-Math.sqrt(Math.sqrt(b.price.div(k.price).toNumber())));p.positionAccount=[...(a=p.positionAccount)!=null?a:[],{poolId:f.poolId,nftMint:f.nftMint,priceLower:b.price,priceUpper:k.price,amountA:w,amountB:x,tickLower:f.tickLower,tickUpper:f.tickUpper,liquidity:f.liquidity,feeGrowthInsideLastX64A:f.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:f.feeGrowthInsideLastX64B,tokenFeesOwedA:f.tokenFeesOwedA,tokenFeesOwedB:f.tokenFeesOwedB,rewardInfos:f.rewardInfos.map(E=>ee(Z({},E),{pendingReward:new re(0)})),leverage:R,tokenFeeAmountA:new re(0),tokenFeeAmountB:new re(0)}];let A=await P.getTickArrayAddressByTick(p.state.programId,f.poolId,f.tickLower,p.state.tickSpacing),O=await P.getTickArrayAddressByTick(p.state.programId,f.poolId,f.tickUpper,p.state.tickSpacing);m[`${p.state.programId.toString()}-${f.poolId.toString()}-${f.tickLower}`]=A,m[`${p.state.programId.toString()}-${f.poolId.toString()}-${f.tickUpper}`]=O}if(o){let d=Object.values(m),f=await $e(t,d,{batchRequest:r}),g={};for(let p=0;p<d.length;p++){let y=f[p];if(y===null)continue;let b=d[p].toString();g[b]=St.decode(y.data)}for(let{state:p,positionAccount:y}of e)if(!!y)for(let b of y){let k=`${p.programId.toString()}-${p.id.toString()}-${b.tickLower}`,w=`${p.programId.toString()}-${p.id.toString()}-${b.tickUpper}`,x=g[m[k].toString()],R=g[m[w].toString()],A=x.ticks[P.getTickOffsetInArray(b.tickLower,p.tickSpacing)],O=R.ticks[P.getTickOffsetInArray(b.tickUpper,p.tickSpacing)],{tokenFeeAmountA:E,tokenFeeAmountB:j}=await Ct.GetPositionFees(p,b,A,O),Y=await Ct.GetPositionRewards(p,b,A,O);b.tokenFeeAmountA=E.gte(new re(0))?E:new re(0),b.tokenFeeAmountB=j.gte(new re(0))?j:new re(0);for(let D=0;D<Y.length;D++)b.rewardInfos[D].pendingReward=Y[D].gte(new re(0))?Y[D]:new re(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new S(0),catchLiquidityInsufficient:u=!1}){var ce;let c,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new S(0))?c=l?pt.add(new re(1)):gt.sub(new re(1)):c=F.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let f=ae(o,m,r,!1),{allTrade:g,expectedAmountOut:p,remainingAccounts:y,executionPrice:b,feeAmount:k}=Ae.getOutputAmountAndRemainAccounts(e,t,n,f.amount.sub((ce=f.fee)!=null?ce:ie),c,u),w=ae(p,d,r,!1),x=F.sqrtPriceX64ToPrice(b,e.mintA.decimals,e.mintB.decimals),R=l?x:new S(1).div(x),A=p.mul(new re(Math.floor((1-s)*1e10))).div(new re(1e10)),O=ae(A,d,r,!1),E=l?e.currentPrice:new S(1).div(e.currentPrice),j=new S(R).sub(E).abs(),Y=E,D=new rt(new S(j).mul(10**15).toFixed(0),new S(Y).mul(10**15).toFixed(0));return{allTrade:g,realAmountIn:f,amountOut:w,minAmountOut:O,expirationTime:ot(f.expirationTime,w.expirationTime),currentPrice:e.currentPrice,executionPrice:R,priceImpact:D,fee:k,remainingAccounts:y,executionPriceX64:b}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let u=r.address===e.mintB.address,[c,l]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new Ue(ee(Z({},c),{mint:c.address,isToken2022:c.programId===xi.toBase58()})),new Ue(ee(Z({},l),{mint:l.address,isToken2022:l.programId===xi.toBase58()}))],{allTrade:f,realAmountIn:g,amountOut:p,minAmountOut:y,expirationTime:b,currentPrice:k,executionPrice:w,priceImpact:x,fee:R,remainingAccounts:A,executionPriceX64:O}=Ae.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Me(c.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),E=ee(Z({},g),{amount:new ye(m,g.amount),fee:g.fee===void 0?void 0:new ye(m,g.fee)}),j=ee(Z({},p),{amount:new ye(d,p.amount),fee:p.fee===void 0?void 0:new ye(d,p.fee)}),Y=ee(Z({},y),{amount:new ye(d,y.amount),fee:y.fee===void 0?void 0:new ye(d,y.fee)}),D=new Le({baseToken:m,denominator:new re(10).pow(new re(20+m.decimals)),quoteToken:d,numerator:k.mul(new S(10**(20+d.decimals))).toFixed(0)}),ce=new Le({baseToken:m,denominator:new re(10).pow(new re(20+m.decimals)),quoteToken:d,numerator:w.mul(new S(10**(20+d.decimals))).toFixed(0)}),oe=new ye(m,R);return{allTrade:f,realAmountIn:E,amountOut:j,minAmountOut:Y,expirationTime:b,currentPrice:D,executionPrice:ce,priceImpact:x,fee:oe,remainingAccounts:A,executionPriceX64:O}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var g,p,y;let o=e[t],s=P.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=P.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,f;return l<=0?f=0:m===l?f=d/l:d===l?f=l/m:f=l/d*(l/m),{feeApr:o.feeApr*f,rewardsApr:[((g=o.rewardApr[0])!=null?g:0)*f,((p=o.rewardApr[1])!=null?p:0)*f,((y=o.rewardApr[2])!=null?y:0)*f],apr:o.apr*f}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[Dt(e.mintA.address).toString()],d=r[Dt(e.mintB.address).toString()],f=e.mintA.decimals,g=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let p=F.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),y=F.getSqrtPriceX64FromTick(s),b=F.getSqrtPriceX64FromTick(a),{amountSlippageA:k,amountSlippageB:w}=V.getAmountsFromLiquidityWithSlippage(p,y,b,t,!1,!1,0),{amountSlippageA:x,amountSlippageB:R}=V.getAmountsFromLiquidityWithSlippage(p,y,b,o,!1,!1,0),A=new S(k.toString()).div(new S(10).pow(f)).mul(m.value).add(new S(w.toString()).div(new S(10).pow(g)).mul(d.value)),O=new S(x.toString()).div(new S(10).pow(f)).mul(m.value).add(new S(R.toString()).div(new S(10).pow(g)).mul(d.value)),E=new S(1).div(A.add(O)),Y=new S(l.volumeFee).mul(365).div(c).mul(E).mul(100).toNumber(),D=3600*24*365,ce=e.rewardDefaultInfos.map(oe=>{var U,Mn;let Te=oe.mint.decimals,$=r[oe.mint.address];return u<((U=oe.startTime)!=null?U:0)||u>((Mn=oe.endTime)!=null?Mn:0)||!oe.perSecond||!$||Te===void 0?0:new S($.value).mul(new S(oe.perSecond).mul(D)).div(new S(10).pow(Te)).mul(E).mul(100).toNumber()});return{feeApr:Y,rewardsApr:ce,apr:Y+ce.reduce((oe,Te)=>oe+Te,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var b,k;let l=F.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),m=F.getSqrtPriceX64FromTick(n),d=F.getSqrtPriceX64FromTick(r),f=a?1-s:1+s,g=ae(o,(b=e[t?"mintA":"mintB"].extensions)==null?void 0:b.feeConfig,u,!c),p=new re(new S(g.amount.sub((k=g.fee)!=null?k:ie).toString()).mul(f).toFixed(0)),y;if(l.lte(m))y=t?V.getLiquidityFromTokenAmountA(m,d,p,!a):new re(0);else if(l.lte(d)){let w=V.getLiquidityFromTokenAmountA(l,d,p,!a),x=V.getLiquidityFromTokenAmountB(m,l,p);y=t?w:x}else y=t?new re(0):V.getLiquidityFromTokenAmountB(m,d,p);return Ae.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:y,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var y,b,k,w;let u=F.getSqrtPriceX64FromTick(n),c=F.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=V.getAmountsFromLiquidity(F.priceToSqrtPriceX64(new S(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,f]=[ae(m.amountA,(y=t.mintA.extensions)==null?void 0:y.feeConfig,e,!0),ae(m.amountB,(b=t.mintB.extensions)==null?void 0:b.feeConfig,e,!0)],[g,p]=[ae(m.amountA.muln(l),(k=t.mintA.extensions)==null?void 0:k.feeConfig,e,!0),ae(m.amountB.muln(l),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:f,amountSlippageA:g,amountSlippageB:p,expirationTime:ot(d.expirationTime,f.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(u=>!n[u.id]).map(u=>new Me(u.id));(await $e(e,r)).forEach((u,c)=>{!u||(n[r[c].toBase58()]=Pi.decode(u.data))});let s=t.map(u=>Ee(new Me(u.programId),new Me(u.id)).publicKey),a=await Ae.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((u,c)=>ee(Z({},u),{[c.id]:ee(Z({},n[c.id]),{id:new Me(c.id),version:6,programId:new Me(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:ee(Z({},c.config),{id:new Me(c.config.id),fundOwner:""}),currentPrice:new S(c.price),exBitmapInfo:a[Ee(new Me(c.programId),new Me(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber()})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var M=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(ie)||(o=o.add(qe)),o}static mulDivFloor(e,t,n){if(n.eq(ie))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ie))throw new Error("division by 0");return e.mul(t).add(n.sub(qe)).div(n)}static x64ToDecimal(e,t){return new S(e.toString()).div(S.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new _(e.mul(S.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(zt).sub(t).mod(zt)}};function le(i,e){return Sn(i.mul(e),64,256)}function So(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Sn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var F=class{static sqrtPriceX64ToPrice(e,t,n){return M.x64ToDecimal(e).pow(2).mul(S.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return M.decimalToX64(e.mul(S.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(ie))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ie))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(ie))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ie))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(ie))return e;let o=t.shln(It);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?M.mulDivCeil(s,e,a):M.mulDivRoundingUp(s,qe,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return M.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(It);if(r)return e.add(o.div(t));{let s=M.mulDivRoundingUp(o,qe,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<we||e>ke)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new _("18445821805675395072"):new _("18446744073709551616");return(t&2)!=0&&(n=le(n,new _("18444899583751176192"))),(t&4)!=0&&(n=le(n,new _("18443055278223355904"))),(t&8)!=0&&(n=le(n,new _("18439367220385607680"))),(t&16)!=0&&(n=le(n,new _("18431993317065453568"))),(t&32)!=0&&(n=le(n,new _("18417254355718170624"))),(t&64)!=0&&(n=le(n,new _("18387811781193609216"))),(t&128)!=0&&(n=le(n,new _("18329067761203558400"))),(t&256)!=0&&(n=le(n,new _("18212142134806163456"))),(t&512)!=0&&(n=le(n,new _("17980523815641700352"))),(t&1024)!=0&&(n=le(n,new _("17526086738831433728"))),(t&2048)!=0&&(n=le(n,new _("16651378430235570176"))),(t&4096)!=0&&(n=le(n,new _("15030750278694412288"))),(t&8192)!=0&&(n=le(n,new _("12247334978884435968"))),(t&16384)!=0&&(n=le(n,new _("8131365268886854656"))),(t&32768)!=0&&(n=le(n,new _("3584323654725218816"))),(t&65536)!=0&&(n=le(n,new _("696457651848324352"))),(t&131072)!=0&&(n=le(n,new _("26294789957507116"))),(t&262144)!=0&&(n=le(n,new _("37481735321082"))),e>0&&(n=hi.div(n)),n}static getTickFromPrice(e,t,n){return F.getTickFromSqrtPriceX64(F.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(gt)||e.lt(pt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new _(t-64),r=So(n,32,128),o=new _("8000000000000000","hex"),s=0,a=new _(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new _(0))&&s<wi;){u=u.mul(u);let g=u.shrn(127);u=u.shrn(63+g.toNumber()),a=a.add(o.mul(g)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=r.add(c).mul(new _(Ai)),d=Sn(m.sub(new _(ki)),64,128).toNumber(),f=Sn(m.add(new _(Ti)),64,128).toNumber();return d==f?d:F.getSqrtPriceX64FromTick(f).lte(e)?f:d}},ct=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=F.getTickFromSqrtPriceX64(F.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=ct.getTickWithPriceAndTickspacing(e,t,n,r),s=F.getSqrtPriceX64FromTick(o);return F.sqrtPriceX64ToPrice(s,n,r)}},V=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ie))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(It),s=t.sub(e);return r?M.mulDivRoundingUp(M.mulDivCeil(o,s,t),qe,e):M.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ie))throw new Error("sqrtPriceX64A must greater than 0");return r?M.mulDivCeil(n,t.sub(e),Be):M.mulDivFloor(n,t.sub(e),Be)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?M.mulDivRoundingUp(a,qe,Bn):a.shrn(It)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),M.mulDivFloor(n,Bn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return V.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=V.getLiquidityFromTokenAmountA(e,n,r,!1),a=V.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return V.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:V.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new _(0)};if(e.lt(n)){let s=V.getTokenAmountAFromLiquidity(e,n,r,o),a=V.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new _(0),amountB:V.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=V.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new _(new S(u.toString()).mul(l).toFixed(0)),d=new _(new S(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var k,w,x,R;let c=F.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),l=F.getSqrtPriceX64FromTick(t),m=F.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,f=V.getAmountsFromLiquidity(c,l,m,r,s),[g,p]=[ae(f.amountA,(k=e.mintA.extensions)==null?void 0:k.feeConfig,a,u),ae(f.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,u)],[y,b]=[ae(new _(new S(f.amountA.toString()).mul(d).toFixed(0)),(x=e.mintA.extensions)==null?void 0:x.feeConfig,a,u),ae(new _(new S(f.amountB.toString()).mul(d).toFixed(0)),(R=e.mintB.extensions)==null?void 0:R.feeConfig,a,u)];return{liquidity:r,amountA:g,amountB:p,amountSlippageA:y,amountSlippageB:b,expirationTime:ot(g.expirationTime,p.expirationTime)}}},ut=class{static swapCompute(e,t,n,r,o,s,a,u,c,l,m,d,f,g,p=!1){if(d.eq(ie))throw new Error("amountSpecified must not be 0");if(g||(g=s?pt.add(qe):gt.sub(qe)),s){if(g.lt(pt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(g.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(g.gt(gt))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(g.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let y=d.gt(ie),b={amountSpecifiedRemaining:d,amountCalculated:ie,sqrtPriceX64:m,tick:c>f?Math.min(f+W.tickCount(l)-1,c):f,accounts:[],liquidity:u,feeAmount:new _(0)},k=f,w=n[f],x=0,R=!s&&w.startTickIndex===b.tick;for(;!b.amountSpecifiedRemaining.eq(ie)&&!b.sqrtPriceX64.eq(g);){x>10;let A={};A.sqrtPriceStartX64=b.sqrtPriceX64;let O=P.nextInitTick(w,b.tick,l,s,R),E=O||null,j=null;if(!(E!=null&&E.liquidityGross.gtn(0))){let D=Ae.nextInitializedTickArrayStartIndex({tickCurrent:b.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},k,s);if(!D.isExist){if(p)return{allTrade:!1,amountSpecifiedRemaining:b.amountSpecifiedRemaining,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts};throw Error("swapCompute LiquidityInsufficient")}k=D.nextStartIndex;let{publicKey:ce}=X(e,t,k);j=ce,w=n[k];try{E=P.firstInitializedTick(w,s)}catch{throw Error("not found next tick info")}}A.tickNext=E.tick,A.initialized=E.liquidityGross.gtn(0),f!==k&&j&&(b.accounts.push(j),f=k),A.tickNext<we?A.tickNext=we:A.tickNext>ke&&(A.tickNext=ke),A.sqrtPriceNextX64=F.getSqrtPriceX64FromTick(A.tickNext);let Y;if(s&&A.sqrtPriceNextX64.lt(g)||!s&&A.sqrtPriceNextX64.gt(g)?Y=g:Y=A.sqrtPriceNextX64,[b.sqrtPriceX64,A.amountIn,A.amountOut,A.feeAmount]=ut.swapStepCompute(b.sqrtPriceX64,Y,b.liquidity,b.amountSpecifiedRemaining,a),b.feeAmount=b.feeAmount.add(A.feeAmount),y?(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.sub(A.amountIn.add(A.feeAmount)),b.amountCalculated=b.amountCalculated.sub(A.amountOut)):(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.add(A.amountOut),b.amountCalculated=b.amountCalculated.add(A.amountIn.add(A.feeAmount))),b.sqrtPriceX64.eq(A.sqrtPriceNextX64)){if(A.initialized){let D=E.liquidityNet;s&&(D=D.mul(He)),b.liquidity=V.addDelta(b.liquidity,D)}R=A.tickNext!=b.tick&&!s&&w.startTickIndex===A.tickNext,b.tick=s?A.tickNext-1:A.tickNext}else if(b.sqrtPriceX64!=A.sqrtPriceStartX64){let D=F.getTickFromSqrtPriceX64(b.sqrtPriceX64);R=D!=b.tick&&!s&&w.startTickIndex===D,b.tick=D}++x}try{let{nextStartIndex:A,isExist:O}=W.nextInitializedTickArray(b.tick,l,s,r,o);O&&f!==A&&(b.accounts.push(X(e,t,A).publicKey),f=A)}catch{}return{allTrade:!0,amountSpecifiedRemaining:ie,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new _(0),amountIn:new _(0),amountOut:new _(0),feeAmount:new _(0)},a=e.gte(t),u=r.gte(ie);if(u){let l=M.mulDivFloor(r,Ht.sub(new _(o.toString())),Ht);s.amountIn=a?V.getTokenAmountAFromLiquidity(t,e,n,!0):V.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=F.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?V.getTokenAmountBFromLiquidity(t,e,n,!1):V.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(He).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=F.getNextSqrtPriceX64FromOutput(e,n,r.mul(He),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=V.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=V.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:V.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:V.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(He))&&(s.amountOut=r.mul(He)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=M.mulDivCeil(s.amountIn,new _(o),Ht.sub(new _(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var ue=60,at=512,P=class{static getTickArrayAddressByTick(e,t,n,r){let o=P.getTickArrayStartIndexByTick(n,r),{publicKey:s}=X(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=P.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=ue)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=W.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*W.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*ue,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*ue,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*ue:e+t*ue}static mergeTickArrayBitmap(e){let t=new No(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*ue));return[...P.searchLowBitFromStart(e,t,s-1,o,n),...P.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return P.searchHightBitFromStart(e,t,0,at,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=P.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=X(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>P.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===r)break}let u=W.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>P.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===r)break}let u=W.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<we||e>ke}static nextInitTick(e,t,n,r,o){if(W.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<ue;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=ue-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<ue;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=F.getSqrtPriceX64FromTick(t),o=F.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new S(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new S(1).div(t),o=ct.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=F.getSqrtPriceX64FromTick(o),a=F.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new S(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=F.getSqrtPriceX64FromTick(t),o=F.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new S(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new S(1).div(t),o=ct.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=F.getSqrtPriceX64FromTick(o),a=F.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new S(1).div(a)}}};var ed=H([Se(8),ne("bump"),ft("index"),J(""),ze("protocolFeeRate"),ze("tradeFeeRate"),ft("tickSpacing"),te(N(),8,"")]),Co=H([ze("blockTimestamp"),v("sqrtPriceX64"),v("cumulativeTimePriceX64"),te(v(),1,"")]),Nn=H([Se(8),ve("initialized"),J("poolId"),te(Co,1e3,"observations"),te(v(),5,"")]),Ko=H([ne("rewardState"),N("openTime"),N("endTime"),N("lastUpdateTime"),v("emissionsPerSecondX64"),N("rewardTotalEmissioned"),N("rewardClaimed"),J("tokenMint"),J("tokenVault"),J("creator"),v("rewardGrowthGlobalX64")]),Pi=H([Se(8),ne("bump"),J("ammConfig"),J("creator"),J("mintA"),J("mintB"),J("vaultA"),J("vaultB"),J("observationId"),ne("mintDecimalsA"),ne("mintDecimalsB"),ft("tickSpacing"),v("liquidity"),v("sqrtPriceX64"),pe("tickCurrent"),ft("observationIndex"),ft("observationUpdateDuration"),v("feeGrowthGlobalX64A"),v("feeGrowthGlobalX64B"),N("protocolFeesTokenA"),N("protocolFeesTokenB"),v("swapInAmountTokenA"),v("swapOutAmountTokenB"),v("swapInAmountTokenB"),v("swapOutAmountTokenA"),ne("status"),te(ne(),7,""),te(Ko,3,"rewardInfos"),te(N(),16,"tickArrayBitmap"),N("totalFeesTokenA"),N("totalFeesClaimedTokenA"),N("totalFeesTokenB"),N("totalFeesClaimedTokenB"),N("fundFeesTokenA"),N("fundFeesTokenB"),N("startTime"),te(N(),15*4-3,"padding")]),Lo=H([v("growthInsideLastX64"),N("rewardAmountOwed")]),Bi=H([Se(8),ne("bump"),J("nftMint"),J("poolId"),pe("tickLower"),pe("tickUpper"),v("liquidity"),v("feeGrowthInsideLastX64A"),v("feeGrowthInsideLastX64B"),N("tokenFeesOwedA"),N("tokenFeesOwedB"),te(Lo,3,"rewardInfos"),te(N(),8,"")]),td=H([Se(8),ne("bump"),J("poolId"),pe("tickLowerIndex"),pe("tickUpperIndex"),v("liquidity"),v("feeGrowthInsideLastX64A"),v("feeGrowthInsideLastX64B"),N("tokenFeesOwedA"),N("tokenFeesOwedB"),te(v(),3,"rewardGrowthInside"),te(N(),8,"")]),Ro=H([pe("tick"),di("liquidityNet"),v("liquidityGross"),v("feeGrowthOutsideX64A"),v("feeGrowthOutsideX64B"),te(v(),3,"rewardGrowthsOutsideX64"),te(ze(),13,"")]),St=H([Se(8),J("poolId"),pe("startTickIndex"),te(Ro,ue,"ticks"),ne("initializedTickCount"),te(ne(),115,"")]),nd=H([Se(329),te(J(),100,"whitelistMints")]),Ii=H([Se(8),J("poolId"),te(te(N(),8),In,"positiveTickArrayBitmap"),te(te(N(),8),In,"negativeTickArrayBitmap")]);import{PublicKey as Do,Keypair as vo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Wo}from"@solana/spl-token";import xd from"bn.js";var Eo=H([J("mint"),J("owner"),N("amount"),ze("delegateOption"),J("delegate"),ne("state"),ze("isNativeOption"),N("isNative"),N("delegatedAmount"),ze("closeAuthorityOption"),J("closeAuthority")]);function Mo(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function Cn(i,...e){if(!Mo(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function Kn(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function Si(i,e){Cn(i);let t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var Zt=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),Fe=(i,e)=>i<<32-e|i>>>e;var ud=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Fo(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function Ln(i){return typeof i=="string"&&(i=Fo(i)),Cn(i),i}var jt=class{clone(){return this._cloneInto()}},cd={}.toString;function Ni(i){let e=n=>i().update(Ln(n)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function _o(i,e,t,n){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,n);let r=BigInt(32),o=BigInt(4294967295),s=Number(t>>r&o),a=Number(t&o),u=n?4:0,c=n?0:4;i.setUint32(e+u,s,n),i.setUint32(e+c,a,n)}var Ci=(i,e,t)=>i&e^~i&t,Ki=(i,e,t)=>i&e^i&t^e&t,Yt=class extends jt{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Zt(this.buffer)}update(e){Kn(this);let{view:t,buffer:n,blockLen:r}=this;e=Ln(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(r-this.pos,o-s);if(a===r){let u=Zt(e);for(;r<=o-s;s+=r)this.process(u,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Kn(this),Si(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let m=s;m<r;m++)t[m]=0;_o(n,r-8,BigInt(this.length*8),o),this.process(n,0);let a=Zt(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<c;m++)a.setUint32(4*m,l[m],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:o,destroyed:s,pos:a}=this;return e.length=r,e.pos=a,e.finished=o,e.destroyed=s,r%t&&e.buffer.set(n),e}};var Oo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),et=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),tt=new Uint32Array(64),Rn=class extends Yt{constructor(){super(64,32,8,!1),this.A=et[0]|0,this.B=et[1]|0,this.C=et[2]|0,this.D=et[3]|0,this.E=et[4]|0,this.F=et[5]|0,this.G=et[6]|0,this.H=et[7]|0}get(){let{A:e,B:t,C:n,D:r,E:o,F:s,G:a,H:u}=this;return[e,t,n,r,o,s,a,u]}set(e,t,n,r,o,s,a,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,t){for(let m=0;m<16;m++,t+=4)tt[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let d=tt[m-15],f=tt[m-2],g=Fe(d,7)^Fe(d,18)^d>>>3,p=Fe(f,17)^Fe(f,19)^f>>>10;tt[m]=p+tt[m-7]+g+tt[m-16]|0}let{A:n,B:r,C:o,D:s,E:a,F:u,G:c,H:l}=this;for(let m=0;m<64;m++){let d=Fe(a,6)^Fe(a,11)^Fe(a,25),f=l+d+Ci(a,u,c)+Oo[m]+tt[m]|0,p=(Fe(n,2)^Fe(n,13)^Fe(n,22))+Ki(n,r,o)|0;l=c,c=u,u=a,a=s+f|0,s=o,o=r,r=n,n=f+p|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,o,s,a,u,c,l)}roundClean(){tt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Li=Ni(()=>new Rn);var Sd=me("Raydium_Util");function Ri({fromPublicKey:i,programId:e=Wo}){let t=vo.generate().publicKey.toBase58().slice(0,32);return{publicKey:qo(i,t,e),seed:t}}function qo(i,e,t){let n=Buffer.concat([i.toBuffer(),Buffer.from(e),t.toBuffer()]),r=Li(n);return new Do(r)}var Fi=me("Raydium_Clmm"),Oe={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},_i=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,g){let p=H([v("sqrtPriceX64"),N("startTime")]),y=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:bt.programId,isSigner:!1,isWritable:!1},{pubkey:At,isSigner:!1,isWritable:!1}],b=Buffer.alloc(p.span);p.encode({sqrtPriceX64:f,startTime:g},b);let k=Buffer.from([...Oe.createPool,...b]);return new _e({keys:y,programId:e,data:k})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:r,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:u,startTime:c,forerunCreate:l}=e,m=Ri({fromPublicKey:r,programId:n}),[d,f]=[new T(o.address),new T(s.address)],g=[bt.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:m.seed,newAccountPubkey:m.publicKey,lamports:l?0:await t.getMinimumBalanceForRentExemption(Nn.span),space:Nn.span,programId:n})],{publicKey:p}=bi(n,a,d,f,r),{publicKey:y}=xn(n,p,d),{publicKey:b}=xn(n,p,f);return g.push(this.createPoolInstruction(n,p,r,a,m.publicKey,d,y,new T(o.programId||ge),f,b,new T(s.programId||ge),Ee(n,p).publicKey,u,c)),{signers:[],instructions:g,instructionTypes:[he.CreateAccount,he.ClmmCreatePool],address:{poolId:p,observationId:m.publicKey,mintAVault:y,mintBVault:b},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,g,p,y,b,k,w,x,R,A,O,E,j,Y){let D=H([pe("tickLowerIndex"),pe("tickUpperIndex"),pe("tickArrayLowerStartIndex"),pe("tickArrayUpperStartIndex"),v("liquidity"),N("amountMaxA"),N("amountMaxB"),ve("withMetadata"),ne("optionBaseFlag"),ve("baseFlag")]),ce=[...Y?[{pubkey:Y,isSigner:!1,isWritable:!0}]:[]],oe=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:At,isSigner:!1,isWritable:!1},{pubkey:bt.programId,isSigner:!1,isWritable:!1},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:Ei,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...ce],Te=Buffer.alloc(D.span);D.encode({tickLowerIndex:k,tickUpperIndex:w,tickArrayLowerStartIndex:x,tickArrayUpperStartIndex:R,liquidity:A,amountMaxA:O,amountMaxB:E,withMetadata:j==="create",baseFlag:!1,optionBaseFlag:0},Te);let $=Buffer.from([...Oe.openPosition,...Te]);return new _e({keys:oe,programId:e,data:$})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,f]=[new T(e.programId),new T(e.id)],g;if(l)g=new T((await l(1))[0]);else{let E=En.generate();m.push(E),g=E.publicKey}let p=P.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=P.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=X(d,f,p),{publicKey:k}=X(d,f,y),{publicKey:w}=Xe(n.wallet,g,ge),{publicKey:x}=Xt(g),{publicKey:R}=We(d,g),{publicKey:A}=st(d,f,r,o),O=this.openPositionFromLiquidityInstruction(d,n.feePayer,f,n.wallet,g,w,x,A,b,k,R,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),r,o,p,y,s,a,u,c);return{signers:m,instructions:[O],instructionTypes:[he.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:g,tickArrayLower:b,tickArrayUpper:k,positionNftAccount:w,metadataAccount:x,personalPosition:R,protocolPosition:A}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,f]=[new T(e.programId),new T(e.id)],g;if(l)g=new T((await l(1))[0]);else{let E=En.generate();m.push(E),g=E.publicKey}let p=P.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=P.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=X(d,f,p),{publicKey:k}=X(d,f,y),{publicKey:w}=Xe(n.wallet,g,ge),{publicKey:x}=Xt(g),{publicKey:R}=We(d,g),{publicKey:A}=st(d,f,r,o),O=this.openPositionFromBaseInstruction(d,n.feePayer,f,n.wallet,g,w,x,A,b,k,R,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),r,o,p,y,c,s,a,u,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,y])?Ee(d,f).publicKey:void 0);return{address:{nftMint:g,tickArrayLower:b,tickArrayUpper:k,positionNftAccount:w,metadataAccount:x,personalPosition:R,protocolPosition:A},instructions:[O],signers:m,instructionTypes:[he.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,g,p,y,b,k,w,x,R,A,O,E,j,Y){let D=H([pe("tickLowerIndex"),pe("tickUpperIndex"),pe("tickArrayLowerStartIndex"),pe("tickArrayUpperStartIndex"),v("liquidity"),N("amountMaxA"),N("amountMaxB"),ve("withMetadata"),ne("optionBaseFlag"),ve("baseFlag")]),ce=[...Y?[{pubkey:Y,isSigner:!1,isWritable:!0}]:[]],oe=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:At,isSigner:!1,isWritable:!1},{pubkey:bt.programId,isSigner:!1,isWritable:!1},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:Ei,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...ce],Te=Buffer.alloc(D.span);D.encode({tickLowerIndex:k,tickUpperIndex:w,tickArrayLowerStartIndex:x,tickArrayUpperStartIndex:R,liquidity:new Mi(0),amountMaxA:O==="MintA"?E:j,amountMaxB:O==="MintA"?j:E,withMetadata:A==="create",baseFlag:O==="MintA",optionBaseFlag:1},Te);let $=Buffer.from([...Oe.openPosition,...Te]);return new _e({keys:oe,programId:e,data:$})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,d=[];if(l)m=new T((await l(1))[0]);else{let E=En.generate();d.push(E),m=E.publicKey}let[f,g]=[new T(e.programId),new T(e.id)],p=P.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=P.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=X(f,g,p),{publicKey:k}=X(f,g,y),{publicKey:w}=Xe(n.wallet,m,ge),{publicKey:x}=Xt(m),{publicKey:R}=We(f,m),{publicKey:A}=st(f,g,r,o),O=this.openPositionFromLiquidityInstruction(f,n.wallet,g,n.wallet,m,w,x,A,b,k,R,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(t.mintA.address),new T(t.mintB.address),r,o,p,y,s,a,u,c,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,y])?Ee(f,g).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:b,tickArrayUpper:k,positionNftAccount:w,metadataAccount:x,personalPosition:R,protocolPosition:A},instructions:[O],signers:d,instructionTypes:[he.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=H([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:bt.programId,isSigner:!1,isWritable:!1},{pubkey:ge,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...Oe.closePosition,...u]);return new _e({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new T(e.programId),{publicKey:s}=Xe(n.wallet,r.nftMint,ge),{publicKey:a}=We(o,r.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[he.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,g,p,y,b,k){let w=H([v("liquidity"),N("amountMaxA"),N("amountMaxB"),ne("optionBaseFlag"),ve("baseFlag")]),x=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[]],R=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...x],A=Buffer.alloc(w.span);w.encode({liquidity:p,amountMaxA:y,amountMaxB:b,optionBaseFlag:0,baseFlag:!1},A);let O=Buffer.from([...Oe.increaseLiquidity,...A]);return new _e({keys:R,programId:e,data:O})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new T(e.programId),new T(e.id)],l=P.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=P.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=X(u,c,l),{publicKey:f}=X(u,c,m),{publicKey:g}=Xe(r.wallet,n.nftMint,ge),{publicKey:p}=We(u,n.nftMint),{publicKey:y}=st(u,c,n.tickLower,n.tickUpper),b=this.increasePositionFromLiquidityInstruction(u,r.wallet,g,p,c,y,d,f,r.tokenAccountA,r.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),o,s,a,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ee(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:g,personalPosition:p,protocolPosition:y},signers:[],instructions:[b],instructionTypes:[he.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new T(e.programId),new T(e.id)],l=P.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=P.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=X(u,c,l),{publicKey:f}=X(u,c,m),{publicKey:g}=Xe(r.wallet,n.nftMint,ge),{publicKey:p}=We(u,n.nftMint),{publicKey:y}=st(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:g,personalPosition:p,protocolPosition:y},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,g,p,c,y,d,f,r.tokenAccountA,r.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),o,s,a,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ee(u,c).publicKey:void 0)],signers:[],instructionTypes:[he.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,g,p,y,b,k){let w=H([v("liquidity"),N("amountMaxA"),N("amountMaxB"),ne("optionBaseFlag"),ve("baseFlag")]),x=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[]],R=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...x],A=Buffer.alloc(w.span);w.encode({liquidity:new Mi(0),amountMaxA:p==="MintA"?y:b,amountMaxB:p==="MintA"?b:y,baseFlag:p==="MintA",optionBaseFlag:1},A);let O=Buffer.from([...Oe.increaseLiquidity,...A]);return new _e({keys:R,programId:e,data:O})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,g,p,y,b,k,w){let x=H([v("liquidity"),N("amountMinA"),N("amountMinB")]),R=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...p.map(j=>[{pubkey:j.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:j.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:j.rewardMint,isSigner:!1,isWritable:!1}]).flat()],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:Ot,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...R],O=Buffer.alloc(x.span);x.encode({liquidity:y,amountMinA:b,amountMinB:k},O);let E=Buffer.from([...Oe.decreaseLiquidity,...O]);return new _e({keys:A,programId:e,data:E})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new T(e.programId),new T(e.id)],m=P.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=P.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:f}=X(c,l,m),{publicKey:g}=X(c,l,d),{publicKey:p}=Xe(r.wallet,n.nftMint,u),{publicKey:y}=We(c,n.nftMint),{publicKey:b}=st(c,l,n.tickLower,n.tickUpper),k=[];for(let x=0;x<e.rewardDefaultInfos.length;x++)k.push({poolRewardVault:new T(t.rewardInfos[x].vault),ownerRewardVault:r.rewardAccounts[x],rewardMint:new T(e.rewardDefaultInfos[x].mint.address)});let w=[];return w.push(this.decreaseLiquidityInstruction(c,r.wallet,p,y,l,b,f,g,r.tokenAccountA,r.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),k,o,s,a,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?Ee(c,l).publicKey:void 0)),{address:{tickArrayLower:f,tickArrayUpper:g,positionNftAccount:p,personalPosition:y,protocolPosition:b},signers:[],instructions:w,instructionTypes:[he.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,g,p,y,b){let k=H([N("amount"),N("otherAmountThreshold"),v("sqrtPriceLimitX64"),ve("isBaseInput")]),w=[...b?[{pubkey:b,isSigner:!1,isWritable:!0}]:[],...m.map(O=>({pubkey:O,isSigner:!1,isWritable:!0}))],x=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:Ot,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],R=Buffer.alloc(k.span);k.encode({amount:f,otherAmountThreshold:g,sqrtPriceLimitX64:p,isBaseInput:y},R);let A=Buffer.from([...Oe.swap,...R]);return new _e({keys:x,programId:e,data:A})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new T(e.programId),new T(e.id)],[d,f]=[new T(t.vault.A),new T(t.vault.B)],[g,p]=[new T(e.mintA.address),new T(e.mintB.address)],y=e.mintA.address===o.toString(),b=[this.swapInstruction(l,r.wallet,m,new T(e.config.id),y?r.tokenAccountA:r.tokenAccountB,y?r.tokenAccountB:r.tokenAccountA,y?d:f,y?f:d,y?g:p,y?p:g,c,n,s,a,u,!0,Ee(l,m).publicKey)];return{signers:[],instructions:b,instructionTypes:[he.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let f=H([N("openTime"),N("endTime"),v("emissionsPerSecondX64")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:bt.programId,isSigner:!1,isWritable:!1},{pubkey:At,isSigner:!1,isWritable:!1}],p=Buffer.alloc(f.span);f.encode({openTime:fe(l),endTime:fe(m),emissionsPerSecondX64:d},p);let y=Buffer.from([...Oe.initReward,...p]);return new _e({keys:g,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new T(e.programId),new T(e.id)],a=yi(o,s,r.mint).publicKey,u=Pn(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new T(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[he.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let f=H([ne("rewardIndex"),v("emissionsPerSecondX64"),N("openTime"),N("endTime")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],p=Buffer.alloc(f.span);f.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:fe(l),endTime:fe(m)},p);let y=Buffer.from([...Oe.setRewardEmissions,...p]);return new _e({keys:g,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new T(e.programId),new T(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,u=new T(t.rewardInfos[d].vault),c=new T(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&Fi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Pn(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new T(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[he.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=H([ne("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:Ot,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...Oe.collectReward,...l]);return new _e({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new T(e.programId),new T(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,u=new T(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&Fi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[he.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:r,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new T(e.programId),new T(e.id)],[m,d]=[new T(t.vault.A),new T(t.vault.B)],[f,g]=[new T(e.mintA.address),new T(e.mintB.address)],p=e.mintA.address===r.toString(),y=[this.swapInstruction(c,n.wallet,l,new T(e.config.id),p?n.tokenAccountB:n.tokenAccountA,p?n.tokenAccountA:n.tokenAccountB,p?d:m,p?m:d,p?f:g,p?g:f,u,m,o,s,a,!1)];return{signers:[],instructions:y,instructionTypes:[he.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};export{_i as ClmmInstrument};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=instrument.mjs.map
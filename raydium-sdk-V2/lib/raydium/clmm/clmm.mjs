var Pr=Object.defineProperty,kr=Object.defineProperties;var xr=Object.getOwnPropertyDescriptors;var Ht=Object.getOwnPropertySymbols;var ui=Object.prototype.hasOwnProperty,li=Object.prototype.propertyIsEnumerable;var ci=(i,e,t)=>e in i?Pr(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,N=(i,e)=>{for(var t in e||(e={}))ui.call(e,t)&&ci(i,t,e[t]);if(Ht)for(var t of Ht(e))li.call(e,t)&&ci(i,t,e[t]);return i},U=(i,e)=>kr(i,xr(e));var wt=(i,e)=>{var t={};for(var n in i)ui.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&Ht)for(var n of Ht(i))e.indexOf(n)<0&&li.call(i,n)&&(t[n]=i[n]);return t};import{PublicKey as V}from"@solana/web3.js";var At=9e15,it=1e9,Tn="0123456789abcdef",Zt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Yt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Pn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-At,maxE:At,crypto:!1},pi,Ze,v=!0,Jt="[DecimalError] ",nt=Jt+"Invalid argument: ",gi=Jt+"Precision limit exceeded",bi=Jt+"crypto unavailable",yi="[object Decimal]",ke=Math.floor,me=Math.pow,Br=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Ir=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Sr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,hi=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Oe=1e7,L=7,Cr=9007199254740991,Nr=Zt.length-1,kn=Yt.length-1,P={toStringTag:yi};P.absoluteValue=P.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),K(i)};P.ceil=function(){return K(new this.constructor(this),this.e+1,2)};P.clampedTo=P.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(nt+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};P.comparedTo=P.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,c=o.s,u=i.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==i.e)return o.e>i.e^c<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return n===r?0:n>r^c<0?1:-1};P.cosine=P.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+L,n.rounding=1,t=Kr(n,ki(n,t)),n.precision=i,n.rounding=e,K(Ze==2||Ze==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};P.cubeRoot=P.cbrt=function(){var i,e,t,n,r,o,s,a,c,u,m=this,l=m.constructor;if(!m.isFinite()||m.isZero())return new l(m);for(v=!1,o=m.s*me(m.s*m,1/3),!o||Math.abs(o)==1/0?(t=he(m.d),i=m.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=me(t,1/3),i=ke((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new l(t),n.s=m.s):n=new l(o.toString()),s=(i=l.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(m),n=J(u.plus(m).times(a),u.plus(c),s+2,1),he(a.d).slice(0,s)===(t=he(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(K(a,i+1,0),a.times(a).times(a).eq(m))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(K(n,i+1,1),e=!n.times(n).times(n).eq(m));break}return v=!0,K(n,i,l.rounding,e)};P.decimalPlaces=P.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-ke(this.e/L))*L,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};P.dividedBy=P.div=function(i){return J(this,new this.constructor(i))};P.dividedToIntegerBy=P.divToInt=function(i){var e=this,t=e.constructor;return K(J(e,new t(i),0,1,1),t.precision,t.rounding)};P.equals=P.eq=function(i){return this.cmp(i)===0};P.floor=function(){return K(new this.constructor(this),this.e+1,3)};P.greaterThan=P.gt=function(i){return this.cmp(i)>0};P.greaterThanOrEqualTo=P.gte=function(i){var e=this.cmp(i);return e==1||e===0};P.hyperbolicCosine=P.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/en(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=Tt(s,1,o.times(e),new s(1),!0);for(var c,u=i,m=new s(8);u--;)c=o.times(o),o=a.minus(c.times(m.minus(c.times(m))));return K(o,s.precision=t,s.rounding=n,!0)};P.hyperbolicSine=P.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=Tt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/en(5,i)),r=Tt(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,K(r,e,t,!0)};P.hyperbolicTangent=P.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,J(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};P.inverseCosine=P.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Ee(t,r,o):new t(0):new t(NaN):e.isZero()?Ee(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Ee(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};P.inverseHyperbolicCosine=P.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,v=!1,t=t.times(t).minus(1).sqrt().plus(t),v=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};P.inverseHyperbolicSine=P.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,v=!1,t=t.times(t).plus(1).sqrt().plus(t),v=!0,n.precision=i,n.rounding=e,t.ln())};P.inverseHyperbolicTangent=P.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?K(new o(r),i,e,!0):(o.precision=t=n-r.e,r=J(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};P.inverseSine=P.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Ee(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};P.inverseTangent=P.atan=function(){var i,e,t,n,r,o,s,a,c,u=this,m=u.constructor,l=m.precision,d=m.rounding;if(u.isFinite()){if(u.isZero())return new m(u);if(u.abs().eq(1)&&l+4<=kn)return s=Ee(m,l+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new m(NaN);if(l+4<=kn)return s=Ee(m,l+4,d).times(.5),s.s=u.s,s}for(m.precision=a=l+10,m.rounding=1,t=Math.min(28,a/L+2|0),i=t;i;--i)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(v=!1,e=Math.ceil(a/L),n=1,c=u.times(u),s=new m(u),r=u;i!==-1;)if(r=r.times(c),o=s.minus(r.div(n+=2)),r=r.times(c),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),v=!0,K(s,m.precision=l,m.rounding=d,!0)};P.isFinite=function(){return!!this.d};P.isInteger=P.isInt=function(){return!!this.d&&ke(this.e/L)>this.d.length-2};P.isNaN=function(){return!this.s};P.isNegative=P.isNeg=function(){return this.s<0};P.isPositive=P.isPos=function(){return this.s>0};P.isZero=function(){return!!this.d&&this.d[0]===0};P.lessThan=P.lt=function(i){return this.cmp(i)<0};P.lessThanOrEqualTo=P.lte=function(i){return this.cmp(i)<1};P.logarithm=P.log=function(i){var e,t,n,r,o,s,a,c,u=this,m=u.constructor,l=m.precision,d=m.rounding,f=5;if(i==null)i=new m(10),e=!0;else{if(i=new m(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new m(NaN);e=i.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new m(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(v=!1,a=l+f,s=tt(u,a),n=e?Qt(m,a+10):tt(i,a),c=J(s,n,a,1),It(c.d,r=l,d))do if(a+=10,s=tt(u,a),n=e?Qt(m,a+10):tt(i,a),c=J(s,n,a,1),!o){+he(c.d).slice(r+1,r+15)+1==1e14&&(c=K(c,l+1,0));break}while(It(c.d,r+=10,d));return v=!0,K(c,l,d)};P.minus=P.sub=function(i){var e,t,n,r,o,s,a,c,u,m,l,d,f=this,g=f.constructor;if(i=new g(i),!f.d||!i.d)return!f.s||!i.s?i=new g(NaN):f.d?i.s=-i.s:i=new g(i.d||f.s!==i.s?f:NaN),i;if(f.s!=i.s)return i.s=-i.s,f.plus(i);if(u=f.d,d=i.d,a=g.precision,c=g.rounding,!u[0]||!d[0]){if(d[0])i.s=-i.s;else if(u[0])i=new g(f);else return new g(c===3?-0:0);return v?K(i,a,c):i}if(t=ke(i.e/L),m=ke(f.e/L),u=u.slice(),o=m-t,o){for(l=o<0,l?(e=u,o=-o,s=d.length):(e=d,t=m,s=u.length),n=Math.max(Math.ceil(a/L),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=u.length,s=d.length,l=n<s,l&&(s=n),n=0;n<s;n++)if(u[n]!=d[n]){l=u[n]<d[n];break}o=0}for(l&&(e=u,u=d,d=e,i.s=-i.s),s=u.length,n=d.length-s;n>0;--n)u[s++]=0;for(n=d.length;n>o;){if(u[--n]<d[n]){for(r=n;r&&u[--r]===0;)u[r]=Oe-1;--u[r],u[n]+=Oe}u[n]-=d[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(i.d=u,i.e=$t(u,t),v?K(i,a,c):i):new g(c===3?-0:0)};P.modulo=P.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?K(new n(t),n.precision,n.rounding):(v=!1,n.modulo==9?(e=J(t,i.abs(),0,3,1),e.s*=i.s):e=J(t,i,0,n.modulo,1),e=e.times(i),v=!0,t.minus(e))};P.naturalExponential=P.exp=function(){return xn(this)};P.naturalLogarithm=P.ln=function(){return tt(this)};P.negated=P.neg=function(){var i=new this.constructor(this);return i.s=-i.s,K(i)};P.plus=P.add=function(i){var e,t,n,r,o,s,a,c,u,m,l=this,d=l.constructor;if(i=new d(i),!l.d||!i.d)return!l.s||!i.s?i=new d(NaN):l.d||(i=new d(i.d||l.s===i.s?l:NaN)),i;if(l.s!=i.s)return i.s=-i.s,l.minus(i);if(u=l.d,m=i.d,a=d.precision,c=d.rounding,!u[0]||!m[0])return m[0]||(i=new d(l)),v?K(i,a,c):i;if(o=ke(l.e/L),n=ke(i.e/L),u=u.slice(),r=o-n,r){for(r<0?(t=u,r=-r,s=m.length):(t=m,n=o,s=u.length),o=Math.ceil(a/L),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=m.length,s-r<0&&(r=s,t=m,m=u,u=t),e=0;r;)e=(u[--r]=u[r]+m[r]+e)/Oe|0,u[r]%=Oe;for(e&&(u.unshift(e),++n),s=u.length;u[--s]==0;)u.pop();return i.d=u,i.e=$t(u,n),v?K(i,a,c):i};P.precision=P.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(nt+i);return t.d?(e=wi(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};P.round=function(){var i=this,e=i.constructor;return K(new e(i),i.e+1,e.rounding)};P.sine=P.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+L,n.rounding=1,t=Lr(n,ki(n,t)),n.precision=i,n.rounding=e,K(Ze>2?t.neg():t,i,e,!0)):new n(NaN)};P.squareRoot=P.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,c=s.e,u=s.s,m=s.constructor;if(u!==1||!a||!a[0])return new m(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(v=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=he(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=ke((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),n=new m(e)):n=new m(u.toString()),t=(c=m.precision)+3;;)if(o=n,n=o.plus(J(s,o,t+2,1)).times(.5),he(o.d).slice(0,t)===(e=he(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(K(o,c+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(K(n,c+1,1),i=!n.times(n).eq(s));break}return v=!0,K(n,c,m.rounding,i)};P.tangent=P.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=J(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,K(Ze==2||Ze==4?t.neg():t,i,e,!0)):new n(NaN)};P.times=P.mul=function(i){var e,t,n,r,o,s,a,c,u,m=this,l=m.constructor,d=m.d,f=(i=new l(i)).d;if(i.s*=m.s,!d||!d[0]||!f||!f[0])return new l(!i.s||d&&!d[0]&&!f||f&&!f[0]&&!d?NaN:!d||!f?i.s/0:i.s*0);for(t=ke(m.e/L)+ke(i.e/L),c=d.length,u=f.length,c<u&&(o=d,d=f,f=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(e=0,r=c+n;r>n;)a=o[r]+f[n]*d[r-n-1]+e,o[r--]=a%Oe|0,e=a/Oe|0;o[r]=(o[r]+e)%Oe|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=$t(o,t),v?K(i,l.precision,l.rounding):i};P.toBinary=function(i,e){return In(this,2,i,e)};P.toDecimalPlaces=P.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Ie(i,0,it),e===void 0?e=n.rounding:Ie(e,0,8),K(t,i+t.e+1,e))};P.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Ge(n,!0):(Ie(i,0,it),e===void 0?e=r.rounding:Ie(e,0,8),n=K(new r(n),i+1,e),t=Ge(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};P.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Ge(r):(Ie(i,0,it),e===void 0?e=o.rounding:Ie(e,0,8),n=K(new o(r),i+r.e+1,e),t=Ge(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};P.toFraction=function(i){var e,t,n,r,o,s,a,c,u,m,l,d,f=this,g=f.d,p=f.constructor;if(!g)return new p(f);if(u=t=new p(1),n=c=new p(0),e=new p(n),o=e.e=wi(g)-f.e-1,s=o%L,e.d[0]=me(10,s<0?L+s:s),i==null)i=o>0?e:u;else{if(a=new p(i),!a.isInt()||a.lt(u))throw Error(nt+a);i=a.gt(e)?o>0?e:u:a}for(v=!1,a=new p(he(g)),m=p.precision,p.precision=o=g.length*L*2;l=J(a,e,0,1,1),r=t.plus(l.times(n)),r.cmp(i)!=1;)t=n,n=r,r=u,u=c.plus(l.times(r)),c=r,r=e,e=a.minus(l.times(r)),a=r;return r=J(i.minus(t),n,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(n)),c.s=u.s=f.s,d=J(u,n,o,1).minus(f).abs().cmp(J(c,t,o,1).minus(f).abs())<1?[u,n]:[c,t],p.precision=m,v=!0,d};P.toHexadecimal=P.toHex=function(i,e){return In(this,16,i,e)};P.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Ie(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(v=!1,t=J(t,i,0,e,1).times(i),v=!0,K(t)):(i.s=t.s,t=i),t};P.toNumber=function(){return+this};P.toOctal=function(i,e){return In(this,8,i,e)};P.toPower=P.pow=function(i){var e,t,n,r,o,s,a=this,c=a.constructor,u=+(i=new c(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new c(me(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,o=c.rounding,i.eq(1))return K(a,n,o);if(e=ke(i.e/L),e>=i.d.length-1&&(t=u<0?-u:u)<=Cr)return r=Ai(c,a,t,n),i.s<0?new c(1).div(r):K(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new c(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=me(+a,u),e=t==0||!isFinite(t)?ke(u*(Math.log("0."+he(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(v=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=xn(i.times(tt(a,n+t)),n),r.d&&(r=K(r,n+5,1),It(r.d,n,o)&&(e=n+10,r=K(xn(i.times(tt(a,e+t)),e),e+5,1),+he(r.d).slice(n+1,n+15)+1==1e14&&(r=K(r,n+1,0)))),r.s=s,v=!0,c.rounding=o,K(r,n,o))};P.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Ge(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Ie(i,1,it),e===void 0?e=r.rounding:Ie(e,0,8),n=K(new r(n),i,e),t=Ge(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};P.toSignificantDigits=P.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Ie(i,1,it),e===void 0?e=n.rounding:Ie(e,0,8)),K(new n(t),i,e)};P.toString=function(){var i=this,e=i.constructor,t=Ge(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};P.truncated=P.trunc=function(){return K(new this.constructor(this),this.e+1,1)};P.valueOf=P.toJSON=function(){var i=this,e=i.constructor,t=Ge(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function he(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=L-n.length,t&&(o+=et(t)),o+=n;s=i[e],n=s+"",t=L-n.length,t&&(o+=et(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ie(i,e,t){if(i!==~~i||i<e||i>t)throw Error(nt+i)}function It(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=L,r=0):(r=Math.ceil((e+1)/L),e%=L),o=me(10,L-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==me(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==me(10,e-3)-1,s}function jt(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=Tn.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function Kr(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/en(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=Tt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var J=function(){function i(n,r,o){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*r+a,n[c]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(n[a]!=r[a]){c=n[a]>r[a]?1:-1;break}return c}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,c){var u,m,l,d,f,g,p,y,b,w,h,A,k,T,I,x,M,E,R,j,te=n.constructor,ue=n.s==r.s?1:-1,ne=n.d,Y=r.d;if(!ne||!ne[0]||!Y||!Y[0])return new te(!n.s||!r.s||(ne?Y&&ne[0]==Y[0]:!Y)?NaN:ne&&ne[0]==0||!Y?ue*0:ue/0);for(c?(f=1,m=n.e-r.e):(c=Oe,f=L,m=ke(n.e/f)-ke(r.e/f)),R=Y.length,M=ne.length,b=new te(ue),w=b.d=[],l=0;Y[l]==(ne[l]||0);l++);if(Y[l]>(ne[l]||0)&&m--,o==null?(T=o=te.precision,s=te.rounding):a?T=o+(n.e-r.e)+1:T=o,T<0)w.push(1),g=!0;else{if(T=T/f+2|0,l=0,R==1){for(d=0,Y=Y[0],T++;(l<M||d)&&T--;l++)I=d*c+(ne[l]||0),w[l]=I/Y|0,d=I%Y|0;g=d||l<M}else{for(d=c/(Y[0]+1)|0,d>1&&(Y=i(Y,d,c),ne=i(ne,d,c),R=Y.length,M=ne.length),x=R,h=ne.slice(0,R),A=h.length;A<R;)h[A++]=0;j=Y.slice(),j.unshift(0),E=Y[0],Y[1]>=c/2&&++E;do d=0,u=e(Y,h,R,A),u<0?(k=h[0],R!=A&&(k=k*c+(h[1]||0)),d=k/E|0,d>1?(d>=c&&(d=c-1),p=i(Y,d,c),y=p.length,A=h.length,u=e(p,h,y,A),u==1&&(d--,t(p,R<y?j:Y,y,c))):(d==0&&(u=d=1),p=Y.slice()),y=p.length,y<A&&p.unshift(0),t(h,p,A,c),u==-1&&(A=h.length,u=e(Y,h,R,A),u<1&&(d++,t(h,R<A?j:Y,A,c))),A=h.length):u===0&&(d++,h=[0]),w[l++]=d,u&&h[0]?h[A++]=ne[x]||0:(h=[ne[x]],A=1);while((x++<M||h[0]!==void 0)&&T--);g=h[0]!==void 0}w[0]||w.shift()}if(f==1)b.e=m,pi=g;else{for(l=1,d=w[0];d>=10;d/=10)l++;b.e=l+m*f-1,K(b,a?o+b.e+1:o,s,g)}return b}}();function K(i,e,t,n){var r,o,s,a,c,u,m,l,d,f=i.constructor;e:if(e!=null){if(l=i.d,!l)return i;for(r=1,a=l[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=L,s=e,m=l[d=0],c=m/me(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/L),a=l.length,d>=a)if(n){for(;a++<=d;)l.push(0);m=c=0,r=1,o%=L,s=o-L+1}else break e;else{for(m=a=l[d],r=1;a>=10;a/=10)r++;o%=L,s=o-L+r,c=s<0?0:m/me(10,r-s-1)%10|0}if(n=n||e<0||l[d+1]!==void 0||(s<0?m:m%me(10,r-s-1)),u=t<4?(c||n)&&(t==0||t==(i.s<0?3:2)):c>5||c==5&&(t==4||n||t==6&&(o>0?s>0?m/me(10,r-s):0:l[d-1])%10&1||t==(i.s<0?8:7)),e<1||!l[0])return l.length=0,u?(e-=i.e+1,l[0]=me(10,(L-e%L)%L),i.e=-e||0):l[0]=i.e=0,i;if(o==0?(l.length=d,a=1,d--):(l.length=d+1,a=me(10,L-o),l[d]=s>0?(m/me(10,r-s)%me(10,s)|0)*a:0),u)for(;;)if(d==0){for(o=1,s=l[0];s>=10;s/=10)o++;for(s=l[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,l[0]==Oe&&(l[0]=1));break}else{if(l[d]+=a,l[d]!=Oe)break;l[d--]=0,a=1}for(o=l.length;l[--o]===0;)l.pop()}return v&&(i.e>f.maxE?(i.d=null,i.e=NaN):i.e<f.minE&&(i.e=0,i.d=[0])),i}function Ge(i,e,t){if(!i.isFinite())return Pi(i);var n,r=i.e,o=he(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+et(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+et(-r-1)+o,t&&(n=t-s)>0&&(o+=et(n))):r>=s?(o+=et(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+et(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=et(n))),o}function $t(i,e){var t=i[0];for(e*=L;t>=10;t/=10)e++;return e}function Qt(i,e,t){if(e>Nr)throw v=!0,t&&(i.precision=t),Error(gi);return K(new i(Zt),e,1,!0)}function Ee(i,e,t){if(e>kn)throw Error(gi);return K(new i(Yt),e,t,!0)}function wi(i){var e=i.length-1,t=e*L+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function et(i){for(var e="";i--;)e+="0";return e}function Ai(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/L+4);for(v=!1;;){if(t%2&&(o=o.times(e),di(o.d,s)&&(r=!0)),t=ke(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),di(e.d,s)}return v=!0,o}function mi(i){return i.d[i.d.length-1]&1}function Ti(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function xn(i,e){var t,n,r,o,s,a,c,u=0,m=0,l=0,d=i.constructor,f=d.rounding,g=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(v=!1,c=g):c=e,a=new d(.03125);i.e>-2;)i=i.times(a),l+=5;for(n=Math.log(me(2,l))/Math.LN10*2+5|0,c+=n,t=o=s=new d(1),d.precision=c;;){if(o=K(o.times(i),c,1),t=t.times(++m),a=s.plus(J(o,t,c,1)),he(a.d).slice(0,c)===he(s.d).slice(0,c)){for(r=l;r--;)s=K(s.times(s),c,1);if(e==null)if(u<3&&It(s.d,c-n,f,u))d.precision=c+=10,t=o=a=new d(1),m=0,u++;else return K(s,d.precision=g,f,v=!0);else return d.precision=g,s}s=a}}function tt(i,e){var t,n,r,o,s,a,c,u,m,l,d,f=1,g=10,p=i,y=p.d,b=p.constructor,w=b.rounding,h=b.precision;if(p.s<0||!y||!y[0]||!p.e&&y[0]==1&&y.length==1)return new b(y&&!y[0]?-1/0:p.s!=1?NaN:y?0:p);if(e==null?(v=!1,m=h):m=e,b.precision=m+=g,t=he(y),n=t.charAt(0),Math.abs(o=p.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)p=p.times(i),t=he(p.d),n=t.charAt(0),f++;o=p.e,n>1?(p=new b("0."+t),o++):p=new b(n+"."+t.slice(1))}else return u=Qt(b,m+2,h).times(o+""),p=tt(new b(n+"."+t.slice(1)),m-g).plus(u),b.precision=h,e==null?K(p,h,w,v=!0):p;for(l=p,c=s=p=J(p.minus(1),p.plus(1),m,1),d=K(p.times(p),m,1),r=3;;){if(s=K(s.times(d),m,1),u=c.plus(J(s,new b(r),m,1)),he(u.d).slice(0,m)===he(c.d).slice(0,m))if(c=c.times(2),o!==0&&(c=c.plus(Qt(b,m+2,h).times(o+""))),c=J(c,new b(f),m,1),e==null)if(It(c.d,m-g,w,a))b.precision=m+=g,u=s=p=J(l.minus(1),l.plus(1),m,1),d=K(p.times(p),m,1),r=a=1;else return K(c,b.precision=h,w,v=!0);else return b.precision=h,c;c=u,r+=2}}function Pi(i){return String(i.s*i.s/0)}function Bn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%L,t<0&&(n+=L),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=L;n<r;)i.d.push(+e.slice(n,n+=L));e=e.slice(n),n=L-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),v&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function Rr(i,e){var t,n,r,o,s,a,c,u,m;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),hi.test(e))return Bn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(Ir.test(e))t=16,e=e.toLowerCase();else if(Br.test(e))t=2;else if(Sr.test(e))t=8;else throw Error(nt+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=Ai(n,new n(t),o,o*2)),u=jt(e,t,Oe),m=u.length-1,o=m;u[o]===0;--o)u.pop();return o<0?new n(i.s*0):(i.e=$t(u,m),i.d=u,v=!1,s&&(i=J(i,r,a*4)),c&&(i=i.times(Math.abs(c)<54?me(2,c):St.pow(2,c))),v=!0,i)}function Lr(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:Tt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/en(5,t)),e=Tt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function Tt(i,e,t,n,r){var o,s,a,c,u=1,m=i.precision,l=Math.ceil(m/L);for(v=!1,c=t.times(t),a=new i(n);;){if(s=J(a.times(c),new i(e++*e++),m,1),a=r?n.plus(s):n.minus(s),n=J(s.times(c),new i(e++*e++),m,1),s=a.plus(n),s.d[l]!==void 0){for(o=l;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,u++}return v=!0,s.d.length=l+1,s}function en(i,e){for(var t=i;--e;)t*=i;return t}function ki(i,e){var t,n=e.s<0,r=Ee(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Ze=n?4:1,e;if(t=e.divToInt(r),t.isZero())Ze=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Ze=mi(t)?n?2:3:n?4:1,e;Ze=mi(t)?n?1:4:n?3:2}return e.minus(r).abs()}function In(i,e,t,n){var r,o,s,a,c,u,m,l,d,f=i.constructor,g=t!==void 0;if(g?(Ie(t,1,it),n===void 0?n=f.rounding:Ie(n,0,8)):(t=f.precision,n=f.rounding),!i.isFinite())m=Pi(i);else{for(m=Ge(i),s=m.indexOf("."),g?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(m=m.replace(".",""),d=new f(1),d.e=m.length-s,d.d=jt(Ge(d),10,r),d.e=d.d.length),l=jt(m,10,r),o=c=l.length;l[--c]==0;)l.pop();if(!l[0])m=g?"0p+0":"0";else{if(s<0?o--:(i=new f(i),i.d=l,i.e=o,i=J(i,d,t,n,0,r),l=i.d,o=i.e,u=pi),s=l[t],a=r/2,u=u||l[t+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&l[t-1]&1||n===(i.s<0?8:7)),l.length=t,u)for(;++l[--t]>r-1;)l[t]=0,t||(++o,l.unshift(1));for(c=l.length;!l[c-1];--c);for(s=0,m="";s<c;s++)m+=Tn.charAt(l[s]);if(g){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)m+="0";for(l=jt(m,r,e),c=l.length;!l[c-1];--c);for(s=1,m="1.";s<c;s++)m+=Tn.charAt(l[s])}else m=m.charAt(0)+"."+m.slice(1);m=m+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)m="0"+m;m="0."+m}else if(++o>c)for(o-=c;o--;)m+="0";else o<c&&(m=m.slice(0,o)+"."+m.slice(o))}m=(e==16?"0x":e==2?"0b":e==8?"0o":"")+m}return i.s<0?"-"+m:m}function di(i,e){if(i.length>e)return i.length=e,!0}function Mr(i){return new this(i).abs()}function Er(i){return new this(i).acos()}function Or(i){return new this(i).acosh()}function Fr(i,e){return new this(i).plus(e)}function Dr(i){return new this(i).asin()}function _r(i){return new this(i).asinh()}function vr(i){return new this(i).atan()}function qr(i){return new this(i).atanh()}function Wr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Ee(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Ee(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Ee(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(J(i,e,o,1)),e=Ee(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(J(i,e,o,1)),t}function Vr(i){return new this(i).cbrt()}function Ur(i){return K(i=new this(i),i.e+1,2)}function Gr(i,e,t){return new this(i).clamp(e,t)}function Xr(i){if(!i||typeof i!="object")throw Error(Jt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,it,"rounding",0,8,"toExpNeg",-At,0,"toExpPos",0,At,"maxE",0,At,"minE",-At,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=Pn[t]),(n=i[t])!==void 0)if(ke(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(nt+t+": "+n);if(t="crypto",r&&(this[t]=Pn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(bi);else this[t]=!1;else throw Error(nt+t+": "+n);return this}function zr(i){return new this(i).cos()}function Hr(i){return new this(i).cosh()}function xi(i){var e,t,n;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,fi(o)){u.s=o.s,v?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;v?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return Bn(u,o.toString())}else if(c!=="string")throw Error(nt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),hi.test(o)?Bn(u,o):Rr(u,o)}if(r.prototype=P,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Xr,r.clone=xi,r.isDecimal=fi,r.abs=Mr,r.acos=Er,r.acosh=Or,r.add=Fr,r.asin=Dr,r.asinh=_r,r.atan=vr,r.atanh=qr,r.atan2=Wr,r.cbrt=Vr,r.ceil=Ur,r.clamp=Gr,r.cos=zr,r.cosh=Hr,r.div=jr,r.exp=Zr,r.floor=Yr,r.hypot=Qr,r.ln=Jr,r.log=$r,r.log10=to,r.log2=eo,r.max=no,r.min=io,r.mod=ro,r.mul=oo,r.pow=so,r.random=ao,r.round=co,r.sign=uo,r.sin=lo,r.sinh=mo,r.sqrt=fo,r.sub=po,r.sum=go,r.tan=bo,r.tanh=yo,r.trunc=ho,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function jr(i,e){return new this(i).div(e)}function Zr(i){return new this(i).exp()}function Yr(i){return K(i=new this(i),i.e+1,3)}function Qr(){var i,e,t=new this(0);for(v=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return v=!0,new this(1/0);t=e}return v=!0,t.sqrt()}function fi(i){return i instanceof St||i&&i.toStringTag===yi||!1}function Jr(i){return new this(i).ln()}function $r(i,e){return new this(i).log(e)}function eo(i){return new this(i).log(2)}function to(i){return new this(i).log(10)}function no(){return Ti(this,arguments,"lt")}function io(){return Ti(this,arguments,"gt")}function ro(i,e){return new this(i).mod(e)}function oo(i,e){return new this(i).mul(e)}function so(i,e){return new this(i).pow(e)}function ao(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Ie(i,1,it),n=Math.ceil(i/L),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(bi);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=L,n&&i&&(r=me(10,L-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=L)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<L&&(t-=L-n)}return s.e=t,s.d=a,s}function co(i){return K(i=new this(i),i.e+1,this.rounding)}function uo(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function lo(i){return new this(i).sin()}function mo(i){return new this(i).sinh()}function fo(i){return new this(i).sqrt()}function po(i,e){return new this(i).sub(e)}function go(){var i=0,e=arguments,t=new this(e[i]);for(v=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return v=!0,K(t,this.precision,this.rounding)}function bo(i){return new this(i).tan()}function yo(i){return new this(i).tanh()}function ho(i){return K(i=new this(i),i.e+1,1)}P[Symbol.for("nodejs.util.inspect.custom")]=P.toString;P[Symbol.toStringTag]="Decimal";var St=P.constructor=xi(Pn);Zt=new St(Zt);Yt=new St(Yt);var S=St;import{get as Bi,set as wo}from"lodash";var Sn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Ii={},Ao={};function de(i){let e=Bi(Ii,i);if(!e){let t=Bi(Ao,i);e=new Sn({name:i,logLevel:t}),wo(Ii,i,e)}return e}import{PublicKey as Bc}from"@solana/web3.js";import Sc from"bn.js";import Eo from"big.js";import sn from"bn.js";import Se from"bn.js";import{PublicKey as Rn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as To}from"@solana/spl-token";import{PublicKey as ie,SystemProgram as Si,SYSVAR_RENT_PUBKEY as Po}from"@solana/web3.js";function Cn({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var vs=[Cn({pubkey:To,isWritable:!1}),Cn({pubkey:Si.programId,isWritable:!1}),Cn({pubkey:Po,isWritable:!1})];function Nn({publicKey:i,transformSol:e}){let t=Ci(i.toString());if(t instanceof ie)return e&&t.equals(Ct)?$:t;if(e&&t.toString()===Ct.toBase58())return $;if(typeof t=="string"){if(t===ie.default.toBase58())return ie.default;try{return new ie(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Ci(i){try{return new ie(i)}catch{return i}}var tn=new ie("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),qs=new ie("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Nt=new ie("SysvarRent111111111111111111111111111111111"),Ws=new ie("SysvarC1ock11111111111111111111111111111111"),Pt=new ie("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Vs=new ie("Sysvar1nstructions1111111111111111111111111"),Us=Si.programId,Gs=new ie("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Xs=new ie("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),zs=new ie("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Hs=new ie("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),js=new ie("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Zs=new ie("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ys=new ie("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Qs=new ie("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Js=new ie("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),$s=new ie("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ea=new ie("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),$=new ie("So11111111111111111111111111111111111111112"),Ct=ie.default;function mt(i){return Nn({publicKey:i,transformSol:!0})}import{PublicKey as ko}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ni}from"@solana/spl-token";var Kn={chainId:101,address:ko.default.toBase58(),programId:Ni.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},rt={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Ni.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Ln=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Ct.toBase58()||e instanceof Rn&&Ct.equals(e)){this.decimals=rt.decimals,this.symbol=rt.symbol,this.name=rt.name,this.mint=new Rn(rt.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?Rn.default:Nn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Xe=Ln;Xe.WSOL=new Ln(U(N({},rt),{mint:rt.address}));import rn from"big.js";import Io from"bn.js";import So from"decimal.js-light";import xo from"toformat";var Bo=xo,Kt=Bo;var nn=de("module/fraction"),Mn=Kt(rn),Rt=Kt(So),Co={[0]:Rt.ROUND_DOWN,[1]:Rt.ROUND_HALF_UP,[2]:Rt.ROUND_UP},No={[0]:rn.roundDown,[1]:rn.roundHalfUp,[2]:rn.roundUp},Z=class{constructor(e,t=new Io(1)){this.numerator=we(e),this.denominator=we(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new Z(this.denominator,this.numerator)}add(e){let t=e instanceof Z?e:new Z(we(e));return this.denominator.eq(t.denominator)?new Z(this.numerator.add(t.numerator),this.denominator):new Z(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof Z?e:new Z(we(e));return this.denominator.eq(t.denominator)?new Z(this.numerator.sub(t.numerator),this.denominator):new Z(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof Z?e:new Z(we(e));return new Z(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof Z?e:new Z(we(e));return new Z(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||nn.logWithError(`${e} is not an integer.`),e<=0&&nn.logWithError(`${e} is not positive.`),Rt.set({precision:e+1,rounding:Co[n]});let r=new Rt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||nn.logWithError(`${e} is not an integer.`),e<0&&nn.logWithError(`${e} is negative.`),Mn.DP=e,Mn.RM=No[n]||1,new Mn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Ro=de("Raydium_price"),Fe=class extends Z{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new Z(En(n.decimals),En(r.decimals))}get raw(){return new Z(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Fe({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Ro.logWithError("mul token not equals");let n=super.mul(t);return new Fe({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var On=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},on=On;on.SOL=new On(Kn);import Lo from"bn.js";var Ki=new Z(new Lo(100)),dt=class extends Z{toSignificant(e=5,t,n){return this.mul(Ki).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Ki).toFixed(e,t,n)}};var Mo=new Se(0),Ya=new Se(1),Qa=new Se(2),Ja=new Se(3),$a=new Se(5),Fn=new Se(10),ec=new Se(100),tc=new Se(1e3),nc=new Se(1e4),Ri=9007199254740991;function we(i){let e=de("Raydium_parseBigNumberish");if(i instanceof Se)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Se(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=Ri||i<=-Ri)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Se(String(i))):typeof i=="bigint"?new Se(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Se(0))}function En(i){return Fn.pow(we(i))}var Oo=de("Raydium_amount"),Li=Kt(Eo);function Fo(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):Oo.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var Ae=class extends Z{constructor(t,n,r=!0,o){let s=new sn(0),a=Fn.pow(new sn(t.decimals));if(r)s=we(n);else{let c=new sn(0),u=new sn(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[m,l]=Fo(n.toString(),t.decimals);c=we(m),u=we(l)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=de(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new Ae(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new Ae(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return Li.DP=this.token.decimals,new Li(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Et,sendAndConfirmTransaction as qn,Transaction as Ot,TransactionMessage as Ft,VersionedTransaction as Dt}from"@solana/web3.js";import Ho from"axios";var le={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{PublicKey as Do,ComputeBudgetProgram as Mi,Transaction as Oi,TransactionMessage as _o,Keypair as Fi,VersionedTransaction as Di}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as vo}from"@solana/spl-token";var Ei=de("Raydium_txUtil"),_i=1644;function an(i){let e=[],t=[];return i.microLamports&&(e.push(Mi.setComputeUnitPrice({microLamports:i.microLamports})),t.push(le.SetComputeUnitPrice)),i.units&&(e.push(Mi.setComputeUnitLimit({units:i.units})),t.push(le.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function kt(i,e){var n,r;let t=e!=null?e:"confirmed";try{return((r=await((n=i.getLatestBlockhash)==null?void 0:n.call(i,{commitment:t})))==null?void 0:r.blockhash)||(await i.getRecentBlockhash(t)).blockhash}catch{return(await i.getRecentBlockhash(t)).blockhash}}function qo(i,e){i.length<1&&Ei.logWithError(`no instructions provided: ${i.toString()}`),e.length<1&&Ei.logWithError(`no signers provided:, ${e.toString()}`);let t=new Oi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...i);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<_i}catch{return!1}}function Ne(i,e){let[t,n]=Do.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function Lt({instructions:i,payer:e,signers:t}){return qo(i,[e,...t])}function Mt({instructions:i,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Fi.generate().publicKey.toString()}){let o=new _o({payerKey:e,recentBlockhash:n,instructions:i}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Di(o).serialize()).toString("base64").length<_i}catch{return!1}}var Wo=i=>Buffer.isBuffer(i)?i:i instanceof Uint8Array?Buffer.from(i.buffer,i.byteOffset,i.byteLength):Buffer.from(i);function ft(i){let e=[];return i.forEach(t=>{t instanceof Oi&&(t.recentBlockhash||(t.recentBlockhash=vo.toBase58()),t.feePayer||(t.feePayer=Fi.generate().publicKey));let n=t.serialize({requireAllSignatures:!1,verifySignatures:!1});t instanceof Di&&(n=Wo(n));let r=n.toString("base64");e.push(r)}),console.log("simulate tx string:",e),e}import{PublicKey as Wi,AddressLookupTableAccount as cn}from"@solana/web3.js";import{PublicKey as vi}from"@solana/web3.js";import{MINT_SIZE as Vo,TOKEN_PROGRAM_ID as Uo,getTransferFeeConfig as Go,unpackMint as Xo}from"@solana/spl-token";var Dn=de("Raydium_accountInfo_util");async function Ye(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=N({batchRequest:!1},t),s=_n(e,o),a=new Array(s.length).fill([]);if(n){let c=s.map(l=>{let d=i._buildArgs([l.map(f=>f.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),u=_n(c,10);a=(await(await Promise.all(u.map(async l=>await i._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&Dn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(d=>{if(d){let{data:f,executable:g,lamports:p,owner:y,rentEpoch:b}=d;return f.length!==2&&f[1]!=="base64"&&Dn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(f[0],"base64"),executable:g,lamports:p,owner:new vi(y),rentEpoch:b}}return null})))}else try{a=await Promise.all(s.map(c=>i.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&Dn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function ot(i,e,t){let n=await Ye(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>U(N({},r),{accountInfo:n[o]}))}async function qi({connection:i,mints:e,config:t}){var o,s,a;if(e.length===0)return{};let n=await ot(i,e.map(c=>({pubkey:mt(c)})),t),r={};for(let c of n){if(!c.accountInfo||c.accountInfo.data.length<Vo){console.log("invalid mint account",c.pubkey.toBase58());continue}let u=Xo(c.pubkey,c.accountInfo,(o=c.accountInfo)==null?void 0:o.owner);r[c.pubkey.toString()]=U(N({},u),{programId:((s=c.accountInfo)==null?void 0:s.owner)||Uo,feeConfig:(a=Go(u))!=null?a:void 0})}return r[vi.default.toBase58()]=r[$.toBase58()],r}async function vn({connection:i,address:e}){let t=await Ye(i,[...new Set(e.map(r=>r.toString()))].map(r=>new Wi(r))),n={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new cn({key:s,state:cn.deserialize(o.data)});n[s.toString()]=a,un[s.toString()]=a}return n}var un={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new cn({key:new Wi("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:cn.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var ln=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.api=e.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Ho.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=an(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Et.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(N({},t||{})):this.build(t)}build(e){var n;let t=new Ot;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var u;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=r||{},c=o!=null?o:await kt(this.connection,this.blockhashCommitment);if(t.recentBlockhash=c,this.signers.length&&t.sign(...this.signers),ft([t]),(u=this.owner)!=null&&u.isKeyPair)return{txId:a?await qn(this.connection,t,this.signers.find(l=>l.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let m=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:s}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:r}=this.build(n),o=t.filter(m=>m.transaction.instructions.length>0),s=[r,...o.map(m=>m.transaction)],a=[this.signers,...o.map(m=>m.signers)],c=[...this.instructionTypes,...o.map(m=>m.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(m=>{m.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async m=>{var y;let{sequentially:l,onTxUpdate:d,recentBlockHash:f,skipPreflight:g=!0}=m||{},p=f!=null?f:await kt(this.connection,this.blockhashCommitment);if((y=this.owner)!=null&&y.isKeyPair){if(l){let b=[];for(let w of s){let h=await qn(this.connection,w,this.signers.find(A=>A.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});b.push(h)}return{txIds:b,signedTxs:s}}return{txIds:await await Promise.all(s.map(async b=>(b.recentBlockhash=p,await this.connection.sendRawTransaction(b.serialize(),{skipPreflight:g})))),signedTxs:s}}if(this.signAllTransactions){let b=s.map((h,A)=>(h.recentBlockhash=p,a[A].length&&h.sign(...a[A]),h));ft(b);let w=await this.signAllTransactions(b);if(l){let h=0,A=[],k=async()=>{if(!w[h])return;let T=await this.connection.sendRawTransaction(w[h].serialize(),{skipPreflight:g});A.push({txId:T,status:"sent",signedTx:w[h]}),d==null||d([...A]),h++,this.connection.onSignature(T,I=>{let x=A.findIndex(M=>M.txId===T);x>-1&&(A[x].status=I.err?"error":"success"),d==null||d([...A]),I.err||k()},"processed"),this.connection.getSignatureStatus(T)};return await k(),{txIds:A.map(T=>T.txId),signedTxs:w}}else{let h=[];for(let A=0;A<w.length;A+=1){let k=await this.connection.sendRawTransaction(w[A].serialize(),{skipPreflight:g});h.push(k)}return{txIds:h,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var f;let d=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:r}=d,o=wt(d,["lookupTableCache","lookupTableAddress","forerunCreate"]),s=N(N({},this.cluster==="devnet"?{}:un),t),a=Array.from(new Set([...n,...this.lookupTableAddress])),c=[];for(let g of a)s[g]===void 0&&c.push(new Et(g));let u=await vn({connection:this.connection,address:c});for(let[g,p]of Object.entries(u))s[g]=p;let m=new Ft({payerKey:this.feePayer,recentBlockhash:r?Et.default.toBase58():await kt(this.connection,this.blockhashCommitment),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s));((f=this.owner)==null?void 0:f.signer)&&!this.signers.some(g=>g.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let l=new Dt(m);return l.sign(this.signers),{builder:this,transaction:l,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async g=>{var w;let{recentBlockHash:p,skipPreflight:y=!0,sendAndConfirm:b}=g||{};if(p&&(l.message.recentBlockhash=p),ft([l]),(w=this.owner)!=null&&w.isKeyPair){let h=await this.connection.sendTransaction(l,{skipPreflight:y});if(b){let{lastValidBlockHeight:A,blockhash:k}=await this.connection.getLatestBlockhash({commitment:this.blockhashCommitment});await this.connection.confirmTransaction({blockhash:k,lastValidBlockHeight:A,signature:h},"confirmed")}return{txId:h,signedTx:l}}if(this.signAllTransactions){let h=await this.signAllTransactions([l]);return{txId:await this.connection.sendTransaction(h[0],{skipPreflight:y}),signedTx:h[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:r}=await this.buildV0(n),o=t.filter(m=>m.builder.instructions.length>0),s=[r,...o.map(m=>m.transaction)],a=[this.signers,...o.map(m=>m.signers)],c=[...this.instructionTypes,...o.map(m=>m.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(m=>{m.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(m,l)=>{m.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async m=>{var p;let{sequentially:l,onTxUpdate:d,recentBlockHash:f,skipPreflight:g=!0}=m||{};if(f&&s.forEach(y=>y.message.recentBlockhash=f),ft(s),(p=this.owner)!=null&&p.isKeyPair){if(l){let y=[];for(let b of s){let w=await this.connection.sendTransaction(b,{skipPreflight:g}),{lastValidBlockHeight:h,blockhash:A}=await this.connection.getLatestBlockhash({commitment:this.blockhashCommitment});await this.connection.confirmTransaction({blockhash:A,lastValidBlockHeight:h,signature:w},"confirmed"),y.push(w)}return{txIds:y,signedTxs:s}}return{txIds:await Promise.all(s.map(async y=>await this.connection.sendTransaction(y,{skipPreflight:g}))),signedTxs:s}}if(this.signAllTransactions){let y=await this.signAllTransactions(s);if(l){let b=0,w=[],h=async()=>{if(!y[b])return;let A=await this.connection.sendTransaction(y[b],{skipPreflight:g});w.push({txId:A,status:"sent",signedTx:y[b]}),d==null||d([...w]),b++,this.connection.onSignature(A,k=>{let T=w.findIndex(I=>I.txId===A);T>-1&&(w[T].status=k.err?"error":"success"),d==null||d([...w]),k.err||h()},"processed"),this.connection.getSignatureStatus(A)};return h(),{txIds:[],signedTxs:y}}else{let b=[];for(let w=0;w<y.length;w+=1){let h=await this.connection.sendTransaction(y[w],{skipPreflight:g});b.push(h)}return{txIds:b,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var m;let u=e||{},{computeBudgetConfig:t}=u,n=wt(u,["computeBudgetConfig"]),r=t?an(t):{instructions:[],instructionTypes:[]},o=this.signers.reduce((l,d)=>U(N({},l),{[d.publicKey.toBase58()]:d}),{}),s=[],a=[],c=[];if(this.allInstructions.forEach(l=>{let d=[...c,l],f=t?[...r.instructions,...d]:d,p=[...new Set(d.map(y=>y.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat()).values()].map(y=>new Et(y));if(c.length<12&&Lt({instructions:f,payer:this.feePayer,signers:p})||Lt({instructions:d,payer:this.feePayer,signers:p}))c.push(l);else{if(c.length===0)throw Error("item ins too big");Lt({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:p})?s.push(new Ot().add(...r.instructions,...c)):s.push(new Ot().add(...c)),a.push(Array.from(new Set(c.map(y=>y.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat())).map(y=>o[y]).filter(y=>y!==void 0)),c=[l]}}),c.length>0){let d=[...new Set(c.map(f=>f.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(f=>o[f]).filter(f=>f!==void 0);Lt({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:d.map(f=>f.publicKey)})?s.push(new Ot().add(...r.instructions,...c)):s.push(new Ot().add(...c)),a.push(d)}return s.forEach(l=>l.feePayer=this.feePayer),(m=this.owner)!=null&&m.signer&&a.forEach(l=>{l.some(d=>d.publicKey.equals(this.owner.publicKey))||l.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async l=>{var b;let{sequentially:d,onTxUpdate:f,recentBlockHash:g,skipPreflight:p=!0}=l||{},y=g!=null?g:await kt(this.connection,this.blockhashCommitment);if(s.forEach(async(w,h)=>{w.recentBlockhash=y,a[h].length&&w.sign(...a[h])}),ft(s),(b=this.owner)!=null&&b.isKeyPair){if(d){let w=[];for(let h of s){let A=await qn(this.connection,h,this.signers.find(k=>k.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:p});w.push(A)}return{txIds:w,signedTxs:s}}return{txIds:await Promise.all(s.map(async w=>await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:p}))),signedTxs:s}}if(this.signAllTransactions){let w=await this.signAllTransactions(s);if(d){let h=0,A=[],k=async()=>{if(!w[h])return;let T=await this.connection.sendRawTransaction(w[h].serialize(),{skipPreflight:p});A.push({txId:T,status:"sent",signedTx:w[h]}),f==null||f([...A]),h++,this.connection.onSignature(T,I=>{let x=A.findIndex(M=>M.txId===T);x>-1&&(A[x].status=I.err?"error":"success"),f==null||f([...A]),I.err||k()},"processed"),this.connection.getSignatureStatus(T)};return await k(),{txIds:A.map(T=>T.txId),signedTxs:w}}else{let h=[];for(let A=0;A<w.length;A+=1){let k=await this.connection.sendRawTransaction(w[A].serialize(),{skipPreflight:p});h.push(k)}return{txIds:h,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuildV0(e){var b;let y=e||{},{computeBudgetConfig:t,lookupTableCache:n={},lookupTableAddress:r=[]}=y,o=wt(y,["computeBudgetConfig","lookupTableCache","lookupTableAddress"]),s=N(N({},this.cluster==="devnet"?{}:un),n),a=Array.from(new Set([...this.lookupTableAddress,...r])),c=[];for(let w of a)s[w]===void 0&&c.push(new Et(w));let u=await vn({connection:this.connection,address:c});for(let[w,h]of Object.entries(u))s[w]=h;let m=t?an(t):{instructions:[],instructionTypes:[]},l=await kt(this.connection,this.blockhashCommitment),d=this.signers.reduce((w,h)=>U(N({},w),{[h.publicKey.toBase58()]:h}),{}),f=[],g=[],p=[];if(this.allInstructions.forEach(w=>{let h=[...p,w],A=t?[...m.instructions,...h]:h;if(p.length<12&&Mt({instructions:A,payer:this.feePayer,lookupTableAddressAccount:s})||Mt({instructions:h,payer:this.feePayer,lookupTableAddressAccount:s}))p.push(w);else{if(p.length===0)throw Error("item ins too big");let k={};for(let T of[...new Set(a)])s[T]!==void 0&&(k[T]=s[T]);if(t&&Mt({instructions:[...m.instructions,...p],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:l})){let T=new Ft({payerKey:this.feePayer,recentBlockhash:l,instructions:[...m.instructions,...p]}).compileToV0Message(Object.values(s));f.push(new Dt(T))}else{let T=new Ft({payerKey:this.feePayer,recentBlockhash:l,instructions:[...p]}).compileToV0Message(Object.values(s));f.push(new Dt(T))}g.push(Array.from(new Set(p.map(T=>T.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat())).map(T=>d[T]).filter(T=>T!==void 0)),p=[w]}}),p.length>0){let h=[...new Set(p.map(A=>A.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(A=>d[A]).filter(A=>A!==void 0);if(t&&Mt({instructions:[...m.instructions,...p],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:l})){let A=new Ft({payerKey:this.feePayer,recentBlockhash:l,instructions:[...m.instructions,...p]}).compileToV0Message(Object.values(s));f.push(new Dt(A))}else{let A=new Ft({payerKey:this.feePayer,recentBlockhash:l,instructions:[...p]}).compileToV0Message(Object.values(s));f.push(new Dt(A))}g.push(h)}return(b=this.owner)!=null&&b.signer&&g.forEach(w=>{w.some(h=>h.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),{builder:this,transactions:f,buildProps:e,signers:g,instructionTypes:this.instructionTypes,execute:async w=>{var I;let{sequentially:h,onTxUpdate:A,recentBlockHash:k,skipPreflight:T=!0}=w||{};if(f.map(async(x,M)=>{g[M].length&&x.sign(g[M]),k&&(x.message.recentBlockhash=k)}),ft(f),(I=this.owner)!=null&&I.isKeyPair){if(h){let x=[];for(let M of f){let E=await this.connection.sendTransaction(M,{skipPreflight:T}),{lastValidBlockHeight:R,blockhash:j}=await this.connection.getLatestBlockhash({commitment:this.blockhashCommitment});await this.connection.confirmTransaction({blockhash:j,lastValidBlockHeight:R,signature:E},"confirmed"),x.push(E)}return{txIds:x,signedTxs:f}}return{txIds:await Promise.all(f.map(async x=>await this.connection.sendTransaction(x,{skipPreflight:T}))),signedTxs:f}}if(this.signAllTransactions){let x=await this.signAllTransactions(f);if(h){let M=0,E=[],R=async()=>{if(!x[M])return;let j=await this.connection.sendTransaction(x[M],{skipPreflight:T});E.push({txId:j,status:"sent",signedTx:x[M]}),A==null||A([...E]),M++,this.connection.onSignature(j,te=>{let ue=E.findIndex(ne=>ne.txId===j);ue>-1&&(E[ue].status=te.err?"error":"success"),A==null||A([...E]),te.err||R()},"processed"),this.connection.getSignatureStatus(j)};return R(),{txIds:[],signedTxs:x}}else{let M=[];for(let E=0;E<x.length;E+=1){let R=await this.connection.sendTransaction(x[E],{skipPreflight:T});M.push(R)}return{txIds:M,signedTxs:x}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};function _n(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as z}from"@solana/web3.js";var gu=new z("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),bu=new z("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),yu=new z("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),hu=new z("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),wu=new z("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Au=new z("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Tu=new z("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Pu=new z("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ku=new z("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),xu=new z("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Bu=new z("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Iu=new z("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Su=new z("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Cu=new z("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Nu=new z("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Ku=new z("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Ru=new z("8yQvrjQuritLntxz6pAaWcEX6CsRMeDmr7baCLnNwEuw"),Lu=new z("E1oP2yNZXw3dFnUoPygWZPg9u2Gad87VFVPeYWqa6rD6"),Mu=new z("E1oP2yNZXw3dFnUoPygWZPg9u2Gad87VFVPeYWqa6rD6"),jo=new z("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Zo=new z("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Yo=new z("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");var Eu={SERUM_MARKET:z.default,OPENBOOK_MARKET:new z("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:z.default,FarmV3:new z("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new z("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new z("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new z("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new z("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new z("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),Router:new z("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:jo,CREATE_CPMM_POOL_AUTH:Zo,CREATE_CPMM_POOL_FEE_ACC:Yo,FEE_DESTINATION_ID:new z("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import{PublicKey as Qo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Jo}from"@solana/spl-token";function De(i,e,t){return Ne([i.toBuffer(),(t!=null?t:Jo).toBuffer(),e.toBuffer()],new Qo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import _e from"bn.js";var _t=1e4;function fe(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=U(N({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new _e(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===_t){let c=new _e(o.maximumFee.toString());return{amount:i.add(c),fee:c,expirationTime:a}}else{let c=Wn(i.mul(new _e(_t)),new _e(_t-o.transferFeeBasisPoints)),u=new _e(o.maximumFee.toString()),m=c.sub(i).gt(u)?i.add(u):c,l=Wn(m.mul(new _e(o.transferFeeBasisPoints)),new _e(_t)),d=l.gt(s)?s:l;return{amount:m,fee:d,expirationTime:a}}else{let c=Wn(i.mul(new _e(o.transferFeeBasisPoints)),new _e(_t)),u=c.gt(s)?s:c;return{amount:i,fee:u,expirationTime:a}}}function pt(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function Wn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new _e(0))?t.add(new _e(1)):t}import{PublicKey as al}from"@solana/web3.js";import{MintLayout as ul,TOKEN_PROGRAM_ID as ml}from"@solana/spl-token";var Vn=r=>{var o=r,{address:i,programId:e,decimals:t}=o,n=wt(o,["address","programId","decimals"]);return N({chainId:101,address:mt(i).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:n.extensions||{}},n)},Un=i=>i?U(N({},i),{transferFeeConfigAuthority:i.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:i.withdrawWithheldAuthority.toBase58(),withheldAmount:i.withheldAmount.toString(),olderTransferFee:U(N({},i.olderTransferFee),{epoch:i.olderTransferFee.epoch.toString(),maximumFee:i.olderTransferFee.maximumFee.toString()}),newerTransferFee:U(N({},i.newerTransferFee),{epoch:i.newerTransferFee.epoch.toString(),maximumFee:i.newerTransferFee.maximumFee.toString()})}):void 0;var Gn=(...i)=>i.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),vt=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=de(t)}createTxBuilder(e){return this.scope.checkOwner(),new ln({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Gn(e))}logInfo(...e){this.logger.info(Gn(e))}logAndCreateError(...e){let t=Gn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import Ke from"bn.js";var se=new Ke(0),ze=new Ke(1),Qe=new Ke(-1),Ce=new Ke(1).shln(64),mn=new Ke(1).shln(128),Xn=Ce.sub(ze),qt=64,Vi=mn.subn(1),xe=-443636,Be=-xe,st=new Ke("4295048016"),at=new Ke("79226673521066979257578248091"),Pl=new Ke("4295048017"),kl=new Ke("79226673521066979257578248090"),Ui=16,Gi="59543866431248",Xi="184467440737095516",zi="15793534762490258745",dn=new Ke(10).pow(new Ke(6));var Hi={tvl:0,volumeQuote:0,mintAmountA:0,mintAmountB:0,rewardDefaultInfos:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,day:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},week:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},month:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},pooltype:[]},xl=new Ke("18446744073700000000");import W from"bn.js";function fn(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function zn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Hn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Wt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function ji(i,e){return Wt(i,e)?null:zn(i,e)}function Zi(i,e){return Wt(i,e)?null:Hn(i,e)}var Kl=Buffer.from("amm_config","utf8"),$o=Buffer.from("pool","utf8"),es=Buffer.from("pool_vault","utf8"),ts=Buffer.from("pool_reward_vault","utf8"),Yi=Buffer.from("position","utf8"),ns=Buffer.from("tick_array","utf8"),is=Buffer.from("operation","utf8"),rs=Buffer.from("pool_tick_array_bitmap_extension","utf8");function Qi(i,e,t,n,r){return Ne([$o,e.toBuffer(),t.toBuffer(),n.toBuffer(),r.toBuffer()],i)}function jn(i,e,t){return Ne([es,e.toBuffer(),t.toBuffer()],i)}function Ji(i,e,t){return Ne([ts,e.toBuffer(),t.toBuffer()],i)}function Q(i,e,t){return Ne([ns,e.toBuffer(),fn(t)],i)}function gt(i,e,t,n){return Ne([Yi,e.toBuffer(),fn(t),fn(n)],i)}function Re(i,e){return Ne([Yi,e.toBuffer()],i)}function pn(i){return Ne([Buffer.from("metadata","utf8"),Pt.toBuffer(),i.toBuffer()],Pt)}function Vt(i){return Ne([is],i)}function ve(i,e){return Ne([rs,e.toBuffer()],i)}import{PublicKey as qe}from"@solana/web3.js";import ce from"bn.js";import Ts from"bn.js";import{PublicKey as fs}from"@solana/web3.js";import nr,{isBN as ir}from"bn.js";import{bits as Ml,BitStructure as El,blob as os,Blob as Ol,cstr as Fl,f32 as Dl,f32be as _l,f64 as vl,f64be as ql,greedy as Wl,Layout as ss,ns64 as Vl,ns64be as Ul,nu64 as Gl,nu64be as Xl,offset as zl,s16 as Hl,s16be as jl,s24 as Zl,s24be as Yl,s32 as as,s32be as Ql,s40 as Jl,s40be as $l,s48 as em,s48be as tm,s8 as nm,seq as cs,struct as im,Structure as us,u16 as ls,u16be as rm,u24 as om,u24be as sm,u32 as am,u32be as cm,u40 as um,u40be as lm,u48 as mm,u48be as dm,u8 as ms,UInt as ds,union as fm,Union as pm,unionLayoutDiscriminator as gm,utf8 as bm}from"@solana/buffer-layout";var Zn=ss,$i=us;var Yn=ds;var er=ms,xt=ls;var Te=as;var tr=cs;var Le=os;var Ut=class extends Zn{constructor(t,n,r){super(t,r);this.blob=Le(t),this.signed=n}decode(t,n=0){let r=new nr(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new nr(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function ae(i){return new Yn(1,i)}function Je(i){return new Yn(4,i)}function O(i){return new Ut(8,!1,i)}function G(i){return new Ut(16,!1,i)}function rr(i){return new Ut(16,!0,i)}var gn=class extends Zn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function re(i){return new gn(Le(32),e=>new fs(e),e=>e.toBuffer(),i)}function He(i){return new gn(er(),ps,gs,i)}function ps(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function gs(i){return i?1:0}var Qn=class extends $i{decode(e,t){return super.decode(e,t)}};function ee(i,e,t){return new Qn(i,e,t)}function oe(i,e,t){let n,r=typeof e=="number"?e:ir(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=ir(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return tr(i,r,t)}var Jn=14,$e=class{static maxTickInTickarrayBitmap(e){return e*pe*bt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!X.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-X.tickCount(n):t+X.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*pe,c=s/a+512;s<0&&s%a!=0&&c--;let u=Math.abs(c);if(r){let m=e.shln(1024-u-1),l=ji(1024,m);if(l!==null){let d=(u-l-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let m=e.shrn(u),l=Zi(1024,m);if(l!==null){let d=(u+l-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-X.tickCount(n)}}}},Gt=class{static getBitmapOffset(e,t){if(!X.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=$e.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=$e.maxTickInTickarrayBitmap(e),n=-t;if(Be<=t)throw Error(`extensionTickBoundary check error: ${Be}, ${t}`);if(n<=xe)throw Error(`extensionTickBoundary check error: ${n}, ${xe}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:C.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=X.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=$e.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let c=C.mergeTickArrayBitmap(e).shln(bt-1-a),u=Wt(512,c)?null:zn(512,c);if(u!==null){let m=t-u*X.tickCount(n);return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:o}}else{let c=C.mergeTickArrayBitmap(e).shrn(a),u=Wt(512,c)?null:Hn(512,c);if(u!==null){let m=t+u*X.tickCount(n);return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:s-X.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%$e.maxTickInTickarrayBitmap(t),r=Math.floor(n/X.tickCount(t));return e<0&&n!=0&&(r=bt-r),r}};var or=ee([Le(8),ae("bump"),xt("index"),re(""),Je("protocolFeeRate"),Je("tradeFeeRate"),xt("tickSpacing"),oe(O(),8,"")]),bs=ee([Je("blockTimestamp"),G("sqrtPriceX64"),G("cumulativeTimePriceX64"),oe(G(),1,"")]),$n=ee([Le(8),He("initialized"),re("poolId"),oe(bs,1e3,"observations"),oe(G(),5,"")]),ys=ee([ae("rewardState"),O("openTime"),O("endTime"),O("lastUpdateTime"),G("emissionsPerSecondX64"),O("rewardTotalEmissioned"),O("rewardClaimed"),re("tokenMint"),re("tokenVault"),re("creator"),G("rewardGrowthGlobalX64")]),bn=ee([Le(8),ae("bump"),re("ammConfig"),re("creator"),re("mintA"),re("mintB"),re("vaultA"),re("vaultB"),re("observationId"),ae("mintDecimalsA"),ae("mintDecimalsB"),xt("tickSpacing"),G("liquidity"),G("sqrtPriceX64"),Te("tickCurrent"),xt("observationIndex"),xt("observationUpdateDuration"),G("feeGrowthGlobalX64A"),G("feeGrowthGlobalX64B"),O("protocolFeesTokenA"),O("protocolFeesTokenB"),G("swapInAmountTokenA"),G("swapOutAmountTokenB"),G("swapInAmountTokenB"),G("swapOutAmountTokenA"),ae("status"),oe(ae(),7,""),oe(ys,3,"rewardInfos"),oe(O(),16,"tickArrayBitmap"),O("totalFeesTokenA"),O("totalFeesClaimedTokenA"),O("totalFeesTokenB"),O("totalFeesClaimedTokenB"),O("fundFeesTokenA"),O("fundFeesTokenB"),O("startTime"),oe(O(),15*4-3,"padding")]),hs=ee([G("growthInsideLastX64"),O("rewardAmountOwed")]),yn=ee([Le(8),ae("bump"),re("nftMint"),re("poolId"),Te("tickLower"),Te("tickUpper"),G("liquidity"),G("feeGrowthInsideLastX64A"),G("feeGrowthInsideLastX64B"),O("tokenFeesOwedA"),O("tokenFeesOwedB"),oe(hs,3,"rewardInfos"),oe(O(),8,"")]),Dm=ee([Le(8),ae("bump"),re("poolId"),Te("tickLowerIndex"),Te("tickUpperIndex"),G("liquidity"),G("feeGrowthInsideLastX64A"),G("feeGrowthInsideLastX64B"),O("tokenFeesOwedA"),O("tokenFeesOwedB"),oe(G(),3,"rewardGrowthInside"),oe(O(),8,"")]),ws=ee([Te("tick"),rr("liquidityNet"),G("liquidityGross"),G("feeGrowthOutsideX64A"),G("feeGrowthOutsideX64B"),oe(G(),3,"rewardGrowthsOutsideX64"),oe(Je(),13,"")]),Xt=ee([Le(8),re("poolId"),Te("startTickIndex"),oe(ws,pe,"ticks"),ae("initializedTickCount"),oe(ae(),115,"")]),sr=ee([Le(329),oe(re(),100,"whitelistMints")]),ar=ee([Le(8),re("poolId"),oe(oe(O(),8),Jn,"positiveTickArrayBitmap"),oe(oe(O(),8),Jn,"negativeTickArrayBitmap")]);var As=15,X=class{static async getTickArrays(e,t,n,r,o,s,a){let c=[],u=C.getTickArrayStartIndexByTick(r,o),m=C.getInitializedTickArrayInRange(s,a,o,u,Math.floor(As/2));for(let f=0;f<m.length;f++){let{publicKey:g}=Q(t,n,m[f]);c.push(g)}let l=(await Ye(e,c)).map(f=>f!==null?Xt.decode(f.data):null),d={};for(let f=0;f<c.length;f++){let g=l[f];g!==null&&(d[g.startTickIndex]=U(N({},g),{address:c[f]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(u=C.getNextTickArrayStartIndex(u,o,s),this.checkIsValidStartIndex(u,o))throw new Error("No enough initialized tickArray");let m=n[u];if(m===void 0)continue;let{nextTick:l,tickArrayAddress:d,tickArrayStartTickIndex:f}=this.firstInitializedTickInOneArray(e,t,m,s);[a,c,u]=[l,d,f]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/X.tickCount(t)),a=n?C.searchLowBitFromStart(r,o,s-1,1,t):C.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=pe-1;for(;a>=0;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a-1}}else{let a=0;for(;a<pe;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a+1}}let{publicKey:s}=Q(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=C.getTickArrayStartIndexByTick(r,o),c=Math.floor((r-a)/o),u=n[a];if(u==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let m;if(s)for(;c>=0;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){m=d;break}c=c-1}else for(c=c+1;c<pe;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){m=d;break}c=c+1}let{publicKey:l}=Q(e,t,a);return{initializedTick:m,tickArrayAddress:l,tickArrayStartTickIndex:u.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(C.checkIsOutOfBoundary(e)){if(e>Be)return!1;let n=C.getTickArrayStartIndexByTick(xe,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return pe*e}};var pe=60,bt=512,C=class{static getTickArrayAddressByTick(e,t,n,r){let o=C.getTickArrayStartIndexByTick(n,r),{publicKey:s}=Q(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=C.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=pe)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=X.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*X.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*pe,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*pe,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*pe:e+t*pe}static mergeTickArrayBitmap(e){let t=new Ts(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*pe));return[...C.searchLowBitFromStart(e,t,s-1,o,n),...C.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return C.searchHightBitFromStart(e,t,0,bt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=C.getAllInitializedTickArrayStartIndex(n,r,o);for(let c of a){let{publicKey:u}=Q(e,t,c);s.push({tickArrayStartIndex:c,tickArrayAddress:u})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>C.mergeTickArrayBitmap(u)),a=[];for(;n>=-7680;){let u=Math.floor((n+7680)/512),m=(n+7680)%512;if(s[u].testn(m)&&a.push(n),n--,a.length===r)break}let c=X.tickCount(o);return a.map(u=>u*c)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>C.mergeTickArrayBitmap(u)),a=[];for(;n<7680;){let u=Math.floor((n+7680)/512),m=(n+7680)%512;if(s[u].testn(m)&&a.push(n),n++,a.length===r)break}let c=X.tickCount(o);return a.map(u=>u*c)}static checkIsOutOfBoundary(e){return e<xe||e>Be}static nextInitTick(e,t,n,r,o){if(X.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<pe;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=pe-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<pe;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=q.getSqrtPriceX64FromTick(t),o=q.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new S(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new S(1).div(t),o=yt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=q.getSqrtPriceX64FromTick(o),a=q.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new S(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=q.getSqrtPriceX64FromTick(t),o=q.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new S(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new S(1).div(t),o=yt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=q.getSqrtPriceX64FromTick(o),a=q.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new S(1).div(a)}}};import je from"bn.js";var zt=class{static getfeeGrowthInside(e,t,n){let r=new je(0),o=new je(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new je(0),a=new je(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let c=_.wrappingSubU128(_.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),u=_.wrappingSubU128(_.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:c,feeGrowthInsideBX64:u}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=_.mulDivFloor(_.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ce),c=t.tokenFeesOwedA.add(a),u=_.mulDivFloor(_.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ce),m=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:m}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=_.mulDivFloor(_.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ce),c=t.tokenFeesOwedA.add(a),u=_.mulDivFloor(_.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ce),m=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:m}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],m=_.wrappingSubU128(c,u.growthInsideLastX64),l=_.mulDivFloor(m,t.liquidity,Ce),d=u.rewardAmountOwed.add(l);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],m=_.wrappingSubU128(c,u.growthInsideLastX64),l=_.mulDivFloor(m,t.liquidity,Ce),d=u.rewardAmountOwed.add(l);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new je(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new je(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(_.wrappingSubU128(_.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new je(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new je(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(_.wrappingSubU128(_.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var y,b,w,h;let a=q.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),c=q.getSqrtPriceX64FromTick(t.tickLower),u=q.getSqrtPriceX64FromTick(t.tickUpper),m=o?1+r:1-r,l=H.getAmountsFromLiquidity(a,c,u,n,o),[d,f]=[fe(l.amountA,(y=e.mintA.extensions)==null?void 0:y.feeConfig,s,!0),fe(l.amountB,(b=e.mintB.extensions)==null?void 0:b.feeConfig,s,!0)],[g,p]=[fe(new je(new S(l.amountA.toString()).mul(m).toFixed(0)),(w=e.mintA.extensions)==null?void 0:w.feeConfig,s,!0),fe(new je(new S(l.amountB.toString()).mul(m).toFixed(0)),(h=e.mintB.extensions)==null?void 0:h.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:f,amountSlippageA:g,amountSlippageB:p,expirationTime:pt(d.expirationTime,f.expirationTime)}}};import{TOKEN_2022_PROGRAM_ID as cr}from"@solana/spl-token";var ge=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,c=[],{isExist:u,startIndex:m,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,a);if(!u||m===void 0||!l)throw new Error("Invalid tick array");c.push(l);let{allTrade:d,amountCalculated:f,accounts:g,sqrtPriceX64:p,feeAmount:y}=ht.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,m,o,s);return c.push(...g),{allTrade:d,expectedAmountOut:f.mul(Qe),remainingAccounts:c,executionPrice:p,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:c,startIndex:u,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!m)throw new Error("Invalid tick array");try{let p=this.preInitializedTickArrayStartIndex(e,s);if(p.isExist){let{publicKey:y}=Q(e.programId,e.id,p.nextStartIndex);a.push(y)}}catch{}a.push(m);let{amountCalculated:l,accounts:d,sqrtPriceX64:f,feeAmount:g}=ht.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(Qe),u,o);return a.push(...d),{expectedAmountIn:l,remainingAccounts:a,executionPrice:f,feeAmount:g}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=ge.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Gt.checkTickArrayIsInit(X.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):C.checkTickArrayIsInitialized(C.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=Q(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,X.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=Q(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/X.tickCount(e.tickSpacing)),r=t?C.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):C.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=X.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=$e.nextInitializedTickArrayStartIndex(C.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Gt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<xe||t>Be)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,c,u;let s=[];for(let m=0;m<o.length;m++){let l=o[m],d=(u=(a=t.rewardDefaultInfos[m])==null?void 0:a.mint.programId)!=null?u:(c=await e.getAccountInfo(l.tokenMint))==null?void 0:c.owner;if(d===void 0)throw Error("get new reward mint info error");let f=U(N({},l),{perSecond:_.x64ToDecimal(l.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new qe(d)});if(f.tokenMint.equals(qe.default))continue;if(n<=f.openTime.toNumber()||r.eq(se)){s.push(f);continue}let g=new ce(Math.min(f.endTime.toNumber(),n)),p=g.sub(f.lastUpdateTime),y=_.mulDivFloor(p,f.emissionsPerSecondX64,r),b=f.rewardGrowthGlobalX64.add(y),w=_.mulDivFloor(p,f.emissionsPerSecondX64,Ce),h=f.rewardTotalEmissioned.add(w);s.push(U(N({},f),{rewardGrowthGlobalX64:b,rewardTotalEmissioned:h,lastUpdateTime:g}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=C.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=$e.maxTickInTickarrayBitmap(e),n=-t;return t>Be&&(t=X.getArrayStartIndex(Be,e)+X.tickCount(e)),n<xe&&(n=X.getArrayStartIndex(xe,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!X.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/X.tickCount(t)*bt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await ot(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=ar.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let c of t){let u=C.getTickArrayStartIndexByTick(c.tickCurrent,c.tickSpacing),m=C.getInitializedTickArrayInRange(c.tickArrayBitmap,c.exBitmapInfo,c.tickSpacing,u,7);for(let l of m){let{publicKey:d}=Q(c.programId,c.id,l);o.push({pubkey:d}),r[d.toString()]=c.id}}let s=await ot(e,o,{batchRequest:n}),a={};for(let c of s){if(!c.accountInfo)continue;let u=r[c.pubkey.toString()];if(!u)continue;a[u.toString()]===void 0&&(a[u.toString()]={});let m=Xt.decode(c.accountInfo.data);a[u.toString()][m.startTickIndex]=U(N({},m),{address:c.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let c=0;c<e.length;c++){let u=e[c];u!==null&&(s.find(m=>m.equals(u.state.programId))||s.push(u.state.programId))}if(n){let c=n.tokenAccounts.map(d=>d.accountInfo.mint),u=[];for(let d of c)for(let f of s)u.push(Re(f,d).publicKey);let m=await Ye(t,u,{batchRequest:r}),l={};for(let d of m){if(d===null)continue;let f=yn.decode(d.data),g=f.poolId.toString(),p=e.find(x=>x.state.id.toBase58()===g);if(p===void 0)continue;let y=p.state,b=C._getTickPriceLegacy({poolInfo:y,tick:f.tickLower,baseIn:!0}),w=C._getTickPriceLegacy({poolInfo:y,tick:f.tickUpper,baseIn:!0}),{amountA:h,amountB:A}=H.getAmountsFromLiquidity(y.sqrtPriceX64,b.tickSqrtPriceX64,w.tickSqrtPriceX64,f.liquidity,!1),k=1/(1-Math.sqrt(Math.sqrt(b.price.div(w.price).toNumber())));p.positionAccount=[...(a=p.positionAccount)!=null?a:[],{poolId:f.poolId,nftMint:f.nftMint,priceLower:b.price,priceUpper:w.price,amountA:h,amountB:A,tickLower:f.tickLower,tickUpper:f.tickUpper,liquidity:f.liquidity,feeGrowthInsideLastX64A:f.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:f.feeGrowthInsideLastX64B,tokenFeesOwedA:f.tokenFeesOwedA,tokenFeesOwedB:f.tokenFeesOwedB,rewardInfos:f.rewardInfos.map(x=>U(N({},x),{pendingReward:new ce(0)})),leverage:k,tokenFeeAmountA:new ce(0),tokenFeeAmountB:new ce(0)}];let T=await C.getTickArrayAddressByTick(p.state.programId,f.poolId,f.tickLower,p.state.tickSpacing),I=await C.getTickArrayAddressByTick(p.state.programId,f.poolId,f.tickUpper,p.state.tickSpacing);l[`${p.state.programId.toString()}-${f.poolId.toString()}-${f.tickLower}`]=T,l[`${p.state.programId.toString()}-${f.poolId.toString()}-${f.tickUpper}`]=I}if(o){let d=Object.values(l),f=await Ye(t,d,{batchRequest:r}),g={};for(let p=0;p<d.length;p++){let y=f[p];if(y===null)continue;let b=d[p].toString();g[b]=Xt.decode(y.data)}for(let{state:p,positionAccount:y}of e)if(!!y)for(let b of y){let w=`${p.programId.toString()}-${p.id.toString()}-${b.tickLower}`,h=`${p.programId.toString()}-${p.id.toString()}-${b.tickUpper}`,A=g[l[w].toString()],k=g[l[h].toString()],T=A.ticks[C.getTickOffsetInArray(b.tickLower,p.tickSpacing)],I=k.ticks[C.getTickOffsetInArray(b.tickUpper,p.tickSpacing)],{tokenFeeAmountA:x,tokenFeeAmountB:M}=await zt.GetPositionFees(p,b,T,I),E=await zt.GetPositionRewards(p,b,T,I);b.tokenFeeAmountA=x.gte(new ce(0))?x:new ce(0),b.tokenFeeAmountB=M.gte(new ce(0))?M:new ce(0);for(let R=0;R<E.length;R++)b.rewardInfos[R].pendingReward=E[R].gte(new ce(0))?E[R]:new ce(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new S(0),catchLiquidityInsufficient:c=!1}){var j;let u,m=n.toBase58()===e.mintA.address,[l,d]=m?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new S(0))?u=m?st.add(new ce(1)):at.sub(new ce(1)):u=q.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let f=fe(o,l,r,!1),{allTrade:g,expectedAmountOut:p,remainingAccounts:y,executionPrice:b,feeAmount:w}=ge.getOutputAmountAndRemainAccounts(e,t,n,f.amount.sub((j=f.fee)!=null?j:se),u,c),h=fe(p,d,r,!1),A=q.sqrtPriceX64ToPrice(b,e.mintA.decimals,e.mintB.decimals),k=m?A:new S(1).div(A),T=p.mul(new ce(Math.floor((1-s)*1e10))).div(new ce(1e10)),I=fe(T,d,r,!1),x=m?e.currentPrice:new S(1).div(e.currentPrice),M=new S(k).sub(x).abs(),E=x,R=new dt(new S(M).mul(10**15).toFixed(0),new S(E).mul(10**15).toFixed(0));return{allTrade:g,realAmountIn:f,amountOut:h,minAmountOut:I,expirationTime:pt(f.expirationTime,h.expirationTime),currentPrice:e.currentPrice,executionPrice:k,priceImpact:R,fee:w,remainingAccounts:y,executionPriceX64:b}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let c=r.address===e.mintB.address,[u,m]=c?[e.mintA,e.mintB]:[e.mintB,e.mintA],[l,d]=[new Xe(U(N({},u),{mint:u.address,isToken2022:u.programId===cr.toBase58()})),new Xe(U(N({},m),{mint:m.address,isToken2022:m.programId===cr.toBase58()}))],{allTrade:f,realAmountIn:g,amountOut:p,minAmountOut:y,expirationTime:b,currentPrice:w,executionPrice:h,priceImpact:A,fee:k,remainingAccounts:T,executionPriceX64:I}=ge.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new qe(u.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),x=U(N({},g),{amount:new Ae(l,g.amount),fee:g.fee===void 0?void 0:new Ae(l,g.fee)}),M=U(N({},p),{amount:new Ae(d,p.amount),fee:p.fee===void 0?void 0:new Ae(d,p.fee)}),E=U(N({},y),{amount:new Ae(d,y.amount),fee:y.fee===void 0?void 0:new Ae(d,y.fee)}),R=new Fe({baseToken:l,denominator:new ce(10).pow(new ce(20+l.decimals)),quoteToken:d,numerator:w.mul(new S(10**(20+d.decimals))).toFixed(0)}),j=new Fe({baseToken:l,denominator:new ce(10).pow(new ce(20+l.decimals)),quoteToken:d,numerator:h.mul(new S(10**(20+d.decimals))).toFixed(0)}),te=new Ae(l,k);return{allTrade:f,realAmountIn:x,amountOut:M,minAmountOut:E,expirationTime:b,currentPrice:R,executionPrice:j,priceImpact:A,fee:te,remainingAccounts:T,executionPriceX64:I}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var g,p,y;let o=e[t],s=C.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=C.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),c=Math.max(s,o.priceMin),m=Math.min(a,o.priceMax)-c,l=a-s,d=o.priceMax-o.priceMin,f;return m<=0?f=0:l===m?f=d/m:d===m?f=m/l:f=m/d*(m/l),{feeApr:o.feeApr*f,rewardsApr:[((g=o.rewardApr[0])!=null?g:0)*f,((p=o.rewardApr[1])!=null?p:0)*f,((y=o.rewardApr[2])!=null?y:0)*f],apr:o.apr*f}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:c}){let u=n==="day"?1:n==="week"?7:n==="month"?30:0,m=e[n],l=r[mt(e.mintA.address).toString()],d=r[mt(e.mintB.address).toString()],f=e.mintA.decimals,g=e.mintB.decimals;if(!m||!l||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let p=q.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),y=q.getSqrtPriceX64FromTick(s),b=q.getSqrtPriceX64FromTick(a),{amountSlippageA:w,amountSlippageB:h}=H.getAmountsFromLiquidityWithSlippage(p,y,b,t,!1,!1,0),{amountSlippageA:A,amountSlippageB:k}=H.getAmountsFromLiquidityWithSlippage(p,y,b,o,!1,!1,0),T=new S(w.toString()).div(new S(10).pow(f)).mul(l.value).add(new S(h.toString()).div(new S(10).pow(g)).mul(d.value)),I=new S(A.toString()).div(new S(10).pow(f)).mul(l.value).add(new S(k.toString()).div(new S(10).pow(g)).mul(d.value)),x=new S(1).div(T.add(I)),E=new S(m.volumeFee).mul(365).div(u).mul(x).mul(100).toNumber(),R=3600*24*365,j=e.rewardDefaultInfos.map(te=>{var Y,ai;let ue=te.mint.decimals,ne=r[te.mint.address];return c<((Y=te.startTime)!=null?Y:0)||c>((ai=te.endTime)!=null?ai:0)||!te.perSecond||!ne||ue===void 0?0:new S(ne.value).mul(new S(te.perSecond).mul(R)).div(new S(10).pow(ue)).mul(x).mul(100).toNumber()});return{feeApr:E,rewardsApr:j,apr:E+j.reduce((te,ue)=>te+ue,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:c,amountHasFee:u}){var b,w;let m=q.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),l=q.getSqrtPriceX64FromTick(n),d=q.getSqrtPriceX64FromTick(r),f=a?1-s:1+s,g=fe(o,(b=e[t?"mintA":"mintB"].extensions)==null?void 0:b.feeConfig,c,!u),p=new ce(new S(g.amount.sub((w=g.fee)!=null?w:se).toString()).mul(f).toFixed(0)),y;if(m.lte(l))y=t?H.getLiquidityFromTokenAmountA(l,d,p,!a):new ce(0);else if(m.lte(d)){let h=H.getLiquidityFromTokenAmountA(m,d,p,!a),A=H.getLiquidityFromTokenAmountB(l,m,p);y=t?h:A}else y=t?new ce(0):H.getLiquidityFromTokenAmountB(l,d,p);return ge.getAmountsFromLiquidity({epochInfo:c,poolInfo:e,tickLower:n,tickUpper:r,liquidity:y,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var y,b,w,h;let c=q.getSqrtPriceX64FromTick(n),u=q.getSqrtPriceX64FromTick(r),m=a?1+s:1-s,l=H.getAmountsFromLiquidity(q.priceToSqrtPriceX64(new S(t.price),t.mintA.decimals,t.mintB.decimals),c,u,o,a),[d,f]=[fe(l.amountA,(y=t.mintA.extensions)==null?void 0:y.feeConfig,e,!0),fe(l.amountB,(b=t.mintB.extensions)==null?void 0:b.feeConfig,e,!0)],[g,p]=[fe(l.amountA.muln(m),(w=t.mintA.extensions)==null?void 0:w.feeConfig,e,!0),fe(l.amountB.muln(m),(h=t.mintB.extensions)==null?void 0:h.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:f,amountSlippageA:g,amountSlippageB:p,expirationTime:pt(d.expirationTime,f.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(c=>!n[c.id]).map(c=>new qe(c.id));(await Ye(e,r)).forEach((c,u)=>{!c||(n[r[u].toBase58()]=bn.decode(c.data))});let s=t.map(c=>ve(new qe(c.programId),new qe(c.id)).publicKey),a=await ge.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((c,u)=>U(N({},c),{[u.id]:U(N({},n[u.id]),{id:new qe(u.id),version:6,programId:new qe(u.programId),mintA:u.mintA,mintB:u.mintB,ammConfig:U(N({},u.config),{id:new qe(u.config.id),fundOwner:""}),currentPrice:new S(u.price),exBitmapInfo:a[ve(new qe(u.programId),new qe(u.id)).publicKey.toBase58()],startTime:n[u.id].startTime.toNumber()})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var ei={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};function ur(i){return U(N({},i),{type:"Concentrated",programId:i.programId.toString(),id:i.id.toString(),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Clmm",price:i.currentPrice.toNumber(),mintAmountA:0,mintAmountB:0,feeRate:i.ammConfig.tradeFeeRate,tvl:0,day:ei,week:ei,month:ei,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,config:U(N({},i.ammConfig),{id:i.ammConfig.id.toString(),defaultRange:0,defaultRangePoint:[]})})}var _=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(se)||(o=o.add(ze)),o}static mulDivFloor(e,t,n){if(n.eq(se))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(se))throw new Error("division by 0");return e.mul(t).add(n.sub(ze)).div(n)}static x64ToDecimal(e,t){return new S(e.toString()).div(S.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new W(e.mul(S.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(mn).sub(t).mod(mn)}};function ye(i,e){return ti(i.mul(e),64,256)}function Ps(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function ti(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var q=class{static sqrtPriceX64ToPrice(e,t,n){return _.x64ToDecimal(e).pow(2).mul(S.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return _.decimalToX64(e.mul(S.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(se))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(se))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(se))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(se))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(se))return e;let o=t.shln(qt);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?_.mulDivCeil(s,e,a):_.mulDivRoundingUp(s,ze,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return _.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(qt);if(r)return e.add(o.div(t));{let s=_.mulDivRoundingUp(o,ze,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<xe||e>Be)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new W("18445821805675395072"):new W("18446744073709551616");return(t&2)!=0&&(n=ye(n,new W("18444899583751176192"))),(t&4)!=0&&(n=ye(n,new W("18443055278223355904"))),(t&8)!=0&&(n=ye(n,new W("18439367220385607680"))),(t&16)!=0&&(n=ye(n,new W("18431993317065453568"))),(t&32)!=0&&(n=ye(n,new W("18417254355718170624"))),(t&64)!=0&&(n=ye(n,new W("18387811781193609216"))),(t&128)!=0&&(n=ye(n,new W("18329067761203558400"))),(t&256)!=0&&(n=ye(n,new W("18212142134806163456"))),(t&512)!=0&&(n=ye(n,new W("17980523815641700352"))),(t&1024)!=0&&(n=ye(n,new W("17526086738831433728"))),(t&2048)!=0&&(n=ye(n,new W("16651378430235570176"))),(t&4096)!=0&&(n=ye(n,new W("15030750278694412288"))),(t&8192)!=0&&(n=ye(n,new W("12247334978884435968"))),(t&16384)!=0&&(n=ye(n,new W("8131365268886854656"))),(t&32768)!=0&&(n=ye(n,new W("3584323654725218816"))),(t&65536)!=0&&(n=ye(n,new W("696457651848324352"))),(t&131072)!=0&&(n=ye(n,new W("26294789957507116"))),(t&262144)!=0&&(n=ye(n,new W("37481735321082"))),e>0&&(n=Vi.div(n)),n}static getTickFromPrice(e,t,n){return q.getTickFromSqrtPriceX64(q.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(at)||e.lt(st))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new W(t-64),r=Ps(n,32,128),o=new W("8000000000000000","hex"),s=0,a=new W(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new W(0))&&s<Ui;){c=c.mul(c);let g=c.shrn(127);c=c.shrn(63+g.toNumber()),a=a.add(o.mul(g)),o=o.shrn(1),s+=1}let u=a.shrn(32),l=r.add(u).mul(new W(Gi)),d=ti(l.sub(new W(Xi)),64,128).toNumber(),f=ti(l.add(new W(zi)),64,128).toNumber();return d==f?d:q.getSqrtPriceX64FromTick(f).lte(e)?f:d}},yt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=q.getTickFromSqrtPriceX64(q.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=yt.getTickWithPriceAndTickspacing(e,t,n,r),s=q.getSqrtPriceX64FromTick(o);return q.sqrtPriceX64ToPrice(s,n,r)}},H=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(se))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(qt),s=t.sub(e);return r?_.mulDivRoundingUp(_.mulDivCeil(o,s,t),ze,e):_.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(se))throw new Error("sqrtPriceX64A must greater than 0");return r?_.mulDivCeil(n,t.sub(e),Ce):_.mulDivFloor(n,t.sub(e),Ce)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?_.mulDivRoundingUp(a,ze,Xn):a.shrn(qt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),_.mulDivFloor(n,Xn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return H.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=H.getLiquidityFromTokenAmountA(e,n,r,!1),a=H.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return H.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:H.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new W(0)};if(e.lt(n)){let s=H.getTokenAmountAFromLiquidity(e,n,r,o),a=H.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new W(0),amountB:H.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:c,amountB:u}=H.getAmountsFromLiquidity(e,t,n,r,s),m=o?1+a:1-a,l=new W(new S(c.toString()).mul(m).toFixed(0)),d=new W(new S(u.toString()).mul(m).toFixed(0));return{amountSlippageA:l,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:c}){var w,h,A,k;let u=q.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),m=q.getSqrtPriceX64FromTick(t),l=q.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,f=H.getAmountsFromLiquidity(u,m,l,r,s),[g,p]=[fe(f.amountA,(w=e.mintA.extensions)==null?void 0:w.feeConfig,a,c),fe(f.amountB,(h=e.mintB.extensions)==null?void 0:h.feeConfig,a,c)],[y,b]=[fe(new W(new S(f.amountA.toString()).mul(d).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,c),fe(new W(new S(f.amountB.toString()).mul(d).toFixed(0)),(k=e.mintB.extensions)==null?void 0:k.feeConfig,a,c)];return{liquidity:r,amountA:g,amountB:p,amountSlippageA:y,amountSlippageB:b,expirationTime:pt(g.expirationTime,p.expirationTime)}}},ht=class{static swapCompute(e,t,n,r,o,s,a,c,u,m,l,d,f,g,p=!1){if(d.eq(se))throw new Error("amountSpecified must not be 0");if(g||(g=s?st.add(ze):at.sub(ze)),s){if(g.lt(st))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(g.gte(l))throw new Error("sqrtPriceX64 must smaller than current")}else{if(g.gt(at))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(g.lte(l))throw new Error("sqrtPriceX64 must greater than current")}let y=d.gt(se),b={amountSpecifiedRemaining:d,amountCalculated:se,sqrtPriceX64:l,tick:u>f?Math.min(f+X.tickCount(m)-1,u):f,accounts:[],liquidity:c,feeAmount:new W(0)},w=f,h=n[f],A=0,k=!s&&h.startTickIndex===b.tick;for(;!b.amountSpecifiedRemaining.eq(se)&&!b.sqrtPriceX64.eq(g);){A>10;let T={};T.sqrtPriceStartX64=b.sqrtPriceX64;let I=C.nextInitTick(h,b.tick,m,s,k),x=I||null,M=null;if(!(x!=null&&x.liquidityGross.gtn(0))){let R=ge.nextInitializedTickArrayStartIndex({tickCurrent:b.tick,tickSpacing:m,tickArrayBitmap:r,exBitmapInfo:o},w,s);if(!R.isExist){if(p)return{allTrade:!1,amountSpecifiedRemaining:b.amountSpecifiedRemaining,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts};throw Error("swapCompute LiquidityInsufficient")}w=R.nextStartIndex;let{publicKey:j}=Q(e,t,w);M=j,h=n[w];try{x=C.firstInitializedTick(h,s)}catch{throw Error("not found next tick info")}}T.tickNext=x.tick,T.initialized=x.liquidityGross.gtn(0),f!==w&&M&&(b.accounts.push(M),f=w),T.tickNext<xe?T.tickNext=xe:T.tickNext>Be&&(T.tickNext=Be),T.sqrtPriceNextX64=q.getSqrtPriceX64FromTick(T.tickNext);let E;if(s&&T.sqrtPriceNextX64.lt(g)||!s&&T.sqrtPriceNextX64.gt(g)?E=g:E=T.sqrtPriceNextX64,[b.sqrtPriceX64,T.amountIn,T.amountOut,T.feeAmount]=ht.swapStepCompute(b.sqrtPriceX64,E,b.liquidity,b.amountSpecifiedRemaining,a),b.feeAmount=b.feeAmount.add(T.feeAmount),y?(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.sub(T.amountIn.add(T.feeAmount)),b.amountCalculated=b.amountCalculated.sub(T.amountOut)):(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.add(T.amountOut),b.amountCalculated=b.amountCalculated.add(T.amountIn.add(T.feeAmount))),b.sqrtPriceX64.eq(T.sqrtPriceNextX64)){if(T.initialized){let R=x.liquidityNet;s&&(R=R.mul(Qe)),b.liquidity=H.addDelta(b.liquidity,R)}k=T.tickNext!=b.tick&&!s&&h.startTickIndex===T.tickNext,b.tick=s?T.tickNext-1:T.tickNext}else if(b.sqrtPriceX64!=T.sqrtPriceStartX64){let R=q.getTickFromSqrtPriceX64(b.sqrtPriceX64);k=R!=b.tick&&!s&&h.startTickIndex===R,b.tick=R}++A}try{let{nextStartIndex:T,isExist:I}=X.nextInitializedTickArray(b.tick,m,s,r,o);I&&f!==T&&(b.accounts.push(Q(e,t,T).publicKey),f=T)}catch{}return{allTrade:!0,amountSpecifiedRemaining:se,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new W(0),amountIn:new W(0),amountOut:new W(0),feeAmount:new W(0)},a=e.gte(t),c=r.gte(se);if(c){let m=_.mulDivFloor(r,dn.sub(new W(o.toString())),dn);s.amountIn=a?H.getTokenAmountAFromLiquidity(t,e,n,!0):H.getTokenAmountBFromLiquidity(e,t,n,!0),m.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=q.getNextSqrtPriceX64FromInput(e,n,m,a)}else s.amountOut=a?H.getTokenAmountBFromLiquidity(t,e,n,!1):H.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(Qe).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=q.getNextSqrtPriceX64FromOutput(e,n,r.mul(Qe),a);let u=t.eq(s.sqrtPriceX64Next);return a?(u&&c||(s.amountIn=H.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),u&&!c||(s.amountOut=H.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=u&&c?s.amountIn:H.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=u&&!c?s.amountOut:H.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!c&&s.amountOut.gt(r.mul(Qe))&&(s.amountOut=r.mul(Qe)),c&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=_.mulDivCeil(s.amountIn,new W(o),dn.sub(new W(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};import{TOKEN_PROGRAM_ID as Pe,TOKEN_2022_PROGRAM_ID as lt,ASSOCIATED_TOKEN_PROGRAM_ID as br}from"@solana/spl-token";import{PublicKey as B,TransactionInstruction as Ve,SystemProgram as Bt,Keypair as si}from"@solana/web3.js";import yr from"bn.js";import{PublicKey as Cs,Keypair as Ns}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ks}from"@solana/spl-token";import nf from"bn.js";var ks=ee([re("mint"),re("owner"),O("amount"),Je("delegateOption"),re("delegate"),ae("state"),Je("isNativeOption"),O("isNative"),O("delegatedAmount"),Je("closeAuthorityOption"),re("closeAuthority")]);function xs(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function ni(i,...e){if(!xs(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function ii(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function lr(i,e){ni(i);let t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var wn=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),We=(i,e)=>i<<32-e|i>>>e;var Wd=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Bs(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function ri(i){return typeof i=="string"&&(i=Bs(i)),ni(i),i}var hn=class{clone(){return this._cloneInto()}},Vd={}.toString;function mr(i){let e=n=>i().update(ri(n)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function Is(i,e,t,n){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,n);let r=BigInt(32),o=BigInt(4294967295),s=Number(t>>r&o),a=Number(t&o),c=n?4:0,u=n?0:4;i.setUint32(e+c,s,n),i.setUint32(e+u,a,n)}var dr=(i,e,t)=>i&e^~i&t,fr=(i,e,t)=>i&e^i&t^e&t,An=class extends hn{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=wn(this.buffer)}update(e){ii(this);let{view:t,buffer:n,blockLen:r}=this;e=ri(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(r-this.pos,o-s);if(a===r){let c=wn(e);for(;r<=o-s;s+=r)this.process(c,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ii(this),lr(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let l=s;l<r;l++)t[l]=0;Is(n,r-8,BigInt(this.length*8),o),this.process(n,0);let a=wn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,m=this.get();if(u>m.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,m[l],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:o,destroyed:s,pos:a}=this;return e.length=r,e.pos=a,e.finished=o,e.destroyed=s,r%t&&e.buffer.set(n),e}};var Ss=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ct=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ut=new Uint32Array(64),oi=class extends An{constructor(){super(64,32,8,!1),this.A=ct[0]|0,this.B=ct[1]|0,this.C=ct[2]|0,this.D=ct[3]|0,this.E=ct[4]|0,this.F=ct[5]|0,this.G=ct[6]|0,this.H=ct[7]|0}get(){let{A:e,B:t,C:n,D:r,E:o,F:s,G:a,H:c}=this;return[e,t,n,r,o,s,a,c]}set(e,t,n,r,o,s,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=c|0}process(e,t){for(let l=0;l<16;l++,t+=4)ut[l]=e.getUint32(t,!1);for(let l=16;l<64;l++){let d=ut[l-15],f=ut[l-2],g=We(d,7)^We(d,18)^d>>>3,p=We(f,17)^We(f,19)^f>>>10;ut[l]=p+ut[l-7]+g+ut[l-16]|0}let{A:n,B:r,C:o,D:s,E:a,F:c,G:u,H:m}=this;for(let l=0;l<64;l++){let d=We(a,6)^We(a,11)^We(a,25),f=m+d+dr(a,c,u)+Ss[l]+ut[l]|0,p=(We(n,2)^We(n,13)^We(n,22))+fr(n,r,o)|0;m=u,u=c,c=a,a=s+f|0,s=o,o=r,r=n,n=f+p|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,m=m+this.H|0,this.set(n,r,o,s,a,c,u,m)}roundClean(){ut.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var pr=mr(()=>new oi);var af=de("Raydium_Util");function gr({fromPublicKey:i,programId:e=Ks}){let t=Ns.generate().publicKey.toBase58().slice(0,32);return{publicKey:Rs(i,t,e),seed:t}}function Rs(i,e,t){let n=Buffer.concat([i.toBuffer(),Buffer.from(e),t.toBuffer()]),r=pr(n);return new Cs(r)}var hr=de("Raydium_Clmm"),Ue={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},be=class{static createPoolInstruction(e,t,n,r,o,s,a,c,u,m,l,d,f,g){let p=ee([G("sqrtPriceX64"),O("startTime")]),y=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:Bt.programId,isSigner:!1,isWritable:!1},{pubkey:Nt,isSigner:!1,isWritable:!1}],b=Buffer.alloc(p.span);p.encode({sqrtPriceX64:f,startTime:g},b);let w=Buffer.from([...Ue.createPool,...b]);return new Ve({keys:y,programId:e,data:w})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:r,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:c,startTime:u,forerunCreate:m}=e,l=gr({fromPublicKey:r,programId:n}),[d,f]=[new B(o.address),new B(s.address)],g=[Bt.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:l.seed,newAccountPubkey:l.publicKey,lamports:m?0:await t.getMinimumBalanceForRentExemption($n.span),space:$n.span,programId:n})],{publicKey:p}=Qi(n,a,d,f,r),{publicKey:y}=jn(n,p,d),{publicKey:b}=jn(n,p,f);return g.push(this.createPoolInstruction(n,p,r,a,l.publicKey,d,y,new B(o.programId||Pe),f,b,new B(s.programId||Pe),ve(n,p).publicKey,c,u)),{signers:[],instructions:g,instructionTypes:[le.CreateAccount,le.ClmmCreatePool],address:{poolId:p,observationId:l.publicKey,mintAVault:y,mintBVault:b},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,m,l,d,f,g,p,y,b,w,h,A,k,T,I,x,M,E){let R=ee([Te("tickLowerIndex"),Te("tickUpperIndex"),Te("tickArrayLowerStartIndex"),Te("tickArrayUpperStartIndex"),G("liquidity"),O("amountMaxA"),O("amountMaxB"),He("withMetadata"),ae("optionBaseFlag"),He("baseFlag")]),j=[...E?[{pubkey:E,isSigner:!1,isWritable:!0}]:[]],te=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:Nt,isSigner:!1,isWritable:!1},{pubkey:Bt.programId,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:br,isSigner:!1,isWritable:!1},{pubkey:Pt,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...j],ue=Buffer.alloc(R.span);R.encode({tickLowerIndex:w,tickUpperIndex:h,tickArrayLowerStartIndex:A,tickArrayUpperStartIndex:k,liquidity:T,amountMaxA:I,amountMaxB:x,withMetadata:M==="create",baseFlag:!1,optionBaseFlag:0},ue);let ne=Buffer.from([...Ue.openPosition,...ue]);return new Ve({keys:te,programId:e,data:ne})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:m}){let l=[],[d,f]=[new B(e.programId),new B(e.id)],g;if(m)g=new B((await m(1))[0]);else{let x=si.generate();l.push(x),g=x.publicKey}let p=C.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=C.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=Q(d,f,p),{publicKey:w}=Q(d,f,y),{publicKey:h}=De(n.wallet,g,Pe),{publicKey:A}=pn(g),{publicKey:k}=Re(d,g),{publicKey:T}=gt(d,f,r,o),I=this.openPositionFromLiquidityInstruction(d,n.feePayer,f,n.wallet,g,h,A,T,b,w,k,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),r,o,p,y,s,a,c,u);return{signers:l,instructions:[I],instructionTypes:[le.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:g,tickArrayLower:b,tickArrayUpper:w,positionNftAccount:h,metadataAccount:A,personalPosition:k,protocolPosition:T}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:u,getEphemeralSigners:m}){let l=[],[d,f]=[new B(e.programId),new B(e.id)],g;if(m)g=new B((await m(1))[0]);else{let x=si.generate();l.push(x),g=x.publicKey}let p=C.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=C.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=Q(d,f,p),{publicKey:w}=Q(d,f,y),{publicKey:h}=De(n.wallet,g,Pe),{publicKey:A}=pn(g),{publicKey:k}=Re(d,g),{publicKey:T}=gt(d,f,r,o),I=this.openPositionFromBaseInstruction(d,n.feePayer,f,n.wallet,g,h,A,T,b,w,k,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),r,o,p,y,u,s,a,c,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,y])?ve(d,f).publicKey:void 0);return{address:{nftMint:g,tickArrayLower:b,tickArrayUpper:w,positionNftAccount:h,metadataAccount:A,personalPosition:k,protocolPosition:T},instructions:[I],signers:l,instructionTypes:[le.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,m,l,d,f,g,p,y,b,w,h,A,k,T,I,x,M,E){let R=ee([Te("tickLowerIndex"),Te("tickUpperIndex"),Te("tickArrayLowerStartIndex"),Te("tickArrayUpperStartIndex"),G("liquidity"),O("amountMaxA"),O("amountMaxB"),He("withMetadata"),ae("optionBaseFlag"),He("baseFlag")]),j=[...E?[{pubkey:E,isSigner:!1,isWritable:!0}]:[]],te=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:Nt,isSigner:!1,isWritable:!1},{pubkey:Bt.programId,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:br,isSigner:!1,isWritable:!1},{pubkey:Pt,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...j],ue=Buffer.alloc(R.span);R.encode({tickLowerIndex:w,tickUpperIndex:h,tickArrayLowerStartIndex:A,tickArrayUpperStartIndex:k,liquidity:new yr(0),amountMaxA:I==="MintA"?x:M,amountMaxB:I==="MintA"?M:x,withMetadata:T==="create",baseFlag:I==="MintA",optionBaseFlag:1},ue);let ne=Buffer.from([...Ue.openPosition,...ue]);return new Ve({keys:te,programId:e,data:ne})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:m}){let l,d=[];if(m)l=new B((await m(1))[0]);else{let x=si.generate();d.push(x),l=x.publicKey}let[f,g]=[new B(e.programId),new B(e.id)],p=C.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=C.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=Q(f,g,p),{publicKey:w}=Q(f,g,y),{publicKey:h}=De(n.wallet,l,Pe),{publicKey:A}=pn(l),{publicKey:k}=Re(f,l),{publicKey:T}=gt(f,g,r,o),I=this.openPositionFromLiquidityInstruction(f,n.wallet,g,n.wallet,l,h,A,T,b,w,k,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(t.mintA.address),new B(t.mintB.address),r,o,p,y,s,a,c,u,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,y])?ve(f,g).publicKey:void 0);return{address:{nftMint:l,tickArrayLower:b,tickArrayUpper:w,positionNftAccount:h,metadataAccount:A,personalPosition:k,protocolPosition:T},instructions:[I],signers:d,instructionTypes:[le.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=ee([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:Bt.programId,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);s.encode({},c);let u=Buffer.from([...Ue.closePosition,...c]);return new Ve({keys:a,programId:e,data:u})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new B(e.programId),{publicKey:s}=De(n.wallet,r.nftMint,Pe),{publicKey:a}=Re(o,r.nftMint),c=[];return c.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:c,instructionTypes:[le.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,m,l,d,f,g,p,y,b,w){let h=ee([G("liquidity"),O("amountMaxA"),O("amountMaxB"),ae("optionBaseFlag"),He("baseFlag")]),A=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[]],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...A],T=Buffer.alloc(h.span);h.encode({liquidity:p,amountMaxA:y,amountMaxB:b,optionBaseFlag:0,baseFlag:!1},T);let I=Buffer.from([...Ue.increaseLiquidity,...T]);return new Ve({keys:k,programId:e,data:I})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[c,u]=[new B(e.programId),new B(e.id)],m=C.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),l=C.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=Q(c,u,m),{publicKey:f}=Q(c,u,l),{publicKey:g}=De(r.wallet,n.nftMint,Pe),{publicKey:p}=Re(c,n.nftMint),{publicKey:y}=gt(c,u,n.tickLower,n.tickUpper),b=this.increasePositionFromLiquidityInstruction(c,r.wallet,g,p,u,y,d,f,r.tokenAccountA,r.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,l])?ve(c,u).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:g,personalPosition:p,protocolPosition:y},signers:[],instructions:[b],instructionTypes:[le.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[c,u]=[new B(e.programId),new B(e.id)],m=C.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),l=C.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=Q(c,u,m),{publicKey:f}=Q(c,u,l),{publicKey:g}=De(r.wallet,n.nftMint,Pe),{publicKey:p}=Re(c,n.nftMint),{publicKey:y}=gt(c,u,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:g,personalPosition:p,protocolPosition:y},instructions:[this.increasePositionFromBaseInstruction(c,r.wallet,g,p,u,y,d,f,r.tokenAccountA,r.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,l])?ve(c,u).publicKey:void 0)],signers:[],instructionTypes:[le.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,m,l,d,f,g,p,y,b,w){let h=ee([G("liquidity"),O("amountMaxA"),O("amountMaxB"),ae("optionBaseFlag"),He("baseFlag")]),A=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[]],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...A],T=Buffer.alloc(h.span);h.encode({liquidity:new yr(0),amountMaxA:p==="MintA"?y:b,amountMaxB:p==="MintA"?b:y,baseFlag:p==="MintA",optionBaseFlag:1},T);let I=Buffer.from([...Ue.increaseLiquidity,...T]);return new Ve({keys:k,programId:e,data:I})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,c,u,m,l,d,f,g,p,y,b,w,h){let A=ee([G("liquidity"),O("amountMinA"),O("amountMinB")]),k=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[],...p.map(M=>[{pubkey:M.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:M.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:M.rewardMint,isSigner:!1,isWritable:!1}]).flat()],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:tn,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...k],I=Buffer.alloc(A.span);A.encode({liquidity:y,amountMinA:b,amountMinB:w},I);let x=Buffer.from([...Ue.decreaseLiquidity,...I]);return new Ve({keys:T,programId:e,data:x})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:c}){let[u,m]=[new B(e.programId),new B(e.id)],l=C.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=C.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:f}=Q(u,m,l),{publicKey:g}=Q(u,m,d),{publicKey:p}=De(r.wallet,n.nftMint,c),{publicKey:y}=Re(u,n.nftMint),{publicKey:b}=gt(u,m,n.tickLower,n.tickUpper),w=[];for(let A=0;A<e.rewardDefaultInfos.length;A++)w.push({poolRewardVault:new B(t.rewardInfos[A].vault),ownerRewardVault:r.rewardAccounts[A],rewardMint:new B(e.rewardDefaultInfos[A].mint.address)});let h=[];return h.push(this.decreaseLiquidityInstruction(u,r.wallet,p,y,m,b,f,g,r.tokenAccountA,r.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),w,o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,d])?ve(u,m).publicKey:void 0)),{address:{tickArrayLower:f,tickArrayUpper:g,positionNftAccount:p,personalPosition:y,protocolPosition:b},signers:[],instructions:h,instructionTypes:[le.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,c,u,m,l,d,f,g,p,y,b){let w=ee([O("amount"),O("otherAmountThreshold"),G("sqrtPriceLimitX64"),He("isBaseInput")]),h=[...b?[{pubkey:b,isSigner:!1,isWritable:!0}]:[],...l.map(I=>({pubkey:I,isSigner:!1,isWritable:!0}))],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:tn,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},...h],k=Buffer.alloc(w.span);w.encode({amount:f,otherAmountThreshold:g,sqrtPriceLimitX64:p,isBaseInput:y},k);let T=Buffer.from([...Ue.swap,...k]);return new Ve({keys:A,programId:e,data:T})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[m,l]=[new B(e.programId),new B(e.id)],[d,f]=[new B(t.vault.A),new B(t.vault.B)],[g,p]=[new B(e.mintA.address),new B(e.mintB.address)],y=e.mintA.address===o.toString(),b=[this.swapInstruction(m,r.wallet,l,new B(e.config.id),y?r.tokenAccountA:r.tokenAccountB,y?r.tokenAccountB:r.tokenAccountA,y?d:f,y?f:d,y?g:p,y?p:g,u,n,s,a,c,!0,ve(m,l).publicKey)];return{signers:[],instructions:b,instructionTypes:[le.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,c,u,m,l,d){let f=ee([O("openTime"),O("endTime"),G("emissionsPerSecondX64")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Bt.programId,isSigner:!1,isWritable:!1},{pubkey:Nt,isSigner:!1,isWritable:!1}],p=Buffer.alloc(f.span);f.encode({openTime:we(m),endTime:we(l),emissionsPerSecondX64:d},p);let y=Buffer.from([...Ue.initReward,...p]);return new Ve({keys:g,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new B(e.programId),new B(e.id)],a=Ji(o,s,r.mint).publicKey,c=Vt(o).publicKey,u=[this.initRewardInstruction(o,n.wallet,s,c,new B(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:c},signers:[],instructions:u,instructionTypes:[le.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,c,u,m,l,d){let f=ee([ae("rewardIndex"),G("emissionsPerSecondX64"),O("openTime"),O("endTime")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0}],p=Buffer.alloc(f.span);f.encode({rewardIndex:u,emissionsPerSecondX64:d,openTime:we(m),endTime:we(l)},p);let y=Buffer.from([...Ue.setRewardEmissions,...p]);return new Ve({keys:g,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new B(e.programId),new B(e.id)],a,c,u;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,c=new B(t.rewardInfos[d].vault),u=new B(t.rewardInfos[d].mint.address));(a===void 0||c===void 0)&&hr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let m=Vt(o).publicKey,l=[this.setRewardInstruction(o,n.wallet,s,m,new B(e.config.id),n.tokenAccount,c,u,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:c,operationId:m},signers:[],instructions:l,instructionTypes:[le.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let c=ee([ae("rewardIndex")]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:tn,isSigner:!1,isWritable:!1}],m=Buffer.alloc(c.span);c.encode({rewardIndex:a},m);let l=Buffer.from([...Ue.collectReward,...m]);return new Ve({keys:u,programId:e,data:l})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new B(e.programId),new B(e.id)],a,c;for(let m=0;m<e.rewardDefaultInfos.length;m++)e.rewardDefaultInfos[m].mint.address===r.toString()&&(a=m,c=new B(t.rewardInfos[m].vault));(a===void 0||c===void 0)&&hr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let u=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,c,r,a)];return{address:{rewardVault:c},signers:[],instructions:u,instructionTypes:[le.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:r,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:c}){let[u,m]=[new B(e.programId),new B(e.id)],[l,d]=[new B(t.vault.A),new B(t.vault.B)],[f,g]=[new B(e.mintA.address),new B(e.mintB.address)],p=e.mintA.address===r.toString(),y=[this.swapInstruction(u,n.wallet,m,new B(e.config.id),p?n.tokenAccountB:n.tokenAccountA,p?n.tokenAccountA:n.tokenAccountB,p?d:l,p?l:d,p?f:g,p?g:f,c,l,o,s,a,!1)];return{signers:[],instructions:y,instructionTypes:[le.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};import Me from"bn.js";import{AccountLayout as wr,TOKEN_PROGRAM_ID as Ar}from"@solana/spl-token";var Tr=class extends vt{constructor(e){super(e)}async getClmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async createPool(e){var w;let{programId:t,owner:n=((w=this.scope.owner)==null?void 0:w.publicKey)||V.default,mint1:r,mint2:o,ammConfig:s,initialPrice:a,startTime:c,computeBudgetConfig:u,forerunCreate:m,txVersion:l}=e,d=this.createTxBuilder(),[f,g,p]=new Me(new V(r.address).toBuffer()).gt(new Me(new V(o.address).toBuffer()))?[o,r,new S(1).div(a)]:[r,o,a],y=q.priceToSqrtPriceX64(p,f.decimals,g.decimals),b=await be.createPoolInstructions({connection:this.scope.connection,programId:t,owner:n,mintA:f,mintB:g,ammConfigId:s.id,initialPriceX64:y,startTime:c,forerunCreate:m});return d.addInstruction(b),d.addCustomComputeBudget(u),d.versionBuild({txVersion:l,extInfo:{address:U(N({},b.address),{programId:t.toString(),id:b.address.poolId.toString(),mintA:f,mintB:g,vault:{A:b.address.mintAVault.toString(),B:b.address.mintBVault.toString()},rewardInfos:[],config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}}),mockPoolInfo:N({type:"Concentrated",rewardDefaultPoolInfos:"Clmm",id:b.address.poolId.toString(),mintA:f,mintB:g,feeRate:s.tradeFeeRate,programId:t.toString(),price:p.toNumber(),config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}},Hi),forerunCreate:m}})}async openPositionFromBase({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,associatedOnly:u=!0,checkCreateATAOwner:m=!1,withMetadata:l="create",getEphemeralSigners:d,computeBudgetConfig:f,txVersion:g}){this.scope.availability.addConcentratedPosition===!1&&this.logAndCreateError("add position feature disabled in your region"),this.scope.checkOwner();let p=this.createTxBuilder(),y=null,b=null,w=n.useSOLBalance&&e.mintA.address===$.toString(),h=n.useSOLBalance&&e.mintB.address===$.toString(),[A,k]=s==="MintA"?[a,c]:[c,a],{account:T,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new V(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:w||A.isZero()?{payer:this.scope.ownerPubKey,amount:A}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:u,checkCreateATAOwner:m});T&&(y=T),p.addInstruction(I||{});let{account:x,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new V(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:h||k.isZero()?{payer:this.scope.ownerPubKey,amount:k}:void 0,skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:h?!1:u,checkCreateATAOwner:m});x&&(b=x),p.addInstruction(M||{}),(!y||!b)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",{ownerTokenAccountA:y==null?void 0:y.toBase58(),ownerTokenAccountB:b==null?void 0:b.toBase58()});let E=t||await this.getClmmPoolKeys(e.id),R=await be.openPositionFromBaseInstructions({poolInfo:e,poolKeys:E,ownerInfo:U(N({},n),{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b}),tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:l,getEphemeralSigners:d});return p.addInstruction(R),p.addCustomComputeBudget(f),p.versionBuild({txVersion:g,extInfo:R.address})}async openPositionFromLiquidity({poolInfo:e,poolKeys:t,ownerInfo:n,amountMaxA:r,amountMaxB:o,tickLower:s,tickUpper:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:m=!1,withMetadata:l="create",txVersion:d,getEphemeralSigners:f}){this.scope.availability.createConcentratedPosition===!1&&this.logAndCreateError("open position feature disabled in your region");let g=this.createTxBuilder(),p=null,y=null,b=n.useSOLBalance&&e.mintA.address===$.toBase58(),w=n.useSOLBalance&&e.mintB.address===$.toBase58(),{account:h,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new V(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:b||r.isZero()?{payer:this.scope.ownerPubKey,amount:r}:void 0,skipCloseAccount:!b,notUseTokenAccount:b,associatedOnly:b?!1:u,checkCreateATAOwner:m});h&&(p=h),g.addInstruction(A||{});let{account:k,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new V(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||o.isZero()?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:u,checkCreateATAOwner:m});k&&(y=k),g.addInstruction(T||{}),(p===void 0||y===void 0)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let I=t||await this.getClmmPoolKeys(e.id),x=await be.openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:I,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:y},tickLower:s,tickUpper:a,liquidity:c,amountMaxA:r,amountMaxB:o,withMetadata:l,getEphemeralSigners:f});return g.addInstruction(x),g.versionBuild({txVersion:d,extInfo:{address:x.address}})}async increasePositionFromLiquidity(e){let{poolInfo:t,poolKeys:n,ownerPosition:r,amountMaxA:o,amountMaxB:s,liquidity:a,ownerInfo:c,associatedOnly:u=!0,checkCreateATAOwner:m=!1,computeBudgetConfig:l,txVersion:d}=e,f=this.createTxBuilder(),g,p,y=c.useSOLBalance&&t.mintA.address===$.toString(),b=c.useSOLBalance&&t.mintB.address===$.toString(),{account:w,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new V(t.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:y||o.isZero()?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!y,associatedOnly:y?!1:u,checkCreateATAOwner:m});w&&(g=w),f.addInstruction(h||{});let{account:A,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new V(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:b||s.isZero()?{payer:this.scope.ownerPubKey,amount:s}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:u,checkCreateATAOwner:m});A&&(p=A),f.addInstruction(k||{}),!g&&!p&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let T=n!=null?n:await this.getClmmPoolKeys(t.id),I=be.increasePositionFromLiquidityInstructions({poolInfo:t,poolKeys:T,ownerPosition:r,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:g,tokenAccountB:p},liquidity:a,amountMaxA:o,amountMaxB:s});return f.addInstruction(I),f.addCustomComputeBudget(l),f.versionBuild({txVersion:d,extInfo:{address:I.address}})}async increasePositionFromBase(e){let{poolInfo:t,ownerPosition:n,base:r,baseAmount:o,otherAmountMax:s,ownerInfo:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:m,txVersion:l}=e,d=this.createTxBuilder(),f,g,p=a.useSOLBalance&&t.mintA.address===$.toString(),y=a.useSOLBalance&&t.mintB.address===$.toString(),{account:b,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new V(t.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,createInfo:p||(r==="MintA"?o:s).isZero()?{payer:this.scope.ownerPubKey,amount:r==="MintA"?o:s}:void 0,skipCloseAccount:!p,associatedOnly:p?!1:c,checkCreateATAOwner:u});b&&(f=b),d.addInstruction(w||{});let{account:h,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new V(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:y||(r==="MintA"?s:o).isZero()?{payer:this.scope.ownerPubKey,amount:r==="MintA"?s:o}:void 0,notUseTokenAccount:y,skipCloseAccount:!y,associatedOnly:y?!1:c,checkCreateATAOwner:u});h&&(g=h),d.addInstruction(A||{}),!f&&!g&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let k=await this.getClmmPoolKeys(t.id),T=be.increasePositionFromBaseInstructions({poolInfo:t,poolKeys:k,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:g},base:r,baseAmount:o,otherAmountMax:s});return d.addInstruction(T),d.addCustomComputeBudget(m),d.versionBuild({txVersion:l,extInfo:{address:T.address}})}async decreaseLiquidity(e){let{poolInfo:t,poolKeys:n,ownerPosition:r,ownerInfo:o,amountMinA:s,amountMinB:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:m=!1,computeBudgetConfig:l,txVersion:d}=e;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let f=this.createTxBuilder(),g=o.useSOLBalance&&t.mintA.address===$.toString(),p=o.useSOLBalance&&t.mintB.address===$.toString(),y,b,{account:w,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new V(t.mintA.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!g,associatedOnly:g?!1:u,checkCreateATAOwner:m});y=w,h&&f.addInstruction(h);let{account:A,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new V(t.mintB.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!p,associatedOnly:p?!1:u,checkCreateATAOwner:m});b=A,k&&f.addInstruction(k);let T=[];for(let E of t.rewardDefaultInfos){let R=o.useSOLBalance&&E.mint.address===$.toString(),j;if(E.mint.address===t.mintA.address)j=y;else if(E.mint.address===t.mintB.address)j=b;else{let{account:te,instructionParams:ue}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new V(E.mint.programId),mint:new V(E.mint.address),notUseTokenAccount:R,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!R,associatedOnly:R?!1:u,checkCreateATAOwner:m});j=te,ue&&f.addInstruction(ue)}T.push(j)}!y&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccountRawInfos);let I=n!=null?n:await this.getClmmPoolKeys(t.id),x=await be.decreaseLiquidityInstructions({poolInfo:t,poolKeys:I,ownerPosition:r,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b,rewardAccounts:T},liquidity:c,amountMinA:s,amountMinB:a});f.addInstruction({instructions:x.instructions,instructionTypes:[le.ClmmDecreasePosition]});let M=N({},x.address);if(o.closePosition){let E=await be.closePositionInstructions({poolInfo:t,poolKeys:I,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:r});f.addInstruction({endInstructions:E.instructions,endInstructionTypes:E.instructionTypes}),M=N(N({},M),E.address)}return f.addCustomComputeBudget(l),f.versionBuild({txVersion:d,extInfo:{address:M}})}async closePosition({poolInfo:e,poolKeys:t,ownerPosition:n,txVersion:r}){this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let o=this.createTxBuilder(),s=t!=null?t:await this.getClmmPoolKeys(e.id),a=be.closePositionInstructions({poolInfo:e,poolKeys:s,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:n});return o.addInstruction(a).versionBuild({txVersion:r,extInfo:{address:a.address}})}async initReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.address.toString()===$.toString(),m=n.perSecond.mul(n.endTime-n.openTime),{account:l,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new V(n.mint.address),mint:new V(n.mint.address),notUseTokenAccount:!!u,skipCloseAccount:!u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Me(new S(m.toFixed(0)).gte(m)?m.toFixed(0):m.add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:o});d&&c.addInstruction(d),l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let f=await this.getClmmPoolKeys(e.id),g=be.initRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardInfo:{programId:new V(n.mint.programId),mint:new V(n.mint.address),openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:_.decimalToX64(n.perSecond)}});return c.addInstruction(g),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:g.address}})}async initRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:r,associatedOnly:o=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,txVersion:c}){for(let l of r)l.endTime<=l.openTime&&this.logAndCreateError("reward time error","rewardInfo",l);let u=this.createTxBuilder(),m={};for(let l of r){let d=n.useSOLBalance&&l.mint.address===$.toString(),f=l.perSecond.mul(l.endTime-l.openTime),{account:g,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new V(l.mint.programId),mint:new V(l.mint.address),notUseTokenAccount:!!d,skipCloseAccount:!d,owner:this.scope.ownerPubKey,createInfo:d?{payer:n.feePayer||this.scope.ownerPubKey,amount:new Me(new S(f.toFixed(0)).gte(f)?f.toFixed(0):f.add(1).toFixed(0))}:void 0,associatedOnly:d?!1:o,checkCreateATAOwner:s});p&&u.addInstruction(p),g||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let y=t!=null?t:await this.getClmmPoolKeys(e.id),b=be.initRewardInstructions({poolInfo:e,poolKeys:y,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:g},rewardInfo:{programId:new V(l.mint.programId),mint:new V(l.mint.address),openTime:l.openTime,endTime:l.endTime,emissionsPerSecondX64:_.decimalToX64(l.perSecond)}});m=N(N({},m),b.address),u.addInstruction(b)}return u.addCustomComputeBudget(a),u.versionBuild({txVersion:c,extInfo:{address:m}})}async setReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.equals($),{account:m,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.programId,mint:n.mint,notUseTokenAccount:u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Me(new S(n.perSecond.sub(n.endTime-n.openTime).toFixed(0)).gte(n.perSecond.sub(n.endTime-n.openTime))?n.perSecond.sub(n.endTime-n.openTime).toFixed(0):n.perSecond.sub(n.endTime-n.openTime).add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:o});l&&c.addInstruction(l),m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let d=await this.getClmmPoolKeys(e.id),f=be.setRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardInfo:{mint:n.mint,openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:_.decimalToX64(n.perSecond)}});return c.addInstruction(f),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:f.address}})}async setRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:r,associatedOnly:o=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,txVersion:c}){let u=this.createTxBuilder(),m={};for(let l of r){l.endTime<=l.openTime&&this.logAndCreateError("reward time error","rewardInfo",l);let d=n.useSOLBalance&&l.mint.address===$.toString(),{account:f,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new V(l.mint.programId),mint:new V(l.mint.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,createInfo:d?{payer:n.feePayer||this.scope.ownerPubKey,amount:new Me(new S(l.perSecond.sub(l.endTime-l.openTime).toFixed(0)).gte(l.perSecond.sub(l.endTime-l.openTime))?l.perSecond.sub(l.endTime-l.openTime).toFixed(0):l.perSecond.sub(l.endTime-l.openTime).add(1).toFixed(0))}:void 0,associatedOnly:d?!1:o,checkCreateATAOwner:s});g&&u.addInstruction(g),f||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let p=t!=null?t:await this.getClmmPoolKeys(e.id),y=be.setRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:f},rewardInfo:{mint:new V(l.mint.address),openTime:l.openTime,endTime:l.endTime,emissionsPerSecondX64:_.decimalToX64(l.perSecond)}});u.addInstruction(y),m=N(N({},m),y.address)}return u.addCustomComputeBudget(a),u.versionBuild({txVersion:c,extInfo:{address:m}})}async collectReward({poolInfo:e,ownerInfo:t,rewardMint:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=e.rewardDefaultInfos.find(f=>f.mint.address===n.toString());s||this.logAndCreateError("reward mint error","not found reward mint",n);let a=this.createTxBuilder(),c=t.useSOLBalance&&n.equals($),{account:u,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new V(s.mint.programId),mint:n,notUseTokenAccount:c,owner:this.scope.ownerPubKey,skipCloseAccount:!c,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:c?!1:r,checkCreateATAOwner:o});m&&a.addInstruction(m),u||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let l=await this.getClmmPoolKeys(e.id),d=be.collectRewardInstructions({poolInfo:e,poolKeys:l,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:u},rewardMint:n});return a.addInstruction(d),a.build({address:d.address})}async collectRewards({poolInfo:e,ownerInfo:t,rewardMints:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=this.createTxBuilder(),a={};for(let c of n){let u=e.rewardDefaultInfos.find(p=>p.mint.address===c.toString());if(!u){this.logAndCreateError("reward mint error","not found reward mint",c);continue}let m=t.useSOLBalance&&c.equals($),{account:l,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new V(u.mint.programId),mint:c,notUseTokenAccount:m,owner:this.scope.ownerPubKey,skipCloseAccount:!m,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:m?!1:r,checkCreateATAOwner:o});l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos),d&&s.addInstruction(d);let f=await this.getClmmPoolKeys(e.id),g=be.collectRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardMint:c});s.addInstruction(g),a=N(N({},a),g.address)}return s.build({address:a})}async swap({poolInfo:e,poolKeys:t,inputMint:n,amountIn:r,amountOutMin:o,priceLimit:s,observationId:a,ownerInfo:c,remainingAccounts:u,associatedOnly:m=!0,checkCreateATAOwner:l=!1,txVersion:d}){let f=this.createTxBuilder(),g=n.toString()===e.mintA.address,p=c.useSOLBalance&&e.mintA.address===$.toBase58(),y=c.useSOLBalance&&e.mintB.address===$.toBase58(),b;!s||s.equals(new S(0))?b=g?st.add(new Me(1)):at.sub(new Me(1)):b=q.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let w;if(!w){let{account:k,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new V(e.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,skipCloseAccount:!p,createInfo:p||!g?{payer:c.feePayer||this.scope.ownerPubKey,amount:g?r:0}:void 0,associatedOnly:p?!1:m,checkCreateATAOwner:l});w=k,T&&f.addInstruction(T)}let h;if(!h){let{account:k,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new V(e.mintB.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!y,createInfo:y||g?{payer:c.feePayer||this.scope.ownerPubKey,amount:g?0:r}:void 0,associatedOnly:y?!1:m,checkCreateATAOwner:l});h=k,T&&f.addInstruction(T)}(!w||!h)&&this.logAndCreateError("user do not have token account",{tokenA:e.mintA.symbol||e.mintA.address,tokenB:e.mintB.symbol||e.mintB.address,ownerTokenAccountA:w,ownerTokenAccountB:h,mintAUseSOLBalance:p,mintBUseSOLBalance:y,associatedOnly:m});let A=t!=null?t:await this.getClmmPoolKeys(e.id);return f.addInstruction(be.makeSwapBaseInInstructions({poolInfo:e,poolKeys:A,observationId:a,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:w,tokenAccountB:h},inputMint:new V(n),amountIn:r,amountOutMin:o,sqrtPriceLimitX64:b,remainingAccounts:u})),f.versionBuild({txVersion:d})}async harvestAllRewards({allPoolInfo:e,allPositions:t,ownerInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,programId:s,txVersion:a,computeBudgetConfig:c}){let u={};for(let l of this.scope.account.tokenAccountRawInfos)r?De(this.scope.ownerPubKey,l.accountInfo.mint,s).publicKey.equals(l.pubkey)&&(u[l.accountInfo.mint.toString()]=l.pubkey):u[l.accountInfo.mint.toString()]=l.pubkey;let m=this.createTxBuilder();for(let l of Object.values(e)){if(t[l.id]===void 0||!t[l.id].find(h=>!h.liquidity.isZero()||h.rewardInfos.find(A=>!A.rewardAmountOwed.isZero())))continue;let d=l,f=n.useSOLBalance&&d.mintA.address===$.toString(),g=n.useSOLBalance&&d.mintB.address===$.toString(),p=u[d.mintA.address];if(!p){let{account:h,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintA.programId,mint:new V(d.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,skipCloseAccount:!f,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:f?!1:r,checkCreateATAOwner:o});p=h,A&&m.addInstruction(A)}let y=u[d.mintB.address];if(!y){let{account:h,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintB.programId,mint:new V(d.mintB.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,skipCloseAccount:!g,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:g?!1:r,checkCreateATAOwner:o});y=h,A&&m.addInstruction(A)}u[d.mintA.address]=p,u[d.mintB.address]=y;let b=[];for(let h of d.rewardDefaultInfos){let A=n.useSOLBalance&&h.mint.address===$.toString(),k=u[h.mint.address];if(!k){let{account:T,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new V(h.mint.programId),mint:new V(h.mint.address),notUseTokenAccount:A,owner:this.scope.ownerPubKey,skipCloseAccount:!A,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:A?!1:r});k=T,I&&m.addInstruction(I)}u[h.mint.address]=k,b.push(k)}let w=await this.getClmmPoolKeys(d.id);for(let h of t[l.id]){let A=be.decreaseLiquidityInstructions({poolInfo:d,poolKeys:w,ownerPosition:h,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:y,rewardAccounts:b},liquidity:new Me(0),amountMinA:new Me(0),amountMinB:new Me(0)});m.addInstruction(A)}}return a===0?m.sizeCheckBuildV0({computeBudgetConfig:c}):m.sizeCheckBuild({computeBudgetConfig:c})}async getWhiteListMint({programId:e}){let t=await this.scope.connection.getAccountInfo(Vt(e).publicKey);return t?sr.decode(t.data).whitelistMints.filter(r=>!r.equals(V.default)):[]}async getOwnerPositionInfo({programId:e}){await this.scope.account.fetchWalletTokenAccounts();let n=this.scope.account.tokenAccountRawInfos.filter(s=>s.accountInfo.amount.eq(new Me(1))).map(s=>Re(new V(e),s.accountInfo.mint).publicKey),r=await this.scope.connection.getMultipleAccountsInfo(n),o=[];return r.forEach(s=>{if(!s)return;let a=yn.decode(s.data);o.push(a)}),o}async getRpcClmmPoolInfo({poolId:e}){return(await this.getRpcClmmPoolInfos({poolIds:[e]}))[String(e)]}async getRpcClmmPoolInfos({poolIds:e,config:t}){let n=await ot(this.scope.connection,e.map(o=>({pubkey:new V(o)})),t),r={};for(let o=0;o<e.length;o++){let s=n[o];if(s===null||!s.accountInfo)throw Error("fetch pool info error: "+String(e[o]));let a=bn.decode(s.accountInfo.data),c=q.sqrtPriceX64ToPrice(a.sqrtPriceX64,a.mintDecimalsA,a.mintDecimalsB).toNumber();r[String(e[o])]=U(N({},a),{currentPrice:c,programId:s.accountInfo.owner})}return r}async getComputeClmmPoolInfos({clmmPoolsRpcInfo:e,mintInfos:t}){let n=new Set(Object.keys(e).map(c=>e[c].ammConfig.toBase58())),r=await ot(this.scope.connection,Array.from(n).map(c=>({pubkey:new V(c)}))),o={};r.forEach(c=>{!c.accountInfo||(o[c.pubkey.toBase58()]=or.decode(c.accountInfo.data))});let s=await ge.fetchComputeMultipleClmmInfo({connection:this.scope.connection,rpcDataMap:e,poolList:Object.keys(e).map(c=>{var l,d,f,g;let[u,m]=[e[c].mintA.toBase58(),e[c].mintB.toBase58()];return{id:c,programId:e[c].programId.toBase58(),mintA:Vn({address:u,decimals:e[c].mintDecimalsA,programId:t[u].programId.toBase58()||Ar.toBase58(),extensions:{feeConfig:(l=t[u])!=null&&l.feeConfig?Un((d=t[u])==null?void 0:d.feeConfig):void 0}}),mintB:Vn({address:m,decimals:e[c].mintDecimalsB,programId:t[m].programId.toBase58()||Ar.toBase58(),extensions:{feeConfig:(f=t[m])!=null&&f.feeConfig?Un((g=t[m])==null?void 0:g.feeConfig):void 0}}),price:e[c].currentPrice,config:U(N({},o[e[c].ammConfig.toBase58()]),{id:e[c].ammConfig.toBase58(),fundFeeRate:0,description:"",defaultRange:0,defaultRangePoint:[]})}})}),a=await ge.fetchMultiplePoolTickArrays({connection:this.scope.connection,poolKeys:Object.values(s)});return{computeClmmPoolInfo:s,computePoolTickData:a}}async getPoolInfoFromRpc(e){var m;let t=await this.getRpcClmmPoolInfo({poolId:e}),n=new Set([t.mintA.toBase58(),t.mintB.toBase58()]),r=await qi({connection:this.scope.connection,mints:Array.from(n).map(l=>new V(l))}),{computeClmmPoolInfo:o,computePoolTickData:s}=await this.scope.clmm.getComputeClmmPoolInfos({clmmPoolsRpcInfo:{[e]:t},mintInfos:r}),a=await ot(this.scope.connection,[{pubkey:t.vaultA},{pubkey:t.vaultB}]),c=ur(o[e]);if(!a[0].accountInfo||!a[1].accountInfo)throw new Error("pool vault data not found");c.mintAmountA=Number(wr.decode(a[0].accountInfo.data).amount.toString()),c.mintAmountB=Number(wr.decode((m=a[1].accountInfo)==null?void 0:m.data).amount.toString());let u=U(N({},o[e]),{id:e,programId:"8yQvrjQuritLntxz6pAaWcEX6CsRMeDmr7baCLnNwEuw",vault:{A:t.vaultA.toBase58(),B:t.vaultB.toBase58()},rewardInfos:[],config:c.config});return{poolInfo:c,poolKeys:u,computePoolInfo:o[e],tickData:s}}};export{Tr as Clmm};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=clmm.mjs.map